;/*FB_PKG_DELIM*/

__d("BusinessComposerIGAudienceTypes",["$InternalEnum"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum").Mirrored(["IG_AUDIENCE_PUBLIC","IG_AUDIENCE_RESTRICTED"]),s=["SD","CU","IR","SY","KP"];l.BusinessComposerIGAudienceTypes=e,l.UnsupportedIGAudienceCountryList=s}),98);
__d("MediaCancelledPostFlowFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("1743938"),s=o("FalcoLoggerInternal").create("media_cancelled_post_flow",e),u=s;l.default=u}),98);
__d("MediaFailedPostFlowFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("1743939"),s=o("FalcoLoggerInternal").create("media_failed_post_flow",e),u=s;l.default=u}),98);
__d("MediaFinishedPostFlowFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("1743940"),s=o("FalcoLoggerInternal").create("media_finished_post_flow",e),u=s;l.default=u}),98);
__d("MediaStartedPostFlowFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("1743941"),s=o("FalcoLoggerInternal").create("media_started_post_flow",e),u=s;l.default=u}),98);
__d("VideoUploadLoggerEvents",[],(function(t,n,r,o,a,i){"use strict";var e=Object.freeze({EVENT_STARTED_GENERATE_THUMBNAILS:"upload.client.started_generate_thumbnails",EVENT_FINISHED_GENERATE_THUMBNAILS:"upload.client.finished_generate_thumbnails",EVENT_SELECTED_CUSTOM_THUMBNAIL:"upload.client.selected_custom_thumbnail",EVENT_VIDEO_DIMENSIONS_UNREADABLE:"upload.client.video_dimensions_unreadable",EVENT_REPLACE_VIDEO:"upload.client.replace_video",EVENT_STARTED_FLOW:"upload.client.started_flow",EVENT_FINISHED_FLOW:"upload.client.finished_flow",EVENT_FAILED_FLOW:"upload.client.failed_flow",EVENT_CANCELED_FLOW:"upload.client.canceled_flow",EVENT_RESIGNED_FLOW:"upload.client.resigned_flow",EVENT_REQUESTED_UPLOADING:"upload.client.requested_uploading",EVENT_INVALIDATED_UPLOADING:"upload.client.invalidated_uploading",EVENT_STARTED_UPLOADING:"upload.client.started_uploading",EVENT_PROGRESS_UPLOADING_START_REQUEST:"upload.client.progress_uploading_start_request",EVENT_FINISHED_UPLOADING:"upload.client.finished_uploading",EVENT_CANCELED_UPLOADING:"upload.client.canceled_uploading",EVENT_ABANDONED_UPLOADING:"upload.client.abandoned_uploading",EVENT_FAILED_UPLOADING:"upload.client.failed_uploading",EVENT_STARTED_SENDING_BYTES:"upload.client.started_sending_bytes",EVENT_FINISHED_SENDING_BYTES:"upload.client.finished_sending_bytes",EVENT_CANCELED_SENDING_BYTES:"upload.client.canceled_sending_bytes",EVENT_FAILED_SENDING_BYTES:"upload.client.failed_sending_bytes",EVENT_STARTED_START_REQUEST:"upload.client.started_sending_start_request",EVENT_FINISHED_START_REQUEST:"upload.client.finished_sending_start_request",EVENT_FAILED_START_REQUEST:"upload.client.failed_sending_start_request",EVENT_CANCELED_START_REQUEST:"upload.client.canceled_sending_start_request",EVENT_STARTED_RECEIVE_REQUEST:"upload.client.started_sending_receive_request",EVENT_FINISHED_RECEIVE_REQUEST:"upload.client.finished_sending_receive_request",EVENT_FAILED_RECEIVE_REQUEST:"upload.client.failed_sending_receive_request",EVENT_STARTED_POST_REQUEST:"upload.client.started_sending_post_request",EVENT_FINISHED_POST_REQUEST:"upload.client.finished_sending_post_request",EVENT_FAILED_POST_REQUEST:"upload.client.failed_sending_post_request",EVENT_HANDLING_SERVER_FAILURE_RESPONSE:"upload.client.handling_server_failure_response",EVENT_HANDLING_TRANSPORT_FAILURE_RESPONSE:"upload.client.handling_transport_failure_response",EVENT_DUPLICATE_POST_REQUEST:"upload.client.duplicate_post_request",EVENT_STARTED_SENDING_CHUNK_BYTES:"upload.client.started_sending_chunk_bytes",EVENT_FINISHED_SENDING_CHUNK_BYTES:"upload.client.finished_sending_chunk_bytes",EVENT_CANCELED_SENDING_CHUNK_BYTES:"upload.client.canceled_sending_chunk_bytes",EVENT_FAILED_SENDING_CHUNK_BYTES:"upload.client.failed_sending_chunk_bytes",EVENT_TIMEOUT_SENDING_CHUNK_BYTES:"upload.client.timeout_sending_chunk_bytes",EVENT_STARTED_FETCHING_STATUS:"upload.client.started_fetching_status",EVENT_FINISHED_FETCHING_STATUS:"upload.client.finished_fetching_status",EVENT_STARTED_POST_FLOW:"upload.client.started_post_flow",EVENT_FINISHED_POST_FLOW:"upload.client.finished_post_flow",EVENT_CANCELED_POST_FLOW:"upload.client.canceled_post_flow",EVENT_FAILED_POST_FLOW:"upload.client.failed_post_flow",EVENT_RETRY_ATTEMPT:"upload.client.retry_attempt",EVENT_RESUMABLE_CALLED:"upload.client.resumable_called",EVENT_RESUMABLE_STARTED:"upload.client.resumable_started",EVENT_RESUMABLE_SUCCESS:"upload.client.resumable_success",EVENT_RESUMABLE_FAILED:"upload.client.resumable_failed",EVENT_ENCODING_START_OBSERVED:"encode.client.encoding_start_observed",EVENT_ENCODING_SUCCESS_OBSERVED:"encode.client.encoding_success_observed",EVENT_ENCODING_FAIL_OBSERVED:"encode.client.encoding_fail_observed",EVENT_ENCODING_ABORT_OBSERVED:"encode.client.encoding_abort_observed",EVENT_FETCH_FAIL_OBSERVED:"encode.client.fetch_video_info_fail_observed",EVENT_ENCODING_SUBSCRIBE_TO_VIDEO_STATUS:"encode.client.subscribe_to_video_status",EVENT_ENCODING_POLLING_FALLBACK:"encode.client.polling_fallback",EVENT_RECEIVED_RESPONSE:"upload.client.received_response",EVENT_STARTED_FLOW_EXP1:"upload.client.started_flow_exp1",EVENT_FINISHED_FLOW_EXP1:"upload.client.finished_flow_exp1",EVENT_CANCELED_FLOW_EXP1:"upload.client.canceled_flow_exp1",EVENT_MEASURE_FREE_LOCAL_STORAGE:"upload.client.free_local_storage"});i.VideoUploadLoggerEvents=e}),66);
__d("VideoUploadLoggingConfig.experimental",["cr:8923"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:8923")}),98);
__d("MediaUploadCommonWwwFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("1839305"),s=o("FalcoLoggerInternal").create("media_upload_common_www",e),u=s;l.default=u}),98);
__d("VideoComposerDialogVersion",[],(function(t,n,r,o,a,i){var e=Object.freeze({V1:"V1",V2:"V2"});i.default=e}),66);
__d("VideoUploadSourceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({ADS_INTERFACES:"ads_interfaces",DIALOG:"dialog",COMPOSER:"composer",BIZ_COMPOSER:"biz_composer",VIDEO_COMPOSER_V2:"video_composer_v2",ADS_API:"ads_api",API:"api",APP_PROMO_VIDEO:"app_promo_video",APP_GAMEPLAY_VIDEO:"app_gameplay_video",APP_PROMO_VIDEO_AB_TEST:"app_promo_video_ab_test",APP_GAMEPLAY_VIDEO_AB_TEST:"app_gameplay_video_ab_test",APP_PROMO_VIDEO_LANDSCAPE:"app_promo_video_landscape",APP_PROMO_VIDEO_PORTRAIT:"app_promo_video_portrait",APP_PROMO_VIDEO_SQUARE:"app_promo_video_square",APP_GAMEPLAY_VIDEO_LANDSCAPE:"app_gameplay_video_landscape",APP_GAMEPLAY_VIDEO_PORTRAIT:"app_gameplay_video_portrait",APP_GAMEPLAY_VIDEO_SQUARE:"app_gameplay_video_square",ASPERA:"aspera",PIXELCLOUD:"pixelcloud",PROTON:"proton",PLATFORM:"platform",INSTANT_ARTICLE:"instant_article",INSTANT_APPLICATION_PREVIEW:"instant_application_preview",IS_REWARDS_ENABLED:"is_rewards_enabled",POWER_EDITOR:"power_editor",CAMPAIGN_MANAGER:"campaign_manager",CREATE_FLOW:"create_flow",VIDEO_BROADCAST:"video_broadcast",SVE_PIPELINE:"sve_pipeline",ALBUM_UPLOADER:"album_uploader",PROFILE_VIDEO:"profile_video",LEARN_VIDEO:"learn_video",BIRTHDAY_VIDEO:"birthday_video",NUX_MEDIA_TOOL:"nux_media_tool",LIVE_BROADCAST:"live_broadcast",CANVAS:"canvas",DYNAMIC_ITEM_DISPLAY_BUNDLE:"dynamic_item_display_bundle",GOODWILL_VIDEO:"goodwill_video",APP_REVIEW:"app_review",APP_REREVIEW:"app_rereview",APP_REREVIEW_SCREENCAST:"app_rereview_screencast",REFERENCE_FILE_COMPOSER:"reference_file_composer",PRODUCT_EDIT_TOOL:"product_edit_tool",SLIDESHOW:"slideshow",ISSUE_MODULE:"issue_module",TAROT_DIGEST:"tarot_digest",LEARN:"learn",PAGES_COVER_VIDEO:"pages_cover_video",EVENT_TOUR:"event_tour",EVENT_COVER_VIDEO:"event_cover_video",PAGE_TRAILER:"page_trailer",SHOW_VIDEO_LIBRARY:"show_video_library",GMS_HUB_ANNOUCEMENTS:"gms_hub_annoucements",LIVE_CREATIVE_KIT_VIDEO:"live_creative_kit_video",MESSENGER_GROUP_VIDEO:"messenger_group_video",P2P:"p2p",DYNAMIC_ITEM:"dynamic_item",AUDIO_STORY_VIDEO:"audio_story_video",IMAGE_OVERLAY_STORY_VIDEO:"image_overlay_story_video",REACTION_STORY:"inspiration_react_mode",SHOWREEL_VIDEO:"showreel_video",INSPIRATIONS:"inspirations",INSPIRATIONS_DIRECT:"inspirations-direct",BACKSTAGE:"backstage",FUNDRAISER_COVER_VIDEO:"fundraiser_cover_video",THIRD_PARTY_VIDEO:"third_party_video",NEWSFEED_COMPOSER:"newsfeed_composer",COMPPHOTO_GENERATED:"compphoto_generated",SIMPLE:"simple",ATTACH_PHOTOS:"attach_photos",COMMENT:"comment",REPLACE:"replace",PAGE_REVIEW:"page_review",WOODHENGE:"woodhenge",UC_DEMONETIZATION_APPEALS:"uc_demonetization_appeals",CREATOR_STOREFRONT_PERSONALIZED_VIDEO:"creator_storefront_personalized_video",CREATOR_STOREFRONT_PROMOTIONAL_VIDEO:"creator_storefront_promotional_video",PROFILE_FEATURED:"profile_featured",INSTANT_GAMES_DVR:"instant_games_dvr",BCMP_PROFILE_PITCHDECK:"branded_content_profile_pitchdeck",MEDIA_MANAGER_INSTAGRAM_VIDEO_COMPOSER:"media_manager_instagram_video_composer",MEDIA_MANAGER_INSTAGRAM_VIDEO:"media_manager_instagram_video",OCULUS_CREATOR_PORTAL:"oculus_creator_portal",VR_CREATOR_STUDIO:"vr_creator_studio",INSTAGRAM_XPOST:"instagram_xpost",WHATSAPP_XPOST:"whatsapp_xpost",HORIZON_XPOST:"horizon_xpost",PH_XPOST:"ph_xpost",DIM_SUM:"dim_sum",VML_VIDEO_SUPERRES:"vml_video_superres_service",MEDIA_MANAGER_BULK_VIDEO_IMPORTER:"media_manager_bulk_video_importer",MARKETPLACE_COMPOSER:"marketplace_composer",MARKETPLACE_COMPOSER_PRE_RECORDED_VIDEO:"marketplace_composer_pre_recorded_video",SOUND_PLATFORM:"sound_platform",OPTIMISTIC_POST:"optimistic_post",WORKPLACE_KNOWLEDGE_LIBRARY:"workplace_knowledge_library",COPYRIGHT_INGESTION:"copyright_ingestion",CMS_MEDIA_MANAGER:"cms_media_manager",PREMIUM_MUSIC_VIDEO:"premium_music_video",BOOSTED_COMPONENT:"boosted_component",VISUAL_EDITOR:"visual_editor",GIF_LINK:"gif_link",SRT_ATTACHMENT:"srt_attachment",SOUNDBITES_VIDEO:"soundbites_video",VOICES_CREATOR_STUDIO:"voices_creator_studio",VOICES_AUDIO_EMBED:"voices_audio_embed",VOICES_ARTICLE:"voices_article",TPG:"tpg",BUSINESS_CREATIVE_ASSET_MANAGER:"business_creative_asset_manager",STAGES:"stages",RMSI_VIDEO_INGESTION:"rights_manager_scaled_video_ingestion",ASSET_MANAGER:"asset_manager",PAID_CONTENT_DIALOG:"paid_content_dialog",CREATION_ML_PRECREATION:"creation_ml_precreation",PODCAST:"podcast",BUSINESS_OMNI_UPLOADER:"business_omni_uploader",BUSINESS_UNIFIED_CREATIVE_EDITOR:"business_unified_creative_editor",REEL_COMPOSER:"reel_composer",CONTENT_INJECTION:"content_injection",DROPS_SHOPPING_EVENT_PAGE:"drops_shopping_event_page",HORIZON_VIDEO:"horizon_video",PAPER_COMPOSER:"paper_composer",SHOP_BUILDER_VIDEO:"shop_builder_video",PROFESSIONAL_DASHBOARD_AB_TESTING:"professional_dashboard_ab_testing",PROFESSIONAL_DASHBOARD_BULK_UPLOAD:"professional_dashboard_bulk_upload",LIVE_CLIP_VIDEO:"live_clip_video",STARFOX_PLAYGROUND:"starfox_playground",CREATOR_FAN_CHALLENGE:"creator_fan_challenge",COMPOSER_ADS_CANVAS_VIDEO_ASSET_CLONER_FEATURE:"composer_ads_canvas_video_asset_cloner_feature",COMPOSER_ADS_VIDEO_AUTO_CROPPER_FEATURE:"composer_ads_video_auto_cropper_feature",COMPOSER_ADS_VIDEO_CLONE_FEATURE:"composer_ads_video_clone_feature",COMPOSER_ADS_VIDEO_CREATIVE_COMPOSER_FEATURE:"composer_ads_video_creative_composer_feature",COMPOSER_ADS_VIDEO_SLIDESHOW_FEATURE:"composer_ads_video_slideshow_feature",COMPOSER_ADS_VIDEO_SLIDESHOW_VARIATIONS_FEATURE:"composer_ads_video_slideshow_variations_feature",COMPOSER_AUTO_CLIPS_TO_REELS:"composer_auto_clips_to_reels",COMPOSER_AUTOGEN_BACK_CATALOG:"composer_autogen_back_catalog",COMPOSER_BASE_VIDEO_EDIT_FEATURE:"composer_base_video_edit_feature",COMPOSER_BIZWEB_AB_TESTING:"composer_bizweb_ab_testing",COMPOSER_BIZWEB_COMPOSER:"composer_bizweb_composer",COMPOSER_BULK_EDIT_COMPOSER:"composer_bulk_edit_composer",COMPOSER_COMET_REEL_COMPOSER:"composer_comet_reel_composer",COMPOSER_CROSS_POST_FROM_VIDEO_ASSET_OBSERVER_FEATURE:"composer_cross_post_from_video_assset_observer_feature",COMPOSER_CS_AB_TESTING:"composer_cs_ab_testing",COMPOSER_CS_AUTO_GENERATE_FB_SHORTS:"composer_cs_auto_generate_fb_shorts",COMPOSER_CS_BULK_UPLOAD:"composer_cs_bulk_upload",COMPOSER_CS_REEL_COMPOSER:"composer_cs_reel_composer",COMPOSER_GRAPH_API_CLIPPING:"composer_graph_api_clipping",COMPOSER_GRAPH_API_CROSSPOST:"composer_graph_api_crosspost",COMPOSER_GRAPH_API_NON_RESUMABLE:"composer_graph_api_non_resumable",COMPOSER_GRAPH_API_RESUMABLE:"composer_graph_api_resumable",COMPOSER_HORIZON_VIDEO_POST_TO_FB:"composer_horizon_video_post_to_fb",COMPOSER_HZ_STORY_XPOST_TO_FB:"composer_hz_story_xpost_to_fb",COMPOSER_IG_GLADOS_VIDEO_ADS_SHOWREEL:"composer_ig_glados_video_ads_showreel",COMPOSER_IG_REELS_SHARED_TO_FB:"composer_ig_reels_shared_to_fb",COMPOSER_IG_STORY_XPOST_TO_FB:"composer_ig_story_xpost_to_fb",COMPOSER_LIVE_VIDEO_BROADCAST:"composer_live_video_broadcast",COMPOSER_LONG_FORM_VIDEO_TO_PLAYLIST:"composer_long_form_video_to_playlist",COMPOSER_PAGE_SLIDESHOW_FEATURE:"composer_page_slideshow_feature",COMPOSER_PAGE_VIDEO_COMPOSER:"composer_page_video_composer",COMPOSER_PH_STORY_XPOST_TO_FB:"composer_ph_story_xpost_to_fb",COMPOSER_PLAYLIST_COMPOSER:"composer_playlist_composer",COMPOSER_PROFILE_VIDEO_INTRO_CLONER:"composer_profile_video_intro_cloner",COMPOSER_REMOTE_TRIMMER:"composer_remote_trimmer",COMPOSER_STORY_VIDEO_RENDER_FEATURE:"composer_story_video_render_feature",COMPOSER_SVE_SHADOW_CLONE_FEATURE:"composer_sve_shadow_clone_feature",COMPOSER_TEXT_BASED_VIDEO_EDITOR:"composer_text_based_video_editor",COMPOSER_UNIFIED_API_FOR_POST_CREATION_FEATURE:"composer_unified_stories_api_for_post_creation_feature",COMPOSER_UNIFIED_STORIES_VIDEO_CONVERTER:"composer_unified_stories_video_converter",COMPOSER_VIDEO_CLONE_FEATURE:"composer_video_clone_feature",COMPOSER_WA_STORY_XPOST_TO_FB:"composer_wa_story_xpost_to_fb",EXPERIMENT_HQ:"experiment_hq",GROUPS_AI:"groups_ai"});i.default=e}),66);
__d("WorkSharedDraftMode",[],(function(t,n,r,o,a,i){var e=Object.freeze({DRAFTER_CREATING:"drafter_creating",FINAL_AUTHOR_EDITING:"final_author_editing"});i.default=e}),66);
__d("logVideoUploadViaFalco",["FBLogger","MediaUploadCommonWwwFalcoEvent","VideoComposerDialogVersion","VideoUploadSourceType","WorkSharedDraftMode","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("FBLogger")("media_upload","media_upload_common_www")}function s(e){if(e!=null)return String(e)}function u(e){if(e!=null)return e==="false"||e==="0"?!1:!!e}function c(t){try{if(t==null)return;var n;return typeof t=="number"?n=Number.isInteger(t)?t:Math.trunc(t):n=Number.parseInt(String(t),10),Number.isNaN(n)||!Number.isFinite(n)?void 0:String(n)}catch(n){e().catching(r("getErrorSafe")(n)).warn("Value should be integer, but it was not - %s",String(t));return}}function d(e){if(e!=null){var t=Number(e);return Number.isNaN(t)||!Number.isFinite(t)?void 0:t}}function m(e){if(!(e==null||typeof e!="object"))return e}function p(e,t){if(e!=null&&Object.values(t).indexOf(e)>=0)return e}function _(t){var n=s(t.waterfall_id);if(n==null){e().warn("Video upload event cannot be logged due missing waterfall_id: %s",String(t.waterfall_id));return}var o=p(t.source,r("VideoUploadSourceType"));if(o==null){e().warn("Video upload event cannot be logged due missing or invalid source type: %s (original: %s)",String(o),String(t.source));return}var a=s(t.event);if(a==null){e().warn("Video upload event cannot be logged due missing event field: %s",String(t.event));return}var i={waterfall_id:n,source:o,event:a,actor_id:s(t.actor_id),target_id:s(t.target_id),composer_entry_point_ref:s(t.composer_entry_point_ref),container_type:c(t.container_type),is_chunked_upload:u(t.is_chunked_upload),hinted_app_id:s(t.app_id),is_remote_upload:u(t.is_remote_upload),composer_dialog_version:p(t.composer_dialog_version,r("VideoComposerDialogVersion")),composer_work_shared_draft_mode:p(t.composer_work_shared_draft_mode,r("WorkSharedDraftMode")),elapsed_time:c(t.elapsed_time),error:s(t.error),error_inner:s(t.error_inner),error_code:c(t.error_code),error_description:s(t.error_description),error_summary:s(t.error_summary),error_trace:s(t.error_trace),source_height:c(t.source_height),source_width:c(t.source_width),duration:c(t.duration),file_size:c(t.file_size),has_file_been_replaced:u(t.has_file_been_replaced),composer_session_id:s(t.composer_session_id),retries:c(t.retries),server_retries:c(t.server_retries),asset_id:s(t.asset_id),file_can_read:u(t.file_can_read),application_state:s(t.application_state),upload_method:s(t.upload_method),upload_domain:s(t.upload_domain),hash:s(t.hash),hash_time:c(t.hash_time),hash_exception:s(t.hash_exception),video_id:s(t.video_id),upload_speed:d(t.upload_speed),skip_upload:u(t.skip_upload),trigger_time:s(t.trigger_time),ad_account_id:s(t.ad_account_id),video_original_file_path:s(t.video_original_file_path),event_reason:s(t.event_reason),retry_id:s(t.retry_id),internet_status:s(t.internet_status),network_status:s(t.network_status),is_spherical:u(t.is_spherical),file_extension:s(t.file_extension),sent_bytes:c(t.sent_bytes),start_offset:c(t.start_offset),transport_retries:c(t.transport_retries),timeout_retries:c(t.timeout_retries),request_manager_state:s(t.request_manager_state),debug:m(t.debug),creative_tools:s(t.creative_tools)};r("MediaUploadCommonWwwFalcoEvent").logCritical(function(){return i})}l.default=_}),98);
__d("VideoUploadLogger",["Banzai","CurrentUser","VideoUploadLoggerEvents","VideoUploadLoggingConfig.experimental","logVideoUploadViaFalco"],(function(t,n,r,o,a,i,l){var e,s=babelHelpers.extends({BANZAI_GK:"videos",BANZAI_ROUTE:"video_waterfall",SOURCE_SIMPLE:"simple",SOURCE_COMPOSER:"composer"},(e=o("VideoUploadLoggerEvents")).VideoUploadLoggerEvents),u=new Set([e.VideoUploadLoggerEvents.EVENT_STARTED_FLOW,e.VideoUploadLoggerEvents.EVENT_FINISHED_FLOW,e.VideoUploadLoggerEvents.EVENT_FAILED_FLOW,e.VideoUploadLoggerEvents.EVENT_CANCELED_FLOW]),c=(function(){function e(t){this.$1=t.source,this.$2=t.composer_dialog_version,this.$3=t.waterfall_id,this.$4=t.ad_account_id,this.$5=t.target_id,this.$6=t.delay,this.$7=[],this.$8=t.is_chunked_upload,this.$9=t.actor_id,this.$10=t.composer_entry_point_ref,this.$11=t.composer_work_shared_draft_mode,this.$12=t.is_remote_upload,this.$13=t.container_type,this.$14=t.has_file_been_replaced,this.$15=t.composer_session_id,this.$16=t.creative_tools,this.$17=t.asset_id,this.$18=r("CurrentUser").getAppID(),this.$19=!t.reported_by_notifier&&e.shouldSendFlowEventsViaNotifier({source_type:t.source,composer_entry_point_ref:t.composer_entry_point_ref})}e.shouldSendFlowEventsViaNotifier=function(t){return!!(r("VideoUploadLoggingConfig.experimental").FLOW_VIA_NOTIFIER_COMPOSERS||[]).find(function(e){return e.source_type===t.source_type&&e.composer_entry_point_ref===t.composer_entry_point_ref})};var t=e.prototype;return t.logEvent=function(t,n){if(!(this.$19&&u.has(t))){var e=babelHelpers.extends({},n);e.elapsed_time==null&&(t.indexOf("started")!==-1?this.$7[t]=Date.now():t.indexOf("finished")!==-1?e.elapsed_time=this.$20(t,"finished"):t.indexOf("canceled")!==-1?e.elapsed_time=this.$20(t,"canceled"):t.indexOf("failed")!==-1&&(e.elapsed_time=this.$20(t,"failed"))),e.event=t,e.source=this.$1,e.composer_dialog_version=e.composer_dialog_version||this.$2,e.waterfall_id=this.$3,e.ad_account_id=this.$4,e.target_id=this.$5,e.is_chunked_upload=this.$8,e.actor_id=this.$9,e.composer_entry_point_ref=this.$10,e.composer_work_shared_draft_mode=this.$11,e.is_remote_upload=this.$12,e.container_type=this.$13,e.has_file_been_replaced=this.$14,e.trigger_time=Date.now(),e.composer_session_id=this.$15,e.asset_id=this.$17,e.app_id=this.$18,r("logVideoUploadViaFalco")(e)}},t.postOnShutdown=function(t){return r("Banzai").subscribe(r("Banzai").SHUTDOWN,t)},t.getWaterfallID=function(){return this.$3},t.$20=function(t,n){var e=t.replace(n,"started"),r=this.$7[e];return r?Date.now()-r:null},e})();Object.assign(c,s);var d=c;l.default=d}),98);
__d("VideoUploadLoggerTyped",["VideoUploadLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){return e.call(this,t)||this}return babelHelpers.inheritsLoose(t,e),t})(r("VideoUploadLogger"));l.VideoUploadLogger=e}),98);
__d("VideoUploadFlowNotifier",["Banzai","MediaCancelledPostFlowFalcoEvent","MediaFailedPostFlowFalcoEvent","MediaFinishedPostFlowFalcoEvent","MediaStartedPostFlowFalcoEvent","Run","SubscriptionsHandler","VideoUploadLoggerEvents","VideoUploadLoggerTyped","WaterfallIDGenerator"],(function(t,n,r,o,a,i,l){"use strict";var e=Object.freeze({SUCCESSFUL:"successful",FAILED:"failed",CANCELED:"canceled",REQUESTED:"requested",STARTED:"started"}),s=(function(){function t(){this.$1={}}var n=t.prototype;return n.registerUpload=function(t,n){var e={isStarted:!1,isUploaded:!1,isCanceled:!1,isFailed:!1};this.$1[String(n)]=e,t.subscribe("upload-started",function(){e.isStarted=!0}),t.subscribe("upload-canceled",function(){e.isCanceled=!0}),t.subscribe("upload-failed",function(){e.isFailed=!0}),t.subscribe("upload-finished",function(){e.isUploaded=!0})},n.cancelUpload=function(t){var e=this.$1[String(t)];e!=null&&(e.isCanceled=!0)},n.$2=function(n){return n.isCanceled?e.CANCELED:n.isUploaded?e.SUCCESSFUL:n.isFailed?e.FAILED:n.isStarted?e.STARTED:e.REQUESTED},n.areAnyVideosIncludedInPost=function(){var t=this,n=Object.keys(this.$1).map(function(e){return t.$2(t.$1[e])});return n.some(function(t){return t!==e.CANCELED})},n.getSummary=function(){var t=this,n=Object.keys(this.$1).map(function(e){return t.$2(t.$1[e])});return{total:n.length,successful:n.filter(function(t){return t===e.SUCCESSFUL}).length,started:n.filter(function(t){return t===e.STARTED}).length,canceled:n.filter(function(t){return t===e.CANCELED}).length,failed:n.filter(function(t){return t===e.FAILED}).length}},t})(),u=(function(){function e(){}var t=e.prototype;return t.logFlowStarted=function(){},t.logFlowFinished=function(){},t.logFlowCanceled=function(){},t.logFlowFailed=function(){},t.release=function(){},e})(),c=(function(){function e(e,t){var n=this;this.$2=t,this.$1=e,this.$4=new Set,this.$3=new(r("SubscriptionsHandler")),e.cancel_on_unload&&this.$3.addSubscriptions(r("Banzai").subscribe(r("Banzai").SHUTDOWN,function(){return n.$6("shutdown")})),e.cancel_on_leave&&this.$3.addSubscriptions(o("Run").onLeave(function(){return n.$6("leave")}))}var t=e.prototype;return t.release=function(){this.$3.release()},t.$7=function(){var e=this.$2.getSummary(),t=this.$5;return{composer_session_id:this.$1.composer_session_id,source_type:this.$1.source,target_id:this.$1.target_id,target_type:this.$1.target_type,composer_entry_point_ref:this.$1.composer_entry_point_ref,total_uploads:e.total,started_uploads:e.started,successful_uploads:e.successful,canceled_uploads:e.canceled,failed_uploads:e.failed,elapsed_time:t!=null?Date.now()-t:null}},t.logFlowFinished=function(){var e=this;this.$4.has(r("MediaFinishedPostFlowFalcoEvent"))||(r("MediaFinishedPostFlowFalcoEvent").log(function(){return e.$7()}),this.$4.add(r("MediaFinishedPostFlowFalcoEvent")))},t.logFlowStarted=function(){var e=this;this.$4.has(r("MediaStartedPostFlowFalcoEvent"))||(r("MediaStartedPostFlowFalcoEvent").log(function(){return e.$7()}),this.$5=Date.now(),this.$4.add(r("MediaStartedPostFlowFalcoEvent")))},t.logFlowCanceled=function(){this.$6("user")},t.logFlowFailed=function(){var e=this;this.$4.has(r("MediaFailedPostFlowFalcoEvent"))||(r("MediaFailedPostFlowFalcoEvent").log(function(){return e.$7()}),this.$4.add(r("MediaFailedPostFlowFalcoEvent")))},t.$6=function(t){var e=this;this.$4.has(r("MediaCancelledPostFlowFalcoEvent"))||(r("MediaCancelledPostFlowFalcoEvent").log(function(){return babelHelpers.extends({},e.$7(),{event_reason:t})}),this.$4.add(r("MediaCancelledPostFlowFalcoEvent")))},e})(),d=(function(){function e(e,t){var n=this;this.$1=t,this.$3=new Set,this.$4=new(o("VideoUploadLoggerTyped")).VideoUploadLogger({source:e.source,waterfall_id:e.composer_session_id,composer_session_id:e.composer_session_id,target_id:e.target_id,composer_entry_point_ref:e.composer_entry_point_ref,reported_by_notifier:!0}),this.$2=new(r("SubscriptionsHandler")),this.$2.addSubscriptions(this.$4.postOnShutdown(function(){return n.$5("shutdown")})),e.cancel_on_leave&&this.$2.addSubscriptions(o("Run").onLeave(function(){return n.$5("leave")}))}var t=e.prototype;return t.release=function(){this.$2.release()},t.logFlowFinished=function(){this.$6(o("VideoUploadLoggerEvents").VideoUploadLoggerEvents.EVENT_FINISHED_FLOW)},t.logFlowStarted=function(){this.$6(o("VideoUploadLoggerEvents").VideoUploadLoggerEvents.EVENT_STARTED_FLOW)},t.logFlowCanceled=function(){this.$5("user")},t.logFlowFailed=function(){this.$6(o("VideoUploadLoggerEvents").VideoUploadLoggerEvents.EVENT_FAILED_FLOW)},t.$6=function(t,n){if(!this.$3.has(t)){var e=this.$1.getSummary();this.$4.logEvent(t,babelHelpers.extends({},n,{debug:{total_uploads:e.total,started_uploads:e.started,successful_uploads:e.successful,canceled_uploads:e.canceled,failed_uploads:e.failed}})),this.$3.add(t)}},t.$5=function(t){this.$6(o("VideoUploadLoggerEvents").VideoUploadLoggerEvents.EVENT_CANCELED_FLOW,{event_reason:t})},e})(),m=Object.freeze({UPLOAD_USER_REMOVED:"upload_removed"}),p=Object.freeze({POST_USER_CANCELED:"post_user_canceled",POST_USER_REQUESTED:"post_user_requested",POST_FAILED:"post_failed",POST_SUCCESSFUL:"post_successful"});function _(e){return e==null?o("WaterfallIDGenerator").generate():e}function f(e){return e.extended_flow_logging_enabled?new h(e):g.getInstance()}var g=(function(){function e(){}e.getInstance=function(){return e.$1};var t=e.prototype;return t.registerVideoUpload=function(t,n){return _(n)},t.notifyOnUploadAction=function(t){},t.notifyOnPostAction=function(t){},e})();g.$1=new g;var h=(function(){function e(e){this.$3=e,this.$5=new s,this.$2=new u,this.$1=!1,this.$4=e.composer_session_id==null?o("WaterfallIDGenerator").generate():e.composer_session_id}var t=e.prototype;return t.$6=function(){var e=o("VideoUploadLoggerTyped").VideoUploadLogger.shouldSendFlowEventsViaNotifier({source_type:this.$3.source,composer_entry_point_ref:this.$3.composer_entry_point_ref}),t=e?d:c;return new t({composer_entry_point_ref:this.$3.composer_entry_point_ref,source:this.$3.source,target_id:this.$3.target_id,target_type:this.$3.target_type,composer_session_id:this.$4,cancel_on_leave:this.$3.cancel_on_leave,cancel_on_unload:this.$3.cancel_on_unload==null?!0:this.$3.cancel_on_unload},this.$5)},t.registerVideoUpload=function(t,n){var e=_(n);return t.setComposerSessionID(this.$4),this.$5.registerUpload(t,e),e},t.notifyOnUploadAction=function(t){switch(t.action){case m.UPLOAD_USER_REMOVED:this.$5.cancelUpload(t.trackingID);break}},t.notifyOnPostAction=function(t){switch(t.action){case p.POST_USER_REQUESTED:!this.$1&&this.$5.areAnyVideosIncludedInPost()&&(this.$2=this.$6(),this.$1=!0),this.$2.logFlowStarted();break;case p.POST_FAILED:this.$2.logFlowFailed(),this.$2.release();break;case p.POST_SUCCESSFUL:this.$2.logFlowFinished(),this.$2.release(),this.$2=new u;break;case p.POST_USER_CANCELED:this.$2.logFlowCanceled(),this.$2.release();break}},e})();l.VideoUploadActions=m,l.VideoPostActions=p,l.createVideoUploadFlowNotifier=f,l.NoOpVideoUploadFlowNotifier=g}),98);
__d("VideoUploadSurface",["$InternalEnum","VideoUploadFlowNotifier","WaterfallIDGenerator"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({JEST_TESTS:"jest_tests",COMMENTS:"comments",FEED:"feed"}),s=(function(){function e(e){this.$1={},this.$2=e}var t=e.prototype;return t.getByID=function(t){return this.$1[t]},t.getExistingOrNoOpByID=function(t){var e=this.getByID(t);return e==null?this.$2.noOpProvider():e},t.register=function(t,n){var e=n==null?o("WaterfallIDGenerator").generate():n;return this.$1[e]=t,e},t.clear=function(t){this.$1[t]=void 0},e})(),u=(function(){function e(){this.$2=new s({noOpProvider:function(){return o("VideoUploadFlowNotifier").NoOpVideoUploadFlowNotifier.getInstance()}})}e.getOrCreate=function(n){var t=e.$1[n];return t==null&&(t=new e,e.$1[n]=t),t};var t=e.prototype;return t.notifiers=function(){return this.$2},e})();u.$1={},l.VideoUploadSurfaceIDs=e,l.VideoUploadSurface=u}),98);
__d("MediaUploadAssetEvent",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["ASSET_ADDED","ASSET_STARTED","ASSET_REMOVED","ASSET_FAILED","ASSET_SUCCEED","ASSET_PROGRESS","ASSET_STALL"]),l=e;i.default=l}),66);
__d("MediaUploadClientEvent",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["CLIENT_CREATED","CLIENT_CONFIG_REQUESTED","CLIENT_CONFIG_RECEIVED","CLIENT_CONFIG_FAILED","CLIENT_CONFIG_CACHED","CLIENT_INTERNET_ONLINE","CLIENT_INTERNET_OFFLINE","CLIENT_INTERNET_UNKNOWN"]),l=e;i.default=l}),66);
__d("MediaUploadEntryPointID",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){this.key=t};i.default=e}),66);
__d("MediaUploadFBEntryPointID",["MediaUploadEntryPointID"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var r;return r=e.call(this,t+"\\"+n)||this,r.sourceType=t,r.entryPointRef=n,r}return babelHelpers.inheritsLoose(t,e),t.castOrThrow=function(n,r){var e=r.createThrowableError;if(n instanceof t)return n;var o;throw e('Provided entry point ID has incorrect type of "'+((o=n.constructor)==null?void 0:o.name)+'"')},t})(r("MediaUploadEntryPointID"));l.default=e}),98);
__d("MediaUploadAsset",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.mediaType=e.mediaType,this.data=e.data}var t=e.prototype;return t.dataAsFile=function(){var e=this.data;return e.mode==="File"?e:null},t.dataAsHTMLInput=function(){var e=this.data;return e.mode==="HTMLInput"?e:null},e})();i.default=e}),66);
__d("MediaUploadMediaType",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["VIDEO"]),l=e;i.default=l}),66);
__d("MediaUploadTime",[],(function(t,n,r,o,a,i){"use strict";var e=1e3,l=e*60,s=l*60;function u(e){return e}function c(t){return t*e}function d(e){return e*l}function m(e){return e*s}function p(e){return e}function _(t){return 1*t/e}function f(e){return 1*e/l}function g(e){return 1*e/s}function h(e,t){return e==null?null:t(e)}function y(e){return h(e,p)}function C(e){return h(e,_)}function b(e){return h(e,f)}function v(e){return h(e,g)}function S(e,t){return e+t}function R(e,t){return e-t}function L(e,t){return e<t?-1:e>t?1:0}i.millisecondsToTime=u,i.secondsToTime=c,i.minutesToTime=d,i.hoursToTime=m,i.timeToMilliseconds=p,i.timeToSeconds=_,i.timeToMinutes=f,i.timeToHours=g,i.maybeTimeToMilliseconds=y,i.maybeTimeToSeconds=C,i.maybeTimeToMinutes=b,i.maybeTimeToHours=v,i.addTime=S,i.subtractTime=R,i.compareTime=L}),66);
__d("MediaUploadAssetFactory",["MediaUploadAsset","MediaUploadMediaType","MediaUploadTime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e==null)return null;var t=/\.([^.]+)$/.exec(e);return t==null||t.length<2?null:t[1]}var s=(function(){function t(e){var t=e.features;this.$1=t}var n=t.prototype;return n.$2=function(n){return{mode:"File",file:n,lastModified:o("MediaUploadTime").millisecondsToTime(n.lastModified),name:n.name,size:n.size,mimeType:n.type,extension:e(n.name)}},n.$3=function(n){return{mode:"HTMLInput",inputElement:n,name:n.value,extension:e(n.value)}},n.createFromFile=function(t,n){return n===void 0&&(n=r("MediaUploadMediaType").VIDEO),new(r("MediaUploadAsset"))({mediaType:n,data:this.$2(t)})},n.createFromHTMLInput=function(t,n){var e;n===void 0&&(n=r("MediaUploadMediaType").VIDEO);var o;if(this.$1.supportFileFromHTML&&((e=t.files)==null?void 0:e.length)>0){var a=t.files[0];o=this.$2(a)}else o=this.$3(t);return new(r("MediaUploadAsset"))({mediaType:n,data:o})},t})();l.default=s}),98);
__d("MediaUploadSDK",["MediaUploadAssetFactory"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){var e=this;this.isSupported=function(){return e.features.supportFileManipulation&&e.features.supportFileFromHTML},this.currentTimeProvider=t.currentTimeProvider,this.randomNumberProvider=t.randomNumberProvider,this.randomStringProvider=t.randomStringProvider,this.retryPolicyProvider=t.retryPolicyProvider,this.promiseTerminator=t.promiseTerminator,this.delayedExecutor=t.delayedExecutor,this.reportRecoverableError=t.reportRecoverableError,this.createThrowableError=t.createThrowableError,this.features=t.featureDetector(),this.registerUnloadHook=t.registerUnloadHook,this.factories={assets:new(r("MediaUploadAssetFactory"))(this)}};l.default=e}),98);
__d("mediaUploadFBRetryPolicyProvider",["MediaUploadTime"],(function(t,n,r,o,a,i,l){"use strict";var e,s={backoff:{initial:(e=o("MediaUploadTime")).millisecondsToTime(400),jitter:e.millisecondsToTime(100),expBase:e.millisecondsToTime(100),expMultiplier:1.5,max:e.secondsToTime(8)},limits:{totalRetryCount:3e3,totalTime:e.hoursToTime(6)}};function u(){return s}l.default=u}),98);
__d("MediaUploadFBSDK",["Banzai","FBLogger","MediaUploadSDK","MediaUploadTime","Random","SubscriptionsHandler","WaterfallIDGenerator","clearTimeout","fileSlice","getErrorSafe","mediaUploadFBRetryPolicyProvider","promiseDone","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e="media_upload",s=(function(t){function n(){return t.call(this,{currentTimeProvider:function(){return o("MediaUploadTime").millisecondsToTime(Date.now())},randomNumberProvider:function(t,n){return(n-t)*r("Random").random()+t},randomStringProvider:function(){return o("WaterfallIDGenerator").generate()},retryPolicyProvider:r("mediaUploadFBRetryPolicyProvider"),promiseTerminator:function(t){return r("promiseDone")(t)},delayedExecutor:function(t,n,a){var e=r("setTimeout")(n,o("MediaUploadTime").timeToMilliseconds(t));return{cancel:function(){a!=null&&a(),r("clearTimeout")(e)}}},reportRecoverableError:function(n,o){o!=null?r("FBLogger")(e).catching(r("getErrorSafe")(o)).mustfix(n):r("FBLogger")(e).mustfix(n)},createThrowableError:function(n){throw r("FBLogger")(e).mustfixThrow(n)},featureDetector:function(){return{supportFileFromHTML:"FileList"in window,supportFileManipulation:"FileReader"in window&&"DataView"in window&&"FormData"in window&&typeof r("fileSlice")=="function"}},registerUnloadHook:function(n){var t=new(r("SubscriptionsHandler")),o=r("Banzai").subscribe(r("Banzai").SHUTDOWN,n);return o!=null?t.addSubscriptions():r("FBLogger")(e).mustfix("Banzai did not return handle for unsubscribing from the unload hook; logging quality will be bad"),{cancel:function(){try{t.release()}catch(t){r("FBLogger")(e).catching(r("getErrorSafe")(t)).mustfix("Failed to unsubscribe from the unload hook")}}}}})||this}return babelHelpers.inheritsLoose(n,t),n})(r("MediaUploadSDK")),u=new s,c=u;l.default=c}),98);
__d("MediaUploadFBStage",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["METADATA_EXTRACTION","METADATA_VALIDATION","HASHING","START_REQUEST","BYTES_UPLOAD","RECEIVE_REQUEST"]),l=e;i.default=l}),66);
__d("MediaUploadSessionEvent",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["SESSION_CONFIRMED","SESSION_SUCCEED","SESSION_FAILED","SESSION_CANCELED","SESSION_FINISHED","SESSION_PROGRESS","PUBLISH_STARTED","PUBLISH_SUCCEED","PUBLISH_FAILED"]),l=e;i.default=l}),66);
__d("MediaUploadStageEvent",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["STAGE_STARTED","STAGE_PROGRESS","STAGE_SUCCEED","STAGE_FAILED","STAGE_CANCELED"]),l=e;i.default=l}),66);
__d("MediaUploadVUShim",["MediaUploadAssetEvent","MediaUploadClientEvent","MediaUploadFBEntryPointID","MediaUploadFBSDK","MediaUploadFBStage","MediaUploadSessionEvent","MediaUploadStageEvent","MediaUploadVUShimSession","MediaUploadVUShimSurface","Promise","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(){this.$1=new Map}var o=t.prototype;return o.createSession=function(t){if(!r("MediaUploadFBSDK").isSupported())return null;var e=t.source,n=t.composer_entry_point_ref;if(e==null||n==null)return null;var o=new(r("MediaUploadFBEntryPointID"))(e,n);if(!r("MediaUploadVUShimSurface").isClientSupported(o)||!r("gkx")("25479"))return null;var a=r("MediaUploadVUShimSurface").getClient(o),i=new(r("MediaUploadVUShimSession"))(t,a);return this.$1.set(i.sessionID,i),i},o.triggerPublish=function(r,o){var t=this.$1.get(r.sessionID);return t==null?(e||(e=n("Promise"))).resolve({isSuccessful:!1,errorCode:"MISSING_SESSION"}):t.triggerPublish(r,o)},o.setupEventSubscription=function(t){var e=this,n=function(r){t.addClientEventListener(r,function(t){return e.emitClientEvents(r)})};for(var o of r("MediaUploadClientEvent").members())n(o);var a=function(r){t.addSessionEventListener(r,function(t){var n;return(n=e.$1.get(t.sessionID))==null?void 0:n.sessionUpdated(r,t)})};for(var i of r("MediaUploadSessionEvent").members())a(i);var l=function(r){t.addAssetEventListener(r,function(t,n){var o;(o=e.$1.get(t.sessionID))==null||o.assetUpdated(r,t,n)})};for(var s of r("MediaUploadAssetEvent").members())l(s);var u=function(o){var n=function(r){t.addStageEventListener(o,r,function(t,n){var a;(a=e.$1.get(t.sessionID))==null||a.stageUpdated(o,r,t,n)})};for(var a of r("MediaUploadFBStage").members())n(a)};for(var c of r("MediaUploadStageEvent").members())u(c)},o.emitClientEvents=function(t){var e;if(t===r("MediaUploadClientEvent").CLIENT_INTERNET_ONLINE)e="online";else if(t===r("MediaUploadClientEvent").CLIENT_INTERNET_OFFLINE)e="offline";else return;for(var n of this.$1.values())n.inform(e)},t})(),u=new s,c=u;l.default=c}),98);
__d("MediaUploadAssetStatus",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["REQUESTED","SCHEDULED","PROCESSING","UPLOADING","COMPLETED","FAILED","REMOVED"]),l=e;i.default=l}),66);
__d("MediaUploadCancelReason",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["USER_REQUEST","NAVIGATION_AWAY","UNLOAD_HOOK"]),l=e;i.default=l}),66);
__d("MediaUploadSessionStatus",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["UNCONFIRMED","CONFIRMED","FAILED","PUBLISHING","COMPLETED","CANCELED"]),l=e;i.default=l}),66);
__d("GraphQLVideoPublisherInputDataHandlerBase",["invariant"],(function(t,n,r,o,a,i,l,s){"use strict";var e=(function(){function e(e,t){this.postData=e,this.extraData=t}var t=e.prototype;return t.mapPostDataToGraphQLInputObject=function(){s(0,85)},t.hasAPISupport=function(){return u(this.postData)},t.uploadables=function(){s(0,85)},e})();function u(e){return!0}l.GraphQLVideoPublisherInputDataHandlerBase=e,l.hasAPISupport=u}),98);
__d("ExpirationType",[],(function(t,n,r,o,a,i){var e=Object.freeze({NONE:0,DELETE:1,HIDE:2,ONLY_ME:3,HIDE_LONG_DURATION:4});i.default=e}),66);
__d("VideoAssetMatureContentRating",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNSET:0,SUITABLE_FOR_ALL:1,FOURTEEN_PLUS:2,EIGHTEEN_PLUS:3});i.default=e}),66);
__d("VideoCommentatingPermission",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNSET:"unset",ALLOW:"allow",DISALLOW:"disallow"});i.default=e}),66);
__d("VideoFundedContentFlagProgram",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNSET:0,IS_FUNDED_CONTENT:1,NOT_FUNDED_CONTENT:2});i.default=e}),66);
__d("VideoProjection",[],(function(t,n,r,o,a,i){var e=Object.freeze({FLAT:"flat",EQUIRECTANGULAR:"equirectangular",CUBEMAP:"cubemap",ROTATED_CUBEMAP:"rotated_cubemap",BARREL:"barrel",BARREL_SPLIT:"barrel_split",CDS_BARREL:"cds_barrel",HALF_EQUIRECTANGULAR:"half_equirectangular"});i.default=e}),66);
__d("VideoStereoFormat",[],(function(t,n,r,o,a,i){var e=Object.freeze({MONO:"mono",LEFT_RIGHT:"left-right",TOP_BOTTOM:"top-bottom"});i.default=e}),66);
__d("GraphQLVideoPublisherVideoUploaderInputDataHandler",["BrandedContentSharedToSponsorStatus","BrandedContentSponsorRelationship","CallToActionTypes","ClientIDs","ExpirationType","GraphQLVideoPublisherInputDataHandlerBase","VideoAssetMatureContentRating","VideoCommentatingPermission","VideoFundedContentFlagProgram","VideoProjection","VideoStereoFormat","enumUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(){return e.apply(this,arguments)||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.mapPostDataToGraphQLInputObject=function(){var e,t=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_1(),n=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_2(),r=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_3(),a=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_4(),i=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_5(),l=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_6(),s=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_7(),u=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_8(),c=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_9(),d=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_10(),m=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_11(),p=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_12(),_=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_13(),f=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_14(),g=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_15(),h=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_16(),y=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_17(),C=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_18(),b=this.postData.publish_as_reel,v=this.postData.translated_audio_metadata,S=(e=this.postData.non_uuc_reel_data)!=null?e:this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_19(),R=this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_20();return{actor_id:this.extraData.target_id,basic_data:t,client_mutation_id:o("ClientIDs").getNewClientID(),thumbnail_data:n,ad_break_data:a,vu_editor_data:u,post_status_data:r,main_composer_tab_data:i,distribution_data:l,stars_data:s,questions_data:c,polls_data:d,tracking_data:m,captions_data:p,spherical_data:_,live_premiere_data:f,video_editor_config_json:this.postData.video_editor_config_json,location_preset_data:g,video_abtesting_data:h,auto_dub_data:y,reel_publish_data:C,publish_as_reel:b,non_uuc_reel_data:S,translated_audio_data:{translated_audio_metadata:v},share_story_settings:R}},n.uploadables=function(){return babelHelpers.extends({},this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_21(),this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_22(),this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_23())},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_1=function(){var e;return{source:this.extraData.source,target_id:this.extraData.target_id,video_id:this.extraData.video_id,video_title:this.postData.video_title,waterfall_id:this.extraData.waterfall_id,xhpc_message:this.postData.xhpc_message,creator_product:(e=this.extraData.creator_product)==null?void 0:e.toString(),composer_entry_point_ref:this.extraData.composer_entry_point_ref,composer_dialog_version:this.extraData.composer_dialog_version,has_file_been_replaced:this.extraData.has_file_been_replaced,supports_chunking:this.extraData.supports_chunking}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_2=function(){return{thumbnail_type:this.postData.thumbnail_type}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_22=function(){return this.postData.thumbnail_uploadable},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_23=function(){var e={},t=this.postData.schedule_custom_background_image,n=this.postData.schedule_custom_profile_image,r=this.postData.schedule_feed_background_image;return t!=null&&(e.schedule_custom_background_image=t),n!=null&&(e.schedule_custom_profile_image=n),r!=null&&(e.schedule_feed_background_image=r),e},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_4=function(){var e,t=(e=this.postData.ad_breaks)==null?void 0:e.map(function(e){return{time_offset:parseInt(e.time_offset,10),status:e.status}});return{ad_breaks:t,ad_break_prereview:this.postData.ad_break_prereview,ad_breaks_experiment_revenue_loss_threshold:this.postData.ad_breaks_experiment_revenue_loss_threshold,ad_breaks_creator_chosen_contextual_category:this.postData.ad_breaks_creator_chosen_contextual_category,enable_ad_breaks_experiment:this.postData.enable_ad_breaks_experiment,ad_breaks_block_lists:this.postData.ad_breaks_block_lists,has_ad_breaks_block_lists:this.postData.has_ad_breaks_block_lists,is_in_stream_enabled:this.postData.is_in_stream_enabled,self_cert_answers:this.postData.self_cert_answers,self_cert_educational_form:this.postData.self_cert_educational_form,self_cert_selected_no_sensitive:this.postData.self_cert_selected_no_sensitive,self_cert_predicted_status:this.postData.self_cert_predicted_status,should_auto_adjust_manual_ad_breaks:this.postData.should_auto_adjust_manual_ad_breaks,should_auto_insert_ad_breaks:this.postData.should_auto_insert_ad_breaks,should_use_image_ads:this.postData.should_use_image_ads,monetization_pre_check_options:this.postData.monetization_pre_check_options}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_3=function(){return{dogfooding:this.postData.dogfooding,draft:this.postData.draft,is_reviewable_branded_content:this.postData.is_reviewable_branded_content,scheduled:this.postData.scheduled,future_date:this.postData.future_date,future_time:this.postData.future_time,expiring:this.postData.expiring,expire_type:this.postData.expire_type!=null?o("enumUtils").enumValueToKeyEnforcing(this.postData.expire_type,r("ExpirationType")):null,expire_time:this.postData.expire_time,backdated_date:this.postData.backdated_date,hide_from_newsfeed:this.postData.hide_from_newsfeed,schedule_timestamp:this.postData.schedule_timestamp}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_24=function(){var e=this.postData.branded_content_data;if(e==null)return null;var t=e.tagging_data;return t!=null&&(t=babelHelpers.extends({},t,{shared_to_sponsor_status:t.shared_to_sponsor_status!=null?o("enumUtils").enumValueToKeyEnforcing(t.shared_to_sponsor_status,r("BrandedContentSharedToSponsorStatus")):null,sponsor_relationship:t.sponsor_relationship!=null?o("enumUtils").enumValueToKeyEnforcing(t.sponsor_relationship,r("BrandedContentSponsorRelationship")):null})),babelHelpers.extends({},e,{tagging_data:t})},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_5=function(){return{action_type_id:this.postData.action_type_id,branded_content_data:this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_24(),collaborator_id:this.postData.collaborator_id,composertags_place_name:this.postData.composertags_place_name,composertags_place:this.postData.composertags_place,composertags_product_items:this.postData.composertags_product_items,composertags_sponsor:this.postData.composertags_sponsor,composertags_with:this.postData.composertags_with,content_tags:this.postData.content_tags,cta_type:this.postData.cta_type!=null?o("enumUtils").enumValueToKeyEnforcing(this.postData.cta_type,r("CallToActionTypes")):null,deal_id:this.postData.deal_id,direct_share_status:this.postData.direct_share_status!=null?o("enumUtils").enumValueToKeyEnforcing(this.postData.direct_share_status,r("BrandedContentSharedToSponsorStatus")):null,episode_data_json:this.postData.episode_data_json,external_movie_data:this.postData.external_movie_data,feed_targeted_data:this.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_25(),fan_funding_promotion_metadata:this.postData.fan_funding_promotion_metadata,free_form_tags:this.postData.free_form_tags,funded_content_program:this.postData.funded_content_program?o("enumUtils").enumValueToKeyEnforcing(this.postData.funded_content_program,r("VideoFundedContentFlagProgram")):null,fundraiser_for_story_charity_id:this.postData.fundraiser_for_story_charity_id,fundraiser_for_story_charity_type:this.postData.fundraiser_for_story_charity_type,game_id:this.postData.game_id,icon_id:this.postData.icon_id,is_explicitly_tagged_as_gaming_video:this.postData.is_explicitly_tagged_as_gaming_video,is_rewards_enabled:this.postData.is_rewards_enabled,is_stars_enabled_for_post:this.postData.is_stars_enabled_for_post,multilingual_specified_lang:this.postData.multilingual_specified_lang,multilingual_status_langs:this.postData.multilingual_status_langs,multilingual_statuses:this.postData.multilingual_statuses,object_id:this.postData.object_id,object_str:this.postData.object_str,playlistIDs:this.postData.playlistIDs,share_to_parent_page_option_selected:this.postData.share_to_parent_page_option_selected,send_dm_invite:this.postData.send_dm_invite,sponsor_relationship:this.postData.sponsor_relationship?o("enumUtils").enumValueToKeyEnforcing(this.postData.sponsor_relationship,r("BrandedContentSponsorRelationship")):null,targeted_privacy_data:JSON.stringify(this.postData.targeted_privacy_data),background_ab_opted_in:this.postData.background_ab_opted_in,video_duration:this.postData.video_duration}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_25=function(){var e=babelHelpers.extends({},this.postData.feed_targeted_data);return this.postData.relevant_until_date!=null&&(e["relevant-until-date"]=this.postData.relevant_until_date),this.postData.relevant_until_time!=null&&(e["relevant-until-time"]=this.postData.relevant_until_time),Object.keys(e).length===0&&(e=void 0),JSON.stringify(e)},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_6=function(){return{commentating_permission:this.postData.commentating_permission!=null?o("enumUtils").enumValueToKeyEnforcing(this.postData.commentating_permission,r("VideoCommentatingPermission")):null,crossposting_config:this.postData.crossposting_config,disturbing:this.postData.disturbing,embeddable:this.postData.embeddable,enable_drm:this.postData.enable_drm,exclude_from_watch:this.postData.exclude_from_watch,mature_content_rating:this.postData.mature_content_rating!=null?o("enumUtils").enumValueToKeyEnforcing(this.postData.mature_content_rating,r("VideoAssetMatureContentRating")):null,no_story:this.postData.no_story,secret:this.postData.secret,shows_v2_episode_data:this.postData.shows_v2_episode_data,social_actions:this.postData.social_actions}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_7=function(){return{is_receiving_stars_enabled:this.postData.is_receiving_stars_enabled,stars_goal_id:this.postData.stars_goal_id,stars_cue_trigger_timestamp:this.postData.stars_cue_trigger_timestamp}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_11=function(){return{custom_labels:this.postData.custom_labels,external_video_id:this.postData.external_video_id}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_9=function(){return{questions:this.postData.questions}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_10=function(){return{polls:this.postData.polls}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_26=function(t){return t.getIsDefault()?"captions_default":"captions_file"},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_12=function(){var e,t=this,n=(e=this.postData.captions)==null?void 0:e.map(function(e,n){return t.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_26(e)+n});return{autopublish_captions:this.postData.autopublish_captions,captions:n,should_review_all_captions:this.postData.should_review_all_captions,spoken_locale:this.postData.spoken_locale,autopublish_subtitles:this.postData.autopublish_subtitles}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_21=function(){var e,t=this,n={};return(e=this.postData.captions)==null||e.forEach(function(e,r){n[t.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_26(e)+r]=e.getFile()}),n},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_8=function(){return{auto_reframe_aspect_ratios:this.postData.auto_reframe_aspect_ratios,auto_reframe_publish_mode:this.postData.auto_reframe_publish_mode,trailer_review_required:this.postData.trailer_review_required,trailer_generate_on:this.postData.trailer_generate_on,auto_reframe_mobile_only:this.postData.auto_reframe_mobile_only||!1}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_13=function(){return{initialHeading:this.postData.initialHeading,initialPitch:this.postData.initialPitch,fov:this.postData.fov,guide_enabled:this.postData.guide_enabled,guide_keyframes:this.postData.guide_keyframes,enable_omnistab:this.postData.enable_omnistab,spherical:this.postData.spherical,projection:this.postData.projection!=null?o("enumUtils").enumValueToKeyEnforcing(this.postData.projection,r("VideoProjection")):null,stereoMode:this.postData.stereoMode!=null?o("enumUtils").enumValueToKeyEnforcing(this.postData.stereoMode,r("VideoStereoFormat")):null}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_14=function(){return{premiere_time_ms:this.postData.premiere_time_ms,should_premiere:this.postData.should_premiere,premiere_in_living_room_video_ids:this.postData.premiere_in_living_room_video_ids,premiere_custom_profile_image_focus:this.postData.premiere_custom_profile_image_focus,feed_background_focus:this.postData.feed_background_focus,premiere_audience:this.postData.premiere_audience,premiere_is_loe:this.postData.premiere_is_loe,premiere_event_category_id:this.postData.premiere_event_category_id}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_15=function(){return{location_preset_id:this.postData.location_preset_id}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_16=function(){return{is_abtesting:this.postData.is_abtesting,should_publish_uuc:this.postData.should_publish_uuc}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_17=function(){return{dubbing_enabled:this.postData.dubbing_enabled,dub_voice_speed:this.postData.dub_voice_speed,target_locale:this.postData.target_locale,voice_code:this.postData.voice_code}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_19=function(){return{publish_as_non_uuc_reel:this.postData.publish_as_non_uuc_reel}},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_18=function(){return this.postData.reel_publish_data},n.$GraphQLVideoPublisherVideoUploaderInputDataHandler$p_20=function(){return this.postData.reshare_post_as_sticker==null?null:{reshare_post_as_sticker:this.postData.reshare_post_as_sticker,resharing_frequency:this.postData.resharing_frequency}},t})(o("GraphQLVideoPublisherInputDataHandlerBase").GraphQLVideoPublisherInputDataHandlerBase);l.default=e}),98);
__d("ReelComposerReelPublishMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24143317328587698"}),null);
__d("ReelComposerReelPublishMutation.graphql",["ReelComposerReelPublishMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"CpxReelPublishResponsePayload",kind:"LinkedField",name:"cpx_reel_publish",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"published_video_id",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ReelComposerReelPublishMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ReelComposerReelPublishMutation",selections:t},params:{id:n("ReelComposerReelPublishMutation_facebookRelayOperation"),metadata:{},name:"ReelComposerReelPublishMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("ReelComposerReframeAspectRatio",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["NONE","VERTICAL","SQUARE","FOUR_BY_FIVE","MANUAL_9X16","SPLIT_1X3"]);i.ReelComposerReframeAspectRatio=e}),66);
__d("ReelCreationFlowUtils",["$InternalEnum","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e=n("$InternalEnum")).Mirrored(["PUBLISH_NOW","SCHEDULE","DRAFT"]),u=e.Mirrored(["AUDIO","VIDEO"]),c=e.Mirrored(["CREATE","EDIT","AB_TESTING"]),d=e.Mirrored(["CREATOR_STUDIO","MBS","REELS_BULK_UPLOAD"]),m=e.Mirrored(["ENABLED","DISABLED"]),p=function(t){switch(r("vulture")("Zy_DFT_d9vEB43MOHwvCR9PVUGA="),t){case s.PUBLISH_NOW:return"published";case s.DRAFT:return"draft";case s.SCHEDULE:return"scheduled"}};l.ReelPublishType=s,l.ReelEnhancementType=u,l.ReelComposerMode=c,l.ReelsComposerEntrypoint=d,l.ReelsComposerOriginalAudioReuseMode=m,l.getReelPostStatusFromReelPublishType=p}),98);
__d("XFBXFamilyBusinessContentType.facebook",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum").Mirrored(["POST","REEL","STORY"]),l=e;i.default=l}),66);
__d("getEnumFromString",["memoizeByReference"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t={};return Object.values(e).forEach(function(e){t[e]=e}),t}var s=r("memoizeByReference")(e);function u(e,t){if(t==null)return null;var n=s(e);return n[t]!=null?n[t]:null}l.default=u}),98);
__d("getChunkForContentState",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){if(t){var r=n.getEntity(t);if(r.getType()==="EMOTICON")return r.getData().originalEmoticon;if(r.getType()==="EMOJI")return r.getData().emoji.join("")}return e.replace("@[","@ [")}i.default=e}),66);
__d("getMentionsTextForContentState",["emptyFunction","getChunkForContentState"],(function(t,n,r,o,a,i){"use strict";var e=n("emptyFunction").thatReturnsTrue,l=/[\\\]:]/g;function s(t,n,r){n===void 0&&(n=""),r===void 0&&(r=!0);var o=t.getBlockMap().map(function(n){var o=n.getText(),a=[];return n.findEntityRanges(e,function(e,i){a.push(u(o.slice(e,i),n.getEntityAt(e),t,r))}),a.join("")});return o.join("\n"+n)}function u(e,t,r,o){if(t){var a=r.getEntity(t);if(a.getType()==="MENTION"){o&&(e=e.replace(l,function(e){return"\\"+e}));var i=a.getData().id;if(/^\d+$/.test(i))return"@["+i+":"+e+"]"}}return n("getChunkForContentState")(e,t,r)}a.exports=s}),null);
__d("getShouldDisableCollabsDraftsandScheduling",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return!r("gkx")("9836")}l.getShouldDisableCollabsDraftsandScheduling=e}),98);
__d("shouldUsePostCollabsField",["getShouldDisableCollabsDraftsandScheduling","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return e?t===!1?r("gkx")("10000"):!o("getShouldDisableCollabsDraftsandScheduling").getShouldDisableCollabsDraftsandScheduling():!1}l.shouldUsePostCollabsField=e}),98);
__d("ReelComposerReelPublishMutation",["AdsValidationConsts","BusinessComposerIGAudienceTypes","DateConsts","ISOCountryCode","ReelComposerReelPublishMutation.graphql","ReelComposerReframeAspectRatio","ReelCreationFlowUtils","RelayModern","getEnumFromString","getMentionsTextForContentState","justknobx","requireDeferred","shouldUsePostCollabsField","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("ODS").__setRef("ReelComposerReelPublishMutation"),u=1,c=e!==void 0?e:e=n("ReelComposerReelPublishMutation.graphql");function d(e,t,n,r){var a=m(r);o("RelayModern").commitMutation(e,{mutation:c,variables:{input:a},onCompleted:t,onError:function(t){return n()}})}function m(e){var t,n,a,i,l,c,d,m,p=e.isFormatMergeEnabled,h=e.videoID,y=e.shouldSkipEncoding,C=e.shouldEnforceVideoEditorPath,b=e.loggingClientInfo,v=e.reelRemixingEnabled,S=e.reelPublishType,R=e.reelScheduledUnixTimestamp,L=e.reelDescription,E=e.trimStartTimeMs,k=e.trimEndTimeMs,I=e.isTrimTimestampsEqualToEntireVideo,T=e.reelReframeAspectRatio,D=e.collaborators,x=e.videoThumbnailFileID,$=e.thumbnailType,P=e.audioEnhancementProcessingAmount,N=e.music,M=e.audioCustomStartTimeMs,w=e.placements,A=e.igBusinessID,F=e.inStreamAdsSettings,O=e.manualCrop,B=e.mixingParams,W=e.geoTargetingData,q=e.overlay,U=e.mainTrack,V=e.photoTrack,H=e.original_resolution,G=e.isReceivingStarsEnabled,z=e.linkedVideoID,j=e.reelsCreatorPlaylistID,K=e.reelsCreatorPlaylistItemOrder,Q=e.reelsCreatorPlaylistItemBatchSize,X=e.addedHashtags,Y=e.fbMonetizationData,J=e.reelEmbeddingEnabled,Z=e.totalVideoDuration,ee=e.isABTest,te=e.shouldUseConsolidatedReelEditPublishPath,ne=e.shouldShareToStory,re=e.storySharingFrequency,oe=e.igTargetingPrivacyData,ae=e.locationTag,ie=e.reelsReshareDestination,le=e.reelsPoll,se=e.pageCaptionSettings,ue=e.reelCaptionSettings,ce=e.alternateAudioTracks,de=e.autoDubbingSettings,me=e.videoContainerType,pe=e.vodTitle,_e=e.allowTrimBeyondMaxLength,fe=e.closedCaptions,ge=e.shouldDisplayManualDescriptionsSectioninBYOA,he=e.isBoostToggleOn,ye=me==="POST"||p===!0,Ce=S===o("ReelCreationFlowUtils").ReelPublishType.DRAFT||ee===!0,be=S===o("ReelCreationFlowUtils").ReelPublishType.SCHEDULE&&ee!==!0,ve={caption:L,enable_remix:v,is_draft:Ce,is_scheduled:be,scheduled_publish_time:R},Se=(N==null?void 0:N.id)!=null?{id:N.id,offset:(M!=null?M:N.audio.highlightStartTimeMs)/o("DateConsts").MS_PER_SEC,duration:(k-E)/o("DateConsts").MS_PER_SEC}:null,Re=I&&T===o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.NONE&&Se===null&&P===0,Le=Re?null:{start_time_in_sec:E/o("DateConsts").MS_PER_SEC,end_time_in_sec:k/o("DateConsts").MS_PER_SEC},Ee=(t=W==null||(n=W.countries)==null?void 0:n.map(function(e){return r("getEnumFromString")(r("ISOCountryCode"),e)}).filter(Boolean))!=null?t:[],ke=((a=W==null?void 0:W.regions)!=null?a:[]).map(function(e){var t,n;return{key:e.key,country:(t=e.country)!=null?t:"",name:(n=e.name)!=null?n:""}});Ee.length>0&&s.onReady(function(e){e.bumpEntityKey(5907,"fb_stories_web","geo_gating.reel.create",1)});var Ie=(i=oe==null||(l=oe.targetingData)==null?void 0:l.geoLocations.countries)!=null?i:null,Te=(c=oe==null?void 0:oe.isIncluded)!=null?c:!1,De=null;if(Ie!=null&&Ie.length>0)if(Te){var xe;De={age_min:r("AdsValidationConsts").minAge,geo_locations:{countries:(xe=Array.from(new Set(Ie)))!=null?xe:[]}}}else{var $e,Pe=Object.keys(r("ISOCountryCode")).filter(function(e){return!o("BusinessComposerIGAudienceTypes").UnsupportedIGAudienceCountryList.includes(e)&&!Ie.includes(e)});De={age_min:r("AdsValidationConsts").minAge,geo_locations:{countries:($e=Array.from(new Set(Pe)))!=null?$e:[]}}}var Ne={reshare_destination:ie==null?void 0:ie.map(function(e){return{message:{text:e.postText},reshare_audience:{to_id:e.groupID}}})},Me=null;j!=null&&(Me={videolist_ids:[j],order:K,batch_size:Q});var we=ye?["FACEBOOK_NEWS_FEED"]:w,Ae=null;if(ye&&F!=null){var Fe,Oe,Be,We,qe,Ue,Ve=(Fe=F==null||(Oe=F.ad_breaks_block_lists)==null||(Oe=Oe.filter(Boolean))==null?void 0:Oe.map(function(e){return e}))!=null?Fe:[],He=(Be=Ve==null?void 0:Ve.map(function(e){return e.toString()}))!=null?Be:[];Ae={has_ad_breaks_block_lists:(We=F==null?void 0:F.has_ad_breaks_block_lists)!=null?We:!1,should_auto_insert_ad_breaks:(qe=F==null?void 0:F.should_auto_insert_ad_breaks)!=null?qe:!1,should_use_image_ads:(Ue=F==null?void 0:F.should_use_image_ads)!=null?Ue:!1,ad_breaks_block_lists:He!=null?He:[]}}var Ge=f(T),ze=o("shouldUsePostCollabsField").shouldUsePostCollabsField(D.length>0,Ce||be),je=fe!=null&&fe.length>0?{caption_ids:fe.map(function(e){return e.id})}:null;return{video_id:h!=null?h:"",should_skip_encoding:y!=null?y:!1,should_enforce_video_editor_path:C!=null?C:!1,metadata:ve,trim_timestamps:Le,reframe_aspect_ratio:_(T),client_info:b,client_mutation_id:(d=b==null?void 0:b.client_session_id)!=null?d:r("uuidv4")(),reframe_aggressiveness:u,reframe_settings:Ge?{version:Ge}:void 0,video_collaboration:ze?null:{collaborators:D},post_collaborators:ze?{post_collaborators:D}:null,video_thumbnail_file_id:x,thumbnail_type:$.toString(),audio_enhancement:{processing:P},is_boost_toggle_on:he,music_overlay:Se,placements:we,ig_business_id:A,manual_reframe:O?g(O):null,audio_mixing:babelHelpers.extends({},B),targeted_privacy_data:Ee.length>0||ke.length>0?{age_min:0,geo_locations:{countries:Ee,regions:ke}}:null,overlay:q,main_track:U,photo_track:V,original_resolution:H,is_receiving_stars_enabled:G,linked_vod_data:z!=null?{target_video_id:z}:null,videolist:Me,hashtags_logging_data:{added_hashtags:(X!=null?X:[]).map(function(e){return{hashtag:e.hashtag,tool_type:e.toolType}})},fb_monetization_data:Y,embeddable:J,should_share_to_story:ne,total_video_duration:Z,should_use_consolidated_reel_edit_publish_path:te,ig_targeted_privacy_data:De,vod_in_stream_ads_settings:Ae,location_tag:ae!=null?{place_id:ae.id}:null,groups_schedule_resharing:Ne,reels_poll:le,auto_gen_captions_settings:ue!=null?{autogenerate_captions_enabled:ue.autogenerate_captions_enabled,should_review_all_captions:ue.should_review_all_captions}:r("justknobx")._("1058")&&se!=null?{autogenerate_captions_enabled:se.autogenerate_captions_enabled,should_review_all_captions:se.should_review_all_captions}:null,translated_audio_metadata:ce!=null&&ce.length>0?ce.map(function(e){var t,n,o,a=e.description,i=a!=null?r("getMentionsTextForContentState")(a.getCurrentContent()):null;return{audio_handle:(t=e.handle)!=null?t:"",lang_code:(n=(o=e.langCode)==null?void 0:o.valueOf())!=null?n:"",handle_type:"UPLOAD_SERVICE_HANDLE",enabled:!0,description:ge===!0&&i!==L?i:null}}):(de==null?void 0:de.translateVoiceWithMetaAi)===!0?de==null||(m=de.targetLanguages)==null?void 0:m.map(function(e){return{lang_code:e,is_lipsync_enabled:de.enableLipSyncing,enabled:!0,source_lang_code:de.sourceLanguage,audio_handle:"",require_review:de.reviewBeforePublishing}}):null,vod_title:ye?pe:void 0,allow_trim_beyond_max_length:_e,closed_captions:je,has_overridden_video_format:p===!0}}var p={aspect_ratio_denominator:16,aspect_ratio_numerator:9};function _(e){switch(e){case o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.NONE:return null;case o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.MANUAL_9X16:case o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.SPLIT_1X3:case o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.VERTICAL:return{aspect_ratio_denominator:16,aspect_ratio_numerator:9};case o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.SQUARE:return{aspect_ratio_denominator:1,aspect_ratio_numerator:1};case o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.FOUR_BY_FIVE:return{aspect_ratio_denominator:5,aspect_ratio_numerator:4}}}function f(e){if(e===o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.VERTICAL)return"VERSION_3"}function g(e){return{left:e==null?void 0:e.crop_section_relative_top_x,right:e?e.crop_section_relative_top_x+e.crop_section_relative_width:void 0,top:e==null?void 0:e.crop_section_relative_top_y,bottom:e?e.crop_section_relative_top_y+e.crop_section_relative_height:void 0}}l.reelPublishMutation=d,l.getReelPublishInputObject=m,l.DEFAULT_ASPECT_RATIO_PARAMS=p,l.getAspectRatioParams=_,l.getReframeVersion=f,l.manualCropToReframeParameters=g}),98);
__d("RelayFBEnvironmentFactory",["RelayFBEnvironmentDefinitions"],(function(t,n,r,o,a,i){"use strict";var e=n("RelayFBEnvironmentDefinitions").createEnvironmentFactory;a.exports=e(function(e){return{configName:"RelayFBEnvironment",actorID:e}})}),null);
__d("VideoComposerVideoPublishingMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="29705123342436060"}),null);
__d("VideoComposerVideoPublishingMutation.graphql",["VideoComposerVideoPublishingMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"VideoPublishResponsePayload",kind:"LinkedField",name:"video_publish",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"video_asset_id",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VideoComposerVideoPublishingMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VideoComposerVideoPublishingMutation",selections:t},params:{id:n("VideoComposerVideoPublishingMutation_facebookRelayOperation"),metadata:{},name:"VideoComposerVideoPublishingMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("VideoComposerVideoPublishingMutation",["RelayAPIConfig","VideoComposerVideoPublishingMutation.graphql","cr:1012418"],(function(t,n,r,o,a,i,l){"use strict";var e,s=9e4,u=e!==void 0?e:e=n("VideoComposerVideoPublishingMutation.graphql");function c(e,t,o,a,i){var l=r("RelayAPIConfig").fetchTimeout;return r("RelayAPIConfig").fetchTimeout=s,n("cr:1012418").commitMutation(t,{uploadables:o,mutation:u,variables:{input:e},onCompleted:function(t){r("RelayAPIConfig").fetchTimeout=l,a(t)},onError:function(t){r("RelayAPIConfig").fetchTimeout=l,i(t)}})}l.commit=c}),98);
__d("VideoComposerVideoPublisher",["ReelComposerReelPublishMutation","ReelComposerReframeAspectRatio","ReelCreationFlowUtils","RelayFBEnvironmentFactory","VideoComposerVideoPublishingMutation","err","getIsEligibleFor180SecondReelLimit"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e.mapPostDataToGraphQLInputObject(),this.$3=e.hasAPISupport(),this.$2=e.uploadables()}var t=e.prototype;return t.publish=function(t,n){if(this.$1.publish_as_reel===!0){var e,a,i,l,s,u,c=r("RelayFBEnvironmentFactory").getForActorID(this.$1.basic_data.target_id),d=(e=this.$1.post_status_data)!=null&&e.draft?o("ReelCreationFlowUtils").ReelPublishType.DRAFT:(a=this.$1.post_status_data)!=null&&a.scheduled?o("ReelCreationFlowUtils").ReelPublishType.SCHEDULE:o("ReelCreationFlowUtils").ReelPublishType.PUBLISH_NOW,m=null,p=(i=this.$1.post_status_data)==null?void 0:i.future_date,_=(l=this.$1.post_status_data)==null?void 0:l.future_time;p!=null&&_!=null&&(m=+new Date(p).getTime()+ +_*1e3),o("ReelComposerReelPublishMutation").reelPublishMutation(c,function(){},function(){},{videoID:(s=this.$1.basic_data.video_id)!=null?s:"",shouldSkipEncoding:!1,shouldEnforceVideoEditorPath:null,loggingClientInfo:{entry_point:"CS_IG_CROSSPOST_REEL",composer_entry_point:"CS_IG_CROSSPOST_REEL",product:"CREATOR_STUDIO",feature:"IG_REELS_SHARED_TO_FB"},reelRemixingEnabled:!1,reelPublishType:d,reelScheduledUnixTimestamp:m!=null?m/1e3:0,reelDescription:(u=this.$1.basic_data.xhpc_message)!=null?u:"",trimStartTimeMs:0,trimEndTimeMs:0,isTrimTimestampsEqualToEntireVideo:!0,reelReframeAspectRatio:o("ReelComposerReframeAspectRatio").ReelComposerReframeAspectRatio.NONE,collaborators:[],videoThumbnailFileID:null,thumbnailType:"generated_default",audioEnhancementProcessingAmount:0,music:null,audioCustomStartTimeMs:null,placements:["FACEBOOK_REEL"],igBusinessID:null,manualCrop:null,mixingParams:null,geoTargetingData:null,allowTrimBeyondMaxLength:r("getIsEligibleFor180SecondReelLimit")()})}else{if(!this.$3)throw r("err")("This api does not support your publishing use case");o("VideoComposerVideoPublishingMutation").commit(this.$1,r("RelayFBEnvironmentFactory").getForActorID(this.$1.basic_data.target_id),this.$2,t,n)}},e})();l.default=e}),98);
__d("VideoUploadGraphQLPostRequestManager",["FBLogger","GraphQLVideoPublisherInputDataHandlerBase","GraphQLVideoPublisherVideoUploaderInputDataHandler","VideoComposerVideoPublisher","clearTimeout","cr:909282","err","mixin","setTimeout"],(function(t,n,r,o,a,i,l){var e=(function(e){function t(t,n,r,o){var a;return a=e.call(this)||this,a.$VideoUploadGraphQLPostRequestManager$p_1=0,a.$VideoUploadGraphQLPostRequestManager$p_2=0,a.$VideoUploadGraphQLPostRequestManager$p_3=0,a.$VideoUploadGraphQLPostRequestManager$p_4=0,a.$VideoUploadGraphQLPostRequestManager$p_5=0,a.$VideoUploadGraphQLPostRequestManager$p_6=0,a.$VideoUploadGraphQLPostRequestManager$p_7=null,a.$VideoUploadGraphQLPostRequestManager$p_8=null,a.$VideoUploadGraphQLPostRequestManager$p_9=!1,a.$VideoUploadGraphQLPostRequestManager$p_1=t,a.$VideoUploadGraphQLPostRequestManager$p_2=n,a.$VideoUploadGraphQLPostRequestManager$p_3=0,a.$VideoUploadGraphQLPostRequestManager$p_4=r,a.$VideoUploadGraphQLPostRequestManager$p_5=o,a.$VideoUploadGraphQLPostRequestManager$p_6=0,a}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.sendRequest=function(t){if(this.$VideoUploadGraphQLPostRequestManager$p_8=t,this.$VideoUploadGraphQLPostRequestManager$p_9){r("FBLogger")("video_publish_graphql").info("Sending publishing request again while processing another request");return}this.$VideoUploadGraphQLPostRequestManager$p_10(),this.inform("request-started")},n.clearRequest=function(){this.$VideoUploadGraphQLPostRequestManager$p_9=!1,this.$VideoUploadGraphQLPostRequestManager$p_6=0,this.$VideoUploadGraphQLPostRequestManager$p_3=0},n.$VideoUploadGraphQLPostRequestManager$p_10=function(){var e=this.$VideoUploadGraphQLPostRequestManager$p_8;if(e!=null){r("clearTimeout")(this.$VideoUploadGraphQLPostRequestManager$p_7),this.$VideoUploadGraphQLPostRequestManager$p_7=null;var t=e.getMetadata(),n=this.__createRequestData(e),o=new(r("GraphQLVideoPublisherVideoUploaderInputDataHandler"))(t,n);this.$VideoUploadGraphQLPostRequestManager$p_9=!0;var a=new(r("VideoComposerVideoPublisher"))(o);a.publish(this.$VideoUploadGraphQLPostRequestManager$p_11.bind(this),this.$VideoUploadGraphQLPostRequestManager$p_12.bind(this))}},n.__createRequestData=function(t){var e=t.getVideoID(),n=t.getTargetID();if(e==null)throw r("err")("Video id cannot be null");if(n==null)throw r("err")("Target id cannot be null");return{video_id:e,target_id:n,source:"COMPOSER",waterfall_id:t.getWaterfallID()||"",creator_product:t.getCreatorProduct(),composer_entry_point_ref:t.getComposerEntryPointRef&&t.getComposerEntryPointRef(),composer_dialog_version:t.getComposerDialogVersion(),has_file_been_replaced:t.getHasFileBeenReplaced(),supports_chunking:t.getSupportsChunking()}},n.$VideoUploadGraphQLPostRequestManager$p_11=function(t){var e;this.inform("request-finished",{video_asset_id:(e=t.video_publish)==null?void 0:e.video_asset_id}),this.clearRequest()},n.$VideoUploadGraphQLPostRequestManager$p_13=function(t){this.inform("request-failed",{error_code:t.number,error_description:t.message,error_summary:t.name,error_object:t}),this.clearRequest()},n.$VideoUploadGraphQLPostRequestManager$p_12=function(t){this.$VideoUploadGraphQLPostRequestManager$p_14(t)&&this.$VideoUploadGraphQLPostRequestManager$p_6<this.$VideoUploadGraphQLPostRequestManager$p_4?(r("FBLogger")("video_publish_graphql").info("retry publishing for error: %s",t.stack),this.$VideoUploadGraphQLPostRequestManager$p_6++,this.$VideoUploadGraphQLPostRequestManager$p_15(this.$VideoUploadGraphQLPostRequestManager$p_16(this.$VideoUploadGraphQLPostRequestManager$p_5,this.$VideoUploadGraphQLPostRequestManager$p_6))):this.$VideoUploadGraphQLPostRequestManager$p_13(t)},n.$VideoUploadGraphQLPostRequestManager$p_16=function(t,n){return Math.pow(t,n)*1e3},n.$VideoUploadGraphQLPostRequestManager$p_15=function(t){r("clearTimeout")(this.$VideoUploadGraphQLPostRequestManager$p_7),this.$VideoUploadGraphQLPostRequestManager$p_7=r("setTimeout")(this.$VideoUploadGraphQLPostRequestManager$p_10.bind(this),t)},n.$VideoUploadGraphQLPostRequestManager$p_14=function(t){var e=t.toString();return!!(e.includes("NetworkTransportError")||e.includes("NetworkTimeoutError")||e.includes("NetworkRequestError"))},n.hasAPISupport=function(t){return o("GraphQLVideoPublisherInputDataHandlerBase").hasAPISupport(t)},t})(r("mixin")(n("cr:909282")));l.default=e}),98);
__d("submitForm",["cr:6114"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.querySelector('input[type="submit"]');t!=null?t.click():(t=n("cr:6114").create("input",{type:"submit",className:"hidden_elem"}),n("cr:6114").appendContent(e,t),t.click(),n("cr:6114").remove(t))}l.default=e}),98);
__d("VideoUploadRequest",["AsyncRequest","DOM","DTSG","FileForm","Form","VideoUploadFeatureDetector","emptyFunction","flattenPHPQueryData","submitForm"],(function(t,n,r,o,a,i){var e="video",l=(function(){"use strict";function t(e){var t;this.$1=e,this.$2=null,this.$3=!1,this.$4=null,this.$5=null,this.$6=null,this.$7=null,this.$8=t=n("emptyFunction"),this.$9=t,this.$10=t,this.$11=t,this.$12=null}var r=t.prototype;return r.setAllowCrossOrigin=function(t){return this.$3=t,this},r.setData=function(t){return this.$4=t,this},r.setWaterfallID=function(t){return this.$6=t,this},r.setSuccessHandler=function(t){return this.$8=t,this},r.setErrorHandler=function(t){return this.$9=t,this},r.setTransportErrorHandler=function(t){return this.$10=t,this},r.setUploadProgressHandler=function(t){return this.$11=t,this},r.setTimeoutHandler=function(t,n){return this.$7=t,this.$12=n,this},r.setThumbnail=function(t){return this.$13=t,this},r.setCustomProfileImage=function(t){return this.$14=t,this},r.setCustomBackgroundImage=function(t){return this.$15=t,this},r.setFeedBackgroundImage=function(t){return this.$16=t,this},r.setHandle=function(t){return this.$5=t,this},r.setCaptions=function(t){return this.$17=t,this},r.setPollOptionImages=function(t){return this.$18=t,this},r.send=function(){if(this.$2)throw new Error("An upload request is already in progress.");if(n("VideoUploadFeatureDetector").supportsXHR()){if(this.$2=this.$19(),this.$13||this.$17||this.$14||this.$15||this.$16||this.$18){var e=new FormData;if(this.$13&&e.append("thumb",this.$13),this.$14&&e.append("schedule_custom_profile_image",this.$14),this.$15&&e.append("schedule_custom_background_image",this.$15),this.$16&&e.append("schedule_feed_background_image",this.$16),this.$17&&this.$17.forEach(function(t,n){var r=t.getIsDefault()?"captions_default":"captions_file"+n;e.append(r,t.getFile())}),this.$18){var t=this.$18;Object.keys(t).forEach(function(n){e.append(n,t[n])})}if(this.$4){var r=n("flattenPHPQueryData")(this.$4);Object.keys(r).forEach(function(t){e.append(t,r[t])})}this.$2.setRawData(e)}this.$2.send()}else this.$2=this.$20(),this.$21(this.$2)},r.sendChunk=function(t){if(this.$2)throw new Error("An upload request is already in progress.");var e=new FormData;this.$5?e.append("fbuploader_video_file_chunk",this.$5):e.append("video_file_chunk",t),this.$2=this.$19(),this.$2.setRawData(e),this.$2.send()},r.sendFile=function(r){if(this.$2)throw new Error("An upload request is already in progress.");this.$2=this.$20();var t=r.cloneNode(!1);r.name=e,n("DOM").replace(r,t),n("DOM").appendContent(this.$2.getRoot(),r),this.$21(this.$2),r.name=t.name,n("DOM").replace(t,r)},r.abort=function(){this.$2&&(this.$2.abort(),this.$2=null)},r.$19=function(){var e=this.__getAsyncRequest().setAllowCrossOrigin(this.$3).setURI(this.$1).setData(this.$4).setRequestHeader("X_FB_VIDEO_WATERFALL_ID",this.$6).setHandler(this.$8).setErrorHandler(this.$9).setTransportErrorHandler(this.$10).setUploadProgressHandler(this.$11);return this.$12&&e.setTimeoutHandler(this.$7,this.$12),e},r.__getAsyncRequest=function(){return new(n("AsyncRequest"))},r.$20=function(){var e=n("DOM").create("form",{action:this.$1,method:"POST"});n("Form").createHiddenInputs(babelHelpers.extends({fb_dtsg:n("DTSG").getToken()},this.$4),e);var t=new(n("FileForm"))(e,null,{allowCrossOrigin:this.$3});return t.subscribe("success",this.$22.bind(this)),t.subscribe("failure",this.$23.bind(this)),t.subscribe("progress",this.$24.bind(this)),t},r.$21=function(t){n("DOM").appendContent(document.body,t.getRoot()),n("submitForm")(t.getRoot())},r.$22=function(t,n){this.$8(n.response)},r.$23=function(t,n){this.$9(n.response)},r.$24=function(t,n){this.$11(n.event)},t})();a.exports=l}),null);
__d("VideoUploadPostRequestManager",["VideoUploadLogger","VideoUploadRequest","clearTimeout","cr:909282","isEmpty","mixin","setTimeout"],(function(t,n,r,o,a,i,l){var e,s=(function(t){function n(e,n,r,o,a){var i;return i=t.call(this)||this,i.$VideoUploadPostRequestManager2=e,i.$VideoUploadPostRequestManager3=n,i.$VideoUploadPostRequestManager4=r,i.$VideoUploadPostRequestManager5=0,i.$VideoUploadPostRequestManager6=o,i.$VideoUploadPostRequestManager7=a,i.$VideoUploadPostRequestManager8=0,i}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.$VideoUploadPostRequestManager9=function(){return this.$VideoUploadPostRequestManager1?new(r("VideoUploadLogger"))({source:this.$VideoUploadPostRequestManager1.getSource(),waterfall_id:this.$VideoUploadPostRequestManager1.getWaterfallID(),target_id:this.$VideoUploadPostRequestManager1.getTargetID(),composer_entry_point_ref:this.$VideoUploadPostRequestManager1.getComposerEntryPointRef&&this.$VideoUploadPostRequestManager1.getComposerEntryPointRef()}):null},o.getRequest=function(){return this.$VideoUploadPostRequestManager10},o.sendRequest=function(t){if(this.$VideoUploadPostRequestManager1=t,this.$VideoUploadPostRequestManager10){var e=this.$VideoUploadPostRequestManager9();e&&e.logEvent(r("VideoUploadLogger").EVENT_DUPLICATE_POST_REQUEST);return}this.$VideoUploadPostRequestManager11=babelHelpers.extends({},t.getMetadata(),this.__createRequestData(t)),this.$VideoUploadPostRequestManager12=this.$VideoUploadPostRequestManager11.thumb,this.$VideoUploadPostRequestManager13=this.$VideoUploadPostRequestManager11.schedule_custom_profile_image,this.$VideoUploadPostRequestManager14=this.$VideoUploadPostRequestManager11.schedule_custom_background_image,this.$VideoUploadPostRequestManager15=this.$VideoUploadPostRequestManager11.schedule_feed_background_image,delete this.$VideoUploadPostRequestManager11.thumb,this.$VideoUploadPostRequestManager16=this.$VideoUploadPostRequestManager11.captions,delete this.$VideoUploadPostRequestManager11.captions,this.$VideoUploadPostRequestManager17=t.getWaterfallID(),this.$VideoUploadPostRequestManager18=this.$VideoUploadPostRequestManager11.pollImages,this.$VideoUploadPostRequestManager19(),this.inform("request-started")},o.$VideoUploadPostRequestManager19=function(){r("clearTimeout")(this.$VideoUploadPostRequestManager20),this.$VideoUploadPostRequestManager20=null,this.$VideoUploadPostRequestManager10=this.__getVideoUploadRequest(this.$VideoUploadPostRequestManager2).setAllowCrossOrigin(!0).setData(this.$VideoUploadPostRequestManager11).setThumbnail(this.$VideoUploadPostRequestManager12).setCustomProfileImage(this.$VideoUploadPostRequestManager13).setCustomBackgroundImage(this.$VideoUploadPostRequestManager14).setFeedBackgroundImage(this.$VideoUploadPostRequestManager15).setCaptions(this.$VideoUploadPostRequestManager16).setWaterfallID(this.$VideoUploadPostRequestManager17).setPollOptionImages(this.$VideoUploadPostRequestManager18).setSuccessHandler(this.$VideoUploadPostRequestManager21.bind(this)).setErrorHandler(this.$VideoUploadPostRequestManager22.bind(this)).setTransportErrorHandler(this.$VideoUploadPostRequestManager23.bind(this)),this.$VideoUploadPostRequestManager10.send()},o.__createRequestData=function(t){return{video_id:t.getVideoID(),target_id:t.getTargetID(),source:t.getSource(),waterfall_id:t.getWaterfallID(),creator_product:t.getCreatorProduct(),composer_entry_point_ref:t.getComposerEntryPointRef&&t.getComposerEntryPointRef(),composer_dialog_version:t.getComposerDialogVersion(),has_file_been_replaced:t.getHasFileBeenReplaced(),supports_chunking:t.getSupportsChunking()}},o.__getVideoUploadRequest=function(t){return new(r("VideoUploadRequest"))(t)},o.clearRequest=function(){this.$VideoUploadPostRequestManager10=null,this.$VideoUploadPostRequestManager8=0,this.$VideoUploadPostRequestManager5=0},o.isInProgress=function(){return!!this.$VideoUploadPostRequestManager10},o.$VideoUploadPostRequestManager24=function(t){r("clearTimeout")(this.$VideoUploadPostRequestManager20),this.$VideoUploadPostRequestManager20=r("setTimeout")(this.$VideoUploadPostRequestManager19.bind(this),t)},o.$VideoUploadPostRequestManager25=function(t,n){return Math.pow(t,n)*1e3},o.$VideoUploadPostRequestManager21=function(t){var e=t.getPayload();this.inform("request-finished",{video_id:e.video_id,video_asset_id:e.video_asset_id,container_type:e.container_type,transport_retries:this.$VideoUploadPostRequestManager5,server_retries:this.$VideoUploadPostRequestManager8,premiere_destination_video_id:e.premiere_destination_video_id}),this.clearRequest()},o.$VideoUploadPostRequestManager26=function(n){var t,o,a=[].concat(n==null||(t=n.getPayload())==null||(t=t.error)==null?void 0:t.opes_mids,[n==null?void 0:n.errorMid]).filter(Boolean);this.inform("request-failed",{error_code:n.getError(),error_description:n.getErrorDescription(),error_summary:n.getErrorSummary(),transport_retries:this.$VideoUploadPostRequestManager5,server_retries:this.$VideoUploadPostRequestManager8,error_is_silent:n.isSilent(),error_is_transient:n.isTransient(),www_request_id:(o=n.getPayload())==null?void 0:o.__www_request_id__,opes_mids:(e||(e=r("isEmpty")))(a)?null:a}),this.clearRequest()},o.$VideoUploadPostRequestManager22=function(t){this.$VideoUploadPostRequestManager10=null,this.$VideoUploadPostRequestManager5=0;var e=this.$VideoUploadPostRequestManager9();if(e){var n={server_retries:this.$VideoUploadPostRequestManager8,extra_data:{failure_is_transient:t.isTransient()}};e.logEvent(r("VideoUploadLogger").EVENT_HANDLING_SERVER_FAILURE_RESPONSE,n)}t.isTransient()&&this.$VideoUploadPostRequestManager8<this.$VideoUploadPostRequestManager6?(this.$VideoUploadPostRequestManager8++,this.$VideoUploadPostRequestManager24(this.$VideoUploadPostRequestManager25(this.$VideoUploadPostRequestManager7,this.$VideoUploadPostRequestManager8))):this.$VideoUploadPostRequestManager26(t)},o.$VideoUploadPostRequestManager23=function(t){var e=this.$VideoUploadPostRequestManager9();if(e){var n={extra_data:{transport_retries:this.$VideoUploadPostRequestManager5}};e.logEvent(r("VideoUploadLogger").EVENT_HANDLING_TRANSPORT_FAILURE_RESPONSE,n)}this.$VideoUploadPostRequestManager3===0||this.$VideoUploadPostRequestManager5>=this.$VideoUploadPostRequestManager3?this.$VideoUploadPostRequestManager26(t):(this.$VideoUploadPostRequestManager5++,this.$VideoUploadPostRequestManager10=null,this.$VideoUploadPostRequestManager24(this.$VideoUploadPostRequestManager25(this.$VideoUploadPostRequestManager4,this.$VideoUploadPostRequestManager5)))},n})(r("mixin")(n("cr:909282"))),u=s;l.default=u}),98);
__d("VideoUploadRequestContext",[],(function(t,n,r,o,a,i){var e=(function(){function e(){var e=this;this.$14=!1,this.$21=0,this.$22=!1,this.$23=!1,this.$26=!1,this.getComposerEntryPointRef=function(){return e.$11},this.reset()}var t=e.prototype;return t.setFile=function(t){return this.$1=t,this},t.getFile=function(){return this.$1},t.setMetadata=function(t){return this.$24=t,this},t.getMetadata=function(){return this.$24},t.setVideoID=function(t){return this.$2=t,this},t.getVideoID=function(){return this.$2},t.setXPVAssetID=function(t){return this.$29=t,this},t.getXPVAssetID=function(){return this.$29},t.setIsXPVSingleProd=function(t){return this.$30=t,this},t.getIsXPVSingleProd=function(){return this.$30},t.setUploadSessionID=function(t){return this.$3=t,this},t.getUploadSessionID=function(){return this.$3},t.setFbRegion=function(t){return this.$4=t,this},t.getFbRegion=function(){return this.$4},t.setStartOffset=function(t){return this.$5=t,this},t.getStartOffset=function(){return this.$5},t.setEndOffset=function(t){return this.$6=t,this},t.getEndOffset=function(){return this.$6},t.setPartitionStartOffset=function(t){return this.$17=t,this},t.getPartitionStartOffset=function(){return this.$17},t.setPartitionEndOffset=function(t){return this.$18=t,this},t.getPartitionEndOffset=function(){return this.$18},t.setPartitionNo=function(t){return this.$19=t,this},t.getPartitionNo=function(){return this.$19},t.setTargetID=function(t){return this.$7=t,this},t.getTargetID=function(){return this.$7},t.setSource=function(t){return this.$8=t,this},t.setComposerDialogVersion=function(t){return this.$9=t,this},t.getComposerDialogVersion=function(){return this.$9},t.getSource=function(){return this.$8},t.setWaterfallID=function(t){return this.$10=t,this},t.getWaterfallID=function(){return this.$10},t.setComposerEntryPointRef=function(t){return this.$11=t,this},t.setComposerWorkSharedDraftMode=function(t){return this.$12=t,this},t.getComposerWorkSharedDraftMode=function(){return this.$12},t.setHasFileBeenReplaced=function(t){return this.$14=t,this},t.getHasFileBeenReplaced=function(){return this.$14},t.setSupportsChunking=function(t){return this.$15=t,this},t.getSupportsChunking=function(){return this.$15},t.setSupportsFileAPI=function(t){return this.$16=t,this},t.getSupportsFileAPI=function(){return this.$16},t.setCreatorProduct=function(t){return this.$20=t,this},t.getCreatorProduct=function(){return this.$20},t.setLastKnownUploadSpeed=function(t){return this.$21=t,this},t.getLastKnownUploadSpeed=function(){return this.$21||0},t.setUseParallelChunks=function(t){return this.$22=t,this},t.getUseParallelChunks=function(){return this.$22},t.setIsSphericalVideo=function(t){return this.$23=t,this},t.getIsSphericalVideo=function(){return this.$23},t.setSphericalMetadata=function(t){return this.$25=t,this},t.getSphericalMetadata=function(){return this.$25},t.setEnableOmnistab=function(t){return this.$26=t,this},t.getEnableOmnistab=function(){return this.$26},t.setClientChunkSize=function(t){return this.$27=t,this},t.getClientChunkSize=function(){return this.$27},t.setVideoPublisherActionSource=function(t){return this.$28=t,this},t.getVideoPublisherActionSource=function(){return this.$28},t.setComposerSessionID=function(t){return this.$13=t,this},t.getComposerSessionID=function(){return this.$13},t.setRetryState=function(t){return this.$31=t,this},t.getRetryState=function(){return this.$31},t.setCreativeTools=function(t){return this.$32=t,this},t.getCreativeTools=function(){return this.$32},t.reset=function(){this.$1=null,this.$2=null,this.$3=null,this.$4=null,this.$5=null,this.$6=null,this.$7=null,this.$8=null,this.$9=null,this.$10=null,this.$11=null,this.$12=null,this.$14=!1,this.$15=null,this.$16=null,this.$17=null,this.$18=null,this.$19=null,this.$20=null,this.$21=0,this.$22=!1,this.$23=!1,this.$24={},this.$25={},this.$26=!1,this.$27=null,this.$28={},this.$13=null,this.$31=null,this.$32=null},e})();i.default=e}),66);
__d("MediaUploadSingleAssetPublisher",["Promise","VideoUploadGraphQLPostRequestManager","VideoUploadPostRequestManager","VideoUploadRequestContext"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(){}t.publish=function(n){return t.$1==null&&(t.$1=new t),t.$1.publish(n)};var o=t.prototype;return o.publish=function(r){var t=this;return new(e||(e=n("Promise")))(function(e){var n=t.$2(r.sessionSnapshot,r.assetSnapshot,r.postData),o,a=t.$3(r.postRequestManagerParams);a.hasAPISupport(r.postData)&&(o=a),o==null&&(o=t.$4(r.postRequestManagerParams)),t.$5(o,e),o.sendRequest(n)})},o.$4=function(t){return new(r("VideoUploadPostRequestManager"))(t==null?void 0:t.chunk_post_uri,t==null?void 0:t.post_max_transport_retries,t==null?void 0:t.post_transport_retry_interval_base,t==null?void 0:t.post_max_server_retries,t==null?void 0:t.post_server_retry_interval_base)},o.$3=function(t){var e,n,o,a;return new(r("VideoUploadGraphQLPostRequestManager"))((e=t==null?void 0:t.post_max_transport_retries)!=null?e:0,(n=t==null?void 0:t.post_transport_retry_interval_base)!=null?n:0,(o=t==null?void 0:t.post_max_server_retries)!=null?o:0,(a=t==null?void 0:t.post_server_retry_interval_base)!=null?a:0)},o.$5=function(t,n){t.subscribe("request-finished",function(e,t){var r={event:e,payload:t};n({isSuccessful:!0,rawResponse:r})}),t.subscribe("request-failed",function(e,t){var r={event:e,payload:t},o=(t==null?void 0:t.error_code)==null||(t==null?void 0:t.error_code)==0?"PublishError":t==null?void 0:t.error_code;n({isSuccessful:!1,errorCode:o,rawErrorObject:t==null?void 0:t.error_object,rawResponse:r})})},o.$2=function(t,n,o){var e;return new(r("VideoUploadRequestContext"))().setVideoID(n.videoID).setTargetID(n.request.attributes.targetID).setSource(t.entryPoint.sourceType).setWaterfallID(t.sessionID).setCreatorProduct(n.request.attributes.creatorProduct).setComposerEntryPointRef(t.entryPoint.entryPointRef).setComposerDialogVersion(n.request.attributes.composerDialogVersion).setHasFileBeenReplaced((e=n.request.attributes.hasFileBeenReplaced)!=null?e:!1).setSupportsChunking(!0).setMetadata(o)},t})();l.default=s}),98);
__d("MediaUploadVUShimLogger",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.logEvent=function(t,n){},t.postOnShutdown=function(t){return{remove:function(){}}},t.getWaterfallID=function(){return this.$1},e})();i.default=e}),66);
__d("MediaUploadVUShimSession",["MediaUploadAssetEvent","MediaUploadAssetStatus","MediaUploadCancelReason","MediaUploadFBSDK","MediaUploadFBStage","MediaUploadSessionEvent","MediaUploadSessionStatus","MediaUploadSingleAssetPublisher","MediaUploadStageEvent","MediaUploadVUShimLogger","MediaUploadVUShimSurface","Promise","WaterfallIDGenerator","cr:909282","mixin"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(t){function a(e,n){var a,i;return i=t.call(this)||this,i.sessionID=o("WaterfallIDGenerator").generate(),i.$MediaUploadVUShimSession$p_1=e,i.$MediaUploadVUShimSession$p_3=(a=e.waterfall_id)!=null?a:i.sessionID,i.$MediaUploadVUShimSession$p_6=n,i.$MediaUploadVUShimSession$p_5=new(r("MediaUploadVUShimLogger"))(i.$MediaUploadVUShimSession$p_3),i.$MediaUploadVUShimSession$p_10=!i.$MediaUploadVUShimSession$p_1.background_upload,i}babelHelpers.inheritsLoose(a,t);var i=a.prototype;return i.createTestLogger=function(){},i.getLogger=function(){return this.$MediaUploadVUShimSession$p_5},i.start=function(t){var e=this;this.inform("set-waterfall-id",{waterfallID:this.$MediaUploadVUShimSession$p_3});var n=r("MediaUploadVUShimSurface").createAssetRequest(function(e){var n=t.getFile(),o=t.getFileInput();if(n!=null)return e.createFromFile(n);if(o!=null){var a=e.createFromHTMLInput(o);if(a.dataAsFile()==null)throw r("MediaUploadFBSDK").createThrowableError("Cannot get File from the HTML input element");return a}else throw r("MediaUploadFBSDK").createThrowableError("Invalid video upload file, it contains only null objects")},t.getStableAssetID(),function(t){var n,r;return{targetID:(n=e.$MediaUploadVUShimSession$p_4)!=null?n:e.$MediaUploadVUShimSession$p_1.target_id,composerSessionID:e.$MediaUploadVUShimSession$p_2,actorID:e.$MediaUploadVUShimSession$p_1.as_actor_id,composerDialogVersion:"V2",publisherActionSource:e.$MediaUploadVUShimSession$p_1.video_publisher_action_source,creatorProduct:((r=t.dataAsFile())==null?void 0:r.extension)==="gif"?4:2}});this.$MediaUploadVUShimSession$p_9=n,this.$MediaUploadVUShimSession$p_6.startUploads(this.sessionID,[n]),this.$MediaUploadVUShimSession$p_10&&this.$MediaUploadVUShimSession$p_6.confirmSession(this.sessionID,[n],function(e){return e.set("dummyPublish",!0)})},i.setTargetID=function(t){this.$MediaUploadVUShimSession$p_4=t},i.setComposerSessionID=function(t){this.$MediaUploadVUShimSession$p_2=t},i.post=function(t){this.$MediaUploadVUShimSession$p_10?r("MediaUploadFBSDK").reportRecoverableError("Video upload client configured for pessimistic upload and explicit publish calls are now allowed"):this.$MediaUploadVUShimSession$p_9!=null&&this.$MediaUploadVUShimSession$p_6.confirmSession(this.sessionID,[this.$MediaUploadVUShimSession$p_9],function(e){return e.set("postData",t)})},i.cancel=function(t){this.$MediaUploadVUShimSession$p_6.cancelSession(this.sessionID,r("MediaUploadCancelReason").USER_REQUEST)},i.abandon=function(t){this.$MediaUploadVUShimSession$p_6.cancelSession(this.sessionID,r("MediaUploadCancelReason").USER_REQUEST)},i.isPostInProgress=function(){var e;return((e=this.$MediaUploadVUShimSession$p_7)==null?void 0:e.status)===r("MediaUploadSessionStatus").PUBLISHING},i.isInProgress=function(){var e,t;return((e=this.$MediaUploadVUShimSession$p_8)==null?void 0:e.status)===r("MediaUploadAssetStatus").PROCESSING||((t=this.$MediaUploadVUShimSession$p_8)==null?void 0:t.status)===r("MediaUploadAssetStatus").UPLOADING},i.getHasUploadFinished=function(){var e;return((e=this.$MediaUploadVUShimSession$p_8)==null?void 0:e.status)===r("MediaUploadAssetStatus").COMPLETED},i.getVideoID=function(){var e;return(e=this.$MediaUploadVUShimSession$p_8)==null?void 0:e.videoID},i.getUploadTime=function(){var e,t,n=(e=this.$MediaUploadVUShimSession$p_8)==null||(e=e.uploadSummary)==null?void 0:e.startedAtMs,r=(t=this.$MediaUploadVUShimSession$p_8)==null||(t=t.uploadSummary)==null?void 0:t.finishedAtMs;return n!=null&&r!=null?r-n:null},i.getExPartitionNumber=function(t){return 0},i.getIsSphericalVideo=function(){var e,t;return(e=(t=this.$MediaUploadVUShimSession$p_8)==null||(t=t.metadata)==null?void 0:t.isSpherical)!=null?e:!1},i.startFlow=function(){this.$MediaUploadVUShimSession$p_10?r("MediaUploadFBSDK").reportRecoverableError("Video upload client configured for pessimistic upload and explicit publish calls are now allowed"):this.$MediaUploadVUShimSession$p_9!=null&&this.$MediaUploadVUShimSession$p_6.confirmSession(this.sessionID,[this.$MediaUploadVUShimSession$p_9])},i.sessionUpdated=function(t,n){var e,o;this.$MediaUploadVUShimSession$p_7=n;var a=n.extras.getUnsafe("postData");if(a!=null){var i=n.publishingResponse;switch(t){case r("MediaUploadSessionEvent").PUBLISH_STARTED:this.inform("post-started",a);break;case r("MediaUploadSessionEvent").PUBLISH_SUCCEED:this.inform("post-finished",babelHelpers.extends({},(e=i==null?void 0:i.payload)!=null?e:{},a));break;case r("MediaUploadSessionEvent").PUBLISH_FAILED:this.inform("post-failed",(o=i==null?void 0:i.payload)!=null?o:{});break;default:}}},i.assetUpdated=function(t,n,o){var e,a,i,l,s,u,c,d,m,p,_,f,g;this.$MediaUploadVUShimSession$p_7=n,this.$MediaUploadVUShimSession$p_8=o;var h,y,C=(e=(a=o.asset.dataAsFile())==null?void 0:a.size)!=null?e:0,b=(i=(l=o.uploadSummary)==null?void 0:l.skippedUpload)!=null?i:!1;switch(t){case r("MediaUploadAssetEvent").ASSET_ADDED:h="upload-requested";break;case r("MediaUploadAssetEvent").ASSET_STARTED:h="upload-started";break;case r("MediaUploadAssetEvent").ASSET_REMOVED:h="upload-canceled";break;case r("MediaUploadAssetEvent").ASSET_PROGRESS:h="upload-progressed",y={start_offset:0,end_offset:C,file_size:C,sent_bytes:b?C:(s=(u=o.uploadSummary)==null?void 0:u.uploadedBytes)!=null?s:0,video_id:o.videoID,upload_domain:o.uploadServiceDomain,skip_upload:b,transport_retries:o.retries.totalRetryAttempts};break;case r("MediaUploadAssetEvent").ASSET_SUCCEED:h="upload-finished",y={start_offset:0,end_offset:C,video_id:o.videoID,is_spherical_video:(c=o==null||(d=o.metadata)==null?void 0:d.isSpherical)!=null?c:!1};break;case r("MediaUploadAssetEvent").ASSET_FAILED:h="upload-failed",y={error_code:(m=o.lastAction)==null?void 0:m.rawErrorCode,error_summary:(p=o.lastAction)==null||(p=p.displayError)==null?void 0:p.summary,error_description:(_=o.lastAction)==null||(_=_.displayError)==null?void 0:_.description,error_is_transient:(f=o.lastAction)==null||(f=f.errorAttributes)==null?void 0:f.transientError,upload_domain:o.uploadServiceDomain,www_request_id:(g=o.lastAction)==null?void 0:g.networkRequestID};break;default:}h!=null&&this.inform(h,y)},i.stageUpdated=function(t,n,o,a){if(this.$MediaUploadVUShimSession$p_7=o,this.$MediaUploadVUShimSession$p_8=a,t===r("MediaUploadStageEvent").STAGE_SUCCEED&&n===r("MediaUploadFBStage").METADATA_EXTRACTION){var e;if(a.metadata!=null){var i,l=a.metadata,s=l.durationMs==null?void 0:l.durationMs/1e3;e={format:{duration:s,isSpherical:(i=l.isSpherical)!=null?i:!1},metadata:{},streams:{numAudioTracks:1,primaryVideo:{type:"video",width:l.width,height:l.height,duration:s},primaryAudio:{type:"audio",duration:s}}}}else e=null;this.inform("metadata-parsed",e)}},i.triggerPublish=function(o,a){var t;this.$MediaUploadVUShimSession$p_7=o,this.$MediaUploadVUShimSession$p_8=a[0];var i=(t=o.extras.getBoolean("dummyPublish"))!=null?t:!1,l=o.extras.getUnsafe("postData");return i?(e||(e=n("Promise"))).resolve({isSuccessful:!0}):l==null?(e||(e=n("Promise"))).resolve({isSuccessful:!1,errorCode:"MISSING_POST_DATA"}):r("MediaUploadSingleAssetPublisher").publish({sessionSnapshot:o,assetSnapshot:a[0],postData:l,postRequestManagerParams:this.$MediaUploadVUShimSession$p_1})},a})(r("mixin")(n("cr:909282")));l.default=s}),98);
__d("MediaUploadOperationOutcome",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["SUCCESS","CANCELED","FAILED_NON_TRANSIENT","FAILED_NO_MORE_RETRIES","FAILED_OUT_OF_TIME"]),l=e;i.default=l}),66);
__d("MediaUploadCancelablePromise",["Promise"],(function(t,n,r,o,a,i){"use strict";var e,l={cancel:function(){}},s=(function(){function t(t){var r=this;this.$1=!1,this.promise=new(e||(e=n("Promise")))(function(e,n){r.$2=t(e,n),r.$2==null&&(r.$2=l),r.$1&&r.$2.cancel()})}t.resolve=function(n){return new t(function(e){e(n)})};var r=t.prototype;return r.then=function(n){var e=this;return new t(function(r,o){var a={cancelable:e};return e.promise.then(function(r){if(a.cancelable=l,e.$1)return r;var o=n(r);return o instanceof t?(a.cancelable=o,o.promise):o}).then(r).catch(function(){a.cancelable=l,o.apply(void 0,arguments)}),{cancel:function(){a.cancelable.cancel()}}})},r.isCanceled=function(){return this.$1},r.cancel=function(){if(!this.$1){var e;this.$1=!0,(e=this.$2)==null||e.cancel()}},t})();i.default=s}),66);
__d("MediaUploadPipeline",["MediaUploadCancelablePromise","MediaUploadOperationOutcome"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){var n=this;this.$2=[],this.$3=null,this.$2=e,this.$1=t,this.cancelablePromise=new(r("MediaUploadCancelablePromise"))(function(e,t){return n.$4(e,t,[].concat(n.$2)),{cancel:function(){var t;(t=n.$3)==null||t.cancel(),n.$3=null,e(r("MediaUploadOperationOutcome").CANCELED)}}})}var t=e.prototype;return t.$4=function(t,n,o){var e=this;if(o.length===0)this.$3=null,t(r("MediaUploadOperationOutcome").SUCCESS);else{var a=o.shift(),i=a();this.$1.promiseTerminator(i.promise.then(function(a){e.cancelablePromise.isCanceled()?t(r("MediaUploadOperationOutcome").CANCELED):a===r("MediaUploadOperationOutcome").SUCCESS?e.$4(t,n,o):t(a)}).catch(n)),this.$3=i}},e})(),s=(function(){function t(e){this.$2=[],this.$1=e}var n=t.prototype;return n.addCancelableStep=function(t){this.$2.push(t)},n.addPlainStep=function(t){this.$2.push(function(){return new(r("MediaUploadCancelablePromise"))(function(e){e(t())})})},n.run=function(){var t=new e(this.$2,this.$1);return t.cancelablePromise},t})();l.default=s}),98);
__d("MediaUploadAssetStrategy",["MediaUploadAssetEvent","MediaUploadAssetStatus","MediaUploadOperationOutcome","MediaUploadPipeline","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(e){this.$1=e.implementation,this.$2=e.executor,this.$3=e.params}var o=t.prototype;return o.removeAsset=function(t){var e;t.updateStatusAndEmit(r("MediaUploadAssetStatus").REMOVED),(e=t.inFlightUpload)==null||e.cancel()},o.addAsset=function(t){t.sessionContext.assetsByID.set(t.assetID,t),t.emitAssetEvent(r("MediaUploadAssetEvent").ASSET_ADDED)},o.scheduleUpload=function(t){var e=this;return t.updateStatusAndEmit(r("MediaUploadAssetStatus").SCHEDULED),this.$2.schedule(function(){return e.$4(t)})},o.$4=function(o){var t=this;if(o.isRemoved())return(e||(e=n("Promise"))).resolve();o.updateStatusAndEmit(r("MediaUploadAssetStatus").PROCESSING);var a=new(r("MediaUploadPipeline"))(this.$3);a.addCancelableStep(function(){return t.$1.runClientLazyLoading(o)}),a.addCancelableStep(function(){return t.$1.runLocalAssetStategy(o)}),a.addCancelableStep(function(){return o.updateStatusAndEmit(r("MediaUploadAssetStatus").UPLOADING),t.$1.runNetworkAssetStategy(o)});var i=a.run();return o.inFlightUpload=i,i.promise.then(function(e){return t.$5(o,e)}).catch(function(e){t.$3.reportRecoverableError("Unexpected failure during asset pipeline execution",e),o.updateStatusAndEmit(r("MediaUploadAssetStatus").FAILED)})},o.$5=function(t,n){if(!t.isRemoved())switch(n){case r("MediaUploadOperationOutcome").SUCCESS:t.updateStatusAndEmit(r("MediaUploadAssetStatus").COMPLETED);break;case r("MediaUploadOperationOutcome").CANCELED:t.updateStatusAndEmit(r("MediaUploadAssetStatus").REMOVED);break;default:t.updateStatusAndEmit(r("MediaUploadAssetStatus").FAILED)}},t})();l.default=s}),98);
__d("MediaUploadRetryState",["MediaUploadTime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.retryPolicy=e,this.$3=0,this.$4=0,this.$1=t.currentTimeProvider,this.$2=t.randomNumberProvider,this.$5=this.$1()}var t=e.prototype;return t.resetBackoff=function(){this.$3=0},t.getRetryAttempts=function(){return this.$4},t.getRetryAttemptsSinceLastReset=function(){return this.$3},t.calculateBackoffDelay=function(){var e=this.retryPolicy.backoff,t=o("MediaUploadTime").timeToMilliseconds(e.initial),n=e.expBase,r=e.expMultiplier;this.$3>0&&n!=null&&r!=null&&(t+=o("MediaUploadTime").timeToMilliseconds(n)*Math.pow(r,this.$3-1)),e.max!=null&&(t=Math.min(t,o("MediaUploadTime").timeToMilliseconds(e.max)));var a=e.jitter==null?0:o("MediaUploadTime").timeToMilliseconds(e.jitter);return a>0&&(t+=this.$2(-.5*a,.5*a)),o("MediaUploadTime").millisecondsToTime(Math.round(t))},t.exceedTotalRetries=function(){var e;return((e=this.retryPolicy.limits)==null?void 0:e.totalRetryCount)!=null&&this.$4>this.retryPolicy.limits.totalRetryCount},t.exceedTotalDuration=function(){var e,t;return((e=this.retryPolicy.limits)==null?void 0:e.totalTime)!=null&&o("MediaUploadTime").compareTime((t=this.retryPolicy.limits)==null?void 0:t.totalTime,o("MediaUploadTime").subtractTime(this.$1(),this.$5))<=0},t.increaseRetryAttemptCounter=function(){this.$3++,this.$4++},e})();l.default=e}),98);
__d("MediaUploadClientResult",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["ACCEPTED","SESSION_NOT_FOUND","ASSET_NOT_FOUND","ASSET_ALREADY_EXISTS","SESSION_ALREADY_CANCELED","SESSION_ALREADY_PUBLISHING","SESSION_ALREADY_PUBLISHED","SESSION_NOT_FAILED","INVALID_TYPE","UNSUPPORTED_BROWSER"]),l=e;i.default=l}),66);
__d("MediaUploadSessionStrategy",["MediaUploadCancelReason","MediaUploadClientResult","MediaUploadSessionEvent","MediaUploadSessionStatus"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e.implementation,this.$2=e.assetStrategy,this.$3=e.params}var t=e.prototype;return t.$4=function(t){if(t.isConfirmed()&&t.progress.publishingExtrasProvided){var e=t.getActiveAssets();for(var n of e)if(n.isFailed()){t.updateStatusAndEmit(r("MediaUploadSessionStatus").FAILED);return}e.every(function(e){return e.isCompleted()})&&this.$5(t)}},t.$5=function(t){t.updateStatusAndEmit(r("MediaUploadSessionStatus").PUBLISHING);var e=[];for(var n of t.assetsByID.values())n.isCompleted()&&e.push(n);var o=this.$1.publish(t,e).then(function(e){t.progress.publishingResponse=e.rawResponse,e.isSuccessful?(t.emitSessionEvent(r("MediaUploadSessionEvent").PUBLISH_SUCCEED),t.updateStatusAndEmit(r("MediaUploadSessionStatus").COMPLETED)):(t.updateLastError({rawErrorCode:e.errorCode,rawErrorObject:e.rawErrorObject}),t.emitSessionEvent(r("MediaUploadSessionEvent").PUBLISH_FAILED),t.updateStatusAndEmit(r("MediaUploadSessionStatus").FAILED),t.updateLastError())}).catch(function(e){t.updateLastError({rawErrorObject:e}),t.emitSessionEvent(r("MediaUploadSessionEvent").PUBLISH_FAILED),t.updateStatusAndEmit(r("MediaUploadSessionStatus").FAILED),t.updateLastError()});this.$3.promiseTerminator(o)},t.$6=function(t,n){var e=this;this.$2.scheduleUpload(n).finally(function(){return e.$4(t)})},t.$7=function(t){return t.isPublished()?r("MediaUploadClientResult").SESSION_ALREADY_PUBLISHED:t.isPublishing()?r("MediaUploadClientResult").SESSION_ALREADY_PUBLISHING:t.isCanceled()?r("MediaUploadClientResult").SESSION_ALREADY_CANCELED:r("MediaUploadClientResult").ACCEPTED},t.$8=function(t){var e=this;t.releaseOnFinish.push(this.$3.registerUnloadHook(function(){e.cancel(t,r("MediaUploadCancelReason").UNLOAD_HOOK)})),t.updateStatusAndEmit(r("MediaUploadSessionStatus").CONFIRMED)},t.cancel=function(t,n){var e=this.$7(t);if(e!==r("MediaUploadClientResult").ACCEPTED)return e;t.progress.cancelReason=n,t.updateStatusAndEmit(r("MediaUploadSessionStatus").CANCELED);for(var o of t.assetsByID.values())this.$2.removeAsset(o);return r("MediaUploadClientResult").ACCEPTED},t.removeAsset=function(t,n){var e=this.$7(t);if(e!==r("MediaUploadClientResult").ACCEPTED)return e;var o=t.assetsByID.get(n);return o==null?r("MediaUploadClientResult").ASSET_NOT_FOUND:(this.$2.removeAsset(o),this.$4(t),r("MediaUploadClientResult").ACCEPTED)},t.uploadAsset=function(t,n){var e=this.$7(t);if(e!==r("MediaUploadClientResult").ACCEPTED)return e;var o=t.assetsByID.get(n.assetID);if(o!=null&&!o.isRemoved())return r("MediaUploadClientResult").ASSET_ALREADY_EXISTS;var a=this.$1.createAssetContext(t,n);return this.$2.addAsset(a),this.$6(t,a),r("MediaUploadClientResult").ACCEPTED},t.syncAssetUploads=function(t,n){var e=this.$7(t);if(e!==r("MediaUploadClientResult").ACCEPTED)return e;var o=new Set(n.map(function(e){return e.assetID})),a=new Set(t.assetsByID.keys());for(var i in a)if(!o.has(i)){var l=t.assetsByID.get(i);l!=null&&this.$2.removeAsset(l)}return this.uploadAssets(t,n),r("MediaUploadClientResult").ACCEPTED},t.uploadAssets=function(t,n){var e=this,r={};return n.forEach(function(n){return r[n.assetID]=e.uploadAsset(t,n)}),r},t.updateSessionExtras=function(t,n,o){var e=this.$7(t);return e!==r("MediaUploadClientResult").ACCEPTED?e:(n(t.extras),o&&(t.progress.publishingExtrasProvided=!0),r("MediaUploadClientResult").ACCEPTED)},t.retry=function(t){var e=this.$7(t);if(e!==r("MediaUploadClientResult").ACCEPTED)return e;if(!t.isFailed())return r("MediaUploadClientResult").SESSION_NOT_FAILED;t.renewRetryID(),this.$8(t);for(var n of t.assetsByID.values())n.isSchedulable()&&this.$6(t,n);return this.$4(t),r("MediaUploadClientResult").ACCEPTED},t.confirm=function(t){var e=this.$7(t);return e!==r("MediaUploadClientResult").ACCEPTED?e:t.isFailed()?this.retry(t):t.isConfirmed()?(this.$4(t),r("MediaUploadClientResult").ACCEPTED):(this.$8(t),this.$4(t),r("MediaUploadClientResult").ACCEPTED)},e})();l.default=e}),98);
__d("MediaUploadClientContext",["MediaUploadAssetStrategy","MediaUploadRetryState","MediaUploadSessionStrategy"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.sdk=e.sdk,this.emitter=e.emitter,this.executor=e.executor,this.progressCalculator=e.progressCalculator,this.assetStrategy=new(r("MediaUploadAssetStrategy"))({implementation:this,executor:this.executor,params:this.sdk}),this.sessionStrategy=new(r("MediaUploadSessionStrategy"))({implementation:this,assetStrategy:this.assetStrategy,params:this.sdk})}var t=e.prototype;return t.runLocalAssetStategy=function(t){throw this.sdk.createThrowableError("Not implemented")},t.runNetworkAssetStategy=function(t){throw this.sdk.createThrowableError("Not implemented")},t.runClientLazyLoading=function(t){throw this.sdk.createThrowableError("Not implemented")},t.createSessionContext=function(t){throw this.sdk.createThrowableError("Not implemented")},t.createAssetContext=function(t,n){throw this.sdk.createThrowableError("Not implemented")},t.publish=function(t,n){throw this.sdk.createThrowableError("Not implemented")},t.subscribeToHooks=function(){throw this.sdk.createThrowableError("Not implemented")},t.createRetryState=function(){return new(r("MediaUploadRetryState"))(this.sdk.retryPolicyProvider(),this.sdk)},e})();l.default=e}),98);
__d("MediaUploadBytesSummary",["MediaUploadTime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.reset=function(){this.$2=null},t.updateForUploadStart=function(t){var e=this.$1.currentTimeProvider();this.$2={fullyCompleted:!1,startedAt:e,updatedAt:e,totalBytes:t,uploadedBytes:0,skippedUpload:!1}},t.updateForUploadSkip=function(t){var e=this.$1.currentTimeProvider();this.$2={fullyCompleted:!0,startedAt:e,updatedAt:e,finishedAt:e,totalBytes:t,uploadedBytes:t,skippedUpload:!0}},t.updateForProgress=function(t){var e=this.$2;if(e==null){this.$1.reportRecoverableError("Upload stats have not been initialized");return}e.uploadedBytes=t,e.updatedAt=this.$1.currentTimeProvider()},t.updateForUploadComplete=function(){var e=this.$2;if(e==null){this.$1.reportRecoverableError("Upload stats have not been initialized");return}this.updateForProgress(e.totalBytes),e.fullyCompleted=!0,e.uploadedBytes=e.totalBytes},t.updateForUploadAbandoned=function(){var e=this.$2;if(e==null){this.$1.reportRecoverableError("Upload stats have not been initialized");return}e.finishedAt=this.$1.currentTimeProvider()},t.computeSpeedBps=function(){var e=this.$2;if(e==null||e.skippedUpload)return null;var t=o("MediaUploadTime").timeToSeconds(o("MediaUploadTime").subtractTime(e.updatedAt,e.startedAt));return t>.1?e.uploadedBytes/t:0},t.computeUploadedPortion=function(){var e=this.$2;return e==null?null:e.fullyCompleted?1:e.totalBytes===0?0:1*e.uploadedBytes/e.totalBytes},t.computeSnapshot=function(){var e=this.$2;return e==null?null:{uploadedBytes:e.uploadedBytes,speedBps:this.computeSpeedBps(),skippedUpload:e.skippedUpload,startedAtMs:o("MediaUploadTime").timeToMilliseconds(e.startedAt),finishedAtMs:o("MediaUploadTime").maybeTimeToMilliseconds(e.finishedAt)}},e})();l.default=e}),98);
__d("MediaUploadAssetContext",["MediaUploadAssetEvent","MediaUploadAssetStatus","MediaUploadBytesSummary","MediaUploadOperationOutcome","MediaUploadStageEvent","MediaUploadTime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){var t=e.sessionContext,n=e.assetRequest,o=e.emitter,a=e.progressCalculator,i=e.retryState,l=e.params;this.sessionContext=t,this.request=n,this.assetID=n.assetID,this.asset=n.asset,this.retryState=i,this.$2=o,this.$3=a,this.$1=l.currentTimeProvider,this.$4=r("MediaUploadAssetStatus").REQUESTED,this.createdAt=this.$1(),this.uploadSummary=new(r("MediaUploadBytesSummary"))(l),this.progress={completedStages:new Set,calculated:{rawValue:0,percentageComplete:0}}}var t=e.prototype;return t.emitAssetEvent=function(t){this.$2.emitAssetEvent(t,this),(t===r("MediaUploadAssetEvent").ASSET_SUCCEED||t===r("MediaUploadAssetEvent").ASSET_REMOVED)&&this.recalculateProgressAndEmit()},t.emitStageEvent=function(t,n){this.$2.emitStageEvent(t,this,n),t===r("MediaUploadStageEvent").STAGE_SUCCEED&&(this.progress.completedStages.add(n),this.recalculateProgressAndEmit()),t===r("MediaUploadStageEvent").STAGE_PROGRESS&&this.recalculateProgressAndEmit()},t.emitStageEventForOperationOutcome=function(t,n){t===r("MediaUploadOperationOutcome").SUCCESS?this.emitStageEvent(r("MediaUploadStageEvent").STAGE_SUCCEED,n):t===r("MediaUploadOperationOutcome").CANCELED?this.emitStageEvent(r("MediaUploadStageEvent").STAGE_CANCELED,n):this.emitStageEvent(r("MediaUploadStageEvent").STAGE_FAILED,n)},t.recalculateProgressAndEmit=function(){var e=this.$3.calculateAssetProgress(this);this.sessionContext.recalculateProgressAndEmit(),e&&this.emitAssetEvent(r("MediaUploadAssetEvent").ASSET_PROGRESS)},t.$5=function(){this.uploadSummary.reset(),this.progress.completedStages.clear(),this.recalculateProgressAndEmit()},t.updateStatusAndEmit=function(t){if(this.$4!==t)switch(this.$4=t,t){case r("MediaUploadAssetStatus").REMOVED:this.emitAssetEvent(r("MediaUploadAssetEvent").ASSET_REMOVED);break;case r("MediaUploadAssetStatus").FAILED:this.emitAssetEvent(r("MediaUploadAssetEvent").ASSET_FAILED);break;case r("MediaUploadAssetStatus").COMPLETED:this.emitAssetEvent(r("MediaUploadAssetEvent").ASSET_SUCCEED);break;case r("MediaUploadAssetStatus").PROCESSING:this.emitAssetEvent(r("MediaUploadAssetEvent").ASSET_STARTED);break;case r("MediaUploadAssetStatus").UPLOADING:this.progress.lastAttemptStartedAt=this.$1();break;case r("MediaUploadAssetStatus").REQUESTED:case r("MediaUploadAssetStatus").SCHEDULED:this.$5();break}},t.isCompleted=function(){return this.$4===r("MediaUploadAssetStatus").COMPLETED},t.isSchedulable=function(){return this.$4===r("MediaUploadAssetStatus").REQUESTED||this.$4===r("MediaUploadAssetStatus").FAILED},t.isRemoved=function(){return this.$4===r("MediaUploadAssetStatus").REMOVED},t.isFailed=function(){return this.$4===r("MediaUploadAssetStatus").FAILED},t.__composeBaseSnapshot=function(){return{asset:this.asset,assetID:this.assetID,status:this.$4,createdAtMs:o("MediaUploadTime").timeToMilliseconds(this.createdAt),lastUploadStartedAtMs:o("MediaUploadTime").maybeTimeToMilliseconds(this.progress.lastAttemptStartedAt),metadata:this.metadata==null?void 0:{width:this.metadata.width,height:this.metadata.height,isSpherical:this.metadata.isSpherical,durationMs:o("MediaUploadTime").maybeTimeToMilliseconds(this.metadata.duration)},retries:{totalRetryAttempts:this.retryState.getRetryAttempts()},uploadSummary:this.uploadSummary.computeSnapshot(),percentageComplete:this.progress.calculated.percentageComplete}},e})();l.default=e}),98);
__d("MediaUploadExtrasStorage",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$2=new Map,this.$1=e}var t=e.prototype;return t.setFromObject=function(t){for(var e of Object.keys(t))this.set(e,t[e]);return this},t.set=function(t,n){return this.$2.set(t,n),this},t.getNumber=function(t){var e=this.getUnsafe(t);return e==null||typeof e=="number"?e:(this.$1.reportRecoverableError("Requested key "+t+" as number, but it was "+typeof e),null)},t.getString=function(t){var e=this.getUnsafe(t);return e==null||typeof e=="string"?e:(this.$1.reportRecoverableError("Requested key "+t+" as string, but it was "+typeof e),null)},t.getBoolean=function(t){var e=this.getUnsafe(t);return e==null||typeof e=="boolean"?e:(this.$1.reportRecoverableError("Requested key "+t+" as boolean, but it was "+typeof e),null)},t.getUnsafe=function(t){return this.$2.get(t)},t.getClassInstance=function(t,n){var e=this.getUnsafe(t);return e==null||e instanceof n?e:(this.$1.reportRecoverableError("Requested key "+t+" as "+String(n)+", but it was something else"),null)},e})();i.default=e}),66);
__d("MediaUploadFBAssetContext",["ErrorNormalizeUtils","MediaUploadAssetContext","MediaUploadExtrasStorage","MediaUploadStageEvent","MediaUploadTime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this,t)||this,n.request=t.assetRequest,n.sessionContext=t.sessionContext,n.processing={rawData:new(r("MediaUploadExtrasStorage"))(t.params)},n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.recordStageOutcome=function(t){var e=t.stage,n=t.outcome,o=t.rawErrorCode,a=t.rawErrorObject,i=t.displayError,l=t.errorAttributes,s=t.networkRequestID,u=a==null?void 0:r("ErrorNormalizeUtils").normalizeError(r("getErrorSafe")(a));this.$MediaUploadFBAssetContext$p_1={stage:e,outcome:n,rawErrorCode:o,errorObject:u,displayError:i,errorAttributes:l,networkRequestID:s}},n.emitStageEvent=function(n,o){n===r("MediaUploadStageEvent").STAGE_STARTED&&(this.$MediaUploadFBAssetContext$p_1=null),e.prototype.emitStageEvent.call(this,n,o)},n.composeSnapshot=function(){var e=this.__composeBaseSnapshot();return babelHelpers.extends({},e,{videoID:this.videoID,request:this.request,uploadServiceDomain:this.processing.uploadServiceDomain,hash:this.processing.pseudoHash==null?null:{hashValue:this.processing.pseudoHash.hashValue,calculationTimeCostMs:o("MediaUploadTime").timeToMilliseconds(this.processing.pseudoHash.calculationTimeCost)},lastAction:this.$MediaUploadFBAssetContext$p_1})},t.castOrThrow=function(n,r){var e=r.createThrowableError;if(n instanceof t)return n;var o;throw e('Provided asset context has incorrect type of "'+((o=n.constructor)==null?void 0:o.name)+'"')},t})(r("MediaUploadAssetContext"));l.default=e}),98);
__d("MediaUploadClientEventContext",[],(function(t,n,r,o,a,i){"use strict";var e=function(t,n){this.startedAt=t.currentTimeProvider(),this.entryPoint=n};i.default=e}),66);
__d("MediaUploadSessionContext",["MediaUploadExtrasStorage","MediaUploadSessionEvent","MediaUploadSessionStatus","MediaUploadTime"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set([r("MediaUploadSessionStatus").COMPLETED,r("MediaUploadSessionStatus").CANCELED,r("MediaUploadSessionStatus").FAILED]),s=(function(){function t(e){var t=e.sessionID,n=e.emitter,o=e.progressCalculator,a=e.params;this.assetsByID=new Map,this.sessionID=t,this.$1=n,this.$2=o,this.extras=new(r("MediaUploadExtrasStorage"))(a),this.$4=a.currentTimeProvider,this.$5=a.randomStringProvider,this.$6=r("MediaUploadSessionStatus").UNCONFIRMED,this.$3={createdAt:this.$4()},this.progress={retryID:this.$5(),publishingExtrasProvided:!1,publishingDone:!1,percentageComplete:0},this.releaseOnFinish=[]}var n=t.prototype;return n.emitSessionEvent=function(t){this.$1.emitSessionEvent(t,this),t===r("MediaUploadSessionEvent").PUBLISH_SUCCEED&&(this.progress.publishingDone=!0,this.recalculateProgressAndEmit()),t===r("MediaUploadSessionEvent").SESSION_FINISHED&&this.$7()},n.renewRetryID=function(){this.progress.retryID=this.$5()},n.updateLastError=function(t){this.__lastError=t},n.recalculateProgressAndEmit=function(){this.$2.calculateSessionProgress(this)&&this.emitSessionEvent(r("MediaUploadSessionEvent").SESSION_PROGRESS)},n.$7=function(){for(;this.releaseOnFinish.length>0;){var e=this.releaseOnFinish.pop();e.cancel()}},n.updateStatusAndEmit=function(n){if(this.$6!==n)switch(this.$6=n,this.progress.terminalStatus==null&&e.has(n)&&(this.progress.terminalStatus=n,this.emitSessionEvent(r("MediaUploadSessionEvent").SESSION_FINISHED)),n){case r("MediaUploadSessionStatus").CONFIRMED:this.progress.terminalStatus=void 0,this.$3.confirmedAt=this.$4(),this.emitSessionEvent(r("MediaUploadSessionEvent").SESSION_CONFIRMED);break;case r("MediaUploadSessionStatus").COMPLETED:this.emitSessionEvent(r("MediaUploadSessionEvent").SESSION_SUCCEED);break;case r("MediaUploadSessionStatus").CANCELED:this.emitSessionEvent(r("MediaUploadSessionEvent").SESSION_CANCELED);break;case r("MediaUploadSessionStatus").FAILED:this.emitSessionEvent(r("MediaUploadSessionEvent").SESSION_FAILED);break;case r("MediaUploadSessionStatus").PUBLISHING:this.emitSessionEvent(r("MediaUploadSessionEvent").PUBLISH_STARTED);break;default:}},n.getActiveAssets=function(){var e=[];for(var t of this.assetsByID.values())t.isRemoved()||e.push(t);return e},n.isCanceled=function(){return this.$6===r("MediaUploadSessionStatus").CANCELED},n.isPublished=function(){return this.$6===r("MediaUploadSessionStatus").COMPLETED},n.isPublishing=function(){return this.$6===r("MediaUploadSessionStatus").PUBLISHING},n.isConfirmed=function(){return this.$6===r("MediaUploadSessionStatus").CONFIRMED},n.isFailed=function(){return this.$6===r("MediaUploadSessionStatus").FAILED},n.__composeBaseSnapshot=function(){return{sessionID:this.sessionID,retryID:this.progress.retryID,status:this.$6,extras:this.extras,timing:{createdAtMs:o("MediaUploadTime").timeToMilliseconds(this.$3.createdAt),confirmedAtMs:o("MediaUploadTime").maybeTimeToMilliseconds(this.$3.confirmedAt)},terminalStatus:this.progress.terminalStatus,percentageComplete:this.progress.percentageComplete,publishingResponse:this.progress.publishingResponse,cancelReason:this.progress.cancelReason}},t})();l.default=s}),98);
__d("MediaUploadFBSessionContext",["ErrorNormalizeUtils","MediaUploadSessionContext","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this,{sessionID:t.sessionID,emitter:t.emitter,progressCalculator:t.progressCalculator,params:t.params})||this,n.entryPoint=t.entryPoint,n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.composeSnapshot=function(){var e=this.__composeBaseSnapshot();return babelHelpers.extends({},e,{entryPoint:this.entryPoint,lastError:this.__lastError==null?null:{errorObject:this.__lastError.rawErrorObject==null?null:r("ErrorNormalizeUtils").normalizeError(r("getErrorSafe")(this.__lastError.rawErrorObject)),rawErrorCode:this.__lastError.rawErrorCode}})},t.castOrThrow=function(n,r){var e=r.createThrowableError;if(n instanceof t)return n;var o;throw e('Provided session context has incorrect type of "'+((o=n.constructor)==null?void 0:o.name)+'"')},t})(r("MediaUploadSessionContext"));l.default=e}),98);
__d("MediaUploadFBClientEventContext",["ErrorNormalizeUtils","MediaUploadClientEventContext","MediaUploadFBAssetContext","MediaUploadFBSessionContext","MediaUploadTime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this,t.envParams,t.entryPoint)||this,n.entryPoint=t.entryPoint,t.context!=null&&t.context instanceof r("MediaUploadFBSessionContext")?n.sessionContext=t.context:t.context!=null&&t.context instanceof r("MediaUploadFBAssetContext")&&(n.sessionContext=t.context.sessionContext,n.assetContext=t.context),n}babelHelpers.inheritsLoose(t,e),t.castOrThrow=function(n,r){if(n instanceof t)return n;var e;throw r.createThrowableError('Provided client event context has incorrect type of "'+((e=n.constructor)==null?void 0:e.name)+'"')};var n=t.prototype;return n.composerSnapshot=function(){var e,t,n,a,i=((e=this.errorInfo)==null?void 0:e.rawErrorObject)==null?void 0:r("ErrorNormalizeUtils").normalizeError(r("getErrorSafe")((t=this.errorInfo)==null?void 0:t.rawErrorObject));return{entryPoint:this.entryPoint,startedAtMs:o("MediaUploadTime").timeToMilliseconds(this.startedAt),sessionSnapshot:(n=this.sessionContext)==null?void 0:n.composeSnapshot(),assetSnapshot:(a=this.assetContext)==null?void 0:a.composeSnapshot(),errorObject:i}},t})(r("MediaUploadClientEventContext"));l.default=e}),98);
__d("MediaUploadEventEmitterAdapter",["EventEmitter","MediaUploadFBAssetContext","MediaUploadFBClientEventContext","MediaUploadFBSessionContext","MediaUploadFBStage"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return t},s=(function(){function t(e){this.$2=new(r("EventEmitter")),this.$1=e,this.emitter=this.$3(),this.subscriber=this.$4()}var n=t.prototype;return n.$3=function(){var t=this,n=function(n){var e=r("MediaUploadFBSessionContext").castOrThrow(n,t.$1);return e.composeSnapshot()},o=function(n){var e=r("MediaUploadFBAssetContext").castOrThrow(n,t.$1);return e.composeSnapshot()},a=this.$2,i=function(r){try{for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];a.emit.apply(a,[e(r)].concat(o))}catch(e){t.$1.reportRecoverableError("Session pub/sub chain failed for event "+String(r),e)}};return{emitClientEvent:function(n,o){i(n,r("MediaUploadFBClientEventContext").castOrThrow(o,t.$1).composerSnapshot())},emitSessionEvent:function(t,r){i(t,n(r))},emitAssetEvent:function(t,r){i(t,n(r.sessionContext),o(r))},emitStageEvent:function(a,l,s){var e=r("MediaUploadFBStage").cast(String(s));if(e==null){t.$1.reportRecoverableError("Invalid stage value, it must be MediaUploadFBStage, ignoring");return}i(a,n(l.sessionContext),o(l),e)}}},n.$4=function(){var t=this,n=function(n,r){try{n()}catch(e){t.$1.reportRecoverableError("Stage pub/sub chain failed for event "+r(),e)}};return{addClientEventListener:function(o,a){var r=t.$2.addListener(e(o),function(e){return n(function(){return a(e)},function(){return String(o)})});return{cancel:function(){return r.remove()}}},addSessionEventListener:function(o,a){var r=t.$2.addListener(e(o),function(e){return n(function(){return a(e)},function(){return String(o)})});return{cancel:function(){return r.remove()}}},addAssetEventListener:function(o,a){var r=t.$2.addListener(e(o),function(e,t){return n(function(){return a(e,t)},function(){return String(o)})});return{cancel:function(){return r.remove()}}},addStageEventListener:function(o,a,i){var r=t.$2.addListener(e(o),function(e,t,r){a===r&&n(function(){return i(e,t)},function(){return String(o)+"  "+String(r)})});return{cancel:function(){return r.remove()}}}}},t})();l.default=s}),98);
__d("MediaUploadExecutor",["Promise"],(function(t,n,r,o,a,i){"use strict";var e,l=(function(){function t(e){e===void 0&&(e=1),this.$1=[],this.$3=0,this.$2=e}var r=t.prototype;return r.schedule=function(r){var t=this;return new(e||(e=n("Promise")))(function(e){var n=function(){var t=r();return t.finally(e),t};t.$1.push(n),t.$4()})},r.$4=function(){var e=this;if(!(this.$3>=this.$2||this.$1.length===0)){var t=this.$1.shift();t().finally(function(){e.$3--,e.$4()}),this.$3++}},t})();i.default=l}),66);
__d("MediaUploadAssetRequest",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){var e=t.assetID,n=t.asset,r=t.extras;this.assetID=e,this.asset=n,this.extras=r};i.default=e}),66);
__d("MediaUploadFBAssetRequest",["MediaUploadAssetRequest"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n,r=t.assetID,o=t.asset,a=t.extras,i=t.attributes;return n=e.call(this,{assetID:r,asset:o,extras:a})||this,n.attributes={targetID:i.targetID,actorID:i.actorID,hasFileBeenReplaced:i.hasFileBeenReplaced,composerDialogVersion:i.composerDialogVersion,publisherActionSource:i.publisherActionSource,creatorProduct:i.creatorProduct,composerSessionID:i.composerSessionID},n}return babelHelpers.inheritsLoose(t,e),t.castOrThrow=function(n,r){var e=r.createThrowableError;if(n instanceof t)return n;var o;throw e('Provided asset request has incorrect type of "'+((o=n.constructor)==null?void 0:o.name)+'"')},t})(r("MediaUploadAssetRequest"));l.default=e}),98);
__d("MediaUploadClient",["MediaUploadClientResult"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$4=new Map,this.$1=e.implementation,this.$2=e.sessionStrategy,this.$3=e.envParams,this.$1.subscribeToHooks(),this.$3.isSupported()||this.$3.reportRecoverableError("This browser does not support this version of the Media Upload SDK")}var t=e.prototype;return t.cancelSession=function(t,n){if(!this.$3.isSupported())return r("MediaUploadClientResult").UNSUPPORTED_BROWSER;var e=this.$4.get(t);return e==null?r("MediaUploadClientResult").SESSION_NOT_FOUND:this.$2.cancel(e,n)},t.cleanSession=function(t){return this.$3.isSupported()?this.$4.delete(t)?r("MediaUploadClientResult").ACCEPTED:r("MediaUploadClientResult").SESSION_NOT_FOUND:r("MediaUploadClientResult").UNSUPPORTED_BROWSER},t.retrySession=function(t){if(!this.$3.isSupported())return r("MediaUploadClientResult").UNSUPPORTED_BROWSER;var e=this.$4.get(t);return e==null?r("MediaUploadClientResult").SESSION_NOT_FOUND:this.$2.retry(e)},t.$5=function(t){var e=this.$4.get(t);return e==null&&(e=this.$1.createSessionContext(t),this.$4.set(t,e)),e},t.updateSessionExtras=function(t,n){if(!this.$3.isSupported())return r("MediaUploadClientResult").UNSUPPORTED_BROWSER;var e=this.$5(t);return this.$2.updateSessionExtras(e,n,!1)},t.confirmSession=function(t,n,o){if(!this.$3.isSupported())return r("MediaUploadClientResult").UNSUPPORTED_BROWSER;var e=this.$5(t),a;return o!=null&&(a=this.$2.updateSessionExtras(e,o,!0),a!==r("MediaUploadClientResult").ACCEPTED)||(a=this.$2.syncAssetUploads(e,n),a!==r("MediaUploadClientResult").ACCEPTED)?a:this.$2.confirm(e)},t.startUploads=function(t,n){if(!this.$3.isSupported()){var e={};return n.forEach(function(t){return e[t.assetID]=r("MediaUploadClientResult").UNSUPPORTED_BROWSER}),e}var o=this.$5(t);return this.$2.uploadAssets(o,n)},t.removeUpload=function(t,n){if(!this.$3.isSupported())return r("MediaUploadClientResult").UNSUPPORTED_BROWSER;var e=this.$4.get(t);return e==null?r("MediaUploadClientResult").SESSION_NOT_FOUND:this.$2.removeAsset(e,n)},e})();l.default=e}),98);
__d("MediaUploadFBClient",["MediaUploadClient"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){return e.call(this,t)||this}return babelHelpers.inheritsLoose(t,e),t})(r("MediaUploadClient"));l.default=e}),98);
__d("MediaUploadFBDefaultServerConfigurationRetrieverQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24229633186643574"}),null);
__d("MediaUploadFBDefaultServerConfigurationRetrieverQuery.graphql",["MediaUploadFBDefaultServerConfigurationRetrieverQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"source_type"}],t=[{alias:null,args:null,kind:"ScalarField",name:"uri",storageKey:null}],r=[{alias:null,args:null,kind:"ScalarField",name:"service_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_domain",storageKey:null}],o=[{alias:null,args:null,concreteType:"MediaUploadConfiguration",kind:"LinkedField",name:"media_upload_config",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"source_type",variableName:"source_type"}],concreteType:"MediaUploadVideoMetadataValidation",kind:"LinkedField",name:"video_metadata_validation",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"min_size_kb",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size_kb",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"min_duration_secs",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_duration_secs",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"min_width",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"min_height",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"min_aspect_ration",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_aspect_ration",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"allowed_extensions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"accept_dimensions_from_player",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"MediaUploadNetworkStart",kind:"LinkedField",name:"network_start",plural:!1,selections:t,storageKey:null},{alias:null,args:null,concreteType:"MediaUploadNetworkReceive",kind:"LinkedField",name:"network_receive",plural:!1,selections:t,storageKey:null},{alias:null,args:null,concreteType:"MediaUploadNetworkUploadService",kind:"LinkedField",name:"network_upload_service",plural:!1,selections:[{alias:null,args:null,concreteType:"MediaUploadNetworkUploadServiceTarget",kind:"LinkedField",name:"default",plural:!1,selections:r,storageKey:null},{alias:null,args:null,concreteType:"MediaUploadNetworkUploadServiceTarget",kind:"LinkedField",name:"targeted",plural:!1,selections:r,storageKey:null},{alias:null,args:null,concreteType:"MediaUploadNetworkUploadServiceTracing",kind:"LinkedField",name:"tracing",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"enabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"min_file_size_kb",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"MediaUploadNetworkMonitor",kind:"LinkedField",name:"network_monitor",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"network_probe_enabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"internet_probe_enabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"internet_probe_timeout_ms",storageKey:null},{alias:null,args:null,concreteType:"MediaUploadBackoffPolicy",kind:"LinkedField",name:"internet_probe_backoff",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"backoff_initial_ms",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backoff_jitter_ms",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backoff_exp_base_ms",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backoff_exp_multiplier",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backoff_max_ms",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"limits_total_retry_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"limits_total_time_ms",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"stall_detection_enabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"stall_detection_timeout_ms",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"MediaUploadFBDefaultServerConfigurationRetrieverQuery",selections:o,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"MediaUploadFBDefaultServerConfigurationRetrieverQuery",selections:o},params:{id:n("MediaUploadFBDefaultServerConfigurationRetrieverQuery_facebookRelayOperation"),metadata:{},name:"MediaUploadFBDefaultServerConfigurationRetrieverQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("isOndemandHost",[],(function(t,n,r,o,a,i){"use strict";var e=/(^|\.)(od[0-9]+\.\w{4}|\d{4,}\.od|my-od\.|my-od-[0-9]\.)/;function l(t){return e.test(t)}i.default=l}),66);
__d("MediaUploadFBDefaultServerConfigurationRetriever",["MediaUploadCancelablePromise","MediaUploadClientEvent","MediaUploadFBClientEventContext","MediaUploadFBDefaultServerConfigurationRetrieverQuery.graphql","MediaUploadOperationOutcome","MediaUploadTime","RelayFBEnvironment","RelayHooks","URI","isOndemandHost","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=e!==void 0?e:e=n("MediaUploadFBDefaultServerConfigurationRetrieverQuery.graphql"),c={metadataValidation:{minSizeKB:1,maxSizeKB:10*1024*1024,minDuration:o("MediaUploadTime").secondsToTime(1),maxDuration:o("MediaUploadTime").hoursToTime(24),minWidth:100,minHeight:100,minAspectRatio:.5,maxAspectRatio:4,extensions:new Set(["3g2","3gp","3gpp","asf","avi","dat","divx","dv","f4v","flv","gif","m2ts","m4v","mkv","mod","mov","mp4","mpe","mpeg","mpeg4","mpg","mts","nsv","ogm","ogv","qt","rmvb","tmp","tod","ts","vob","webm","wmv"]),acceptDimensionsFromPlayer:!1},startRequest:{baseURI:new(s||(s=r("URI")))("https://vupload-edge.facebook.com/ajax/video/upload/requests/start/")},startRequestPath:"/ajax/video/upload/requests/start/",receiveRequest:{baseURI:new s("https://vupload-edge.facebook.com/ajax/video/upload/requests/receive/")},receiveRequestPath:"/ajax/video/upload/requests/receive/",uploadService:{defaultService:{serviceName:"rupload",serviceDomain:"facebook.com",serviceConsumer:"fb_video"},targetedService:null,tracing:{enabled:!1,minFileSizeKB:102400},oculusCreatorStudio:"meta_quest_media_studio"},networkMonitor:{networkProbe:{enabled:!0},internetProbe:{enabled:!1,timeout:o("MediaUploadTime").secondsToTime(2),backoffPolicy:{backoff:{initial:o("MediaUploadTime").secondsToTime(10),jitter:o("MediaUploadTime").secondsToTime(0),expBase:o("MediaUploadTime").secondsToTime(1),expMultiplier:2,max:o("MediaUploadTime").secondsToTime(60)},limits:{}}},stallDetector:{enabled:!1,timeout:o("MediaUploadTime").secondsToTime(30)}}},d=(function(){function e(e){this.$5=!0,this.$1=e.entryPoint,this.$3=e.emitter,this.$2=e.setters,this.$4=e.envParams}var t=e.prototype;return t.$6=function(){return o("RelayHooks").fetchQuery(r("RelayFBEnvironment"),u,{source_type:this.$1.sourceType})},t.run=function(t){var e=this,n=new(r("MediaUploadFBClientEventContext"))({entryPoint:this.$1,envParams:this.$4,context:t});return this.$5?(this.$3.emitClientEvent(r("MediaUploadClientEvent").CLIENT_CONFIG_REQUESTED,n),new(r("MediaUploadCancelablePromise"))(function(t){try{var o=e.$6().subscribe({error:(function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t})(function(o){e.$4.reportRecoverableError("Error getting client configuration",o),e.$3.emitClientEvent(r("MediaUploadClientEvent").CLIENT_CONFIG_FAILED,n),e.$7(null),t(r("MediaUploadOperationOutcome").SUCCESS)}),next:function(a){e.$3.emitClientEvent(r("MediaUploadClientEvent").CLIENT_CONFIG_RECEIVED,n),e.$7(a),e.$5=!1,t(r("MediaUploadOperationOutcome").SUCCESS)}});return{cancel:function(){o.unsubscribe()}}}catch(o){e.$4.reportRecoverableError("Error requesting client configuration",o),e.$7(null),e.$3.emitClientEvent(r("MediaUploadClientEvent").CLIENT_CONFIG_FAILED,n),t(r("MediaUploadOperationOutcome").SUCCESS)}})):(this.$3.emitClientEvent(r("MediaUploadClientEvent").CLIENT_CONFIG_CACHED,n),r("MediaUploadCancelablePromise").resolve(r("MediaUploadOperationOutcome").SUCCESS))},t.$8=function(t){var e,n,r,o,a,i,l;if((t==null||(e=t.default)==null?void 0:e.service_name)==null||(t==null||(n=t.default)==null?void 0:n.service_domain)==null)this.$4.reportRecoverableError("Invalid configuration for default endpoint of the Upload Service, falling back to default"),l=c.uploadService.defaultService;else{var s,u;l={serviceName:t==null||(s=t.default)==null?void 0:s.service_name,serviceDomain:t==null||(u=t.default)==null?void 0:u.service_domain,serviceConsumer:c.uploadService.defaultService.serviceConsumer}}var d;if((t==null||(r=t.targeted)==null?void 0:r.service_name)!=null&&(t==null||(o=t.targeted)==null?void 0:o.service_domain)!=null){var m,p;d={serviceName:t==null||(m=t.targeted)==null?void 0:m.service_name,serviceDomain:t==null||(p=t.targeted)==null?void 0:p.service_domain}}else(t==null?void 0:t.targeted)==null?d=null:(this.$4.reportRecoverableError("Invalid configuration for target endpoint of the Upload Service, falling back to default"),d=c.uploadService.targetedService);var _;if((t==null||(a=t.tracing)==null?void 0:a.enabled)!=null&&(t==null||(i=t.tracing)==null?void 0:i.min_file_size_kb)!=null){var f,g;_={enabled:t==null||(f=t.tracing)==null?void 0:f.enabled,minFileSizeKB:t==null||(g=t.tracing)==null?void 0:g.min_file_size_kb}}else this.$4.reportRecoverableError("Invalid configuration for tracing in the Upload Service, falling back to default"),_=c.uploadService.tracing;var h=!1;this.$1.sourceType==="vr_creator_studio"&&(h=!0,l.serviceConsumer=c.uploadService.oculusCreatorStudio),this.$2.uploadService({defaultService:l,targetedService:d,tracing:_,includeAccessToken:h})},t.$9=function(t){var e;if((t==null?void 0:t.min_size_kb)==null||(t==null?void 0:t.max_size_kb)==null||(t==null?void 0:t.min_width)==null||(t==null?void 0:t.min_height)==null||(t==null?void 0:t.min_duration_secs)==null||(t==null?void 0:t.max_duration_secs)==null||(t==null?void 0:t.min_aspect_ration)==null||(t==null?void 0:t.max_aspect_ration)==null||(t==null?void 0:t.allowed_extensions)==null||(t==null?void 0:t.accept_dimensions_from_player)==null)this.$4.reportRecoverableError("Invalid metadata validation, falling back to default"),e=babelHelpers.extends({sourceType:this.$1.sourceType},c.metadataValidation),this.$1.sourceType==="vr_creator_studio"&&(e.maxSizeKB=100*1024*1024);else{var n=t==null?void 0:t.max_duration_secs;e={sourceType:this.$1.sourceType,minSizeKB:t==null?void 0:t.min_size_kb,maxSizeKB:t==null?void 0:t.max_size_kb,minWidth:t==null?void 0:t.min_width,minHeight:t==null?void 0:t.min_height,minAspectRatio:t==null?void 0:t.min_aspect_ration,maxAspectRatio:t==null?void 0:t.max_aspect_ration,extensions:new Set(t==null?void 0:t.allowed_extensions),acceptDimensionsFromPlayer:t==null?void 0:t.accept_dimensions_from_player,minDuration:o("MediaUploadTime").secondsToTime(t==null?void 0:t.min_duration_secs),maxDuration:o("MediaUploadTime").secondsToTime(n)}}this.$2.metadataValidation(e)},t.$10=function(t){return(t==null?void 0:t.backoff_initial_ms)==null?null:{backoff:{initial:o("MediaUploadTime").millisecondsToTime(t==null?void 0:t.backoff_initial_ms),jitter:(t==null?void 0:t.backoff_jitter_ms)==null?null:o("MediaUploadTime").millisecondsToTime(t==null?void 0:t.backoff_jitter_ms),expBase:(t==null?void 0:t.backoff_exp_base_ms)==null?null:o("MediaUploadTime").millisecondsToTime(t==null?void 0:t.backoff_exp_base_ms),expMultiplier:t==null?void 0:t.backoff_exp_multiplier,max:(t==null?void 0:t.backoff_max_ms)==null?null:o("MediaUploadTime").millisecondsToTime(t==null?void 0:t.backoff_max_ms)},limits:{totalRetryCount:t==null?void 0:t.limits_total_retry_count,totalTime:(t==null?void 0:t.limits_total_time_ms)==null?null:o("MediaUploadTime").millisecondsToTime(t==null?void 0:t.limits_total_time_ms)}}},t.$11=function(t){var e,n=this.$10(t==null?void 0:t.internet_probe_backoff);if((t==null?void 0:t.network_probe_enabled)==null||(t==null?void 0:t.internet_probe_enabled)==null||(t==null?void 0:t.internet_probe_timeout_ms)==null||n==null||(t==null?void 0:t.stall_detection_enabled)==null||(t==null?void 0:t.stall_detection_timeout_ms)==null)this.$4.reportRecoverableError("Invalid network monitor configuration, falling back to default"),e=c.networkMonitor;else{var r=t.network_probe_enabled,a=t.internet_probe_enabled,i=t.internet_probe_timeout_ms,l=t.stall_detection_enabled,s=t.stall_detection_timeout_ms;e={networkProbe:{enabled:r},internetProbe:{enabled:a,timeout:o("MediaUploadTime").millisecondsToTime(i),backoffPolicy:n},stallDetector:{enabled:l,timeout:o("MediaUploadTime").millisecondsToTime(s)}}}this.$2.networkMonitor(e)},t.$12=function(t){var e;if((t==null?void 0:t.uri)==null)this.$4.reportRecoverableError("Invalid metadata validation, falling back to default"),this.$1.sourceType==="vr_creator_studio"?e={baseURI:new(s||(s=r("URI")))("https://"+window.location.hostname+c.startRequestPath)}:e=c.startRequest;else{var n=new(s||(s=r("URI")))(t==null?void 0:t.uri);e={baseURI:n}}this.$2.startRequest(e)},t.$13=function(t){var e;if((t==null?void 0:t.uri)==null)this.$4.reportRecoverableError("Invalid metadata validation, falling back to default"),this.$1.sourceType==="vr_creator_studio"?e={baseURI:new(s||(s=r("URI")))("https://"+window.location.hostname+c.receiveRequestPath)}:e=c.receiveRequest;else{var n=new(s||(s=r("URI")))(t==null?void 0:t.uri);e={baseURI:n}}this.$2.receiveRequest(e)},t.$7=function(t){var e,n,r,o,a;this.$12(t==null||(e=t.media_upload_config)==null?void 0:e.network_start),this.$13(t==null||(n=t.media_upload_config)==null?void 0:n.network_receive),this.$8(t==null||(r=t.media_upload_config)==null?void 0:r.network_upload_service),this.$9(t==null||(o=t.media_upload_config)==null?void 0:o.video_metadata_validation),this.$11(t==null||(a=t.media_upload_config)==null?void 0:a.network_monitor)},e})();function m(e){return e}l.default=d}),98);
__d("MediaUploadFBStageOutcome",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["SUCCESS","CANCEL","EXCEPTION","INTERNAL_FAILURE","UNSUPPORTED_FEATURE","ASSET_IS_NOT_FILE","ASSET_IS_NOT_SUPPORTED","REQUEST_ERROR","INVALID_SERVER_RESPONSE","MISSING_MANDATORY_DATA"]),l=e;i.default=l}),66);
__d("MediaUploadFBFileHasher",["MediaUploadFBStage","MediaUploadFBStageOutcome","MediaUploadOperationOutcome","MediaUploadStageEvent"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=r("MediaUploadFBStage").HASHING,this.$2=e.pseudoHasher,this.$3=e.fullHasher}var t=e.prototype;return t.process=async function(t){t.emitStageEvent(r("MediaUploadStageEvent").STAGE_STARTED,this.$1);try{await this.$4(t)}catch(e){t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").EXCEPTION,rawErrorObject:e})}return t.emitStageEvent(r("MediaUploadStageEvent").STAGE_SUCCEED,this.$1),r("MediaUploadOperationOutcome").SUCCESS},t.$5=function(t,n,r){return n==null?Promise.resolve():n.hash(t.file).then(function(e){return e.outcome==="SUCCESS"&&r(e.value),e})},t.$4=async function(t){var e=this,n=t.asset.dataAsFile();if(n==null){t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").MISSING_MANDATORY_DATA});return}var o=await this.$5(n,this.$3,function(e){return t.processing.fullHash=e}).then(async function(r){return(r==null?void 0:r.outcome)==="SUCCESS"?(t.processing.pseudoHash=t.processing.fullHash,[r,r]):[r,await e.$5(n,e.$2,function(e){return t.processing.pseudoHash=e})]});for(var a of o)if((a==null?void 0:a.outcome)==="FILE_TOO_LARGE"){t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").ASSET_IS_NOT_SUPPORTED});return}else if((a==null?void 0:a.outcome)==="FAILURE"){t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").INTERNAL_FAILURE,rawErrorCode:a==null?void 0:a.rawErrorCode,rawErrorObject:a==null?void 0:a.rawErrorObject});return}t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").SUCCESS})},e})();l.default=e}),98);
__d("MediaUploadNetworkStatus",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({UNKNOWN:"Unknown",CONNECTED:"Connected",DISCONNECTED:"Disconnected",TIMEOUT:"TimedOut"}),l=e;i.default=l}),66);
__d("MediaUploadFBInternetProbe",["AsyncRequest","MediaUploadCancelablePromise","MediaUploadNetworkStatus","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e="https://rupload.facebook.com/fb_video/ping-",s=(function(){function t(t,n){this.$2=t,this.$1=n,this.$3=[""+e+r("uuidv4")()]}var n=t.prototype;return n.$4=function(t){return new(r("MediaUploadCancelablePromise"))(function(e){var n=new(r("AsyncRequest"))().setAllowCrossOrigin(!0).setAllowCredentials(!0).setMethod("GET").setURI(t).setReadOnly(!0).setOption("suppressEvaluation",!0).setHandler(function(t){var n,o=t==null||(n=t.payload)==null?void 0:n.status;e(o===200?r("MediaUploadNetworkStatus").CONNECTED:r("MediaUploadNetworkStatus").DISCONNECTED)}).setTransportErrorHandler(function(){e(r("MediaUploadNetworkStatus").DISCONNECTED)}).setErrorHandler(function(){e(r("MediaUploadNetworkStatus").DISCONNECTED)});return n.send()||e(r("MediaUploadNetworkStatus").DISCONNECTED),{cancel:function(){n.abort()}}})},n.$5=function(){var e=this;return new Promise(function(t){e.$1.delayedExecutor(e.$2.timeout,function(){return t(r("MediaUploadNetworkStatus").TIMEOUT)})})},n.probe=async function(){var e=this,t=this.$3.map(function(t){return e.$4(t)}),n=Promise.race([this.$5()].concat(t.map(function(e){return e.promise}))),r=await n;return t.forEach(function(e){return e.cancel()}),r},t})();l.default=s}),98);
__d("MediaUploadFBLocalAssetStrategy",["MediaUploadPipeline"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e.envParams,this.metadataParser=e.metadataParser,this.metadataValidator=e.metadataValidator,this.fileHasher=e.fileHasher}var t=e.prototype;return t.run=function(t){var e=this,n=new(r("MediaUploadPipeline"))(this.$1);n.addPlainStep(function(){return e.metadataParser.parse(t)}),n.addPlainStep(function(){return e.metadataValidator.validate(t,e.metadataParser.retriveRawMetadata(t))});var o=this.fileHasher;return o!=null&&n.addPlainStep(function(){return o.process(t)}),n.run()},e})();l.default=e}),98);
__d("ISOVideoBoxConstants",[],(function(t,n,r,o,a,i){"use strict";var e=8,l=[255,204,130,99,248,85,74,147,136,20,88,122,2,82,31,221],s=[174,36,178,77,60,143,79,24,138,123,224,9,193,56,53,193];i.BOX_BASE_SIZE=e,i.GSPHERICAL_UUID=l,i.FBSPHERICAL_UUID=s}),66);
__d("FBSphericalMetadataTags",[],(function(t,n,r,o,a,i){var e=Object.freeze({SPHERICAL:"FBSpherical:Spherical",INITIAL_VERTICAL_FOV_DEGREES:"FBSpherical:InitialVerticalFOVDegrees",GUIDE:"FBSpherical:Guide",HOTSPOT:"FBSpherical:HotspotMetadata",USED_360_DIRECTOR:"FBSpherical:Used360Director"});i.default=e}),66);
__d("GSphericalMetadataTags",[],(function(t,n,r,o,a,i){var e=Object.freeze({SPHERICAL:"GSpherical:Spherical",INITIAL_VIEW_HEADING_DEGREES:"GSpherical:InitialViewHeadingDegrees",INITIAL_VIEW_PITCH_DEGREES:"GSpherical:InitialViewPitchDegrees",PROJECTION_TYPE:"GSpherical:ProjectionType",STEREO_MODE:"GSpherical:StereoMode",STITCHED:"GSpherical:Stitched",STITCHING_SOFTWARE:"GSpherical:StitchingSoftware",CROPPED_AREA_IMAGE_WIDTH_PIXELS:"GSphercal:CroppedAreaImageWidthPixels",CROPPED_AREA_IMAGE_HEIGHT_PIXELS:"GSphercal:CroppedAreaImageHeightPixels",CROPPED_AREA_LEFT_PIXELS:"GSphercal:CroppedAreaLeftPixels",CROPPED_AREA_TOP_PIXELS:"GSphercal:CroppedAreaTopPixels",FULL_PANO_WIDTH_PIXELS:"GSphercal:FullPanoWidthPixels",FULL_PANO_HEIGHT_PIXELS:"GSphercal:FullPanoHeightPixels"});i.default=e}),66);
__d("SphericalVideoMetadataTags",["FBSphericalMetadataTags","GSphericalMetadataTags"],(function(t,n,r,o,a,i,l){"use strict";var e=Object.freeze({GSPHERICAL:r("GSphericalMetadataTags"),FBSPHERICAL:r("FBSphericalMetadataTags")});l.default=e}),98);
__d("VideoSphericalMetadataUtil",["SphericalVideoMetadataTags","VideoProjection","VideoStereoFormat"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(!e)return null;e=e.replace(/\0/g,"");var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t}function s(e){return Object.values(r("VideoProjection")).includes(e)?e:null}function u(e){return Object.values(r("VideoStereoFormat")).includes(e)?e:null}function c(e){for(var t=e.getElementsByTagNameNS("*","*"),n=null,o=0;o<t.length;o++){var a=t[o],i=a.nodeName,l=a.parentElement;if(i!=="parsererror"&&l&&l.nodeName!=="parsererror"&&Object.values(r("SphericalVideoMetadataTags").GSPHERICAL).indexOf(i)<0&&Object.values(r("SphericalVideoMetadataTags").GSPHERICAL).indexOf(l.nodeName)<0){n||(n="");var s=a.outerHTML;n+="<"+i+s.slice(i.length+1,-(i.length+1))+i+">"}}return n}function d(e,t,n,r,o){if(t!==null&&n!==null&&r!==null&&o!==null&&e.projectionType==="equirectangular"&&(e.stereoMode==="left-right"||e.stereoMode==="top-bottom")){var a=parseInt(t,10),i=parseInt(n,10),l=parseInt(r,10),s=parseInt(o,10);if(Math.abs(a-l/2)<=1&&Math.abs(i-s)<=1)return!0}return!1}function m(e,t,n){return new File([e],t,{type:n})}function p(e){for(var t=new ArrayBuffer(e.length),n=new DataView(t),r=0;r<e.length;r++)n.setUint8(r,e.charCodeAt(r));return t}function _(e,t,n){var r=e.buffer;return m(r,t,n)}function f(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}l.parseXMLToDocument=e,l.stringToProjectionType=s,l.stringToStereoMode=u,l.getUnsupportedGSphericalTagsXML=c,l.isGoogleVR180=d,l.arrayBufferToFile=m,l.stringToArrayBuffer=p,l.bufferToFile=_,l.uuidArrayEquals=f}),98);
__d("VideoUploadMetadataParserErrorCode",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["FILE_READING_NOT_SUPPORTED","UNKNOWN_FILE_EXTENSION","INTERNAL_FAILURE"]),l=e;i.default=l}),66);
__d("checkForSphericalTag",["VideoSphericalMetadataUtil"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("VideoSphericalMetadataUtil").parseXMLToDocument(e);if(!t)return!1;var n=t.getElementsByTagNameNS("*","Spherical");if(n.length===0)return!1;var r=n[0],a=r.childNodes[0].nodeValue;return a.toLowerCase()==="true"}l.default=e}),98);
__d("getVideo64BitAtomLength",["Int64"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,o){var a=e.getUint32(t+o+n),i=e.getUint32(t+n+o+o);return new(r("Int64"))(i,a).toNumber()}l.default=e}),98);
__d("VideoUploadMetadataParser",["Bootloader","ErrorNormalizeUtils","ISOVideoBoxConstants","VideoSphericalMetadataUtil","VideoUploadFeatureDetector","VideoUploadMetadataParserErrorCode","checkForSphericalTag","err","fileSlice","getErrorSafe","getVideo64BitAtomLength","gkx","nullthrows","promiseDone"],(function(t,n,r,o,a,i,l){var e=4,s=4,u=r("gkx")("26232")?20482048:5242880,c=24,d=88,m=20,p=16,_=4,f=84,g=20,h=62,y=4,C=12,b=12,v=16,S=16,R={0:36,1:52,2:72},L=1,E=1,k=4,I=1,T=1,D=4,x=4,$=16,P=32,N=34,M=(function(){function t(e,t,n,r){this.$1=e,this.$2=t==null?function(){}:t,this.$4=n,this.$5=!0,this.$3=r}var n=t.prototype;return n.getHandler=function(){return this.$2},n.$6=function(t){this.$2(t),this.$3!=null&&this.$3({success:!0,metadata:t})},n.$7=function(t,n){if(this.$2(null),this.$3!=null){var e=n==null?void 0:r("ErrorNormalizeUtils").normalizeError(r("getErrorSafe")(n));this.$3({success:!1,errorCode:t,errorObject:e})}},n.parse=function(){if(!o("VideoUploadFeatureDetector").supportsFileReading())return this.$7(r("VideoUploadMetadataParserErrorCode").FILE_READING_NOT_SUPPORTED),null;switch(this.$1.getExtension()){case"mp4":case"mov":case"m4v":case"3gp":case"3g2":break;case"mkv":if(r("gkx")("26231"))break;default:return this.$7(r("VideoUploadMetadataParserErrorCode").UNKNOWN_FILE_EXTENSION),null}return this.$8()},n.$8=async function(){var e=this,t=this.$9(),n=this.$10(this.$1.getFile(),1e4);return new Promise(function(o,a){try{r("promiseDone")(Promise.all([t,n]).then(function(t){var n=t[0];if(n.completed){var r=t[1];n.videoPlayerData=r,e.$6(n)}o(n)},function(t){e.$7(r("VideoUploadMetadataParserErrorCode").INTERNAL_FAILURE,t),a(t)}))}catch(t){e.$7(r("VideoUploadMetadataParserErrorCode").INTERNAL_FAILURE,t),a(t)}})},n.$9=async function(){var e=this,t;switch(this.$1.getExtension()){case"mp4":case"mov":case"m4v":case"3gp":case"3g2":t=this.$11(0,Math.min(u,this.$1.getSize()||0),null);break;case"mkv":await new Promise(function(n,o){r("Bootloader").loadModules(["VideoUploadMetadataMKVParser"],function(r){var o=new r(e.$1);t=o.parse(),n()},"VideoUploadMetadataParser")});break;default:throw new Error("Unrecognized file extension in _parseImpl")}return r("nullthrows")(t)},n.$11=function(t,n,o){var e=this,a=new FileReader;return new Promise(function(i,l){a.onload=async function(r){try{if(!(a.result instanceof ArrayBuffer))throw new Error("reader.result is something other than ArrayBuffer");var s=e.$12(new DataView(a.result),0,n-t,t,o);if(s.completed){var c=e.$13(s);c.completed=!0,i(c)}else{var d=await e.$11(t+s.nextOffset,Math.min(e.$1.getSize()||0,t+s.nextOffset+u),s);i(d)}}catch(e){l(e)}};var s=e.$1.getFile();a.readAsArrayBuffer(r("fileSlice").call(s,t,n))})},n.$10=function(t,n){return!this.$4||!window.URL||!window.URL.createObjectURL||!t?null:new Promise(function(e,r){if(!t.type.startsWith("video/")){r("Incorrect file type, expected video");return}var o=document.createElement("video"),a=window.setTimeout(function(){i(),r("Video onloadedmetadata timed out")},n);function i(){URL.revokeObjectURL(o.src),window.clearTimeout(a),o.remove()}o.onloadedmetadata=function(){if(o.videoWidth===0||o.videoHeight===0){i(),r("Video onloadedmetadata corrupt metadata");return}var t={width:o.videoWidth,height:o.videoHeight};i(),e(t)},o.onerror=function(){var e;i(),r("Video error: "+(((e=o.error)==null?void 0:e.message)||"Unknown error"))},o.src=URL.createObjectURL(t)})},n.$14=function(t,n,r){for(var e=[],o=0;o<r;o++)e.push(String.fromCharCode(t.getUint8(n+o)));return e.join("")},n.$15=function(t,n,r){var e={version:null,ambisonic_type:null,ambisonic_order:null,ambisonic_channel_ordering:null,ambisonic_normalization:null,num_channels:null,channel_map:[]},o=0;e.version=t.getUint8(n+o),o=L,e.ambisonic_type=t.getUint8(n+o),o+=E,e.ambisonic_order=t.getUint32(n+o),o+=k,e.ambisonic_channel_ordering=t.getUint8(n+o),o+=I,e.ambisonic_normalization=t.getUint8(n+o),o+=T,e.num_channels=t.getUint32(n+o),o+=D;for(var a=0;a<e.num_channels;a++)if(e.channel_map.push(t.getUint32(n+o)),o+=x,o>r)return null;return JSON.stringify(e)},n.$16=function(n,a,i,l){try{var t=s+e,u=o("ISOVideoBoxConstants").GSPHERICAL_UUID.length;if(t+u<i){for(var c=[],d=0;d<u;d++)c.push(n.getUint8(a+t+d));var m=o("VideoSphericalMetadataUtil").uuidArrayEquals(c,o("ISOVideoBoxConstants").GSPHERICAL_UUID),p=o("VideoSphericalMetadataUtil").uuidArrayEquals(c,o("ISOVideoBoxConstants").FBSPHERICAL_UUID);if(t+=u,m||p){var _=this.$14(n,a+t,i-t);r("checkForSphericalTag")(_)&&(l.sphericalMetadata.spherical=!0,p?l.sphericalMetadata.FBSphericalMetadataXML=_:l.sphericalMetadata.sphericalMetadataXml=_)}}}catch(e){}},n.$12=function(n,o,a,i,l){for(var t=l||{widths:[],heights:[],streamTypes:[],streamDurations:[],spherical:!1,sphericalMetadata:{sphericalMetadataXml:null,FBSphericalMetadataXML:null,fbSpatialAudioMetadataXml:null,ytSa3dMetadataJson:null},isParsingInMediaInformationAtom:!1,endOfMediaInformationAtomOffset:null,streamSampleCounts:[],samples:[]},u=null;o<a;){var L=n.getUint32(o),E=this.$14(n,o+e,s);if(L===1&&(L=r("getVideo64BitAtomLength")(n,o,s,e)),o+L>a)return t.completed=!1,t.nextOffset=o,L>a&&(t.nextOffset+=L),t;if(t.isParsingInMediaInformationAtom&&o>=Number(t.endOfMediaInformationAtomOffset)&&(t.isParsingInMediaInformationAtom=!1,t.endOfMediaInformationAtomOffset=null),o+i===0&&E!=="ftyp")throw new Error("No ftyp atom");if(L===0)throw new Error("len is 0");var k=function(){var e=n.getUint32(o+m),t=n.getUint32(o+c);if(e===0)throw r("err")("mvhd timescale is 0");return t/e};switch(E){case"moov":case"trak":case"mdia":case"stbl":o+=e+s;break;case"mvhd":t.duration=k(),o+=L;break;case"tkhd":var I=n.getUint16(o+f),T=n.getUint16(o+d);t.widths.push(I),t.heights.push(T),t.samples.push({descriptions:[]}),u=n.getUint32(o+g),o+=L;break;case"hdlr":if(!t.isParsingInMediaInformationAtom){var D=this.$14(n,o+p,_);switch(D){case"vide":D="video";break;case"soun":D="audio";break;case"subt":D="subtitle";break;default:D="data"}t.streamTypes.push(D)}o+=L;break;case"mdhd":t.streamDurations.push(k()),o+=L;break;case"uuid":this.$16(n,o,L,t),o+=L;break;case"meta":var x=b+C+y,M=this.$14(n,o+x,4);if(M!=="face"){o+=L;break}var w=e+s+h,A=this.$14(n,o+w,L-w);A!==null&&(t.sphericalMetadata.fbSpatialAudioMetadataXml==null&&(t.sphericalMetadata.fbSpatialAudioMetadataXml="<fb360_spatial_audio>"),u?t.sphericalMetadata.fbSpatialAudioMetadataXml+=`
                <track id="`+u.toString()+`">
                  `+A+`
                </track>
              `:t.sphericalMetadata.fbSpatialAudioMetadataXml+=`
                <spatial_audio_formatting>
                  `+A+`
                </spatial_audio_formatting>
              `),o+=L;break;case"minf":var F=this.$14(n,o+2*e+s,s);F==="smhd"||F==="vmhd"?(o+=e+s,t.isParsingInMediaInformationAtom=!0,t.endOfMediaInformationAtomOffset=o+L):(t.streamSampleCounts.push(null),o+=L);break;case"stsd":o+=v;break;case"avc1":if(this.$5&&t.samples.length>0){var O=t.samples[t.samples.length-1];O.descriptions.push({width:n.getUint16(o+P),height:n.getUint16(o+N)})}o+=L;break;case"mp4a":case"sowt":case"raw ":case"twos":case"fl32":case"fl64":case"in24":case"in32":case"ulaw":case"alaw":case"lpcm":case"Opus":var B=n.getUint16(o+S).toString();Object.prototype.hasOwnProperty.call(R,B)?o+=R[B]:o+=L;break;case"SA3D":var W=this.$15(n,o+e+s,L);W!==null&&t.sphericalMetadata.ytSa3dMetadataJson===null&&(t.sphericalMetadata.ytSa3dMetadataJson=W),o+=L;break;case"stsz":case"stz2":t.streamSampleCounts.push(n.getUint32(o+$)),o+=L;break;default:o+=L}}return t.completed=!0,t.sphericalMetadata.fbSpatialAudioMetadataXml&&(t.sphericalMetadata.fbSpatialAudioMetadataXml+="</fb360_spatial_audio>"),t},n.$13=function(t){var e={streams:{numAudioTracks:0},format:{},metadata:{}},n=t.widths.length,r=t.heights.length,o=t.streamTypes.length,a=t.streamDurations.length,i=t.streamSampleCounts.length,l=t.samples.length;if(n!==r||n!==o||n!==a||n!==i||n!==l)throw new Error("Number of parsed widths, heights, durations or sample counts for video file are mismatched.");for(var s=0;s<n;s++){var u={width:t.widths[s],height:t.heights[s],duration:t.streamDurations[s],type:t.streamTypes[s],sampleCount:t.streamSampleCounts[s]};if(u.type==="video"){this.$5&&t.samples[s].descriptions.forEach(function(e){e.width>u.width&&e.height>u.height&&(u.width=e.width,u.height=e.height)});var c=u.width*u.height,d=e.streams.primaryVideo;(!d||d.width*d.height>c)&&(e.streams.primaryVideo=u)}else if(u.type==="audio"){var m=e.streams.primaryAudio;(!m||m.duration<u.duration)&&(e.streams.primaryAudio=u),e.streams.numAudioTracks++}}return e.format.duration=t.duration,e.format.isSpherical=t.sphericalMetadata.spherical,t.sphericalMetadata.spherical&&(e.metadata.sphericalMetadataXml=t.sphericalMetadata.sphericalMetadataXml,e.metadata.FBSphericalMetadataXML=t.sphericalMetadata.FBSphericalMetadataXML,e.metadata.fbSpatialAudioMetadataXml=t.sphericalMetadata.fbSpatialAudioMetadataXml,e.metadata.ytSa3dMetadataJson=t.sphericalMetadata.ytSa3dMetadataJson),e},t})();l.default=M}),98);
__d("MediaUploadFBMetadataParser",["MediaUploadFBStage","MediaUploadFBStageOutcome","MediaUploadOperationOutcome","MediaUploadStageEvent","MediaUploadTime","VideoUploadFile","VideoUploadMetadataParser"],(function(t,n,r,o,a,i,l){"use strict";var e="MediaUploadMetadataParser",s=(function(){function t(){this.$1=r("MediaUploadFBStage").METADATA_EXTRACTION}var n=t.prototype;return n.parse=async function(t){t.emitStageEvent(r("MediaUploadStageEvent").STAGE_STARTED,this.$1);try{await this.$2(t)}catch(e){t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").EXCEPTION,rawErrorObject:e})}return t.emitStageEvent(r("MediaUploadStageEvent").STAGE_SUCCEED,this.$1),r("MediaUploadOperationOutcome").SUCCESS},n.retriveRawMetadata=function(n){return n.processing.rawData.getUnsafe(e)},n.$2=function(t){var e=this,n=t.asset,o=n.dataAsFile();if(o==null)return t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").ASSET_IS_NOT_FILE}),Promise.resolve();var a=new(r("VideoUploadFile"))(null,o.file,o.size,o.extension);return new Promise(function(n){var o=new(r("VideoUploadMetadataParser"))(a,null,!1,function(o){o.success?e.$3(t,o.metadata):o.errorObject!=null?t.recordStageOutcome({stage:e.$1,outcome:r("MediaUploadFBStageOutcome").EXCEPTION,rawErrorCode:String(o.errorCode),rawErrorObject:o.errorObject}):t.recordStageOutcome({stage:e.$1,outcome:r("MediaUploadFBStageOutcome").INTERNAL_FAILURE,rawErrorCode:String(o.errorCode)}),n()});o.parse()})},n.$3=function(n,r){var t,a,i,l,s,u;n.processing.rawData.set(e,r);var c=(t=r.format)==null?void 0:t.duration,d=c==null?void 0:o("MediaUploadTime").secondsToTime(c),m=(a=r.streams)==null||(a=a.primaryVideo)==null?void 0:a.width,p=(i=r.streams)==null||(i=i.primaryVideo)==null?void 0:i.height;r.videoPlayerData!=null&&((l=r.videoPlayerData)==null?void 0:l.width)>0&&((s=r.videoPlayerData)==null?void 0:s.height)>0&&(m=r.videoPlayerData.width,p=r.videoPlayerData.height);var _=(u=r.format)==null?void 0:u.isSpherical;n.metadata={duration:d,width:m,height:p,isSpherical:_}},t})();l.default=s}),98);
__d("VideoUploadFileValidator",["errorCode","fbt","cr:909496","cr:909497","react","vulture"],(function(t,n,r,o,a,i,l,s){var e,u=e||(e=n("react")),c=[1363019,1363020,1363021,1363022,1363023,1363024,1363025,1363026,1363027,1363030,1363031,1363032,1363033,1363038,1363039,1363040,1363048],d=["VIDEO__INVALID_GUIDE_DATA"],m=(function(){"use strict";function e(e){this.$1=e}var t=e.prototype;return t.validate=function(t,n){return this.$2(t)&&this.$3(t)&&this.$4(t.getExtension()==="gif",n)},t.getValidationErrorMessage=function(t,n){return this.$5(t)||this.$6(t)||this.$7(t.getExtension()==="gif",n)},e.canReplaceVideoForError=function(t){return n("vulture")("GXIBEX7SKQtgztutRnjhZ9IvfSk="),t?d.indexOf(t)>-1?!1:c.indexOf(t)>-1:!0},t.$2=function(t){var e=this.$5(t);return e?(n("cr:909496")!==null&&n("cr:909496").show(e.summary,e.description),!1):!0},t.$5=function(t){var e;if(!this.$1.extensions[(e=t.getExtension())==null?void 0:e.toLowerCase()]){var r="http://www.facebook.com/help/218673814818907/",o=u.jsx(n("cr:909497"),{target:"_blank",href:r,children:s._(/*BTDS*/"formatos recomendados")});return{summary:s._(/*BTDS*/"Formato de archivo incompatible"),description:s._(/*BTDS*/"El archivo que has seleccionado tiene un formato no compatible. Utiliza uno de nuestros {link} para archivos de v\u00eddeo.",[s._param("link",o)])}}},t.$3=function(t){var e=this.$6(t);return e?(n("cr:909496")!==null&&n("cr:909496").show(e.summary,e.description),!1):!0},t.$6=function(t){var e;if(t.getSize()!==null)return t.getSize()<this.$1.minSize&&(e=this.$8()),t.getSize()>this.$1.maxSize&&(e=this.$9()),e},t.$8=function(){var e=Math.round(this.$1.minSize/1024);return{summary:s._(/*BTDS*/"El archivo de v\u00eddeo es demasiado peque\u00f1o"),description:s._(/*BTDS*/"El archivo de v\u00eddeo que has intentado subir es demasiado peque\u00f1o. El tama\u00f1o m\u00ednimo permitido para los archivos de v\u00eddeo es {min-size} KB. Prueba a subir un v\u00eddeo de mayor tama\u00f1o.",[s._param("min-size",e)])}},t.$9=function(){var e=Math.floor(this.$1.maxSize/1024/1024);return{summary:s._(/*BTDS*/"El archivo de v\u00eddeo es demasiado grande"),description:s._(/*BTDS*/"El archivo de v\u00eddeo que has intentado subir es demasiado grande. El tama\u00f1o m\u00e1ximo permitido para los archivos de v\u00eddeo es {max-size} MB. Prueba a subir un archivo de menor tama\u00f1o.",[s._param("max-size",e)])}},t.$4=function(t,r){var e=this.$7(t,r);return e?(n("cr:909496")!==null&&n("cr:909496").show(e.summary,e.description),!1):!0},t.$7=function(t,n){var e;if(n){var r=n.format.duration;if(r&&(r>this.$1.maxLength&&(e=this.$10()),r<this.$1.minLength&&!t&&(e=this.$11())),!(!n.streams||!n.streams.primaryVideo)){var o=n.streams.primaryVideo.width,a=n.streams.primaryVideo.height,i=0,l=0;n.videoPlayerData!==null&&(i=n.videoPlayerData.height,l=n.videoPlayerData.width),this.$1.acceptDimensionsFromPlayer&&l!==0&&i!==0&&(o=l,a=i),!n.streams.primaryVideo&&n.streams.primaryAudio&&(e=this.$12()),o<this.$1.minWidth&&(e=this.$13()),a<this.$1.minHeight&&(e=this.$14());var s=o/a;return this.$1.require16to9AspectRatio&&(s>2||s<1.6)&&(e=this.$15()),this.$1.minAspectRatio&&s<this.$1.minAspectRatio&&(e=this.$16()),this.$1.maxAspectRatio&&s>this.$1.maxAspectRatio&&(e=this.$17()),e}}},t.$10=function(){return this.$1.source==="profile_video"?{summary:s._(/*BTDS*/"El v\u00eddeo del perfil dura demasiado"),description:s._(/*BTDS*/"La duraci\u00f3n m\u00e1xima es de {max-length} segundos. Sube un v\u00eddeo m\u00e1s corto.",[s._param("max-length",this.$1.maxLength)])}:this.$1.source==="event_cover_video"?{summary:s._(/*BTDS*/"El v\u00eddeo de portada del evento dura demasiado"),description:s._(/*BTDS*/"Los v\u00eddeos no pueden durar m\u00e1s de {max-length} segundos.",[s._param("max-length",this.$1.maxLength)])}:{summary:s._(/*BTDS*/"El v\u00eddeo es demasiado largo"),description:s._(/*BTDS*/"El v\u00eddeo que has intentado subir es demasiado largo. La duraci\u00f3n m\u00e1xima permitida para los v\u00eddeos es {max-length} minutos. Sube un v\u00eddeo de menor duraci\u00f3n.",[s._param("max-length",Math.round(this.$1.maxLength/60))])}},t.$11=function(){return{summary:s._(/*BTDS*/"Archivo de v\u00eddeo demasiado corto"),description:s._(/*BTDS*/"_j{\"second\":\"El v\\u00eddeo que has intentado subir es demasiado corto. La duraci\\u00f3n m\\u00ednima permitida para los v\\u00eddeos es {min-length} segundos. Sube un v\\u00eddeo de mayor duraci\\u00f3n.\",\"seconds\":\"El v\\u00eddeo que has intentado subir es demasiado corto. La duraci\\u00f3n m\\u00ednima permitida para los v\\u00eddeos es {min-length} segundos. Sube un v\\u00eddeo de mayor duraci\\u00f3n.\"}",[s._enum(this.$1.minLength===1?"second":"seconds",{second:"second",seconds:"seconds"}),s._param("min-length",this.$1.minLength)])}},t.$12=function(){n("vulture")("INKG3L69H5R65NZ1WJ71126FvrI=");var e="http://www.facebook.com/help/?faq=218673814818907#What-formats-of-video-files-can-I-upload?",t=u.jsx(n("cr:909497"),{href:e,children:s._(/*BTDS*/"formato de v\u00eddeo compatible")});return{summary:s._(/*BTDS*/"No se ha detectado ning\u00fan v\u00eddeo"),description:s._(/*BTDS*/"Parece que est\u00e1s intentando subir un archivo que no es un v\u00eddeo. Prueba a subir un {supported-video-format link}",[s._param("supported-video-format link",t)])}},t.$13=function(){return{summary:s._(/*BTDS*/"El v\u00eddeo no es suficientemente ancho"),description:s._(/*BTDS*/"El v\u00eddeo que has intentado subir es demasiado estrecho. La anchura m\u00ednima permitida para los v\u00eddeos es {min-width}. Sube un v\u00eddeo con una anchura mayor.",[s._param("min-width",this.$1.minWidth)])}},t.$15=function(){return n("vulture")("uxlnhk-6pEg8Fk9bfORWCRp4alE="),{summary:s._(/*BTDS*/"Se ha producido un problema al subir el v\u00eddeo"),description:s._(/*BTDS*/"Para que los v\u00eddeos se vean bien deben tener una relaci\u00f3n de aspecto de 16:9. Edita tu v\u00eddeo y vu\u00e9lvelo a subir.")}},t.$14=function(){return{summary:s._(/*BTDS*/"El v\u00eddeo no es suficientemente alto"),description:s._(/*BTDS*/"El v\u00eddeo que has intentado subir no es lo suficientemente alto. La altura m\u00ednima permitida para los v\u00eddeos es {min-height}. Sube un v\u00eddeo con una altura mayor.",[s._param("min-height",this.$1.minHeight)])}},t.$17=function(){return{summary:s._(/*BTDS*/"V\u00eddeo demasiado ancho"),description:s._(/*BTDS*/"El v\u00eddeo que has seleccionado es demasiado ancho. Las relaciones de aspecto de los v\u00eddeos deben estar entre {max_aspect_ratio} y {min_aspect_ratio}. Graba y sube un v\u00eddeo m\u00e1s alto.",[s._param("max_aspect_ratio",this.$1.maxAspectRatio+":1"),s._param("min_aspect_ratio",this.$1.minAspectRatio+":1")])}},t.$16=function(){return{summary:s._(/*BTDS*/"V\u00eddeo demasiado alto"),description:s._(/*BTDS*/"El v\u00eddeo que has seleccionado es demasiado alto. Las relaciones de aspecto de los v\u00eddeos deben estar entre {max_aspect_ratio} y {min_aspect_ratio}. Graba y sube un v\u00eddeo m\u00e1s ancho.",[s._param("max_aspect_ratio",this.$1.maxAspectRatio+":1"),s._param("min_aspect_ratio",this.$1.minAspectRatio+":1")])}},e})();a.exports=m}),130);
__d("MediaUploadFBMetadataValidator",["MediaUploadFBStage","MediaUploadFBStageOutcome","MediaUploadOperationOutcome","MediaUploadStageEvent","MediaUploadTime","Promise","VideoUploadFile","VideoUploadFileValidator"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(e){this.$1=r("MediaUploadFBStage").METADATA_VALIDATION,this.$2=e}var a=t.prototype;return a.validate=function(o,a){o.emitStageEvent(r("MediaUploadStageEvent").STAGE_STARTED,this.$1);var t;try{t=this.$3(o,a)}catch(e){o.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").EXCEPTION,rawErrorObject:e}),t=r("MediaUploadOperationOutcome").SUCCESS}return o.emitStageEventForOperationOutcome(t,this.$1),(e||(e=n("Promise"))).resolve(t)},a.$4=function(t){var e={};return t.extensions.forEach(function(t){return e[t]=1}),{minSize:t.minSizeKB*1024,maxSize:t.maxSizeKB*1024,maxLength:o("MediaUploadTime").timeToSeconds(t.maxDuration),minLength:o("MediaUploadTime").timeToSeconds(t.minDuration),acceptDimensionsFromPlayer:t.acceptDimensionsFromPlayer,minWidth:t.minWidth,minHeight:t.minHeight,require16to9AspectRatio:!1,minAspectRatio:t.minAspectRatio,maxAspectRatio:t.maxAspectRatio,source:t.sourceType,extensions:e}},a.$3=function(t,n){var e=t.asset.dataAsFile();if(e==null)return t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").ASSET_IS_NOT_FILE}),r("MediaUploadOperationOutcome").SUCCESS;if(this.configuration==null)throw this.$2.createThrowableError("Missing configuration in the MediaUploadFBMetadataValidator");var o=new(r("VideoUploadFile"))(null,e.file,e.size,e.extension),a=this.$4(this.configuration),i=new(r("VideoUploadFileValidator"))(a),l=i.getValidationErrorMessage(o,n);return l!=null?(t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").INTERNAL_FAILURE,displayError:l}),r("MediaUploadOperationOutcome").FAILED_NON_TRANSIENT):(t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").SUCCESS}),r("MediaUploadOperationOutcome").SUCCESS)},t})();l.default=s}),98);
__d("MediaUploadOperationAttemptOutcome",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["SUCCESS","CANCELED","TRANSIENT_FAILURE","TRANSIENT_FAILURE_IMMEDIATE_RETRY","NON_TRANSIENT_FAILURE"]),l=e;i.default=l}),66);
__d("MediaUploadRetryableOperation",["MediaUploadCancelablePromise","MediaUploadOperationAttemptOutcome","MediaUploadOperationOutcome"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n){var o=this;this.$4=null,this.$1=e,this.$2=t,this.$3=n,this.cancelablePromise=new(r("MediaUploadCancelablePromise"))(function(e){return o.$5(e),{cancel:function(){var t;(t=o.$4)==null||t.cancel(),o.$4=null,e(r("MediaUploadOperationOutcome").CANCELED)}}})}e.createAsPromise=function(n,r,o){var t=new e(n,r,o);return t.cancelablePromise};var t=e.prototype;return t.$5=function(t){var e=this,n=this.$1();this.$4=n,this.$3.promiseTerminator(n.promise.then(function(n){e.$4=null,e.$6(t,n)},function(n){throw e.$4=null,e.$6(t,r("MediaUploadOperationAttemptOutcome").NON_TRANSIENT_FAILURE),n}))},t.$6=function(t,n){switch(n){case r("MediaUploadOperationAttemptOutcome").CANCELED:t(r("MediaUploadOperationOutcome").CANCELED);break;case r("MediaUploadOperationAttemptOutcome").SUCCESS:t(r("MediaUploadOperationOutcome").SUCCESS);break;case r("MediaUploadOperationAttemptOutcome").NON_TRANSIENT_FAILURE:t(r("MediaUploadOperationOutcome").FAILED_NON_TRANSIENT);break;case r("MediaUploadOperationAttemptOutcome").TRANSIENT_FAILURE:this.$7(t,!1);break;case r("MediaUploadOperationAttemptOutcome").TRANSIENT_FAILURE_IMMEDIATE_RETRY:this.$7(t,!0);break}},t.$7=function(t,n){var e=this;if(this.$2.increaseRetryAttemptCounter(),this.$2.exceedTotalDuration())t(r("MediaUploadOperationOutcome").FAILED_OUT_OF_TIME);else if(this.$2.exceedTotalRetries())t(r("MediaUploadOperationOutcome").FAILED_NO_MORE_RETRIES);else if(n)this.$5(t);else{var o=this.$2.calculateBackoffDelay();this.$4=this.$3.delayedExecutor(o,function(){return e.$5(t)},function(){return t(r("MediaUploadOperationOutcome").CANCELED)})}},e})();l.default=e}),98);
__d("MediaUploadFBNetworkAssetStrategy",["MediaUploadPipeline","MediaUploadRetryableOperation"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,r){this.$1=e,this.startRequest=t,this.uploadServiceRequest=n,this.receiveRequest=r}var t=e.prototype;return t.run=function(t){var e=this,n=t.asset.dataAsFile();if(n==null)throw this.$1.createThrowableError("Browser is not compatible with current version of the SDK");var o=new(r("MediaUploadPipeline"))(this.$1);return o.addCancelableStep(function(){return r("MediaUploadRetryableOperation").createAsPromise(function(){return e.startRequest.send(t)},t.retryState,e.$1)}),o.addCancelableStep(function(){return r("MediaUploadRetryableOperation").createAsPromise(function(){return e.uploadServiceRequest.send(t,n,e.startRequest.retriveResponse(t))},t.retryState,e.$1)}),o.addCancelableStep(function(){return r("MediaUploadRetryableOperation").createAsPromise(function(){return e.receiveRequest.send(t,e.startRequest.retriveResponse(t),e.uploadServiceRequest.retriveResponse(t))},t.retryState,e.$1)}),o.run()},t.cancel=function(){},e})();l.default=e}),98);
__d("MediaUploadFBNetworkProbe",["MediaUploadNetworkStatus","Network"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){}var t=e.prototype;return t.probe=function(){return r("Network").isOnline()?r("MediaUploadNetworkStatus").CONNECTED:r("MediaUploadNetworkStatus").DISCONNECTED},e})();l.default=e}),98);
__d("MediaUploadFBEndpointRequest",["AsyncRequest","MediaUploadCancelablePromise","MediaUploadOperationAttemptOutcome","MediaUploadStageEvent"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){}var t=e.prototype;return t.send=function(t,n){var e=this;return new(r("MediaUploadCancelablePromise"))(function(o){n.emitStageEvent(r("MediaUploadStageEvent").STAGE_STARTED,t.stage);var a=t.createPayload();if(a==null){n.emitStageEvent(r("MediaUploadStageEvent").STAGE_FAILED,t.stage),o(r("MediaUploadOperationAttemptOutcome").NON_TRANSIENT_FAILURE);return}var i=new(r("AsyncRequest"))().setAllowCrossOrigin(!0).setURI(t.uri).setData(a).setRequestHeader("X_FB_VIDEO_WATERFALL_ID",n.sessionContext.sessionID).setProgressHandler(function(){t.networkNotifier.notifyOnProgress(n,t.stage)}).setHandler(function(r){o(e.$1(t,n,r))}).setErrorHandler(function(r){o(e.$2(t,n,r))});if(i.send())return t.networkNotifier.notifyOnNewRequest(n,t.stage),{cancel:function(){t.networkNotifier.notifyOnAbandon(n,t.stage),i.abort()}};o(r("MediaUploadOperationAttemptOutcome").NON_TRANSIENT_FAILURE)})},t.$1=function(t,n,o){var e;return t.networkNotifier.notifyOnResponse(n,t.stage),(e=n.retryState)==null||e.resetBackoff(),t.acceptSuccessfulResponse(o),n.emitStageEvent(r("MediaUploadStageEvent").STAGE_SUCCEED,t.stage),r("MediaUploadOperationAttemptOutcome").SUCCESS},t.$2=function(t,n,o){var e=o.error<1e3,a=o.error>9999;e||a?t.networkNotifier.notifyOnResponse(n,t.stage):t.networkNotifier.notifyOnTransportError(n,t.stage),t.acceptErrorResponse(o),n.emitStageEvent(r("MediaUploadStageEvent").STAGE_FAILED,t.stage);var i=e&&o.error>=400&&o.error<500||a&&!o.transientError;return i?r("MediaUploadOperationAttemptOutcome").NON_TRANSIENT_FAILURE:r("MediaUploadOperationAttemptOutcome").TRANSIENT_FAILURE},e})();l.default=e}),98);
__d("MediaUploadFBReceiveRequest",["ActorURI","MediaUploadCancelablePromise","MediaUploadFBEndpointRequest","MediaUploadFBStage","MediaUploadFBStageOutcome","MediaUploadOperationAttemptOutcome","MediaUploadStageEvent"],(function(t,n,r,o,a,i,l){"use strict";var e="MediaUploadFBReceiveRequest",s=(function(){function t(e){this.$1=r("MediaUploadFBStage").RECEIVE_REQUEST,this.$2=e.entryPoint,this.$3=e.payloadHook,this.$4=e.customHeadersHook,this.$5=e.envParams,this.$6=new(r("MediaUploadFBEndpointRequest")),this.$7=e.networkNotifier}var n=t.prototype;return n.send=function(n,a,i){var t=this;if(this.configuration==null)throw this.$5.createThrowableError("Missing configuration in the MediaUploadFBReceiveRequest");return(a==null?void 0:a.skip_upload)===!0?(n.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").SUCCESS}),n.emitStageEvent(r("MediaUploadStageEvent").STAGE_SUCCEED,this.$1),r("MediaUploadCancelablePromise").resolve(r("MediaUploadOperationAttemptOutcome").SUCCESS)):this.$6.send({stage:this.$1,networkNotifier:this.$7,uri:n.request.attributes.actorID==null?this.configuration.baseURI:o("ActorURI").create(this.configuration.baseURI,n.request.attributes.actorID),createPayload:function(){return t.$8(n,a,i)},createCustomHeaders:function(){return t.$9(n)},acceptSuccessfulResponse:function(a){n.processing.rawData.set(e,a.payload),n.recordStageOutcome({stage:t.$1,outcome:r("MediaUploadFBStageOutcome").SUCCESS})},acceptErrorResponse:function(o){var e;n.recordStageOutcome({stage:t.$1,outcome:r("MediaUploadFBStageOutcome").REQUEST_ERROR,rawErrorCode:o.error,displayError:{summary:o.errorSummary,description:o.errorDescription},errorAttributes:{silentError:o.silentError,transientError:o.transientError},networkRequestID:(e=o.payload)==null?void 0:e.__www_request_id__})}},n)},n.$9=function(t){var e=this.$4;return e?e({assetSnapshot:t.composeSnapshot(),sessionSnapshot:t.sessionContext.composeSnapshot()}):null},n.$8=function(t,n,o){if(n==null)return t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").MISSING_MANDATORY_DATA,rawErrorCode:"MISSING_START_CALL_RESPONSE"}),null;if(o==null)return t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").MISSING_MANDATORY_DATA,rawErrorCode:"MISSING_UPLOAD_SERVICE_RESPONSE"}),null;var e=t.asset.dataAsFile(),a={waterfall_id:t.sessionContext.sessionID,target_id:t.request.attributes.targetID,video_id:n.video_id,source:this.$2.sourceType,composer_entry_point_ref:this.$2.entryPointRef,supports_chunking:!0,supports_upload_service:!0,partition_start_offset:0,partition_end_offset:e==null?void 0:e.size,start_offset:0,end_offset:e==null?void 0:e.size,upload_speed:t.uploadSummary.computeSpeedBps(),fbuploader_video_file_chunk:o.everstoreHandle,has_file_been_replaced:t.request.attributes.hasFileBeenReplaced,composer_dialog_version:t.request.attributes.composerDialogVersion,composer_work_shared_draft_mode:t.request.attributes.workSharedDraftMode},i=this.$3;return i!=null&&i({assetSnapshot:t.composeSnapshot(),sessionSnapshot:t.sessionContext.composeSnapshot(),startCallResponse:n,payload:a}),a},t})();l.default=s}),98);
__d("MediaUploadFBStartRequest",["ActorURI","MediaUploadFBEndpointRequest","MediaUploadFBStage","MediaUploadFBStageOutcome"],(function(t,n,r,o,a,i,l){"use strict";var e="MediaUploadFBStartRequest",s=(function(){function t(e){this.$1=r("MediaUploadFBStage").START_REQUEST,this.$2=e.entryPoint,this.$3=e.payloadHook,this.$4=e.customHeadersHook,this.$5=e.envParams,this.$6=new(r("MediaUploadFBEndpointRequest")),this.$7=e.networkNotifier}var n=t.prototype;return n.retriveResponse=function(n){return n.processing.rawData.getUnsafe(e)},n.send=function(n){var t=this;if(this.configuration==null)throw this.$5.createThrowableError("Missing configuration in the MediaUploadFBStartRequest");return this.$6.send({stage:this.$1,networkNotifier:this.$7,uri:n.request.attributes.actorID==null?this.configuration.baseURI:o("ActorURI").create(this.configuration.baseURI,n.request.attributes.actorID),createPayload:function(){return t.$8(n)},createCustomHeaders:function(){return t.$9(n)},acceptSuccessfulResponse:function(a){var o=a.payload;if(o.video_id!=null)n.processing.rawData.set(e,o),n.videoID=o.video_id,n.recordStageOutcome({stage:t.$1,outcome:r("MediaUploadFBStageOutcome").SUCCESS});else{var i;n.recordStageOutcome({stage:t.$1,outcome:r("MediaUploadFBStageOutcome").INVALID_SERVER_RESPONSE,networkRequestID:(i=a.payload)==null?void 0:i.__www_request_id__})}},acceptErrorResponse:function(o){var e;n.recordStageOutcome({stage:t.$1,outcome:r("MediaUploadFBStageOutcome").REQUEST_ERROR,rawErrorCode:o.error,displayError:{summary:o.errorSummary,description:o.errorDescription},errorAttributes:{silentError:o.silentError,transientError:o.transientError},networkRequestID:(e=o.payload)==null?void 0:e.__www_request_id__})}},n)},n.$9=function(t){var e=this.$4;return e!=null?e({assetSnapshot:t.composeSnapshot(),sessionSnapshot:t.sessionContext.composeSnapshot()}):null},n.$8=function(t){var e,n=t.asset.dataAsFile(),r={waterfall_id:t.sessionContext.sessionID,target_id:t.request.attributes.targetID,source:this.$2.sourceType,composer_entry_point_ref:this.$2.entryPointRef,supports_chunking:n!=null,supports_file_api:n!=null,file_size:n==null?0:n.size,file_extension:String(t.asset.data.extension),spherical:(e=t.metadata)==null?void 0:e.isSpherical,partition_start_offset:0,partition_end_offset:n==null?void 0:n.size,has_file_been_replaced:t.request.attributes.hasFileBeenReplaced,composer_dialog_version:t.request.attributes.composerDialogVersion,video_publisher_action_source:t.request.attributes.publisherActionSource,composer_work_shared_draft_mode:t.request.attributes.workSharedDraftMode},o=this.$3;return o!=null&&o({assetSnapshot:t.composeSnapshot(),sessionSnapshot:t.sessionContext.composeSnapshot(),payload:r}),r},t})();l.default=s}),98);
__d("MediaUploadFBUploadServiceRequest",["AsyncResponse","MediaUploadCancelablePromise","MediaUploadFBStage","MediaUploadFBStageOutcome","MediaUploadOperationAttemptOutcome","MediaUploadStageEvent","RelayAPIConfig","ResumableUploadService","ResumableUploadServiceState.enum","md5"],(function(t,n,r,o,a,i,l){"use strict";var e="MediaUploadFBUploadServiceRequest",s=(function(){function t(e){this.$1=r("MediaUploadFBStage").BYTES_UPLOAD,this.$2=e.envParams,this.$3=e.networkNotifier}var n=t.prototype;return n.send=function(t,n,o){var e=this;return new(r("MediaUploadCancelablePromise"))(function(a){t.emitStageEvent(r("MediaUploadStageEvent").STAGE_STARTED,e.$1);var i=e.configuration;if(i==null)throw e.$2.createThrowableError("Missing configuration in the MediaUploadFBUploadServiceRequest");if(o==null){t.recordStageOutcome({stage:e.$1,outcome:r("MediaUploadFBStageOutcome").MISSING_MANDATORY_DATA,rawErrorCode:"MISSING_START_CALL_RESPONSE"}),t.emitStageEvent(r("MediaUploadStageEvent").STAGE_FAILED,e.$1),a(r("MediaUploadOperationAttemptOutcome").NON_TRANSIENT_FAILURE);return}if(o.skip_upload){t.uploadSummary.updateForUploadSkip(n.size),t.recordStageOutcome({stage:e.$1,outcome:r("MediaUploadFBStageOutcome").SUCCESS}),t.emitStageEvent(r("MediaUploadStageEvent").STAGE_SUCCEED,e.$1),a(r("MediaUploadOperationAttemptOutcome").SUCCESS);return}t.uploadSummary.updateForUploadStart(n.size),t.recalculateProgressAndEmit();var l=e.$4(t,n,i,o),s=r("ResumableUploadService").create(l);return t.processing.uploadServiceDomain=s.getServiceName(),e.$5(t,s,a),s.resume(n.file),e.$3.notifyOnNewRequest(t,e.$1),{cancel:function(){s.cancel()}}})},n.retriveResponse=function(n){return n.processing.rawData.getUnsafe(e)},n.$6=function(n,o,a){this.$3.notifyOnResponse(n,this.$1),typeof a=="string"?(n.processing.rawData.set(e,{everstoreHandle:a}),n.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").SUCCESS}),n.emitStageEvent(r("MediaUploadStageEvent").STAGE_SUCCEED,this.$1),o(r("MediaUploadOperationAttemptOutcome").SUCCESS)):(n.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").INVALID_SERVER_RESPONSE,rawErrorCode:"RECEIVED_HANDLE_IS_NOT_STRING"}),n.emitStageEvent(r("MediaUploadStageEvent").STAGE_FAILED,this.$1),o(r("MediaUploadOperationAttemptOutcome").NON_TRANSIENT_FAILURE))},n.$7=function(t,n,o){o.error<1e3?this.$3.notifyOnResponse(t,this.$1):this.$3.notifyOnTransportError(t,this.$1),t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").REQUEST_ERROR,rawErrorCode:o.error,displayError:{summary:o.errorSummary,description:o.errorDescription},errorAttributes:{silentError:o.silentError,transientError:o.transientError}}),t.emitStageEvent(r("MediaUploadStageEvent").STAGE_FAILED,this.$1);var e=o.error>=400&&o.error<500;n(e?r("MediaUploadOperationAttemptOutcome").NON_TRANSIENT_FAILURE:r("MediaUploadOperationAttemptOutcome").TRANSIENT_FAILURE)},n.$8=function(t,n,o){o instanceof r("AsyncResponse")?this.$7(t,n,o):(this.$3.notifyOnAbandon(t,this.$1),t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").REQUEST_ERROR,rawErrorObject:o}),t.emitStageEvent(r("MediaUploadStageEvent").STAGE_FAILED,this.$1),n(r("MediaUploadOperationAttemptOutcome").TRANSIENT_FAILURE))},n.$9=function(t,n){this.$3.notifyOnAbandon(t,this.$1),t.recordStageOutcome({stage:this.$1,outcome:r("MediaUploadFBStageOutcome").CANCEL}),t.emitStageEvent(r("MediaUploadStageEvent").STAGE_CANCELED,this.$1),n(r("MediaUploadOperationAttemptOutcome").CANCELED)},n.$10=function(t,n){this.$3.notifyOnProgress(t,this.$1),(n==null?void 0:n.loaded)!=null&&(t.uploadSummary.updateForProgress(n.loaded),t.emitStageEvent(r("MediaUploadStageEvent").STAGE_PROGRESS,this.$1))},n.$5=function(t,n,o){var e=this,a;n.addListener((a=r("ResumableUploadServiceState.enum")).SUCCESS,function(n){return e.$6(t,o,n)}),n.addListener(a.TRANSPORT_FAILURE,function(n){return e.$7(t,o,n)}),n.addListener(a.FAIL,function(n){return e.$8(t,o,n)}),n.addListener(a.CANCEL,function(){return e.$9(t,o)}),n.addListener(a.PROGRESS,function(n){return e.$10(t,n)})},n.$4=function(t,n,o,a){var e,i,l=n.file,s=[String(l.lastModified),l.name,l.type,String(l.size),(e=(i=t.processing.pseudoHash)==null?void 0:i.hashValue)!=null?e:[t.sessionContext.sessionID,t.assetID].join("-")].join("-"),u=[r("md5")(s),String(a.start_offset),String(a.end_offset)].join("-"),c=o.tracing.enabled&&o.tracing.minFileSizeKB<l.size/1024?["video_upload_www",[t.assetID,String(t.retryState.getRetryAttempts())].join("_"),[String(t.sessionContext.sessionID),String(a.video_id)].join("_")].join(":"):null,d=o.defaultService,m=d.serviceName,p=d.serviceDomain;t.retryState.getRetryAttemptsSinceLastReset()<10&&o.targetedService!=null&&(m=o.targetedService.serviceName,p=o.targetedService.serviceDomain);var _=null;return o.includeAccessToken&&(_=r("RelayAPIConfig").accessToken),{consumer:o.defaultService.serviceConsumer,accessToken:_,sessionKey:u,serviceName:m,serviceDomain:p,tracingHeaderValue:c,receiveParameters:{start_offset:String(a.start_offset),end_offset:String(a.end_offset),composer_session_id:t.sessionContext.sessionID,upload_session_id:String(a.upload_session_id),product_media_id:a.video_id,xpv_asset_id:a.xpv_asset_id,is_xpv_single_prod:a.is_xpv_single_prod,fb_region:a.fb_region,total_file_size:String(l.size),target_id:t.request.attributes.targetID,video_waterfall_id:t.sessionContext.sessionID}}},t})();l.default=s}),98);
__d("MediaUploadFalcoLogger",["CurrentUser","MediaUploadAssetEvent","MediaUploadClientEvent","MediaUploadFBStage","MediaUploadFBStageOutcome","MediaUploadSessionEvent","MediaUploadSessionStatus","MediaUploadStageEvent","MediaUploadTime","logVideoUploadViaFalco"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=new Map([[(e=r("MediaUploadClientEvent")).CLIENT_CONFIG_REQUESTED,"upload.client.started_client_config_fetch"],[e.CLIENT_CONFIG_RECEIVED,"upload.client.finished_client_config_fetch"],[e.CLIENT_CONFIG_FAILED,"upload.client.failed_client_config_fetch"],[e.CLIENT_CONFIG_CACHED,"upload.client.cached_client_config_fetch"]]),p=new Map([[(s=r("MediaUploadSessionEvent")).SESSION_CONFIRMED,"upload.client.started_flow"],[s.PUBLISH_STARTED,"upload.client.started_sending_post_request"],[s.PUBLISH_SUCCEED,"upload.client.finished_sending_post_request"],[s.PUBLISH_FAILED,"upload.client.failed_sending_post_request"]]),_=new Map([[r("MediaUploadSessionStatus").FAILED,"upload.client.failed_flow"],[r("MediaUploadSessionStatus").CANCELED,"upload.client.canceled_flow"],[r("MediaUploadSessionStatus").COMPLETED,"upload.client.finished_flow"]]),f=new Map([[(u=r("MediaUploadAssetEvent")).ASSET_ADDED,"upload.client.requested_uploading"],[u.ASSET_STARTED,"upload.client.started_uploading"],[u.ASSET_FAILED,"upload.client.failed_uploading"],[u.ASSET_REMOVED,"upload.client.canceled_uploading"],[u.ASSET_SUCCEED,"upload.client.finished_uploading"],[u.ASSET_STALL,"upload.client.stall_detected"]]),g=new Map([[(c=r("MediaUploadStageEvent")).STAGE_STARTED,new Map([[(d=r("MediaUploadFBStage")).START_REQUEST,"upload.client.started_sending_start_request"],[d.BYTES_UPLOAD,"upload.client.started_sending_bytes"],[d.RECEIVE_REQUEST,"upload.client.started_sending_receive_request"]])],[c.STAGE_SUCCEED,new Map([[d.START_REQUEST,"upload.client.finished_sending_start_request"],[d.BYTES_UPLOAD,"upload.client.finished_sending_bytes"],[d.RECEIVE_REQUEST,"upload.client.finished_sending_receive_request"]])],[c.STAGE_FAILED,new Map([[d.START_REQUEST,"upload.client.failed_sending_start_request"],[d.RECEIVE_REQUEST,"upload.client.failed_sending_receive_request"],[d.BYTES_UPLOAD,"upload.client.failed_sending_bytes"],[d.METADATA_VALIDATION,"upload.client.invalidated_uploading"]])],[c.STAGE_CANCELED,new Map([[d.START_REQUEST,"upload.client.canceled_sending_start_request"],[d.BYTES_UPLOAD,"upload.client.canceled_sending_bytes"],[d.RECEIVE_REQUEST,"upload.client.canceled_sending_receive_request"]])]]),h=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.subscribe=function(t,n){var e=this;m.forEach(function(r,o){t.addClientEventListener(o,function(t){return e.$3(n,r,t)})}),p.forEach(function(r,o){t.addSessionEventListener(o,function(t){return e.$4(n,r,t)})}),_.forEach(function(o,a){t.addSessionEventListener(r("MediaUploadSessionEvent").SESSION_FINISHED,function(t){t.terminalStatus===a&&t.timing.confirmedAtMs!=null&&e.$4(n,o,t)})}),f.forEach(function(r,o){t.addAssetEventListener(o,function(t,o){return e.$5(n,r,t,o)})}),g.forEach(function(r,o){r.forEach(function(r,a){t.addStageEventListener(o,a,function(t,o){e.$5(n,r,t,o)})})})},t.$6=function(t){return t==null?null:o("MediaUploadTime").timeToMilliseconds(this.$1.currentTimeProvider())-t},t.$7=function(t,n){var e,o;return{event:t,application_state:"www_v2",is_chunked_upload:!0,file_can_read:this.$1.features.supportFileManipulation,network_status:(e=this.$2)==null||(e=e.injectNetworkStatus)==null?void 0:e.getNetworkStatus(),internet_status:(o=this.$2)==null||(o=o.injectNetworkStatus)==null?void 0:o.getInternetStatus(),trigger_time:this.$1.currentTimeProvider(),app_id:r("CurrentUser").getAppID(),source:n.sourceType,composer_entry_point_ref:n.entryPointRef}},t.$8=function(t){var e,n,o,a,i,l=(t==null?void 0:t.rawErrorCode)!=null&&typeof(t==null?void 0:t.rawErrorCode)=="string"?t==null?void 0:t.rawErrorCode:void 0,s=(t==null?void 0:t.rawErrorCode)!=null&&typeof(t==null?void 0:t.rawErrorCode)=="number"?t==null?void 0:t.rawErrorCode:void 0;return{error:l!=null?l:t==null||(e=t.displayError)==null?void 0:e.summary,error_inner:(t==null?void 0:t.outcome)===r("MediaUploadFBStageOutcome").SUCCESS||t==null?void 0:t.outcome,error_description:(n=t==null||(o=t.errorObject)==null?void 0:o.message)!=null?n:t==null||(a=t.displayError)==null?void 0:a.description,error_trace:t==null||(i=t.errorObject)==null?void 0:i.stack,error_code:s}},t.$9=function(t){return{event_reason:t.cancelReason,elapsed_time:this.$6(t.timing.confirmedAtMs),waterfall_id:t.sessionID,retry_id:t.retryID}},t.$10=function(t){var e,n,r,o,a,i,l,s,u;return{elapsed_time:this.$6(t.lastUploadStartedAtMs),asset_id:t.assetID,video_id:t.videoID,composer_session_id:t.request.attributes.composerSessionID,target_id:t.request.attributes.targetID,composer_dialog_version:t.request.attributes.composerDialogVersion,has_file_been_replaced:t.request.attributes.hasFileBeenReplaced,source_width:(e=t.metadata)==null?void 0:e.width,source_height:(n=t.metadata)==null?void 0:n.height,is_spherical:(r=t.metadata)==null?void 0:r.isSpherical,duration:(o=t.metadata)==null?void 0:o.durationMs,file_size:(a=t.asset.dataAsFile())==null?void 0:a.size,video_original_file_path:t.asset.data.name,hash:(i=t.hash)==null?void 0:i.hashValue,hash_time:(l=t.hash)==null?void 0:l.calculationTimeCostMs,retries:t.retries.totalRetryAttempts,upload_domain:t.uploadServiceDomain,upload_speed:(s=t.uploadSummary)==null?void 0:s.speedBps,skip_upload:(u=t.uploadSummary)==null?void 0:u.skippedUpload}},t.$11=function(t){var e,n;return((e=this.$2)==null?void 0:e.injectExtraSessionFields)!=null?(n=this.$2)==null?void 0:n.injectExtraSessionFields(t):null},t.$12=function(t,n){var e,r;return((e=this.$2)==null?void 0:e.injectExtraAssetFields)!=null?(r=this.$2)==null?void 0:r.injectExtraAssetFields(t,n):null},t.$13=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.map(function(e){return e!=null?e:{}});return Object.assign.apply(Object,[{}].concat(r))},t.$3=function(t,n,r){var e=r.assetSnapshot,o=r.sessionSnapshot,a=this.$13(o==null?null:this.$11(o),o==null||e==null?null:this.$12(o,e),this.$7(n,t),o==null?null:this.$9(o),o==null||e==null?null:this.$10(e),this.$8(r),{elapsed_time:this.$6(r.startedAtMs)});this.$14(a)},t.$4=function(t,n,r){var e=this.$13(this.$11(r),this.$7(n,t),this.$9(r),this.$8(r.lastError));this.$14(e)},t.$5=function(t,n,r,o){var e=this.$13(this.$11(r),this.$12(r,o),this.$7(n,t),this.$9(r),this.$10(o),this.$8(o.lastAction));this.$14(e)},t.$14=function(t){r("logVideoUploadViaFalco")(t)},e})();l.default=h}),98);
__d("MediaUploadLinearProgressCalculator",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e,this.$2=this.$4(),this.$3=this.$1.sessionWeights.assets+this.$1.sessionWeights.publishing}var t=e.prototype;return t.$4=function(){var e=this.$1.assetWeights.uploadBytes;return this.$1.assetWeights.singleOperations.forEach(function(t){return e+=t}),e},t.$5=function(t,n){var e=Math.floor(t*100/this.$1.percentagePrecision)*this.$1.percentagePrecision,r=Math.abs(e-n)>=this.$1.percentagePrecision;return{percentageProgress:e,isDifferent:r}},t.calculateAssetProgress=function(t){var e=this.$1.assetWeights,n=0;if(t.isCompleted())n=1;else{for(var r of t.progress.completedStages.values()){var o=e.singleOperations.get(r);o!=null&&(n+=o)}var a=t.uploadSummary.computeUploadedPortion();a!=null&&(n+=e.uploadBytes*a),n/=this.$2}var i=this.$5(n,t.progress.calculated.percentageComplete);return t.progress.calculated.rawValue=n,t.progress.calculated.percentageComplete=i.percentageProgress,t.progress.calculated.rawValue=n,i.isDifferent},t.calculateSessionProgress=function(t){var e=this.$1.sessionWeights,n=0;t.progress.publishingDone&&(n+=e.publishing);var r=t.getActiveAssets();if(r.length>0){var o=e.assets/r.length;t.getActiveAssets().forEach(function(e){n+=o*e.progress.calculated.rawValue})}else n+=e.assets;n/=this.$3;var a=this.$5(n,t.progress.percentageComplete);return t.progress.percentageComplete=a.percentageProgress,a.isDifferent},e})();i.default=e}),66);
__d("MediaUploadNetworkMonitor",["MediaUploadAssetEvent","MediaUploadClientEvent","MediaUploadNetworkStatus","MediaUploadRetryState","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s={probe:function(){return r("MediaUploadNetworkStatus").UNKNOWN}},u={probe:function(){return(e||(e=n("Promise"))).resolve(r("MediaUploadNetworkStatus").UNKNOWN)}},c=(function(){function e(e,t){this.$1=e,this.$3=s,this.$2=u,this.$4=r("MediaUploadNetworkStatus").UNKNOWN,this.$5=new Map,this.$6=null,this.$8=null,this.$9=t.emitClientEvent}var t=e.prototype;return t.updateConfiguration=function(t){var e,n;this.$3=(e=t.networkProbe)!=null?e:s,this.$2=(n=t.internetProbe)!=null?n:u,this.$7=t.internetProbeBackoffPolicy==null?null:new(r("MediaUploadRetryState"))(t.internetProbeBackoffPolicy,this.$1),this.$8=t.stallDetectorTimeout,this.$10()},t.getNetworkStatus=function(){return this.$3.probe()},t.getInternetStatus=function(){return this.$4},t.$11=function(t,n){return t.sessionContext.sessionID+"/"+t.assetID+"/"+String(n)},t.$12=function(t,n,o){var e,a;this.$13(r("MediaUploadNetworkStatus").CONNECTED),(e=this.$7)==null||e.resetBackoff(),(a=this.$6)==null||a.cancel(),this.$6=null;var i=this.$11(t,n);o&&this.$5.set(i,{assetContext:t}),this.$10(),this.$14(i)},t.$15=function(t,n){var e=this.$11(t,n),r=this.$5.get(e);if(r!=null){var o;(o=r.stallDetector)==null||o.cancel(),r.stallDetector=null}this.$5.delete(e)},t.$14=function(t){var e,n=this.$8;if(n!=null){var o=this.$5.get(t);o!=null&&((e=o.stallDetector)==null||e.cancel(),o.stallDetector=this.$1.delayedExecutor(n,function(){o.assetContext.emitAssetEvent(r("MediaUploadAssetEvent").ASSET_STALL),o.stallDetector=null}))}},t.$10=function(){var e=this,t=this.$7;t!=null&&this.$5.size!==0&&this.$6==null&&(this.$6=this.$1.delayedExecutor(t.calculateBackoffDelay(),function(){var t=e.$2.probe().then(function(t){return e.$13(t)}).finally(function(){e.$6=null,e.$10()});e.$1.promiseTerminator(t)}),t.increaseRetryAttemptCounter())},t.$13=function(t){if(this.$4!==t)switch(this.$4=t,this.$4){case r("MediaUploadNetworkStatus").CONNECTED:this.$9(r("MediaUploadClientEvent").CLIENT_INTERNET_ONLINE);break;case r("MediaUploadNetworkStatus").DISCONNECTED:this.$9(r("MediaUploadClientEvent").CLIENT_INTERNET_OFFLINE);break;case r("MediaUploadNetworkStatus").TIMEOUT:this.$9(r("MediaUploadClientEvent").CLIENT_INTERNET_UNKNOWN);break;case r("MediaUploadNetworkStatus").UNKNOWN:}},t.notifyOnNewRequest=function(t,n){this.$12(t,n,!0)},t.notifyOnProgress=function(t,n){this.$12(t,n,!1)},t.notifyOnAbandon=function(t,n){this.$15(t,n)},t.notifyOnTransportError=function(t,n){this.$15(t,n)},t.notifyOnResponse=function(t,n){this.$15(t,n),this.$12(t,n,!1)},e})();l.default=c}),98);
__d("MediaUploadFBDefaultClientContext",["MediaUploadClientContext","MediaUploadClientEvent","MediaUploadEventEmitterAdapter","MediaUploadExecutor","MediaUploadFBAssetContext","MediaUploadFBAssetRequest","MediaUploadFBClient","MediaUploadFBClientEventContext","MediaUploadFBDefaultServerConfigurationRetriever","MediaUploadFBFileHasher","MediaUploadFBInternetProbe","MediaUploadFBLocalAssetStrategy","MediaUploadFBMetadataParser","MediaUploadFBMetadataValidator","MediaUploadFBNetworkAssetStrategy","MediaUploadFBNetworkProbe","MediaUploadFBReceiveRequest","MediaUploadFBSessionContext","MediaUploadFBStage","MediaUploadFBStartRequest","MediaUploadFBUploadServiceRequest","MediaUploadFalcoLogger","MediaUploadLinearProgressCalculator","MediaUploadNetworkMonitor","cr:1856704"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,o){var a,i=new(r("MediaUploadEventEmitterAdapter"))(t);return a=e.call(this,{sdk:t,emitter:i.emitter,executor:new(r("MediaUploadExecutor")),progressCalculator:new(r("MediaUploadLinearProgressCalculator"))({assetWeights:{uploadBytes:.9,singleOperations:new Map([[r("MediaUploadFBStage").START_REQUEST,.05],[r("MediaUploadFBStage").RECEIVE_REQUEST,.05]])},sessionWeights:{publishing:.1,assets:.9},percentagePrecision:1})})||this,a.entryPoint=n,a.eventAdapter=i,a.configuration=o,a.networkMonitor=new(r("MediaUploadNetworkMonitor"))(a.sdk,{emitClientEvent:function(o){return i.emitter.emitClientEvent(o,new(r("MediaUploadFBClientEventContext"))({entryPoint:n,envParams:t}))}}),a.localAssetStategy=a.$MediaUploadFBDefaultClientContext$p_1(),a.networkAssetStategy=a.$MediaUploadFBDefaultClientContext$p_2(),a.serverConfigurationRetriever=new(r("MediaUploadFBDefaultServerConfigurationRetriever"))({entryPoint:n,emitter:a.emitter,setters:{metadataValidation:function(t){a.localAssetStategy.metadataValidator.configuration=t},startRequest:function(t){a.networkAssetStategy.startRequest.configuration=t},receiveRequest:function(t){a.networkAssetStategy.receiveRequest.configuration=t},uploadService:function(t){a.networkAssetStategy.uploadServiceRequest.configuration=t},networkMonitor:function(t){a.networkMonitor.updateConfiguration({networkProbe:t.networkProbe.enabled?new(r("MediaUploadFBNetworkProbe")):null,internetProbe:t.internetProbe.enabled?new(r("MediaUploadFBInternetProbe"))({timeout:t.internetProbe.timeout},a.sdk):null,internetProbeBackoffPolicy:t.internetProbe.backoffPolicy,stallDetectorTimeout:t.stallDetector.enabled?t.stallDetector.timeout:null})}},envParams:a.sdk}),a.client=new(r("MediaUploadFBClient"))({implementation:a,sessionStrategy:a.sessionStrategy,envParams:a.sdk}),a.emitter.emitClientEvent(r("MediaUploadClientEvent").CLIENT_CREATED,new(r("MediaUploadFBClientEventContext"))({entryPoint:n,envParams:a.sdk})),a}babelHelpers.inheritsLoose(t,e);var o=t.prototype;return o.$MediaUploadFBDefaultClientContext$p_1=function(){return new(r("MediaUploadFBLocalAssetStrategy"))({envParams:this.sdk,metadataParser:new(r("MediaUploadFBMetadataParser")),metadataValidator:new(r("MediaUploadFBMetadataValidator"))(this.sdk),fileHasher:new(r("MediaUploadFBFileHasher"))({pseudoHasher:n("cr:1856704")==null?void 0:new(n("cr:1856704"))({maxChunkSize:1048576,takeFirstBytes:102400,hashingAlgorithm:"sha256",outputEncoding:"base64"},this.sdk)})})},o.$MediaUploadFBDefaultClientContext$p_2=function(){var e,t,n,o,a=new(r("MediaUploadFBStartRequest"))({entryPoint:this.entryPoint,payloadHook:(e=this.configuration.networkHooks)==null?void 0:e.startRequestPayload,customHeadersHook:(t=this.configuration.networkHooks)==null?void 0:t.startRequestCustomHeaders,envParams:this.sdk,networkNotifier:this.networkMonitor}),i=new(r("MediaUploadFBUploadServiceRequest"))({envParams:this.sdk,networkNotifier:this.networkMonitor}),l=new(r("MediaUploadFBReceiveRequest"))({entryPoint:this.entryPoint,payloadHook:(n=this.configuration.networkHooks)==null?void 0:n.receiveRequestPayload,customHeadersHook:(o=this.configuration.networkHooks)==null?void 0:o.receiveRequestCustomHeaders,envParams:this.sdk,networkNotifier:this.networkMonitor});return new(r("MediaUploadFBNetworkAssetStrategy"))(this.sdk,a,i,l)},o.runClientLazyLoading=function(t){return this.serverConfigurationRetriever.run(r("MediaUploadFBAssetContext").castOrThrow(t,this.sdk))},o.runLocalAssetStategy=function(t){return this.localAssetStategy.run(r("MediaUploadFBAssetContext").castOrThrow(t,this.sdk))},o.runNetworkAssetStategy=function(t){return this.networkAssetStategy.run(r("MediaUploadFBAssetContext").castOrThrow(t,this.sdk))},o.createSessionContext=function(t){return new(r("MediaUploadFBSessionContext"))({sessionID:t,entryPoint:this.entryPoint,emitter:this.emitter,progressCalculator:this.progressCalculator,params:this.sdk})},o.createAssetContext=function(t,n){return new(r("MediaUploadFBAssetContext"))({sessionContext:r("MediaUploadFBSessionContext").castOrThrow(t,this.sdk),assetRequest:r("MediaUploadFBAssetRequest").castOrThrow(n,this.sdk),emitter:this.emitter,progressCalculator:this.progressCalculator,retryState:this.createRetryState(),params:this.sdk})},o.publish=function(t,n){var e=this,o=r("MediaUploadFBSessionContext").castOrThrow(t,this.sdk).composeSnapshot(),a=n.map(function(t){return r("MediaUploadFBAssetContext").castOrThrow(t,e.sdk).composeSnapshot()});return this.configuration.eventHooks.publishCallback(o,a)},o.subscribeToHooks=function(){var e=this,t=new(r("MediaUploadFalcoLogger"))(this.sdk,{injectNetworkStatus:this.networkMonitor,injectExtraSessionFields:function(){return{composer_dialog_version:e.configuration.composerDialogVersion}}});t.subscribe(this.eventAdapter.subscriber,this.entryPoint),this.configuration.eventHooks.eventSubscriber!=null&&this.configuration.eventHooks.eventSubscriber(this.eventAdapter.subscriber)},t})(r("MediaUploadClientContext"));l.default=e}),98);
__d("MediaUploadSurface",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=t,this.sdk=e}var t=e.prototype;return t.isClientSupported=function(t){var e=this.$1.get(t.key);return e!=null},t.getClient=function(t){var e=this.$1.get(t.key);if(e==null)throw this.sdk.createThrowableError("Client configuration was not provided for the entry point "+t.key);return e()},e})();i.default=e}),66);
__d("MediaUploadFBSurface",["MediaUploadExtrasStorage","MediaUploadFBAssetRequest","MediaUploadSurface"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){return e.call(this,t,n)||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.createAssetRequest=function(t,n,o,a){var e=t(this.sdk.factories.assets),i;a!=null&&(i=new(r("MediaUploadExtrasStorage"))(this.sdk),a(i));var l;return typeof o=="function"?l=o(e):l=o,new(r("MediaUploadFBAssetRequest"))({asset:e,assetID:n,attributes:l,extras:i})},t})(r("MediaUploadSurface"));l.default=e}),98);
__d("MediaUploadSurfaceDefinition",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e,this.$2=new Map,this.$3=new Map}var t=e.prototype;return t.$4=function(t,n){var e=this;return function(){var r=e.$3.get(t.key);return r==null&&(r=e.$1.client(t,n),e.$3.set(t.key,r)),r}},t.registerClientConfiguration=function(t){var e=this;return t.entryPoints.forEach(function(n){e.$2.set(n.key,e.$4(n,t))}),this},t.createSurface=function(){return this.$1.surface(this.$2)},e})();i.default=e}),66);
__d("MediaUploadFBDefaultSurfaceDefinition",["MediaUploadFBDefaultClientContext","MediaUploadFBEntryPointID","MediaUploadFBSurface","MediaUploadSurfaceDefinition"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){return e.call(this,{client:function(n,o){var e=new(r("MediaUploadFBDefaultClientContext"))(t,r("MediaUploadFBEntryPointID").castOrThrow(n,t),o);return e.client},surface:function(n){return new(r("MediaUploadFBSurface"))(t,n)}})||this}return babelHelpers.inheritsLoose(t,e),t})(r("MediaUploadSurfaceDefinition"));l.default=e}),98);
__d("MediaUploadVUShimSurface",["MediaUploadFBDefaultSurfaceDefinition","MediaUploadFBEntryPointID","MediaUploadFBSDK","MediaUploadVUShim"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(r("MediaUploadFBDefaultSurfaceDefinition"))(r("MediaUploadFBSDK"));s.registerClientConfiguration({entryPoints:[new(e=r("MediaUploadFBEntryPointID"))("composer","pages_feed"),new e("composer","pages_feed_video_composer"),new e("newsfeed_composer","feed"),new e("composer","timeline")],eventHooks:{publishCallback:function(t,n){return r("MediaUploadVUShim").triggerPublish(t,n)},eventSubscriber:function(t){r("MediaUploadVUShim").setupEventSubscription(t)}}});var u=s.createSurface(),c=u;l.default=c}),98);
__d("VideoUploadCrashMonitor",["Bandicoot","VideoUploadLogger"],(function(t,n,r,o,a,i){var e=(function(e){"use strict";function t(t,n,r,o,a,i,l,s){var u;return u=e.call(this,"VideoUploadSession")||this,u.$VideoUploadCrashMonitor1={waterfallID:t,actorID:n,source:r,targetID:o,loggingDelay:a,supportsChunking:i,composerEntryPointRef:l,flowStarted:s},u}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.flowStarted=function(){this.$VideoUploadCrashMonitor1.flowStarted=!0},r.getCrashTimeData=function(){return this.$VideoUploadCrashMonitor1},r.logCrash=function(t,r,o){if(r.waterfallID){var e=new(n("VideoUploadLogger"))({actor_id:r.actorID,source:r.source,waterfall_id:r.waterfallID,target_id:r.targetID,delay:r.loggingDelay,is_chunked_upload:r.supportsChunking,composer_entry_point_ref:r.composerEntryPointRef}),a={error:"Crash Detected",error_description:"Detected video upload did not complete due to a crash"};e.logEvent(n("VideoUploadLogger").EVENT_FAILED_UPLOADING,a),r.flowStarted&&e.logEvent(n("VideoUploadLogger").EVENT_RESIGNED_FLOW,{})}},t})(n("Bandicoot"));a.exports=e}),null);
__d("GraphQLVideoPublishUtils",["immutable"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=r("immutable").List(["cs_ab_testing_video_upload","cs_content_library","cs_content_library_bulk_upload","cs_content_library_upload_videos","cs_content_show_episode_upload","cs_global_basic_post","cs_global_bulk_upload","cs_global_multipost","cs_global_upload_video","cs_home_basic_post","cs_home_bulk_video","cs_home_upload_video","cs_home_multipost","cs_instagram_content_library","media_manager","pages_feed_video_composer","pages_composer_bulk_upload_upsell","page_content_tab_drafts","page_content_tab_published_posts_opted_out","page_content_tab_scheduled_posts_opted_out","page_content_tab_video_library","page_content_tab_video_library_premiere","pages_posts","pages_video_tab","timeline","video_page_video_list","cs_unified_composer_optout","cs_content_show_trailer_upload","biz_web_testing_video_upload"]);n=n.push("feed_story");var o=n.contains(t);return(e==="composer"||e==="media_manager_instagram_video_composer"||e==="comment")&&o}l.isGraphQLPublish=e}),98);
__d("ResumableUploadAsyncService",["AsyncRequest","EventEmitter","ResumableUploadServiceState.enum","URI","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s="rupload",u="facebook.com",c=(function(t){function n(e,n,o,a,i,l,c,d,m){var p;return p=t.call(this)||this,p.consumer=e,p.accessToken=n,p.sessionKey=o||r("uuidv4")(),p.contentKey=a||"",p.contentValue=i||"",p.serviceName=l&&l!=""?l:s,p.serviceDomain=c&&c!=""?c:u,p.receiveParameters=d,p.tracingHeaderValue=m,p}babelHelpers.inheritsLoose(n,t),n.create=function(t){return new n(t.consumer,t.accessToken,t.sessionKey||"",t.contentKey,t.contentValue,t.serviceName,t.serviceDomain,t.receiveParameters,t.tracingHeaderValue)};var o=n.prototype;return o.resume=async function(t){try{var e=await this.sendOffsetRequest();this.emit(r("ResumableUploadServiceState.enum").START,{offset:e.offset});var n=await this.sendUploadRequest(t,e);this.emit(r("ResumableUploadServiceState.enum").SUCCESS,n.h)}catch(e){this.emit(r("ResumableUploadServiceState.enum").FAIL,e)}this.abortUpload=void 0},o.cancel=function(){this.abortUpload&&this.abortUpload(),this.emit(r("ResumableUploadServiceState.enum").CANCEL)},o.sendOffsetRequest=function(){var e=this;return new Promise(function(t,n){var o=new(r("AsyncRequest"))().setAllowCrossOrigin(!0).setAllowCredentials(!0).setMethod("GET").setURI(e.getUploadUri()).setReadOnly(!0).setRequestHeader("Authorization","OAuth "+e.accessToken).setHandler(function(e){return t(JSON.parse(e.payload.response))}).setErrorHandler(n).setOption("suppressEvaluation",!0).setTransportErrorHandler(function(t){e.emit(r("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,t)});e.abortUpload=function(){return o.abort()},o.send()})},o.sendUploadRequest=function(t,n){var e=this,o=n||{},a=o.offset,i=o.duplicate,l=i?"":t.slice(a);return new Promise(function(n,o){var i=new(r("AsyncRequest"))().setAllowCrossOrigin(!0).setAllowCredentials(!0).setURI(e.getUploadUri()).setRawData(l).setHandler(function(e){return n(JSON.parse(e.payload.response))}).setErrorHandler(o).setRequestHeader("Authorization","OAuth "+e.accessToken).setRequestHeader("X-Entity-Name",encodeURIComponent(t.name)).setRequestHeader("X-Entity-Type",t.type).setRequestHeader("X-Entity-Length",String(t.size)).setRequestHeader("Offset",String(a)).setOption("suppressEvaluation",!0).setUploadProgressHandler(function(n){var o=new ProgressEvent("upload-service",{total:t.size,loaded:n.loaded+Number(a)});e.emit(r("ResumableUploadServiceState.enum").PROGRESS,o)}).setTransportErrorHandler(function(t){e.emit(r("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,t)});e.abortUpload=function(){return i.abort()};var s=e.receiveParameters;s&&(i.setRequestHeader("start_offset",String(s.start_offset)).setRequestHeader("end_offset",String(s.end_offset)).setRequestHeader("composer_session_id",String(s.composer_session_id)).setRequestHeader("id",String(s.upload_session_id)),s.fb_region&&i.setRequestHeader("X-FB-Region",String(s.fb_region))),e.tracingHeaderValue&&i.setRequestHeader("x-fb-product-log",e.tracingHeaderValue),i.send()})},o.getUploadUri=function(){var t=this.getServiceName(),n=new(e||(e=r("URI")))("https://"+t+"/"+this.consumer+"/"+this.sessionKey);return this.contentKey&&this.contentValue&&(n=n.addQueryData(this.contentKey,this.contentValue)),n},o.getServiceName=function(){return this.serviceName+"."+this.serviceDomain},n})(r("EventEmitter"));l.default=c}),98);
__d("VideoUploadConnectionMonitor",["Network","VideoUploadFeatureDetector","cr:909282","debounce","mixin","setTimeout"],(function(t,n,r,o,a,i){var e=(function(e){"use strict";function t(){var t;return t=e.call(this)||this,t.$VideoUploadConnectionMonitor$p_1=!1,t.$VideoUploadConnectionMonitor$p_2=[],t.$VideoUploadConnectionMonitor$p_3=!1,t.$VideoUploadConnectionMonitor$p_4=!0,t.$VideoUploadConnectionMonitor$p_5=n("debounce")(function(){t.$VideoUploadConnectionMonitor$p_6(!1)},2e3),t}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.notifyStart=function(){var e=this;this.$VideoUploadConnectionMonitor$p_3||(this.$VideoUploadConnectionMonitor$p_2.length===0&&(this.$VideoUploadConnectionMonitor$p_2.push(n("Network").addListener("online",function(){e.$VideoUploadConnectionMonitor$p_6(!0)})),this.$VideoUploadConnectionMonitor$p_2.push(n("Network").addListener("offline",function(){e.$VideoUploadConnectionMonitor$p_1?e.$VideoUploadConnectionMonitor$p_5():(e.$VideoUploadConnectionMonitor$p_5.reset(),n("setTimeout")(e.$VideoUploadConnectionMonitor$p_5,2e3))}))),this.$VideoUploadConnectionMonitor$p_3=!0)},r.notifyProgress=function(t){this.$VideoUploadConnectionMonitor$p_3&&t&&n("VideoUploadFeatureDetector").supportsFullProgress()&&(this.$VideoUploadConnectionMonitor$p_1=!0,t.total&&t.loaded===t.total?this.$VideoUploadConnectionMonitor$p_5.reset():this.$VideoUploadConnectionMonitor$p_5())},r.notifySuccess=function(){this.$VideoUploadConnectionMonitor$p_3&&(this.reset(),this.$VideoUploadConnectionMonitor$p_6(!0))},r.notifyTransportError=function(){this.$VideoUploadConnectionMonitor$p_3&&(this.$VideoUploadConnectionMonitor$p_3=!1,this.$VideoUploadConnectionMonitor$p_6(!1))},r.notifyError=function(){this.$VideoUploadConnectionMonitor$p_3&&(this.reset(),this.$VideoUploadConnectionMonitor$p_6(!0))},r.isOnline=function(){return this.$VideoUploadConnectionMonitor$p_4},r.reset=function(){for(;this.$VideoUploadConnectionMonitor$p_2.length;)this.$VideoUploadConnectionMonitor$p_2.pop().remove();this.$VideoUploadConnectionMonitor$p_5.reset(),this.$VideoUploadConnectionMonitor$p_3=!1},r.$VideoUploadConnectionMonitor$p_6=function(t){this.$VideoUploadConnectionMonitor$p_5.reset(),this.$VideoUploadConnectionMonitor$p_4!==t&&(this.$VideoUploadConnectionMonitor$p_4=t,this.$VideoUploadConnectionMonitor$p_4?this.inform("online"):this.inform("offline"))},t})(n("mixin")(n("cr:909282")));a.exports=e}),null);
__d("VideoUploadReceiveRequestManager",["fbt","ODS","ResumableUploadAsyncService","ResumableUploadService","ResumableUploadServiceState.enum","VideoUploadConnectionMonitor","VideoUploadRequest","clearTimeout","cr:909282","err","isEmpty","md5","mixin","setTimeout","uuidv4"],(function(t,n,r,o,a,i,l,s){var e,u,c=1363037,d={INITIAL:"initial",NEXT_CHUNK:"next chunk",INVALID_OFFSET_RETRY:"invalid offset retry",SERVER_FAILURE_RETRY:"server failure retry",TRANSPORT_FAILURE_RETRY:"transport failure retry",TIMEOUT_RETRY:"timeout retry",BACK_ONLINE:"back online"},m=(function(t){function n(e,n,o,a,i,l,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L){var E;return m===void 0&&(m=""),p===void 0&&(p=!1),_===void 0&&(_=!1),f===void 0&&(f=null),g===void 0&&(g=null),h===void 0&&(h=null),y===void 0&&(y=0),C===void 0&&(C=!1),b===void 0&&(b=!1),v===void 0&&(v=!1),S===void 0&&(S=!1),R===void 0&&(R=!1),L===void 0&&(L=0),E=t.call(this)||this,E.$VideoUploadReceiveRequestManager$p_1=e,E.$VideoUploadReceiveRequestManager$p_2=n,E.$VideoUploadReceiveRequestManager$p_3=o!=null?o:0,E.$VideoUploadReceiveRequestManager$p_4=a,E.$VideoUploadReceiveRequestManager$p_5=i,E.$VideoUploadReceiveRequestManager$p_6=l,E.$VideoUploadReceiveRequestManager$p_7=s,E.$VideoUploadReceiveRequestManager$p_8=u,E.$VideoUploadReceiveRequestManager$p_9=c,E.$VideoUploadReceiveRequestManager$p_10=d,E.$VideoUploadReceiveRequestManager$p_11=0,E.$VideoUploadReceiveRequestManager$p_14=0,E.$VideoUploadReceiveRequestManager$p_15=0,E.$VideoUploadReceiveRequestManager$p_16=null,E.$VideoUploadReceiveRequestManager$p_17=null,E.$VideoUploadReceiveRequestManager$p_18=0,E.$VideoUploadReceiveRequestManager$p_19="constructed",E.$VideoUploadReceiveRequestManager$p_13=null,E.$VideoUploadReceiveRequestManager$p_20=null,E.$VideoUploadReceiveRequestManager$p_21=null,E.$VideoUploadReceiveRequestManager$p_22=m,E.$VideoUploadReceiveRequestManager$p_24=_,E.$VideoUploadReceiveRequestManager$p_23=p,E.$VideoUploadReceiveRequestManager$p_25=f,E.$VideoUploadReceiveRequestManager$p_26=!1,E.$VideoUploadReceiveRequestManager$p_27=g,E.$VideoUploadReceiveRequestManager$p_30=C,E.$VideoUploadReceiveRequestManager$p_31=b,E.$VideoUploadReceiveRequestManager$p_32=v,E.$VideoUploadReceiveRequestManager$p_29=y,E.$VideoUploadReceiveRequestManager$p_33=S,E.$VideoUploadReceiveRequestManager$p_28=h,E.$VideoUploadReceiveRequestManager$p_12=r("uuidv4")(),E.$VideoUploadReceiveRequestManager$p_34=R,E.$VideoUploadReceiveRequestManager$p_35=L,E.$VideoUploadReceiveRequestManager$p_40=null,E.$VideoUploadReceiveRequestManager$p_41=null,E.$VideoUploadReceiveRequestManager$p_39=!1,E.$VideoUploadReceiveRequestManager$p_38=null,E.$VideoUploadReceiveRequestManager$p_36=new(r("VideoUploadConnectionMonitor")),E.$VideoUploadReceiveRequestManager$p_36.subscribe("online",E.$VideoUploadReceiveRequestManager$p_49.bind(E)),E.$VideoUploadReceiveRequestManager$p_36.subscribe("offline",E.$VideoUploadReceiveRequestManager$p_50.bind(E)),E}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.updateVideoID=function(t){this.$VideoUploadReceiveRequestManager$p_37.getVideoID()||(this.$VideoUploadReceiveRequestManager$p_37.setVideoID(t),this.$VideoUploadReceiveRequestManager$p_44&&this.$VideoUploadReceiveRequestManager$p_44.setData(this.__createRequestData(this.$VideoUploadReceiveRequestManager$p_37)),this.$VideoUploadReceiveRequestManager$p_51())},a.isResumabilityEnabled=function(){return this.$VideoUploadReceiveRequestManager$p_23},a.isResumableServiceProxyReceiveEnabled=function(){return this.$VideoUploadReceiveRequestManager$p_30},a.sendRequest=function(t){if(this.$VideoUploadReceiveRequestManager$p_19="sending request",this.$VideoUploadReceiveRequestManager$p_44){this.$VideoUploadReceiveRequestManager$p_19="request already in progress";return}this.$VideoUploadReceiveRequestManager$p_18=t.getEndOffset()-t.getStartOffset(),this.$VideoUploadReceiveRequestManager$p_37=t,this.$VideoUploadReceiveRequestManager$p_52(d.INITIAL)},a.cancelRequest=function(){this.$VideoUploadReceiveRequestManager$p_44&&(this.$VideoUploadReceiveRequestManager$p_44.abort(),this.$VideoUploadReceiveRequestManager$p_21!=null&&this.$VideoUploadReceiveRequestManager$p_21.cancel(),this.$VideoUploadReceiveRequestManager$p_53(),this.inform("request-canceled"))},a.appendStateLogData=function(t,n){t[n+"request_manager_state"]=this.$VideoUploadReceiveRequestManager$p_19,t[n+"upload_speed"]=this.$VideoUploadReceiveRequestManager$p_17,t[n+"transport_retries"]=this.$VideoUploadReceiveRequestManager$p_11,t[n+"server_retries"]=this.$VideoUploadReceiveRequestManager$p_14,t[n+"timeout_retries"]=this.$VideoUploadReceiveRequestManager$p_15,t[n+"last_timeout_value"]=this.$VideoUploadReceiveRequestManager$p_42,t[n+"last_request_start_time"]=this.$VideoUploadReceiveRequestManager$p_16,t[n+"pending_request"]=this.$VideoUploadReceiveRequestManager$p_44!=null,t[n+"pending_timer"]=this.$VideoUploadReceiveRequestManager$p_45!=null,t[n+"cached_chunk"]=this.$VideoUploadReceiveRequestManager$p_43!=null,t[n+"early_receive_start"]=this.$VideoUploadReceiveRequestManager$p_39,this.$VideoUploadReceiveRequestManager$p_37!=null&&(t[n+"start_offset"]=this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),t[n+"end_offset"]=this.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),t[n+"partition_start_offset"]=this.$VideoUploadReceiveRequestManager$p_37.getPartitionStartOffset(),t[n+"partition_end_offset"]=this.$VideoUploadReceiveRequestManager$p_37.getPartitionEndOffset()),this.$VideoUploadReceiveRequestManager$p_36!=null&&(t[n+"connection_monitor_online"]=this.$VideoUploadReceiveRequestManager$p_36.isOnline())},a.getHostName=function(t){try{return new URL(t).hostname}catch(e){return null}},a.$VideoUploadReceiveRequestManager$p_53=function(){this.$VideoUploadReceiveRequestManager$p_44=null,this.$VideoUploadReceiveRequestManager$p_43=null,this.$VideoUploadReceiveRequestManager$p_11=0,this.$VideoUploadReceiveRequestManager$p_14=0,this.$VideoUploadReceiveRequestManager$p_12=r("uuidv4")(),this.$VideoUploadReceiveRequestManager$p_15=0,this.$VideoUploadReceiveRequestManager$p_16=null,this.$VideoUploadReceiveRequestManager$p_17=null,this.$VideoUploadReceiveRequestManager$p_18=0,this.$VideoUploadReceiveRequestManager$p_40=null,this.$VideoUploadReceiveRequestManager$p_41=null,this.$VideoUploadReceiveRequestManager$p_39=!1,this.$VideoUploadReceiveRequestManager$p_26=!1,this.$VideoUploadReceiveRequestManager$p_38=null,this.$VideoUploadReceiveRequestManager$p_37.reset(),this.$VideoUploadReceiveRequestManager$p_36.reset(),r("clearTimeout")(this.$VideoUploadReceiveRequestManager$p_45),this.$VideoUploadReceiveRequestManager$p_45=null},a.$VideoUploadReceiveRequestManager$p_52=function(t,n){if(r("clearTimeout")(this.$VideoUploadReceiveRequestManager$p_45),this.$VideoUploadReceiveRequestManager$p_45=null,this.$VideoUploadReceiveRequestManager$p_20=t,this.$VideoUploadReceiveRequestManager$p_13=r("uuidv4")(),this.$VideoUploadReceiveRequestManager$p_37.getSupportsChunking()&&this.$VideoUploadReceiveRequestManager$p_37.getStartOffset()>=this.$VideoUploadReceiveRequestManager$p_37.getPartitionEndOffset()){n?this.$VideoUploadReceiveRequestManager$p_19="request finished - not notified":(this.inform("request-finished",{start_offset:this.$VideoUploadReceiveRequestManager$p_37.getEndOffset()-1,end_offset:this.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager$p_11,server_retries:this.$VideoUploadReceiveRequestManager$p_14,upload_speed:this.$VideoUploadReceiveRequestManager$p_17,request_manager_state:this.$VideoUploadReceiveRequestManager$p_19,upload_domain:this.$VideoUploadReceiveRequestManager$p_38,debug:{request_reason:this.$VideoUploadReceiveRequestManager$p_20,single_request_id:this.$VideoUploadReceiveRequestManager$p_13}}),this.$VideoUploadReceiveRequestManager$p_19="request finished - notified");return}this.$VideoUploadReceiveRequestManager$p_44=this.__getVideoUploadRequest(this.$VideoUploadReceiveRequestManager$p_1).setAllowCrossOrigin(!0).setData(this.__createRequestData(this.$VideoUploadReceiveRequestManager$p_37)).setWaterfallID(this.$VideoUploadReceiveRequestManager$p_37.getWaterfallID()).setSuccessHandler(this.__handleSuccessResponse.bind(this)).setErrorHandler(this.__handleServerFailureResponse.bind(this)).setTransportErrorHandler(this.$VideoUploadReceiveRequestManager$p_54.bind(this)),this.$VideoUploadReceiveRequestManager$p_23||this.$VideoUploadReceiveRequestManager$p_44.setUploadProgressHandler(this.$VideoUploadReceiveRequestManager$p_55.bind(this)),this.$VideoUploadReceiveRequestManager$p_16=Date.now(),this.$VideoUploadReceiveRequestManager$p_38=this.getHostName(this.$VideoUploadReceiveRequestManager$p_1);var e=!1;if(this.$VideoUploadReceiveRequestManager$p_37.getSupportsChunking()){if(this.$VideoUploadReceiveRequestManager$p_5){var o=this.$VideoUploadReceiveRequestManager$p_56(this.$VideoUploadReceiveRequestManager$p_37.getEndOffset()-this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),this.$VideoUploadReceiveRequestManager$p_17);this.$VideoUploadReceiveRequestManager$p_44.setTimeoutHandler(o,this.__handleResponseTimeout.bind(this)),this.$VideoUploadReceiveRequestManager$p_19="sending chunk with timeout = "+o,this.$VideoUploadReceiveRequestManager$p_42=o}else this.$VideoUploadReceiveRequestManager$p_19="sending chunk without timeout";var a=this.$VideoUploadReceiveRequestManager$p_57();if(a==null){var i="Provided chunk is null.",l=r("err")(i);l.is_js_error=!0,this.$VideoUploadReceiveRequestManager$p_58({error_description:i,error_is_transient:!1,error:l});return}else this.$VideoUploadReceiveRequestManager$p_23&&this.$VideoUploadReceiveRequestManager$p_29<this.$VideoUploadReceiveRequestManager$p_37.getFile().getSize()?(e=!0,this.$VideoUploadReceiveRequestManager$p_59(a)):this.$VideoUploadReceiveRequestManager$p_44.sendChunk(a)}else this.$VideoUploadReceiveRequestManager$p_19="sending file",this.$VideoUploadReceiveRequestManager$p_44.sendFile(this.$VideoUploadReceiveRequestManager$p_37.getFile().getFileInput());this.$VideoUploadReceiveRequestManager$p_60(e),this.$VideoUploadReceiveRequestManager$p_36.notifyStart(),this.inform("request-started",{start_offset:this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager$p_11,server_retries:this.$VideoUploadReceiveRequestManager$p_14,upload_speed:this.$VideoUploadReceiveRequestManager$p_17,request_manager_state:this.$VideoUploadReceiveRequestManager$p_19,upload_domain:this.$VideoUploadReceiveRequestManager$p_38,debug:{request_reason:this.$VideoUploadReceiveRequestManager$p_20,single_request_id:this.$VideoUploadReceiveRequestManager$p_13}})},a.$VideoUploadReceiveRequestManager$p_60=function(t){(this.$VideoUploadReceiveRequestManager$p_37.getSource()==="create_flow"||this.$VideoUploadReceiveRequestManager$p_37.getSource()==="ads_interfaces")&&(u||(u=o("ODS"))).bumpEntityKey(2966,"video_ads_upload",t?"upload_service":"graph_api")},a.$VideoUploadReceiveRequestManager$p_61=function(t,n,r){this.$VideoUploadReceiveRequestManager$p_37.getVideoID()?t(n,r):(this.$VideoUploadReceiveRequestManager$p_40=t,this.$VideoUploadReceiveRequestManager$p_41=n)},a.$VideoUploadReceiveRequestManager$p_51=function(){this.$VideoUploadReceiveRequestManager$p_40&&(this.$VideoUploadReceiveRequestManager$p_40(this.$VideoUploadReceiveRequestManager$p_41),this.$VideoUploadReceiveRequestManager$p_40=null,this.$VideoUploadReceiveRequestManager$p_41=null)},a.$VideoUploadReceiveRequestManager$p_59=function(t){var e,n=this.$VideoUploadReceiveRequestManager$p_37.getFile(),o=n.getFile().lastModified+n.getFile().name+n.getFile().type+this.$VideoUploadReceiveRequestManager$p_62(),a=String(r("md5")(o))+"-"+this.$VideoUploadReceiveRequestManager$p_37.getStartOffset()+"-"+this.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),i=((e=this.$VideoUploadReceiveRequestManager$p_37)==null?void 0:e.getRetryState())==null?this.$VideoUploadReceiveRequestManager$p_14+this.$VideoUploadReceiveRequestManager$p_11+this.$VideoUploadReceiveRequestManager$p_15:this.$VideoUploadReceiveRequestManager$p_37.getRetryState().getTotalRetryCount(),l=this.$VideoUploadReceiveRequestManager$p_34&&this.$VideoUploadReceiveRequestManager$p_35<n.getSize()?["video_upload_www",[this.$VideoUploadReceiveRequestManager$p_12,String(i)].join("_"),[String(this.$VideoUploadReceiveRequestManager$p_37.getWaterfallID()),String(this.$VideoUploadReceiveRequestManager$p_37.getVideoID())].join("_")].join(":"):null;this.isResumabilityEnabled()&&this.$VideoUploadReceiveRequestManager$p_25&&this.$VideoUploadReceiveRequestManager$p_11>this.$VideoUploadReceiveRequestManager$p_2/3&&(this.$VideoUploadReceiveRequestManager$p_26=!0);var s="fb_video";this.$VideoUploadReceiveRequestManager$p_30&&(s="fb_video2");var u=null;if(this.$VideoUploadReceiveRequestManager$p_30||this.$VideoUploadReceiveRequestManager$p_31){var c={};c.start_offset=this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),c.end_offset=this.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),c.composer_session_id=this.$VideoUploadReceiveRequestManager$p_37.getWaterfallID(),c.upload_session_id=this.$VideoUploadReceiveRequestManager$p_37.getUploadSessionID(),c.product_media_id=this.$VideoUploadReceiveRequestManager$p_37.getVideoID(),c.xpv_asset_id=this.$VideoUploadReceiveRequestManager$p_37.getXPVAssetID(),c.is_xpv_single_prod=this.$VideoUploadReceiveRequestManager$p_37.getIsXPVSingleProd(),c.fb_region=this.$VideoUploadReceiveRequestManager$p_37.getFbRegion(),this.$VideoUploadReceiveRequestManager$p_32&&(c.total_file_size=this.$VideoUploadReceiveRequestManager$p_37.getFile().getSize()),u=c}var d={};d.consumer=s,d.sessionKey=a,d.serviceName=this.$VideoUploadReceiveRequestManager$p_26?null:this.$VideoUploadReceiveRequestManager$p_25,d.serviceDomain=this.$VideoUploadReceiveRequestManager$p_27,d.receiveParameters=u,d.tracingHeaderValue=l;var m;this.$VideoUploadReceiveRequestManager$p_24?m=r("ResumableUploadAsyncService").create(d):m=r("ResumableUploadService").create(d),this.$VideoUploadReceiveRequestManager$p_21=m,this.$VideoUploadReceiveRequestManager$p_38=m.getServiceName(),this.$VideoUploadReceiveRequestManager$p_63(),m.resume(t),this.inform("resumable-called",{debug:{single_request_id:this.$VideoUploadReceiveRequestManager$p_13,authority:this.$VideoUploadReceiveRequestManager$p_38}})},a.$VideoUploadReceiveRequestManager$p_63=function(){var e=this;this.$VideoUploadReceiveRequestManager$p_37.getVideoID()||(this.$VideoUploadReceiveRequestManager$p_39=!0);var t=this.$VideoUploadReceiveRequestManager$p_21;t!=null&&(t.addListener(r("ResumableUploadServiceState.enum").START,function(t){e.inform("resumable-started",{resume_from_offset:t.offset,debug:{single_request_id:e.$VideoUploadReceiveRequestManager$p_13,partition:e.$VideoUploadReceiveRequestManager$p_37.getPartitionNo(),authority:e.$VideoUploadReceiveRequestManager$p_38}})}),this.$VideoUploadReceiveRequestManager$p_46=function(t){e.inform("resumable-failed",{error_code:t.getError(),error_description:t.getErrorDescription(),error_summary:t.getErrorSummary(),error_is_transient:t.isTransient(),debug:{error_source:"service",single_request_id:e.$VideoUploadReceiveRequestManager$p_13,partition:e.$VideoUploadReceiveRequestManager$p_37.getPartitionNo(),authority:e.$VideoUploadReceiveRequestManager$p_38}}),e.__handleServerFailureResponse(t)},t.addListener(r("ResumableUploadServiceState.enum").FAIL,function(t){e.$VideoUploadReceiveRequestManager$p_61(e.$VideoUploadReceiveRequestManager$p_46,t)}),this.$VideoUploadReceiveRequestManager$p_47=function(t){e.$VideoUploadReceiveRequestManager$p_30?e.__handleSuccessResponsePayload({start_offset:e.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),end_offset:e.$VideoUploadReceiveRequestManager$p_37.getPartitionEndOffset()}):(e.$VideoUploadReceiveRequestManager$p_44.setHandle(t),e.$VideoUploadReceiveRequestManager$p_44.sendChunk(null)),e.inform("resumable-success",{everstore_handle:t,debug:{single_request_id:e.$VideoUploadReceiveRequestManager$p_13,partition:e.$VideoUploadReceiveRequestManager$p_37.getPartitionNo(),authority:e.$VideoUploadReceiveRequestManager$p_38}})},t.addListener(r("ResumableUploadServiceState.enum").SUCCESS,function(t){e.$VideoUploadReceiveRequestManager$p_61(e.$VideoUploadReceiveRequestManager$p_47,t)}),this.$VideoUploadReceiveRequestManager$p_48=function(t,n){e.inform("resumable-failed",{error_code:t.getError(),error_description:t.getErrorDescription(),error_summary:t.getErrorSummary(),error_is_transient:t.isTransient(),resume_from_offset:n.offset,debug:{error_source:"transport",single_request_id:e.$VideoUploadReceiveRequestManager$p_13,partition:e.$VideoUploadReceiveRequestManager$p_37.getPartitionNo(),method:n.method,authority:e.$VideoUploadReceiveRequestManager$p_38}}),e.$VideoUploadReceiveRequestManager$p_54(t)},t.addListener(r("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,function(t,n){e.$VideoUploadReceiveRequestManager$p_61(e.$VideoUploadReceiveRequestManager$p_48,t,n)}),t.addListener(r("ResumableUploadServiceState.enum").PROGRESS,function(t){e.$VideoUploadReceiveRequestManager$p_33&&(e.$VideoUploadReceiveRequestManager$p_11=0),e.$VideoUploadReceiveRequestManager$p_55(t)}))},a.__getVideoUploadRequest=function(t){return new(r("VideoUploadRequest"))(t)},a.$VideoUploadReceiveRequestManager$p_64=function(t,n){this.$VideoUploadReceiveRequestManager$p_19="setting request to send after"+n,r("clearTimeout")(this.$VideoUploadReceiveRequestManager$p_45),this.$VideoUploadReceiveRequestManager$p_45=r("setTimeout")(this.$VideoUploadReceiveRequestManager$p_52.bind(this,t),n)},a.$VideoUploadReceiveRequestManager$p_57=function(){if(this.$VideoUploadReceiveRequestManager$p_43)return this.$VideoUploadReceiveRequestManager$p_43;var e=this.$VideoUploadReceiveRequestManager$p_37.getFile();if(this.$VideoUploadReceiveRequestManager$p_23){var t=e.getFile();this.$VideoUploadReceiveRequestManager$p_43=t?t.slice(this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),this.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),"application/octet-stream"):null}else this.$VideoUploadReceiveRequestManager$p_43=e.getChunk(this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),this.$VideoUploadReceiveRequestManager$p_37.getEndOffset());return this.$VideoUploadReceiveRequestManager$p_43},a.__createRequestData=function(t){return{composer_session_id:t.getComposerSessionID(),video_id:t.getVideoID(),start_offset:t.getStartOffset(),end_offset:t.getEndOffset(),source:t.getSource(),target_id:t.getTargetID(),waterfall_id:t.getWaterfallID(),composer_entry_point_ref:t.getComposerEntryPointRef&&t.getComposerEntryPointRef(),composer_work_shared_draft_mode:t.getComposerWorkSharedDraftMode(),composer_dialog_version:t.getComposerDialogVersion(),has_file_been_replaced:t.getHasFileBeenReplaced(),supports_chunking:t.getSupportsChunking(),upload_speed:this.$VideoUploadReceiveRequestManager$p_17,partition_start_offset:t.getPartitionStartOffset(),partition_end_offset:t.getPartitionEndOffset()}},a.__handleSuccessResponse=function(t){var e=t.getPayload();this.__handleSuccessResponsePayload(e)},a.__handleSuccessResponsePayload=function(t){this.$VideoUploadReceiveRequestManager$p_19="success response received";var e=Date.now()-(this.$VideoUploadReceiveRequestManager$p_16||0);if(e=e===0?1:e,t.start_offset===this.$VideoUploadReceiveRequestManager$p_37.getEndOffset()){var n=this.$VideoUploadReceiveRequestManager$p_37.getEndOffset()-this.$VideoUploadReceiveRequestManager$p_37.getStartOffset();this.$VideoUploadReceiveRequestManager$p_17=Math.floor(n/e)}else this.$VideoUploadReceiveRequestManager$p_17=null;this.$VideoUploadReceiveRequestManager$p_36.notifySuccess(),this.inform("request-finished",{start_offset:this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager$p_11,server_retries:this.$VideoUploadReceiveRequestManager$p_14,upload_speed:this.$VideoUploadReceiveRequestManager$p_17,request_manager_state:this.$VideoUploadReceiveRequestManager$p_19,upload_domain:this.$VideoUploadReceiveRequestManager$p_38,debug:{request_reason:this.$VideoUploadReceiveRequestManager$p_20,single_request_id:this.$VideoUploadReceiveRequestManager$p_13}}),this.$VideoUploadReceiveRequestManager$p_37.setStartOffset(t.start_offset);var o=t.end_offset;this.$VideoUploadReceiveRequestManager$p_37.getClientChunkSize()&&(o=t.start_offset+Math.min(this.$VideoUploadReceiveRequestManager$p_37.getPartitionEndOffset()-t.start_offset,this.$VideoUploadReceiveRequestManager$p_37.getClientChunkSize())),this.$VideoUploadReceiveRequestManager$p_37.setEndOffset(o),this.$VideoUploadReceiveRequestManager$p_37.setLastKnownUploadSpeed(this.$VideoUploadReceiveRequestManager$p_17),this.$VideoUploadReceiveRequestManager$p_44=null,this.$VideoUploadReceiveRequestManager$p_43=null,this.$VideoUploadReceiveRequestManager$p_11=0,this.$VideoUploadReceiveRequestManager$p_14=0,this.$VideoUploadReceiveRequestManager$p_12=r("uuidv4")(),this.$VideoUploadReceiveRequestManager$p_15=0,this.$VideoUploadReceiveRequestManager$p_37.getSupportsChunking()&&this.$VideoUploadReceiveRequestManager$p_52(d.NEXT_CHUNK,!0)},a.$VideoUploadReceiveRequestManager$p_65=function(t){var e,n=this,r=t.getPayload();this.$VideoUploadReceiveRequestManager$p_19="invalid offset response received start="+r.start_offset+" end="+r.end_offset,(this.$VideoUploadReceiveRequestManager$p_37.getStartOffset()!=r.start_offset||this.$VideoUploadReceiveRequestManager$p_37.getEndOffset()!=r.end_offset)&&(this.$VideoUploadReceiveRequestManager$p_37.setStartOffset(r.start_offset),this.$VideoUploadReceiveRequestManager$p_37.setEndOffset(r.end_offset),this.$VideoUploadReceiveRequestManager$p_43=null),((e=this.$VideoUploadReceiveRequestManager$p_37)==null?void 0:e.getRetryState())==null?(this.$VideoUploadReceiveRequestManager$p_14++,this.$VideoUploadReceiveRequestManager$p_52(d.INVALID_OFFSET_RETRY)):this.$VideoUploadReceiveRequestManager$p_37.getRetryState().handleRetry({context:{location:"receive-invalid_offset"},retryHandler:function(t){return n.$VideoUploadReceiveRequestManager$p_64(d.INVALID_OFFSET_RETRY,t)},failureHandler:function(){return n.$VideoUploadReceiveRequestManager$p_66(t)}})},a.__handleServerFailureResponse=function(t){var e=this;if(this.$VideoUploadReceiveRequestManager$p_19="failure response received",this.$VideoUploadReceiveRequestManager$p_44=null,this.$VideoUploadReceiveRequestManager$p_11=0,this.$VideoUploadReceiveRequestManager$p_17=null,this.$VideoUploadReceiveRequestManager$p_15=0,this.$VideoUploadReceiveRequestManager$p_36.notifyError(),this.__hasInvalidStartOffsetAndHasRetries(t.getError()))this.$VideoUploadReceiveRequestManager$p_65(t);else{var n;((n=this.$VideoUploadReceiveRequestManager$p_37)==null?void 0:n.getRetryState())==null?(t.isTransient()||this.$VideoUploadReceiveRequestManager$p_10)&&this.$VideoUploadReceiveRequestManager$p_14<this.$VideoUploadReceiveRequestManager$p_4?(this.$VideoUploadReceiveRequestManager$p_19="transient server error",this.$VideoUploadReceiveRequestManager$p_14++,this.$VideoUploadReceiveRequestManager$p_64(d.SERVER_FAILURE_RETRY,this.$VideoUploadReceiveRequestManager$p_67(this.$VideoUploadReceiveRequestManager$p_9,this.$VideoUploadReceiveRequestManager$p_14,0))):this.$VideoUploadReceiveRequestManager$p_66(t):this.$VideoUploadReceiveRequestManager$p_37.getRetryState().handleRetry({context:{location:"receive-server_issue",error_code:t.getError()},predicate:function(){return t.isTransient()},retryHandler:function(n){e.$VideoUploadReceiveRequestManager$p_19="transient server error",e.$VideoUploadReceiveRequestManager$p_64(d.SERVER_FAILURE_RETRY,n)},failureHandler:function(){return e.$VideoUploadReceiveRequestManager$p_66(t)}})}},a.__handleResponseTimeout=function(t){var e=this,n;this.inform("request-timeout",{start_offset:this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManager$p_37.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager$p_11,server_retries:this.$VideoUploadReceiveRequestManager$p_14,timeout_retries:this.$VideoUploadReceiveRequestManager$p_15,upload_speed:this.$VideoUploadReceiveRequestManager$p_17,request_manager_state:this.$VideoUploadReceiveRequestManager$p_19,debug:{upload_domain:this.$VideoUploadReceiveRequestManager$p_38,single_request_id:this.$VideoUploadReceiveRequestManager$p_13}}),this.$VideoUploadReceiveRequestManager$p_44.abort(),this.$VideoUploadReceiveRequestManager$p_44=null,this.$VideoUploadReceiveRequestManager$p_17=null,this.$VideoUploadReceiveRequestManager$p_36.notifyTransportError();var r=function(){var t=e.$VideoUploadReceiveRequestManager$p_37.getEndOffset()-e.$VideoUploadReceiveRequestManager$p_37.getStartOffset();t=Math.floor(t/2),t=Math.max(t,e.$VideoUploadReceiveRequestManager$p_18);var n=e.$VideoUploadReceiveRequestManager$p_37.getEndOffset();n=Math.min(n,e.$VideoUploadReceiveRequestManager$p_37.getStartOffset()+t),e.$VideoUploadReceiveRequestManager$p_37.setEndOffset(n),e.$VideoUploadReceiveRequestManager$p_43=null,e.$VideoUploadReceiveRequestManager$p_19="resending after timeout with chunksize="+t,e.$VideoUploadReceiveRequestManager$p_52(d.TIMEOUT_RETRY)},o=function(){e.$VideoUploadReceiveRequestManager$p_58({error_code:1006,error_description:s._(/*BTDS*/"Your browser appears to be offline. Please check your internet connection and try again."),error_summary:s._(/*BTDS*/"No hay conexi\u00f3n de red"),error_is_transient:!0,opes_mids:["fake_mid_network_connection"]})};((n=this.$VideoUploadReceiveRequestManager$p_37)==null?void 0:n.getRetryState())==null?++this.$VideoUploadReceiveRequestManager$p_15<=this.$VideoUploadReceiveRequestManager$p_6?r():o():this.$VideoUploadReceiveRequestManager$p_37.getRetryState().handleRetry({context:{location:"receive-timeout",error_code:1006},retryHandler:function(t){return r()},failureHandler:function(){return o()}})},a.__hasInvalidStartOffsetAndHasRetries=function(t){return t===c&&this.$VideoUploadReceiveRequestManager$p_14<this.$VideoUploadReceiveRequestManager$p_4},a.$VideoUploadReceiveRequestManager$p_54=function(t){var e,n=this;this.$VideoUploadReceiveRequestManager$p_36.notifyTransportError(),this.$VideoUploadReceiveRequestManager$p_17=null,((e=this.$VideoUploadReceiveRequestManager$p_37)==null?void 0:e.getRetryState())==null?(this.$VideoUploadReceiveRequestManager$p_15=0,this.$VideoUploadReceiveRequestManager$p_11<this.$VideoUploadReceiveRequestManager$p_2?(this.$VideoUploadReceiveRequestManager$p_19="resending after transport failure",this.$VideoUploadReceiveRequestManager$p_11++,this.$VideoUploadReceiveRequestManager$p_44=null,this.$VideoUploadReceiveRequestManager$p_64(d.TRANSPORT_FAILURE_RETRY,this.$VideoUploadReceiveRequestManager$p_67(this.$VideoUploadReceiveRequestManager$p_8,this.$VideoUploadReceiveRequestManager$p_11,this.$VideoUploadReceiveRequestManager$p_3))):this.$VideoUploadReceiveRequestManager$p_66(t)):this.$VideoUploadReceiveRequestManager$p_37.getRetryState().handleRetry({context:{location:"receive-transport_issue",error_code:t.getError()},retryHandler:function(t){n.$VideoUploadReceiveRequestManager$p_44=null,n.$VideoUploadReceiveRequestManager$p_19="resending after transport failure",n.$VideoUploadReceiveRequestManager$p_64(d.TRANSPORT_FAILURE_RETRY,t)},failureHandler:function(){return n.$VideoUploadReceiveRequestManager$p_66(t)}})},a.$VideoUploadReceiveRequestManager$p_66=function(n){var t,o,a=[].concat(n==null||(t=n.getPayload())==null||(t=t.error)==null?void 0:t.opes_mids,[n==null?void 0:n.errorMid]).filter(Boolean);this.$VideoUploadReceiveRequestManager$p_58({error_code:n.getError(),error_description:n.getErrorDescription(),error_summary:n.getErrorSummary(),error_is_transient:n.isTransient(),upload_domain:this.uploadDomain,www_request_id:(o=n.getPayload())==null?void 0:o.__www_request_id__,opes_mids:(e||(e=r("isEmpty")))(a)?null:a})},a.$VideoUploadReceiveRequestManager$p_58=function(t){this.$VideoUploadReceiveRequestManager$p_19="handling failure error",t.debug=babelHelpers.extends({},t.debug,{single_request_id:this.$VideoUploadReceiveRequestManager$p_13}),this.inform("request-failed",t),this.$VideoUploadReceiveRequestManager$p_53()},a.$VideoUploadReceiveRequestManager$p_55=function(t){this.$VideoUploadReceiveRequestManager$p_36.notifyProgress(t),this.$VideoUploadReceiveRequestManager$p_37&&this.$VideoUploadReceiveRequestManager$p_37.getFile()&&this.inform("request-progressed",{file_size:this.$VideoUploadReceiveRequestManager$p_37.getFile().getSize(),start_offset:this.$VideoUploadReceiveRequestManager$p_37.getStartOffset(),sent_bytes:t.loaded,transport_retries:this.$VideoUploadReceiveRequestManager$p_11,upload_domain:this.$VideoUploadReceiveRequestManager$p_38,debug:{single_request_id:this.$VideoUploadReceiveRequestManager$p_13}})},a.$VideoUploadReceiveRequestManager$p_49=function(){var e;this.inform("online"),this.$VideoUploadReceiveRequestManager$p_11=0,this.$VideoUploadReceiveRequestManager$p_15=0,(e=this.$VideoUploadReceiveRequestManager$p_37)==null||(e=e.getRetryState())==null||e.resetDelay(),this.$VideoUploadReceiveRequestManager$p_45&&this.$VideoUploadReceiveRequestManager$p_52(d.BACK_ONLINE)},a.$VideoUploadReceiveRequestManager$p_50=function(){this.inform("offline")},a.$VideoUploadReceiveRequestManager$p_67=function(t,n,r){var e=0;return this.$VideoUploadReceiveRequestManager$p_23?e=Math.min(Math.pow(t,n),8)*1e3:e=Math.pow(t,n)*1e3,r>0&&(e=Math.min(e,r)),e},a.$VideoUploadReceiveRequestManager$p_56=function(t,n){var e;n!=null&&n>0?e=n:e=10;var r=Math.floor(t/e*this.$VideoUploadReceiveRequestManager$p_7/100);return Math.max(r,3e4)},a.$VideoUploadReceiveRequestManager$p_62=function(){return this.$VideoUploadReceiveRequestManager$p_28?this.$VideoUploadReceiveRequestManager$p_28:this.$VideoUploadReceiveRequestManager$p_37.getWaterfallID()},n})(r("mixin")(n("cr:909282")));l.default=m}),226);
__d("FileHasher",["FileHashWorkerResource","WebWorker","emptyFunction","fileSliceName"],(function(t,n,r,o,a,i){var e=(function(){"use strict";function e(){var e=this,t=n("FileHashWorkerResource");n("WebWorker").prepareResource(t),this.$1=new(n("WebWorker"))(t).setMessageHandler(function(t){e.$2(t)}).execute()}e.isSupported=function(){return n("WebWorker").isSupported()};var t=e.prototype;return t.hash=function(t,r){return this.$2=r,this.$1.postMessage({file:t,fileSliceName:n("fileSliceName")}),this},t.destroy=function(){this.$2=n("emptyFunction"),this.$1.terminate()},e})();a.exports=e}),null);
__d("VideoUploadStartRequestManager",["Assert","FileHasher","VideoUploadRequest","clearTimeout","cr:909282","isEmpty","mixin","performanceNow","setTimeout"],(function(t,n,r,o,a,i,l){var e,s,u=(function(t){function n(e,n,r,o,a,i,l,s){var u;return u=t.call(this)||this,u.$VideoUploadStartRequestManager1=e,u.$VideoUploadStartRequestManager2=n,u.$VideoUploadStartRequestManager3=r,u.$VideoUploadStartRequestManager4=o,u.$VideoUploadStartRequestManager5=0,u.$VideoUploadStartRequestManager6=a,u.$VideoUploadStartRequestManager7=i,u.$VideoUploadStartRequestManager8=l,u.$VideoUploadStartRequestManager9=s,u.$VideoUploadStartRequestManager10=0,u}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.getRequest=function(){return this.$VideoUploadStartRequestManager11},o.sendRequest=function(n){var t=this;this.$VideoUploadStartRequestManager12||this.$VideoUploadStartRequestManager11||(this.$VideoUploadStartRequestManager13=n,this.$VideoUploadStartRequestManager6&&this.$VideoUploadStartRequestManager13.getFile().getFile()&&this.$VideoUploadStartRequestManager13.getFile().getFile().size<this.$VideoUploadStartRequestManager7&&r("FileHasher").isSupported()?(this.$VideoUploadStartRequestManager14=(e||(e=r("performanceNow")))(),this.$VideoUploadStartRequestManager12=new(r("FileHasher")),this.$VideoUploadStartRequestManager12.hash(this.$VideoUploadStartRequestManager13.getFile().getFile(),function(n){t.$VideoUploadStartRequestManager14=(e||(e=r("performanceNow")))()-t.$VideoUploadStartRequestManager14,t.$VideoUploadStartRequestManager15=n.hash,t.$VideoUploadStartRequestManager12.destroy(),t.$VideoUploadStartRequestManager12=null,n.hash||(t.$VideoUploadStartRequestManager16=n.exception),t.$VideoUploadStartRequestManager17()})):this.$VideoUploadStartRequestManager17())},o.$VideoUploadStartRequestManager17=function(){this.$VideoUploadStartRequestManager18(),this.inform("request-started",{hash_time:this.$VideoUploadStartRequestManager14,hash_exception:this.$VideoUploadStartRequestManager16})},o.$VideoUploadStartRequestManager18=function(){r("clearTimeout")(this.$VideoUploadStartRequestManager19),this.$VideoUploadStartRequestManager19=null,this.$VideoUploadStartRequestManager11=this.__getVideoUploadRequest(this.$VideoUploadStartRequestManager1).setAllowCrossOrigin(!0).setData(this.__getDataToSend(this.$VideoUploadStartRequestManager13,this.$VideoUploadStartRequestManager15)).setWaterfallID(this.$VideoUploadStartRequestManager13.getWaterfallID()).setSuccessHandler(this.$VideoUploadStartRequestManager20.bind(this)).setErrorHandler(this.$VideoUploadStartRequestManager21.bind(this)).setTransportErrorHandler(this.$VideoUploadStartRequestManager22.bind(this)),this.$VideoUploadStartRequestManager11.send()},o.__getVideoUploadRequest=function(t){return new(r("VideoUploadRequest"))(t)},o.__getDataToSend=function(t,n){var e={file_size:t.getFile().getSize(),file_extension:t.getFile().getExtension(),target_id:t.getTargetID(),source:t.getSource(),composer_dialog_version:t.getComposerDialogVersion(),waterfall_id:t.getWaterfallID(),composer_session_id:t.getComposerSessionID(),composer_entry_point_ref:t.getComposerEntryPointRef&&t.getComposerEntryPointRef(),composer_work_shared_draft_mode:t.getComposerWorkSharedDraftMode(),has_file_been_replaced:t.getHasFileBeenReplaced(),supports_chunking:t.getSupportsChunking(),supports_file_api:t.getSupportsFileAPI(),partition_start_offset:t.getPartitionStartOffset(),partition_end_offset:t.getPartitionEndOffset(),creator_product:t.getCreatorProduct(),original_file_hash:n,spherical:t.getIsSphericalVideo(),spherical_metadata:t.getSphericalMetadata(),video_publisher_action_source:t.getVideoPublisherActionSource()};return t.getCreativeTools()!=null&&(e.creative_tools=t.getCreativeTools()),e},o.cancelRequest=function(){this.$VideoUploadStartRequestManager23(),this.inform("request-canceled")},o.$VideoUploadStartRequestManager24=function(t){r("clearTimeout")(this.$VideoUploadStartRequestManager19),this.$VideoUploadStartRequestManager19=r("setTimeout")(this.$VideoUploadStartRequestManager18.bind(this),t)},o.$VideoUploadStartRequestManager23=function(){this.$VideoUploadStartRequestManager12&&(this.$VideoUploadStartRequestManager12.destroy(),this.$VideoUploadStartRequestManager12=null),this.$VideoUploadStartRequestManager11&&(this.$VideoUploadStartRequestManager11.abort(),this.$VideoUploadStartRequestManager11=null),this.$VideoUploadStartRequestManager10=0,this.$VideoUploadStartRequestManager5=0,this.$VideoUploadStartRequestManager13=null,r("clearTimeout")(this.$VideoUploadStartRequestManager19),this.$VideoUploadStartRequestManager19=null},o.$VideoUploadStartRequestManager25=function(t,n,r){var e=Math.pow(t,n)*1e3;return r>0&&(e=Math.min(e,r)),e},o.$VideoUploadStartRequestManager20=function(t){var e;(e=this.$VideoUploadStartRequestManager13)==null||(e=e.getRetryState())==null||e.resetDelay();var n=t.getPayload();this.inform("request-finished",this.__getSuccessInformData(n)),this.$VideoUploadStartRequestManager11=null,r("Assert").isTrue(this.$VideoUploadStartRequestManager12==null,"Unexpected: if file hasher is not null, clean up is required.")},o.__getSuccessInformData=function(t){return{video_id:t.video_id,xpv_asset_id:t.xpv_asset_id,is_xpv_single_prod:t.is_xpv_single_prod,upload_session_id:t.upload_session_id,fb_region:t.region_hint,start_offset:t.start_offset,end_offset:t.end_offset,transport_retries:this.$VideoUploadStartRequestManager5,server_retries:this.$VideoUploadStartRequestManager10,skip_upload:t.skip_upload,hash_time:this.$VideoUploadStartRequestManager14}},o.$VideoUploadStartRequestManager26=function(t){this.inform("request-failed",this.$VideoUploadStartRequestManager27(t)),this.$VideoUploadStartRequestManager11=null,r("Assert").isTrue(this.$VideoUploadStartRequestManager12==null,"Unexpected: if file hasher is not null, clean up is required.")},o.$VideoUploadStartRequestManager21=function(t){var e,n=this;this.$VideoUploadStartRequestManager11=null;var r=(e=this.$VideoUploadStartRequestManager13)==null?void 0:e.getRetryState();r==null?(this.$VideoUploadStartRequestManager5=0,t.isTransient()&&this.$VideoUploadStartRequestManager10<this.$VideoUploadStartRequestManager8?(this.$VideoUploadStartRequestManager10++,this.$VideoUploadStartRequestManager24(this.$VideoUploadStartRequestManager25(this.$VideoUploadStartRequestManager9,this.$VideoUploadStartRequestManager10))):this.$VideoUploadStartRequestManager26(t)):r.handleRetry({context:{location:"start-server_issue",error_code:t.getError()},predicate:function(){return t.isTransient()},retryHandler:function(t){n.$VideoUploadStartRequestManager10=r.getTotalRetryCount(),n.$VideoUploadStartRequestManager24(t)},failureHandler:function(){return n.$VideoUploadStartRequestManager26(t)}})},o.$VideoUploadStartRequestManager22=function(t){var e,n=this;((e=this.$VideoUploadStartRequestManager13)==null?void 0:e.getRetryState())==null?this.$VideoUploadStartRequestManager2===0||this.$VideoUploadStartRequestManager5>=this.$VideoUploadStartRequestManager2?this.$VideoUploadStartRequestManager26(t):(this.$VideoUploadStartRequestManager5++,this.$VideoUploadStartRequestManager11=null,this.$VideoUploadStartRequestManager24(this.$VideoUploadStartRequestManager25(this.$VideoUploadStartRequestManager3,this.$VideoUploadStartRequestManager5,this.$VideoUploadStartRequestManager4))):this.$VideoUploadStartRequestManager13.getRetryState().handleRetry({context:{location:"start-transport_issue",error_code:t.getError()},retryHandler:function(t){n.$VideoUploadStartRequestManager11=null,n.$VideoUploadStartRequestManager24(t)},failureHandler:function(){return n.$VideoUploadStartRequestManager26(t)}})},o.$VideoUploadStartRequestManager27=function(t){var e,n,o=[].concat(t==null||(e=t.getPayload())==null||(e=e.error)==null?void 0:e.opes_mids,[t==null?void 0:t.errorMid]).filter(Boolean);return{error_code:t.getError(),error_description:t.getErrorDescription(),error_summary:t.getErrorSummary(),transport_retries:this.$VideoUploadStartRequestManager5,server_retries:this.$VideoUploadStartRequestManager10,error_is_transient:t.isTransient(),www_request_id:(n=t.getPayload())==null?void 0:n.__www_request_id__,opes_mids:(s||(s=r("isEmpty")))(o)?null:o}},n})(r("mixin")(n("cr:909282"))),c=u;l.default=c}),98);
__d("VideoUploadSession",["AsyncRequest","GraphQLVideoPublishUtils","SubscriptionsHandler","VideoUploadCrashMonitor","VideoUploadFeatureDetector","VideoUploadFileValidator","VideoUploadGraphQLPostRequestManager","VideoUploadLogger","VideoUploadMetadataParser","VideoUploadPostRequestManager","VideoUploadReceiveRequestManager","VideoUploadRequestContext","VideoUploadStartRequestManager","WaterfallIDGenerator","cr:909282","err","getByPath","mixin"],(function(t,n,r,o,a,i){var e={CANCELED:"canceled",ABANDONED:"abandoned",SHUTDOWN:"shutdown"},l=(function(t){"use strict";function r(e){var r;if(r=t.call(this)||this,r.$VideoUploadSession2=e.source,r.$VideoUploadSession3=e.composer_dialog_version,r.$VideoUploadSession4=e.target_id,r.$VideoUploadSession5=e.logging_delay,r.$VideoUploadSession6=e.silent_file_validation,r.$VideoUploadSession7=e.background_upload,r.$VideoUploadSession8=e.actor_id,r.$VideoUploadSession9=e.composer_entry_point_ref,r.$VideoUploadSession10=e.composer_work_shared_draft_mode,r.$VideoUploadSession11=e.video_publisher_action_source,r.$VideoUploadSession12=e.monitor_crashes,r.$VideoUploadSession13=e.isMultiMediaPost,r.$VideoUploadSession14=e.container_type,r.$VideoUploadSession15=e.number_of_partitions,r.$VideoUploadSession16=e.multi_partitioning_enabled,r.$VideoUploadSession17=e.change_default_chunk_size,r.$VideoUploadSession18=e.has_file_been_replaced?e.has_file_been_replaced:!1,r.$VideoUploadSession17&&(r.$VideoUploadSession19=e.client_chunk_size),r.$VideoUploadSession20=e.early_receive,r.$VideoUploadSession21=!1,r.$VideoUploadSession22=e.accept_dimensions_from_player,r.$VideoUploadSession23=e.ad_account_id,r.$VideoUploadSession24=e.waterfall_id,r.$VideoUploadSession25=null,r.$VideoUploadSession26=new(n("VideoUploadFileValidator"))({minSize:e.min_size,maxSize:e.max_size,minLength:e.min_length,maxLength:e.max_length,minWidth:e.min_width,minHeight:e.min_height,extensions:e.extensions,source:e.source,require16to9AspectRatio:e.require_16to9_aspect_ratio,minAspectRatio:e.min_aspect_ratio,maxAspectRatio:e.max_aspect_ratio,acceptDimensionsFromPlayer:e.accept_dimensions_from_player}),r.$VideoUploadSession27=n("VideoUploadFeatureDetector").supportsChunking(),r.$VideoUploadSession28=n("VideoUploadFeatureDetector").supportsFileAPI(),r.$VideoUploadSession27?(r.$VideoUploadSession29=e.parallel_chunk_uploads,r.$VideoUploadSession29&&(r.$VideoUploadSession30=e.parallel_chunk_upload_filesize,r.$VideoUploadSession31=e.default_chunk_size)):r.$VideoUploadSession29=!1,r.$VideoUploadSession32=e.shutdown_logging_enabled,r.$VideoUploadSession33=r.$VideoUploadSession$p_34(e),r.$VideoUploadSession35=r.$VideoUploadSession$p_36(e),r.$VideoUploadSession29)if(r.$VideoUploadSession16){var o=0;for(r.$VideoUploadSession37=[],o=0;o<r.$VideoUploadSession15-1;o++)r.$VideoUploadSession37[o]=r.$VideoUploadSession$p_36(e)}else r.$VideoUploadSession37=r.$VideoUploadSession$p_36(e);return r.$VideoUploadSession38=r.$VideoUploadSession$p_39(e),r.$VideoUploadSession40=r.$VideoUploadSession$p_41(e),r.$VideoUploadSession42=e.log_free_local_storage,r.$VideoUploadSession43=null,r}babelHelpers.inheritsLoose(r,t);var o=r.prototype;return o.$VideoUploadSession$p_44=function(){this.$VideoUploadSession45=[],this.$VideoUploadSession46=[],this.$VideoUploadSession47=[],this.$VideoUploadSession48=[],this.$VideoUploadSession49=[];var e=0;for(e=0;e<this.$VideoUploadSession1-1;e++)this.$VideoUploadSession45.push(!1)},o.$VideoUploadSession$p_50=function(){var e;this.$VideoUploadSession24==null&&(this.$VideoUploadSession24=n("WaterfallIDGenerator").generate()),this.$VideoUploadSession51=new(n("VideoUploadLogger"))({actor_id:this.$VideoUploadSession8,ad_account_id:this.$VideoUploadSession23,source:this.$VideoUploadSession2,composer_dialog_version:this.$VideoUploadSession3,waterfall_id:this.$VideoUploadSession24,target_id:this.$VideoUploadSession4,delay:this.$VideoUploadSession5,is_chunked_upload:this.$VideoUploadSession27,composer_entry_point_ref:this.$VideoUploadSession9,composer_work_shared_draft_mode:this.$VideoUploadSession10,container_type:this.$VideoUploadSession14,has_file_been_replaced:this.$VideoUploadSession18,composer_session_id:this.$VideoUploadSession52,asset_id:(e=this.$VideoUploadSession53)==null?void 0:e.getStableAssetID(),creative_tools:this.$VideoUploadSession54}),this.inform("set-waterfall-id",{waterfallID:this.$VideoUploadSession24})},o.createTestLogger=function(){this.$VideoUploadSession$p_50()},o.$VideoUploadSession$p_55=function(){return this.$VideoUploadSession51||this.$VideoUploadSession$p_50(),this.$VideoUploadSession51},o.getLogger=function(){return this.$VideoUploadSession51?this.$VideoUploadSession51:null},o.$VideoUploadSession$p_56=function(){return null},o.start=function(t){var e=this;this.$VideoUploadSession57=null,this.$VideoUploadSession58=null,this.$VideoUploadSession59=null,this.$VideoUploadSession60=!1,this.$VideoUploadSession61=!1,this.$VideoUploadSession62=null,this.$VideoUploadSession53=t,this.$VideoUploadSession63=0,this.$VideoUploadSession64=!1,this.$VideoUploadSession65={sphericalMetadataXml:null,fbSpatialAudioMetadataXml:null,ytSa3dMetadataJson:null},this.$VideoUploadSession66=!1,this.$VideoUploadSession43=this.$VideoUploadSession$p_56(),this.$VideoUploadSession$p_50(),this.$VideoUploadSession16&&(this.$VideoUploadSession1=Math.min(this.$VideoUploadSession15,Math.ceil(this.$VideoUploadSession53.getSize()/this.$VideoUploadSession30))),this.__logEvent(n("VideoUploadLogger").EVENT_REQUESTED_UPLOADING),this.inform("upload-requested");var r=new(n("VideoUploadMetadataParser"))(this.$VideoUploadSession53,this.$VideoUploadSession$p_67.bind(this),this.$VideoUploadSession22);r.parse(),this.$VideoUploadSession42&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t,r){e.__logEvent(n("VideoUploadLogger").EVENT_MEASURE_FREE_LOCAL_STORAGE,{free_space_in_device:r})})},o.setTargetID=function(t){this.$VideoUploadSession4=t},o.setComposerSessionID=function(t){this.$VideoUploadSession52=t},o.setCreativeTools=function(t){this.$VideoUploadSession54=t},o.post=function(t){this.__logEvent(n("VideoUploadLogger").EVENT_STARTED_POST_REQUEST,this.$VideoUploadSession25),this.inform("post-started",t);var e=this.__createPostRequestContext(t);if(n("GraphQLVideoPublishUtils").isGraphQLPublish(this.$VideoUploadSession2,this.$VideoUploadSession9)&&this.$VideoUploadSession40.hasAPISupport(t)){this.$VideoUploadSession40.sendRequest(e),this.$VideoUploadSession68=t;return}this.$VideoUploadSession38.sendRequest(e),this.$VideoUploadSession68=t},o.__createPostRequestContext=function(t){var e=new(n("VideoUploadRequestContext"));return this.__setupPostRequestContext(e,t),e},o.__setupPostRequestContext=function(t,n){t.setMetadata(n).setVideoID(this.$VideoUploadSession57).setTargetID(this.$VideoUploadSession4).setSource(this.$VideoUploadSession2).setComposerDialogVersion(this.$VideoUploadSession3).setComposerWorkSharedDraftMode(this.$VideoUploadSession10).setWaterfallID(this.$VideoUploadSession24).setComposerSessionID(this.$VideoUploadSession52).setSupportsChunking(this.$VideoUploadSession27).setCreatorProduct(this.$VideoUploadSession53.getCreatorProduct()).setFile(this.$VideoUploadSession53).setHasFileBeenReplaced(this.$VideoUploadSession18),n&&(n.spherical&&(this.$VideoUploadSession64=!0,t.setIsSphericalVideo(this.$VideoUploadSession64)),n.enable_omnistab&&(this.$VideoUploadSession66=!0,t.setEnableOmnistab(this.$VideoUploadSession66))),t.setComposerEntryPointRef&&t.setComposerEntryPointRef(this.$VideoUploadSession9)},o.$VideoUploadSession$p_69=function(o,a){if(this.$VideoUploadSession60){var t={event_reason:a,debug:babelHelpers.extends({},this.__fetchReceiveRequestManagerStateLogData(),{is_background_upload:this.$VideoUploadSession7})},i=a===e.CANCELED?n("VideoUploadLogger").EVENT_CANCELED_UPLOADING:n("VideoUploadLogger").EVENT_ABANDONED_UPLOADING;this.$VideoUploadSession$p_70(),this.$VideoUploadSession7?(this.$VideoUploadSession61||this.__logEvent(i),this.$VideoUploadSession71&&(this.__logEvent(n("VideoUploadLogger").EVENT_CANCELED_FLOW,t),this.$VideoUploadSession71=!1)):(this.__logEvent(i),this.__logEvent(n("VideoUploadLogger").EVENT_CANCELED_FLOW,t)),this.inform("upload-canceled")}else o&&this.$VideoUploadSession57&&r.deleteVideo(this.$VideoUploadSession57)},o.cancel=function(n){n===void 0&&(n=!1),this.$VideoUploadSession$p_69(n,e.CANCELED)},o.abandon=function(n){n===void 0&&(n=!1),this.$VideoUploadSession$p_69(n,e.ABANDONED)},o.isPostInProgress=function(){return this.$VideoUploadSession38.isInProgress()},o.isInProgress=function(){return this.$VideoUploadSession60},o.getHasUploadFinished=function(){return this.$VideoUploadSession61},o.getVideoID=function(){return this.$VideoUploadSession57},o.getUploadTime=function(){return this.$VideoUploadSession72},o.getExPartitionNumber=function(t){var e=0;for(e=0;e<this.$VideoUploadSession1-1&&!(t>=this.$VideoUploadSession46[e]&&t<this.$VideoUploadSession47[e]);e++);return e===this.$VideoUploadSession1?-1:e},o.getIsSphericalVideo=function(){return this.$VideoUploadSession64||!1},o.getVideoMetadata=function(){return this.$VideoUploadSession25||null},o.startFlow=function(){!this.$VideoUploadSession7||this.$VideoUploadSession71||(this.__logEvent(n("VideoUploadLogger").EVENT_STARTED_FLOW,{is_spherical:this.getIsSphericalVideo()?"true":null}),this.$VideoUploadSession71=!0,this.$VideoUploadSession73&&this.$VideoUploadSession73.flowStarted())},o.__extractVideoMetadata=function(t){var e,r=(e=n("getByPath"))(t,["streams","primaryVideo"]),o={source_height:e(r,["height"]),source_width:e(r,["width"]),duration:e(r,["duration"])*1e3};return o.original_video_duration=o.duration,o},o.$VideoUploadSession$p_67=function(t){var e,r;if(this.$VideoUploadSession6){var o=this.$VideoUploadSession26.getValidationErrorMessage(this.$VideoUploadSession53,t);if(o){var a=n("err")(o.summary);a.is_js_error=!0,r={error_summary:o.summary,error_description:o.description,error:a},e=!1}else e=!0}else e=this.$VideoUploadSession26.validate(this.$VideoUploadSession53,t);if(!e){this.__logEvent(n("VideoUploadLogger").EVENT_INVALIDATED_UPLOADING),this.inform("upload-failed",r);return}if(this.$VideoUploadSession25=this.__extractVideoMetadata(t),t&&t.format&&(this.$VideoUploadSession64=t.format.isSpherical,t.metadata&&(this.$VideoUploadSession65.sphericalMetadataXml=t.metadata.sphericalMetadataXml,this.$VideoUploadSession65.fbSpatialAudioMetadataXml=t.metadata.fbSpatialAudioMetadataXml,this.$VideoUploadSession65.ytSa3dMetadataJson=t.metadata.ytSa3dMetadataJson)),this.$VideoUploadSession7||this.__logEvent(n("VideoUploadLogger").EVENT_STARTED_FLOW,{is_spherical:this.getIsSphericalVideo()?"true":null}),this.$VideoUploadSession74=this.$VideoUploadSession29&&this.$VideoUploadSession53.getSize()>=this.$VideoUploadSession30,this.$VideoUploadSession75=!1,this.$VideoUploadSession76=0,this.$VideoUploadSession77=this.$VideoUploadSession76,this.$VideoUploadSession78=0,this.$VideoUploadSession16?this.$VideoUploadSession$p_44():this.$VideoUploadSession45=!1,this.$VideoUploadSession74)if(this.$VideoUploadSession16){var i=0;this.$VideoUploadSession79=Math.ceil(this.$VideoUploadSession53.getSize()/this.$VideoUploadSession1);var l=this.$VideoUploadSession79,s=this.$VideoUploadSession79;for(i=0;i<this.$VideoUploadSession1-1;i++)this.$VideoUploadSession46[i]=l,l=Math.min(this.$VideoUploadSession46[i]+s,this.$VideoUploadSession53.getSize()),this.$VideoUploadSession47[i]=l,this.$VideoUploadSession48[i]=this.$VideoUploadSession46[i],this.$VideoUploadSession49[i]=0}else this.$VideoUploadSession79=Math.floor(this.$VideoUploadSession53.getSize()/2),this.$VideoUploadSession46=this.$VideoUploadSession79,this.$VideoUploadSession48=this.$VideoUploadSession46,this.$VideoUploadSession49=0,this.$VideoUploadSession47=this.$VideoUploadSession53.getSize();else this.$VideoUploadSession79=this.$VideoUploadSession53.getSize();var u=new(n("VideoUploadRequestContext"))().setFile(this.$VideoUploadSession53).setTargetID(this.$VideoUploadSession4).setSource(this.$VideoUploadSession2).setComposerDialogVersion(this.$VideoUploadSession3).setComposerWorkSharedDraftMode(this.$VideoUploadSession10).setWaterfallID(this.$VideoUploadSession24).setComposerSessionID(this.$VideoUploadSession52).setHasFileBeenReplaced(this.$VideoUploadSession18).setSupportsChunking(this.$VideoUploadSession27).setSupportsFileAPI(this.$VideoUploadSession28).setCreatorProduct(this.$VideoUploadSession53.getCreatorProduct()).setPartitionStartOffset(this.$VideoUploadSession76).setPartitionEndOffset(this.$VideoUploadSession79).setRetryState(this.$VideoUploadSession43).setCreativeTools(this.$VideoUploadSession54);this.$VideoUploadSession29&&u.setUseParallelChunks(this.$VideoUploadSession29),this.$VideoUploadSession64&&(u.setIsSphericalVideo(this.$VideoUploadSession64),u.setSphericalMetadata(this.$VideoUploadSession65)),u.setComposerEntryPointRef&&u.setComposerEntryPointRef(this.$VideoUploadSession9),u.setVideoPublisherActionSource(this.$VideoUploadSession11),this.$VideoUploadSession$p_80(),this.$VideoUploadSession33.sendRequest(u),this.$VideoUploadSession20&&this.$VideoUploadSession17&&this.$VideoUploadSession35.isResumabilityEnabled()&&!this.$VideoUploadSession35.isResumableServiceProxyReceiveEnabled()&&this.$VideoUploadSession$p_81(),this.inform("metadata-parsed",t)},o.$VideoUploadSession$p_34=function(t){var e=this.$VideoUploadSession27?t.chunk_start_uri:t.start_uri,n=this.__getVideoUploadStartRequestManager(e,t.start_max_transport_retries,t.start_transport_retry_interval_base,t.start_max_transport_retry_timeout,t.skip_upload_enabled,t.skip_upload_file_size_limit,t.start_max_server_retries,t.start_server_retry_interval_base);return n.subscribe("request-started",this.$VideoUploadSession$p_82.bind(this)),n.subscribe("request-finished",this.$VideoUploadSession$p_83.bind(this)),n.subscribe("request-failed",this.$VideoUploadSession$p_84.bind(this)),n.subscribe("request-canceled",this.$VideoUploadSession$p_85.bind(this)),n},o.$VideoUploadSession$p_36=function(t){var e=this.$VideoUploadSession27?t.chunk_receive_uri:t.receive_uri,n=this.__getVideoUploadReceiveRequestManager(e,t);return n.subscribe("request-started",this.$VideoUploadSession$p_86.bind(this)),n.subscribe("request-progressed",this.$VideoUploadSession$p_87.bind(this)),n.subscribe("request-finished",this.$VideoUploadSession$p_88.bind(this)),n.subscribe("request-failed",this.$VideoUploadSession$p_89.bind(this)),n.subscribe("request-canceled",this.$VideoUploadSession$p_90.bind(this)),n.subscribe("request-timeout",this.$VideoUploadSession$p_91.bind(this)),n.subscribe("online",this.$VideoUploadSession$p_92.bind(this)),n.subscribe("offline",this.$VideoUploadSession$p_93.bind(this)),n.subscribe("resumable-called",this.$VideoUploadSession$p_94.bind(this)),n.subscribe("resumable-started",this.$VideoUploadSession$p_95.bind(this)),n.subscribe("resumable-success",this.$VideoUploadSession$p_96.bind(this)),n.subscribe("resumable-failed",this.$VideoUploadSession$p_97.bind(this)),n},o.$VideoUploadSession$p_39=function(t){var e=this.$VideoUploadSession27?t.chunk_post_uri:t.post_uri,n=this.__getVideoUploadPostRequestManager(e,t);return n.subscribe("request-finished",this.__handlePostRequestFinished.bind(this)),n.subscribe("request-failed",this.$VideoUploadSession$p_98.bind(this)),n},o.$VideoUploadSession$p_41=function(t){var e=new(n("VideoUploadGraphQLPostRequestManager"))(isNaN(t.post_max_transport_retries)?0:t.post_max_transport_retries,isNaN(t.post_transport_retry_interval_base)?0:t.post_transport_retry_interval_base,isNaN(t.post_max_server_retries)?0:t.post_max_server_retries,isNaN(t.post_server_retry_interval_base)?0:t.post_server_retry_interval_base);return e.subscribe("request-finished",this.__handlePostRequestFinished.bind(this)),e.subscribe("request-failed",this.$VideoUploadSession$p_98.bind(this)),e},o.$VideoUploadSession$p_82=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_STARTED_UPLOADING,babelHelpers.extends({hash_time:r.hash_time,hash_exception:r.hash_exception},this.$VideoUploadSession25)),this.__logEvent(n("VideoUploadLogger").EVENT_STARTED_START_REQUEST,this.$VideoUploadSession25),this.$VideoUploadSession99=Date.now(),this.inform("upload-started")},o.$VideoUploadSession$p_81=function(t){if(this.$VideoUploadSession21)this.$VideoUploadSession$p_100();else{this.$VideoUploadSession21=!0,t||(t={video_id:null});var e=this.__createReceiveRequestContext(t,!1);if(this.$VideoUploadSession35.sendRequest(e),this.$VideoUploadSession74)if(this.$VideoUploadSession16){var n=0;for(n=0;n<this.$VideoUploadSession1-1;n++)e=this.__createReceiveRequestContext(t,!0,n),this.$VideoUploadSession37[n].sendRequest(e)}else e=this.__createReceiveRequestContext(t,!0),this.$VideoUploadSession37.sendRequest(e)}},o.$VideoUploadSession$p_100=function(){if(this.$VideoUploadSession35.updateVideoID(this.$VideoUploadSession57),this.$VideoUploadSession74)if(this.$VideoUploadSession16){var e=0;for(e=0;e<this.$VideoUploadSession1-1;e++)this.$VideoUploadSession37[e].updateVideoID(this.$VideoUploadSession57)}else this.$VideoUploadSession37.updateVideoID(this.$VideoUploadSession57)},o.$VideoUploadSession$p_101=function(t){return this.$VideoUploadSession43==null?((t==null?void 0:t.transport_retries)||0)+((t==null?void 0:t.server_retries)||0)+((t==null?void 0:t.timeout_retries)||0):this.$VideoUploadSession43.getTotalRetryCount()},o.$VideoUploadSession$p_83=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_PROGRESS_UPLOADING_START_REQUEST,{retries:this.$VideoUploadSession$p_101(r),transport_retries:r.transport_retries,hash_time:r.hash_time,skip_upload:r.skip_upload?1:null}),this.__logEvent(n("VideoUploadLogger").EVENT_FINISHED_START_REQUEST,babelHelpers.extends({video_id:r.video_id},this.$VideoUploadSession25)),this.$VideoUploadSession57=r.video_id,this.$VideoUploadSession58=r.upload_session_id,this.$VideoUploadSession59=r.fb_region,this.$VideoUploadSession102=r.skip_upload,r.skip_upload?(this.$VideoUploadSession$p_103(),this.inform("upload-progressed",{start_offset:0,end_offset:this.$VideoUploadSession53.getSize(),file_size:this.$VideoUploadSession53.getSize(),sent_bytes:this.$VideoUploadSession53.getSize(),video_id:r.video_id,skip_upload:r.skip_upload}),this.$VideoUploadSession7&&this.__logFinishedUploading(),this.inform("upload-finished",{start_offset:0,end_offset:this.$VideoUploadSession53.getSize(),video_id:r.video_id,is_spherical_video:this.$VideoUploadSession64})):this.$VideoUploadSession$p_81(r)},o.__fetchReceiveRequestManagerStateLogData=function(){var e={};if(this.$VideoUploadSession35!=null&&(this.$VideoUploadSession35.appendStateLogData(e,"requestManager_"),e.request_manager_state=e.requestManager_last_log_state),this.$VideoUploadSession16){var t=0;for(t=0;t<this.$VideoUploadSession1-1;t++)this.$VideoUploadSession37[t]!=null&&this.$VideoUploadSession37[t].appendStateLogData(e,"requestManagerEx_"+t.toString())}else this.$VideoUploadSession37!=null&&this.$VideoUploadSession37.appendStateLogData(e,"requestManagerEx_");return e},o.__createReceiveRequestContext=function(t,r,o){r||(r=!1);var e=new(n("VideoUploadRequestContext"));return this.$VideoUploadSession16?this.__setupReceiveRequestContext(e,t,r,o):this.__setupReceiveRequestContext(e,t,r),e},o.__setupReceiveRequestContext=function(t,n,r,o){var e,a,i,l;r?this.$VideoUploadSession16?(this.$VideoUploadSession17&&(this.$VideoUploadSession31=this.$VideoUploadSession47[o]-this.$VideoUploadSession46[o],this.$VideoUploadSession31=this.$VideoUploadSession19?Math.min(this.$VideoUploadSession19,this.$VideoUploadSession31):this.$VideoUploadSession31),e=this.$VideoUploadSession46[o],a=this.$VideoUploadSession47[o],i=this.$VideoUploadSession46[o],l=this.$VideoUploadSession46[o]+this.$VideoUploadSession31>=this.$VideoUploadSession47[o]?this.$VideoUploadSession47[o]:this.$VideoUploadSession46[o]+this.$VideoUploadSession31):(this.$VideoUploadSession17&&(this.$VideoUploadSession31=this.$VideoUploadSession47-this.$VideoUploadSession46,this.$VideoUploadSession31=this.$VideoUploadSession19?Math.min(this.$VideoUploadSession19,this.$VideoUploadSession31):this.$VideoUploadSession31),e=this.$VideoUploadSession46,a=this.$VideoUploadSession47,i=this.$VideoUploadSession46,l=this.$VideoUploadSession46+this.$VideoUploadSession31>=this.$VideoUploadSession47?this.$VideoUploadSession47:this.$VideoUploadSession46+this.$VideoUploadSession31):(e=this.$VideoUploadSession76,a=this.$VideoUploadSession79,this.$VideoUploadSession17?(i=this.$VideoUploadSession76,l=this.$VideoUploadSession19?Math.min(this.$VideoUploadSession19,this.$VideoUploadSession79):this.$VideoUploadSession79):(i=n.start_offset,l=n.end_offset)),t.setFile(this.$VideoUploadSession53).setVideoID(n.video_id).setXPVAssetID(n.xpv_asset_id).setIsXPVSingleProd(n.is_xpv_single_prod).setUploadSessionID(n.upload_session_id).setFbRegion(n.fb_region).setStartOffset(i).setEndOffset(l).setPartitionStartOffset(e).setPartitionEndOffset(a).setPartitionNo(o).setTargetID(this.$VideoUploadSession4).setSource(this.$VideoUploadSession2).setComposerDialogVersion(this.$VideoUploadSession3).setComposerWorkSharedDraftMode(this.$VideoUploadSession10).setWaterfallID(this.$VideoUploadSession24).setComposerSessionID(this.$VideoUploadSession52).setSupportsChunking(this.$VideoUploadSession27).setHasFileBeenReplaced(this.$VideoUploadSession18).setRetryState(this.$VideoUploadSession43),this.$VideoUploadSession29&&t.setUseParallelChunks(this.$VideoUploadSession29),t.setComposerEntryPointRef&&t.setComposerEntryPointRef(this.$VideoUploadSession9),this.$VideoUploadSession19&&t.setClientChunkSize(this.$VideoUploadSession19)},o.$VideoUploadSession$p_84=function(t,r){var e=this.__getLogErrorData(r);this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_START_REQUEST,e),this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_UPLOADING,e);var o=r.error_is_transient?n("VideoUploadLogger").EVENT_RESIGNED_FLOW:n("VideoUploadLogger").EVENT_FAILED_FLOW;this.$VideoUploadSession7?this.$VideoUploadSession71&&(this.__logEvent(o),this.$VideoUploadSession71=!1):this.__logEvent(o),this.$VideoUploadSession$p_103(),this.$VideoUploadSession$p_104(),this.inform("upload-failed",r)},o.$VideoUploadSession$p_85=function(t){this.__logEvent(n("VideoUploadLogger").EVENT_CANCELED_START_REQUEST)},o.$VideoUploadSession$p_86=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_STARTED_RECEIVE_REQUEST,{debug:r.debug}),!r.start_offset&&!r.transport_retries&&!r.server_retries&&this.__logEvent(n("VideoUploadLogger").EVENT_STARTED_SENDING_BYTES,{total_bytes:this.$VideoUploadSession53.getSize(),upload_domain:r.upload_domain,debug:r.debug}),this.$VideoUploadSession27&&this.__logEvent(n("VideoUploadLogger").EVENT_STARTED_SENDING_CHUNK_BYTES,{start_offset:r.start_offset,total_bytes:r.end_offset-r.start_offset,retries:this.$VideoUploadSession$p_101(r),transport_retries:r.transport_retries,server_retries:r.server_retries,upload_speed:r.upload_speed,request_manager_state:r.request_manager_state,upload_domain:r.upload_domain,debug:r.debug})},o.$VideoUploadSession$p_87=function(t,n){if(n.start_offset<this.$VideoUploadSession79)this.$VideoUploadSession77=n.start_offset,this.$VideoUploadSession78=n.sent_bytes;else if(this.$VideoUploadSession16){var e=0;e=this.getExPartitionNumber(n.start_offset),e>-1&&(this.$VideoUploadSession48[e]=n.start_offset,this.$VideoUploadSession49[e]=n.sent_bytes)}else this.$VideoUploadSession48=n.start_offset,this.$VideoUploadSession49=n.sent_bytes;if(n.start_offset=this.$VideoUploadSession77,n.sent_bytes=this.$VideoUploadSession78,this.$VideoUploadSession74)if(this.$VideoUploadSession16)for(e=0;e<this.$VideoUploadSession1-1;e++)n.start_offset+=this.$VideoUploadSession48[e]-this.$VideoUploadSession46[e],n.sent_bytes+=this.$VideoUploadSession49[e];else n.start_offset+=this.$VideoUploadSession48-this.$VideoUploadSession46,n.sent_bytes+=this.$VideoUploadSession49;var r=Math.min(n.start_offset+n.sent_bytes,n.file_size);r>this.$VideoUploadSession63&&(this.$VideoUploadSession63=r,this.inform("upload-progressed",n))},o.$VideoUploadSession$p_88=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_FINISHED_RECEIVE_REQUEST,{debug:r.debug}),this.$VideoUploadSession27&&this.__logEvent(n("VideoUploadLogger").EVENT_FINISHED_SENDING_CHUNK_BYTES,{start_offset:r.start_offset,sent_bytes:r.end_offset-r.start_offset,retries:this.$VideoUploadSession$p_101(r),transport_retries:r.transport_retries,server_retries:r.server_retries,upload_speed:r.upload_speed,request_manager_state:r.request_manager_state,upload_domain:r.upload_domain,debug:r.debug});var e=!1;if(r.start_offset<this.$VideoUploadSession79)this.$VideoUploadSession75=r.end_offset>=this.$VideoUploadSession79;else if(this.$VideoUploadSession16){var o=0;if(o=this.getExPartitionNumber(r.start_offset),o===-1){var a="Invalid offset",i=n("err")(a);i.is_js_error=!0;var l={error_summary:a,error_description:"Offset doesn't fall in any exPartition range.",error:i};this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_UPLOADING),this.inform("upload-failed",l);return}this.$VideoUploadSession45[o]=r.end_offset>=this.$VideoUploadSession47[o]}else this.$VideoUploadSession45=r.end_offset>=this.$VideoUploadSession47;if(this.$VideoUploadSession16)for(o=0;o<this.$VideoUploadSession1-1;o++)if(this.$VideoUploadSession45[o]===!1){e=!1;break}else e=!0;else e=this.$VideoUploadSession45;(!this.$VideoUploadSession28||this.$VideoUploadSession75&&(!this.$VideoUploadSession74||e))&&(this.__logEvent(n("VideoUploadLogger").EVENT_FINISHED_SENDING_BYTES,{sent_bytes:this.$VideoUploadSession53.getSize(),upload_domain:r.upload_domain,debug:r.debug}),this.$VideoUploadSession72=Date.now()-this.$VideoUploadSession99,this.$VideoUploadSession7&&this.__logFinishedUploading(),r.video_id=this.$VideoUploadSession57,r.is_spherical_video=this.$VideoUploadSession64,this.inform("upload-finished",r),this.$VideoUploadSession13&&(this.$VideoUploadSession7||this.__logFinishedUploading(),this.__logEvent(n("VideoUploadLogger").EVENT_FINISHED_FLOW,r),this.$VideoUploadSession71=!1,this.$VideoUploadSession$p_104(),this.inform("multimedia-upload-finished",r)))},o.$VideoUploadSession$p_89=function(t,r){var e=this.__getLogErrorData(r);if(this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_RECEIVE_REQUEST,e),this.$VideoUploadSession27&&this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_SENDING_CHUNK_BYTES,e),this.$VideoUploadSession60){this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_SENDING_BYTES,e),this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_UPLOADING,e);var o=r.error_is_transient?n("VideoUploadLogger").EVENT_RESIGNED_FLOW:n("VideoUploadLogger").EVENT_FAILED_FLOW;this.$VideoUploadSession7?this.$VideoUploadSession71&&(this.__logEvent(o,e),this.$VideoUploadSession71=!1):this.__logEvent(o,e)}this.$VideoUploadSession$p_104(),this.inform("upload-failed",r)},o.$VideoUploadSession$p_90=function(t){this.$VideoUploadSession27?this.__logEvent(n("VideoUploadLogger").EVENT_CANCELED_SENDING_CHUNK_BYTES):this.__logEvent(n("VideoUploadLogger").EVENT_CANCELED_SENDING_BYTES)},o.$VideoUploadSession$p_91=function(t,r){var e={start_offset:r.start_offset,sent_bytes:r.end_offset-r.start_offset,retries:this.$VideoUploadSession$p_101(r),transport_retries:r.transport_retries,server_retries:r.server_retries,timeout_retries:r.timeout_retries,upload_speed:r.upload_speed,request_manager_state:r.request_manager_state,debug:r.debug};this.__logEvent(n("VideoUploadLogger").EVENT_TIMEOUT_SENDING_CHUNK_BYTES,e)},o.$VideoUploadSession$p_92=function(t,n){this.inform("online",n)},o.$VideoUploadSession$p_93=function(t,n){this.inform("offline",n)},o.$VideoUploadSession$p_94=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_RESUMABLE_CALLED,r)},o.$VideoUploadSession$p_95=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_RESUMABLE_STARTED,r)},o.$VideoUploadSession$p_96=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_RESUMABLE_SUCCESS,r)},o.$VideoUploadSession$p_97=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_RESUMABLE_FAILED,r)},o.__handlePostRequestFinished=function(t,r){this.__logEvent(n("VideoUploadLogger").EVENT_FINISHED_POST_REQUEST,babelHelpers.extends({video_id:this.$VideoUploadSession57},this.$VideoUploadSession25)),r.video_id||(r.video_id=this.$VideoUploadSession57),this.$VideoUploadSession7||this.__logFinishedUploading(),this.__logEvent(n("VideoUploadLogger").EVENT_FINISHED_FLOW),this.$VideoUploadSession71=!1,this.$VideoUploadSession$p_104();var e=babelHelpers.extends({},r,this.$VideoUploadSession68);this.inform("post-finished",e)},o.__logFinishedUploading=function(){this.__logEvent(n("VideoUploadLogger").EVENT_FINISHED_UPLOADING,babelHelpers.extends({elapsed_time:this.$VideoUploadSession72,skip_upload:this.$VideoUploadSession102?1:null,video_id:this.$VideoUploadSession57},this.$VideoUploadSession25)),this.$VideoUploadSession61=!0},o.$VideoUploadSession$p_98=function(t,r){var e=this.__getLogErrorData(r);if(this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_POST_REQUEST,e),this.$VideoUploadSession60){this.__logEvent(n("VideoUploadLogger").EVENT_FAILED_UPLOADING,e);var o=r.error_is_transient?n("VideoUploadLogger").EVENT_RESIGNED_FLOW:n("VideoUploadLogger").EVENT_FAILED_FLOW;this.__logEvent(o,e)}this.$VideoUploadSession$p_104(),this.inform("post-failed",r)},o.$VideoUploadSession$p_103=function(){if(this.$VideoUploadSession35.cancelRequest(),this.$VideoUploadSession74)if(this.$VideoUploadSession16){var e=0;for(e=0;e<this.$VideoUploadSession1-1;e++)this.$VideoUploadSession37[e].cancelRequest()}else this.$VideoUploadSession37.cancelRequest();this.$VideoUploadSession21=!1},o.$VideoUploadSession$p_70=function(){this.$VideoUploadSession33.cancelRequest(),this.$VideoUploadSession$p_103(),this.$VideoUploadSession$p_104(),this.$VideoUploadSession57&&(r.deleteVideo(this.$VideoUploadSession57),this.$VideoUploadSession57=null,this.$VideoUploadSession58=null,this.$VideoUploadSession59=null)},o.$VideoUploadSession$p_80=function(){var t=this;this.$VideoUploadSession60=!0,this.$VideoUploadSession32&&(this.$VideoUploadSession62=new(n("SubscriptionsHandler")),this.$VideoUploadSession62.addSubscriptions(this.$VideoUploadSession$p_55().postOnShutdown(function(){if(t.$VideoUploadSession60){var r={event_reason:e.SHUTDOWN,debug:babelHelpers.extends({},t.__fetchReceiveRequestManagerStateLogData(),{is_background_upload:t.$VideoUploadSession7})};t.$VideoUploadSession7?t.$VideoUploadSession71&&t.__logEvent(n("VideoUploadLogger").EVENT_CANCELED_FLOW,r):t.__logEvent(n("VideoUploadLogger").EVENT_CANCELED_FLOW,r),t.inform("upload-canceled")}}))),this.$VideoUploadSession12&&(this.$VideoUploadSession73=new(n("VideoUploadCrashMonitor"))(this.$VideoUploadSession24,this.$VideoUploadSession8,this.$VideoUploadSession2,this.$VideoUploadSession4,this.$VideoUploadSession5,this.$VideoUploadSession27,this.$VideoUploadSession9,!this.$VideoUploadSession7||this.$VideoUploadSession71),this.$VideoUploadSession73.startSession())},o.$VideoUploadSession$p_104=function(){this.$VideoUploadSession60=!1,this.$VideoUploadSession62&&(this.$VideoUploadSession62.release(),this.$VideoUploadSession62=null),this.$VideoUploadSession73&&(this.$VideoUploadSession73.endSession(),this.$VideoUploadSession73=null)},o.__getLogErrorData=function(t){return{error:t.error_summary,error_code:t.error_code,error_description:t.error_description,retries:this.$VideoUploadSession$p_101(t),transport_retries:t.transport_retries,server_retries:t.server_retries,request_manager_state:t.request_manager_state,debug:t.debug}},o.__logEvent=function(t,n){n=n||{},this.$VideoUploadSession53&&(n.file_size=this.$VideoUploadSession53.getSize(),n.file_extension=this.$VideoUploadSession53.getExtension(),n.sent_bytes=this.$VideoUploadSession63),this.$VideoUploadSession$p_55().logEvent(t,n)},o.__getVideoUploadStartRequestManager=function(t,r,o,a,i,l,s,u){return new(n("VideoUploadStartRequestManager"))(t,r,o,a,i,l,s,u)},o.__getVideoUploadReceiveRequestManager=function(t,r){return new(n("VideoUploadReceiveRequestManager"))(t,r.max_transport_retries,r.max_transport_retry_timeout,r.max_server_retries,r.response_timeout_enabled,r.max_response_timeout_retries,r.response_timeout_speed_variation_factor_ppt,r.transport_retry_interval_base,r.server_retry_interval_base,r.receive_errors_force_retry,r.access_token,r.resumability_enabled,r.resumability_async_enabled,r.resumable_service_name,r.resumable_service_domain,r.datr,r.resumability_min_file_size,r.resumable_service_proxy_receive,r.resumable_service_send_media_info,r.resumable_service_send_file_size,r.resumable_reset_transport_retries_on_progress,r.traffic_tracing_enabled,r.traffic_tracing_min_file_size)},o.__getVideoUploadPostRequestManager=function(t,r){return new(n("VideoUploadPostRequestManager"))(t,r.post_max_transport_retries,r.post_transport_retry_interval_base,r.post_max_server_retries,r.post_server_retry_interval_base)},r.deleteVideo=function(t){var e=new(n("AsyncRequest"))("/ajax/video/actions/delete").setData({fbid:t,redirect:!1});e.setErrorHandler(function(){}),e.send()},r})(n("mixin")(n("cr:909282")));a.exports=l}),null);
__d("VideoUploader",["FBLogger","MediaUploadVUShim","VideoUploadCrashMonitor","VideoUploadSession","cr:909282","getErrorSafe","mixin"],(function(t,n,r,o,a,i,l){var e=(function(e){function t(t){var n;return n=e.call(this)||this,n.abandon=function(e){e===void 0&&(e=!1);var t=n.getVideoID();n.$VideoUploader2?n.$VideoUploader2.abandon(e):e&&t&&r("VideoUploadSession").deleteVideo(t),n.reset()},n.$VideoUploader1=t,n.$VideoUploader2=null,n.$VideoUploader3=null,n.$VideoUploader4=t.waterfall_id==null?null:t.waterfall_id,n.$VideoUploader5=n.$VideoUploader1.ad_account_id,t.monitor_crashes&&(n.$VideoUploader6=new(r("VideoUploadCrashMonitor")),n.$VideoUploader6.logKnownCrashes()),n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.setComposerSessionID=function(t){this.$VideoUploader7=t,this.$VideoUploader2&&this.$VideoUploader2.setComposerSessionID(t)},n.getLogger=function(){if(this.$VideoUploader2&&this.$VideoUploader2.getLogger)return this.$VideoUploader2.getLogger()},n.upload=function(t,n){var e=this;if(!this.$VideoUploader2){var r=this.__getVideoUploadSession(this.$VideoUploader1);r.setComposerSessionID(this.$VideoUploader7),(n==null?void 0:n.creativeTools)!=null&&r.setCreativeTools(JSON.stringify(n==null?void 0:n.creativeTools)),r.subscribe(this.__getEventsWhichShouldListenFromSession(),function(t,n){return e.$VideoUploader8(t,n)}),this.$VideoUploader2=r,r.start(t)}},n.__getVideoUploadSession=function(t){try{var e=r("MediaUploadVUShim").createSession(t);return e==null?new(r("VideoUploadSession"))(t):e}catch(e){return r("FBLogger")("media_upload").catching(r("getErrorSafe")(e)).warn("Failed to create shim video upload session"),new(r("VideoUploadSession"))(t)}},n.__getEventsWhichShouldListenFromSession=function(){return["upload-requested","upload-started","upload-progressed","upload-finished","upload-failed","upload-canceled","post-started","post-finished","post-failed","online","offline","metadata-parsed","set-waterfall-id"]},n.postUserRequest=function(){this.$VideoUploader2&&this.$VideoUploader2.startFlow&&this.$VideoUploader2.startFlow()},n.setTargetID=function(t){this.$VideoUploader2!=null&&this.$VideoUploader2.setTargetID(t)},n.setHasFileBeenReplaced=function(t){this.$VideoUploader1.has_file_been_replaced=t},n.post=function(t){this.$VideoUploader2&&this.$VideoUploader2.post(t)},n.getVideoID=function(){return this.$VideoUploader2&&(this.$VideoUploader3=this.$VideoUploader2.getVideoID()),this.$VideoUploader3},n.getVideoMetadataFromSession=function(){if(this.$VideoUploader2)return this.$VideoUploader2.getVideoMetadata()},n.cancel=function(t){t===void 0&&(t=!1);var e=this.getVideoID();this.$VideoUploader2?this.$VideoUploader2.cancel(t):t&&e&&r("VideoUploadSession").deleteVideo(e),this.reset()},n.reset=function(){this.$VideoUploader2&&(this.$VideoUploader3=this.getVideoID()),this.$VideoUploader2=null},n.getUploadSession=function(){return this.$VideoUploader2},n.getLoggerData=function(){return{waterfall_id:this.$VideoUploader2?this.$VideoUploader2.$VideoUploader4:null,actor_id:this.$VideoUploader1.actor_id,target_id:this.$VideoUploader1.target_id,target_type:this.$VideoUploader1.target_type,composer_entry_point_ref:this.$VideoUploader1.composer_entry_point_ref}},n.isPostInProgress=function(){return!!this.$VideoUploader2&&this.$VideoUploader2.isPostInProgress()},n.isSessionInProgress=function(){return!!this.$VideoUploader2&&this.$VideoUploader2.isInProgress()},n.isSessionExist=function(){return!!this.$VideoUploader2},n.getUploadParameters=function(){return this.$VideoUploader1},n.__getSession=function(){return this.$VideoUploader2},n.__getEventsForWhichSessionShouldBeSetToNull=function(){return["upload-failed","post-finished","multimedia-upload-finished"]},n.$VideoUploader8=function(t,n){this.__getEventsForWhichSessionShouldBeSetToNull().includes(t)&&this.reset(),this.__delegateEvent(t,n)},n.__delegateEvent=function(t,n){this.inform(t,n)},t})(r("mixin")(n("cr:909282")));l.default=e}),98);
__d("CometComposerDraftingUtils",["fbt","ComposerMediaFileUploader","FBLogger","LexicalText","MWPActor.react","ReactDOM","err","qex"],(function(t,n,r,o,a,i,l,s){"use strict";var e=["abTestData","attachmentArea","copyrightPreCheckMetadata","editorRef","editorState","featureDefinitionsGating","lexicalEditor","mediaUploadStatuses","onCloseReelsComposer","onCloseUnderlyingDialog","placeholderTextOverride","submitText","videoComposerData"],u=["currentSelectedVideoFrame","generatedThumbnails","thumbnailFile"],c=["onRemove"],d="comet_composer_drafts",m="reel_draft",p="post_draft",_=1,f="draft_content",g=12096e5;function h(){var e;return o("MWPActor.react").isAPPlus()||o("MWPActor.react").isPromode()?!1:(e=r("qex")._("1295"))!=null?e:!1}function y(){var e;return o("MWPActor.react").isAPPlus()||o("MWPActor.react").isPromode()?!1:(e=r("qex")._("1805"))!=null?e:!1}function C(){var e;return(e=r("qex")._("4296"))!=null?e:!0}function b(e){r("FBLogger")("comet_composer").mustfix("Experienced error during post draft retrieval: "+e.toString())}function v(e){r("FBLogger")("comet_composer").mustfix("Experienced error during post draft save: "+e.toString())}function S(e){r("FBLogger")("comet_composer").mustfix("Experienced error during post draft deletion: "+e.toString())}function R(e,t,n){return new Promise(function(r,o){var a=window.indexedDB.open(d,_);a.onupgradeneeded=function(e){var t=e.target.result,n=t.createObjectStore(m,{keyPath:"id"});n.createIndex(f,[f],{unique:!1});var r=t.createObjectStore(p,{keyPath:"id"});r.createIndex(f,[f],{unique:!1})},a.onerror=function(){v(a.error),o(a.error)},a.onsuccess=function(a){var i=a.target.result;try{var l=i.transaction(n,"readwrite"),s=l.objectStore(n);s.put({draftViewState:e,id:t,timestamp:Date.now()}),l.oncomplete=function(){i.close(),r(!0)},l.onerror=function(e){i.close(),o(e)}}catch(e){i.close(),v(e),o(e)}}})}function L(e,t){return new Promise(function(n,r){var o=window.indexedDB.open(d,_);o.onerror=function(e){r(e)},o.onupgradeneeded=function(e){var t=e.target.result,n=t.createObjectStore(m,{keyPath:"id"});n.createIndex(f,[f],{unique:!1});var r=t.createObjectStore(p,{keyPath:"id"});r.createIndex(f,[f],{unique:!1})},o.onsuccess=function(o){var a=o.target.result;try{var i=a.transaction(t,"readonly"),l=i.objectStore(t),s=l.get(e);i.oncomplete=function(){var r;a.close();var o=(r=s.result)==null?void 0:r.timestamp;if(o!=null&&Date.now()-o>g)E(e,t).then(function(){return n(null)}).catch(function(e){S(e)});else{var i,l=(i=s.result)==null?void 0:i.draftViewState;n(l)}},i.onerror=function(e){a.close(),r(e)}}catch(e){a.close(),e instanceof Error&&e.name==="NotFoundError"?(b(e),k().then(function(){return n(null)}).catch(function(e){r(e)})):r(e)}}})}function E(e,t){return new Promise(function(n,r){var o=window.indexedDB.open(d,_);o.onsuccess=function(a){var i=a.target.result;try{var l=i.transaction(t,"readwrite"),s=l.objectStore(t).delete(e);l.oncomplete=function(){i.close(),n(!0)},l.onerror=function(){i.close(),S(o.error),r(s.error)}}catch(e){i.close(),S(e),r(e)}},o.onerror=function(){S(o.error),r(o.error)}})}function k(){return new Promise(function(e,t){var n=window.indexedDB.deleteDatabase(d);n.onsuccess=function(){e(!0)},n.onerror=function(){t(n.error)}})}function I(e,t,n,a){var i=r("ComposerMediaFileUploader").getInstance(t);a==null||a();var l=[];if(e.mediaUploadStatuses)for(var s in e.mediaUploadStatuses)l.push(e.mediaUploadStatuses[s].onFileComplete);else return Promise.resolve();if(l.length>0&&i!=null){var u=function(t){o("ReactDOM").flushSync(function(){return n({draftState:"PREEXISTING",entID:t.entID,imageURL:t.attachmentType==="PHOTO"?t.imageURL:void 0,takenTime:t.attachmentType==="PHOTO"?t.takenTime:void 0,type:"MEDIA_UPLOAD_SUCCESSFUL",uploadID:t.uploadID})})};return i.successObserver.subscribe(u),Promise.all(l).then(function(){return Promise.resolve()}).catch(function(e){var t;return r("FBLogger")("comet_composer").mustfix("Media upload failed during draft save","Error: "+((t=e==null?void 0:e.message)!=null?t:"Unknown error")),Promise.reject(e)}).finally(function(){i.successObserver.unsubscribe(u)})}else return Promise.resolve()}async function T(e){if(e==null)return null;if(e instanceof File||e instanceof Blob)return e;if(typeof e=="object"&&e!=null&&"getData"in e&&typeof e.getData=="function")try{var t=await e.getData();return t}catch(e){return r("FBLogger")("comet_composer").warn("Failed to serialize thumbnail file",e),null}return null}async function D(t,n,a,i,l,d){var m,p,_=(m=t.lexicalEditor)==null?void 0:m.getEditorState(),f=_==null?void 0:_.toJSON(),g=t.abTestData,h=t.attachmentArea,y=t.copyrightPreCheckMetadata,C=t.editorRef,b=t.editorState,v=t.featureDefinitionsGating,S=t.lexicalEditor,L=t.mediaUploadStatuses,E=t.onCloseReelsComposer,k=t.onCloseUnderlyingDialog,I=t.placeholderTextOverride,D=t.submitText,x=t.videoComposerData,$=babelHelpers.objectWithoutPropertiesLoose(t,e),P=S==null||(p=S.getEditorState())==null?void 0:p.read(o("LexicalText").$rootTextContent),N=null;t.mediaAttachments!=null&&(N=await Promise.all(t.mediaAttachments.map(async function(e){if(e.fileType==="VIDEO"){var t=e.videoAttachmentMetadata;if(t!=null){var n=t.currentSelectedVideoFrame,r=t.generatedThumbnails,o=t.thumbnailFile,a=babelHelpers.objectWithoutPropertiesLoose(t,u),i=await T(o);return babelHelpers.extends({},e,{videoAttachmentMetadata:babelHelpers.extends({},a,{thumbnailFile:i})})}}return e})));var M;t.byoaAudioTracks!=null&&(M=t.byoaAudioTracks.map(function(e){var t=e.description.getEditorState(),n=t.toJSON();return{file:e.file,handle:e.handle,key:e.key,langCode:e.langCode,serializedDescription:n}}));var w=h!=null?h:{},A=w.onRemove,F=babelHelpers.objectWithoutPropertiesLoose(w,c),O=babelHelpers.extends({},$,{attachmentArea:F,draftedPostText:P},N!=null&&{mediaAttachments:N},{serializedAudioTracks:M,serializedLexicalEditorState:f});R(O,l,d).then(function(){n!=null&&n(),i==null||i(),a==null||a({ignoreIsSavingFlag:!0})}).catch(function(e){r("FBLogger")("comet_composer").mustfix(e),i==null||i(r("err")(s._(/*BTDS*/"Se ha producido un error. Vuelve a intentarlo m\u00e1s tarde").toString()))})}function x(e){return e.map(function(e){var t=e;e.fileType==="VIDEO"&&e.file!=null&&(t=babelHelpers.extends({},e,{fileObjectURL:URL.createObjectURL(e.file)}));var n=t.videoAttachmentMetadata;if(n!=null){var r=babelHelpers.extends({},n);if(n.thumbnailPreviewURL!=null&&n.thumbnailFile!=null&&n.thumbnailFile instanceof File){var o=URL.createObjectURL(n.thumbnailFile);r.thumbnailPreviewURL=o,r.customURL=o}t=babelHelpers.extends({},t,{videoAttachmentMetadata:r})}return t})}l.canFriendsAndFamilyUsersDraftPostsSilentExposure=h,l.canFriendsAndFamilyUsersDraftPostsWithExposure=y,l.shouldShowDraftsInline=C,l.logDraftRetrievalError=b,l.logDraftSaveError=v,l.logDraftDeleteError=S,l.addDraftToIndexedDB=R,l.getDraftFromIndexedDB=L,l.deleteDraftFromIndexedDB=E,l.clearAllDraftsFromIndexedDB=k,l.processMediaUpload=I,l.createSerializedDraft=D,l.createNewObjectURLsForVideosAndThumbnails=x}),226);
/**
 * License: https://www.facebook.com/legal/license/BDuAztjQnAL/
 */
__d("CryptoJS",[],(function(t,n,r,o,a,i){(function(e,t){typeof i=="object"?a.exports=i=t():typeof define=="function"&&define.amd?define([],t):e.CryptoJS=t()})(this,function(){var e=e||(function(e,t){var n=Object.create||(function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}})(),r={},o=r.lib={},a=o.Base=(function(){return{extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),i=o.WordArray=a.extend({init:function(e,n){e=this.words=e||[],n!=t?this.sigBytes=n:this.sigBytes=4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var a=0;a<o;a++){var i=n[a>>>2]>>>24-a%4*8&255;t[r+a>>>2]|=i<<24-(r+a)%4*8}else for(var a=0;a<o;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],o=function(t){var t=t,n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,t=18e3*(65535&t)+(t>>16)&r;var o=(n<<16)+t&r;return o/=4294967296,o+=.5,o*(e.random()>.5?1:-1)}},a=0;a<t;a+=4){var l=o(4294967296*(n||e.random()));n=987654071*l(),r.push(4294967296*l()|0)}return new i.init(r,t)}}),l=r.enc={},s=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var a=t[o>>>2]>>>24-o%4*8&255;r.push((a>>>4).toString(16)),r.push((15&a).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new i.init(n,t/2)}},u=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var a=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(a))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new i.init(n,t)}},c=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,a=this.blockSize,l=4*a,s=o/l;s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);var u=s*a,c=e.min(4*u,o);if(u){for(var d=0;d<u;d+=a)this._doProcessBlock(r,d);var m=r.splice(0,u);n.sigBytes-=c}return new i.init(m,c)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(o.Hasher=d.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r})(Math);return(function(){function t(e,t,n){for(var r=[],a=0,i=0;i<t;i++)if(i%4){var l=n[e.charCodeAt(i-1)]<<i%4*2,s=n[e.charCodeAt(i)]>>>6-i%4*2;r[a>>>2]|=(l|s)<<24-a%4*8,a++}return o.create(r,a)}var n=e,r=n.lib,o=r.WordArray,a=n.enc;a.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var o=[],a=0;a<n;a+=3)for(var i=t[a>>>2]>>>24-a%4*8&255,l=t[a+1>>>2]>>>24-(a+1)%4*8&255,s=t[a+2>>>2]>>>24-(a+2)%4*8&255,u=i<<16|l<<8|s,c=0;c<4&&a+.75*c<n;c++)o.push(r.charAt(u>>>6*(3-c)&63));var d=r.charAt(64);if(d)for(;o.length%4;)o.push(d);return o.join("")},parse:function(e){var n=e.length,r=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var a=0;a<r.length;a++)o[r.charCodeAt(a)]=a}var i=r.charAt(64);if(i){var l=e.indexOf(i);l!==-1&&(n=l)}return t(e,n,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})(),(function(t){function n(e,t,n,r,o,a,i){var l=e+(t&n|~t&r)+o+i;return(l<<a|l>>>32-a)+t}function r(e,t,n,r,o,a,i){var l=e+(t&r|n&~r)+o+i;return(l<<a|l>>>32-a)+t}function o(e,t,n,r,o,a,i){var l=e+(t^n^r)+o+i;return(l<<a|l>>>32-a)+t}function a(e,t,n,r,o,a,i){var l=e+(n^(t|~r))+o+i;return(l<<a|l>>>32-a)+t}var i=e,l=i.lib,s=l.WordArray,u=l.Hasher,c=i.algo,d=[];(function(){for(var e=0;e<64;e++)d[e]=4294967296*t.abs(t.sin(e+1))|0})();var m=c.MD5=u.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var l=t+i,s=e[l];e[l]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var u=this._hash.words,c=e[t+0],m=e[t+1],p=e[t+2],_=e[t+3],f=e[t+4],g=e[t+5],h=e[t+6],y=e[t+7],C=e[t+8],b=e[t+9],v=e[t+10],S=e[t+11],R=e[t+12],L=e[t+13],E=e[t+14],k=e[t+15],I=u[0],T=u[1],D=u[2],x=u[3];I=n(I,T,D,x,c,7,d[0]),x=n(x,I,T,D,m,12,d[1]),D=n(D,x,I,T,p,17,d[2]),T=n(T,D,x,I,_,22,d[3]),I=n(I,T,D,x,f,7,d[4]),x=n(x,I,T,D,g,12,d[5]),D=n(D,x,I,T,h,17,d[6]),T=n(T,D,x,I,y,22,d[7]),I=n(I,T,D,x,C,7,d[8]),x=n(x,I,T,D,b,12,d[9]),D=n(D,x,I,T,v,17,d[10]),T=n(T,D,x,I,S,22,d[11]),I=n(I,T,D,x,R,7,d[12]),x=n(x,I,T,D,L,12,d[13]),D=n(D,x,I,T,E,17,d[14]),T=n(T,D,x,I,k,22,d[15]),I=r(I,T,D,x,m,5,d[16]),x=r(x,I,T,D,h,9,d[17]),D=r(D,x,I,T,S,14,d[18]),T=r(T,D,x,I,c,20,d[19]),I=r(I,T,D,x,g,5,d[20]),x=r(x,I,T,D,v,9,d[21]),D=r(D,x,I,T,k,14,d[22]),T=r(T,D,x,I,f,20,d[23]),I=r(I,T,D,x,b,5,d[24]),x=r(x,I,T,D,E,9,d[25]),D=r(D,x,I,T,_,14,d[26]),T=r(T,D,x,I,C,20,d[27]),I=r(I,T,D,x,L,5,d[28]),x=r(x,I,T,D,p,9,d[29]),D=r(D,x,I,T,y,14,d[30]),T=r(T,D,x,I,R,20,d[31]),I=o(I,T,D,x,g,4,d[32]),x=o(x,I,T,D,C,11,d[33]),D=o(D,x,I,T,S,16,d[34]),T=o(T,D,x,I,E,23,d[35]),I=o(I,T,D,x,m,4,d[36]),x=o(x,I,T,D,f,11,d[37]),D=o(D,x,I,T,y,16,d[38]),T=o(T,D,x,I,v,23,d[39]),I=o(I,T,D,x,L,4,d[40]),x=o(x,I,T,D,c,11,d[41]),D=o(D,x,I,T,_,16,d[42]),T=o(T,D,x,I,h,23,d[43]),I=o(I,T,D,x,b,4,d[44]),x=o(x,I,T,D,R,11,d[45]),D=o(D,x,I,T,k,16,d[46]),T=o(T,D,x,I,p,23,d[47]),I=a(I,T,D,x,c,6,d[48]),x=a(x,I,T,D,y,10,d[49]),D=a(D,x,I,T,E,15,d[50]),T=a(T,D,x,I,g,21,d[51]),I=a(I,T,D,x,R,6,d[52]),x=a(x,I,T,D,_,10,d[53]),D=a(D,x,I,T,v,15,d[54]),T=a(T,D,x,I,m,21,d[55]),I=a(I,T,D,x,C,6,d[56]),x=a(x,I,T,D,k,10,d[57]),D=a(D,x,I,T,h,15,d[58]),T=a(T,D,x,I,L,21,d[59]),I=a(I,T,D,x,f,6,d[60]),x=a(x,I,T,D,S,10,d[61]),D=a(D,x,I,T,p,15,d[62]),T=a(T,D,x,I,b,21,d[63]),u[0]=u[0]+I|0,u[1]=u[1]+T|0,u[2]=u[2]+D|0,u[3]=u[3]+x|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;n[o>>>5]|=128<<24-o%32;var a=t.floor(r/4294967296),i=r;n[(o+64>>>9<<4)+15]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[(o+64>>>9<<4)+14]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(n.length+1),this._process();for(var l=this._hash,s=l.words,u=0;u<4;u++){var c=s[u];s[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return l},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}});i.MD5=u._createHelper(m),i.HmacMD5=u._createHmacHelper(m)})(Math),(function(){var t=e,n=t.lib,r=n.WordArray,o=n.Hasher,a=t.algo,i=[],l=a.SHA1=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],a=n[2],l=n[3],s=n[4],u=0;u<80;u++){if(u<16)i[u]=0|e[t+u];else{var c=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=c<<1|c>>>31}var d=(r<<5|r>>>27)+s+i[u];d+=u<20?(o&a|~o&l)+1518500249:u<40?(o^a^l)+1859775393:u<60?(o&a|o&l|a&l)-1894007588:(o^a^l)-899497514,s=l,l=a,a=o<<30|o>>>2,o=r,r=d}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+a|0,n[3]=n[3]+l|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(r+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=o._createHelper(l),t.HmacSHA1=o._createHmacHelper(l)})(),(function(t){var n=e,r=n.lib,o=r.WordArray,a=r.Hasher,i=n.algo,l=[],s=[];(function(){function e(e){for(var n=t.sqrt(e),r=2;r<=n;r++)if(!(e%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,o=0;o<64;)e(r)&&(o<8&&(l[o]=n(t.pow(r,.5))),s[o]=n(t.pow(r,1/3)),o++),r++})();var u=[],c=i.SHA256=a.extend({_doReset:function(){this._hash=new o.init(l.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],a=n[2],i=n[3],l=n[4],c=n[5],d=n[6],m=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var _=u[p-15],f=(_<<25|_>>>7)^(_<<14|_>>>18)^_>>>3,g=u[p-2],h=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;u[p]=f+u[p-7]+h+u[p-16]}var y=l&c^~l&d,C=r&o^r&a^o&a,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),v=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),S=m+v+y+s[p]+u[p],R=b+C;m=d,d=c,c=l,l=i+S|0,i=a,a=o,o=r,r=S+R|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+a|0,n[3]=n[3]+i|0,n[4]=n[4]+l|0,n[5]=n[5]+c|0,n[6]=n[6]+d|0,n[7]=n[7]+m|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;return n[o>>>5]|=128<<24-o%32,n[(o+64>>>9<<4)+14]=t.floor(r/4294967296),n[(o+64>>>9<<4)+15]=r,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=a._createHelper(c),n.HmacSHA256=a._createHmacHelper(c)})(Math),(function(){function t(e){return e<<8&4278255360|e>>>8&16711935}var n=e,r=n.lib,o=r.WordArray,a=n.enc;a.Utf16=a.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o+=2){var a=t[o>>>2]>>>16-o%4*8&65535;r.push(String.fromCharCode(a))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return o.create(n,2*t)}},a.Utf16LE={stringify:function(e){for(var n=e.words,r=e.sigBytes,o=[],a=0;a<r;a+=2){var i=t(n[a>>>2]>>>16-a%4*8&65535);o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var n=e.length,r=[],a=0;a<n;a++)r[a>>>1]|=t(e.charCodeAt(a)<<16-a%2*16);return o.create(r,2*n)}}})(),(function(){if(typeof ArrayBuffer=="function"){var t=e,n=t.lib,r=n.WordArray,o=r.init,a=r.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,n=[],r=0;r<t;r++)n[r>>>2]|=e[r]<<24-r%4*8;o.call(this,n,t)}else o.apply(this,arguments)};a.prototype=r}})(),(function(t){function n(e,t,n){return e^t^n}function r(e,t,n){return e&t|~e&n}function o(e,t,n){return(e|~t)^n}function a(e,t,n){return e&n|t&~n}function i(e,t,n){return e^(t|~n)}function l(e,t){return e<<t|e>>>32-t}var s=e,u=s.lib,c=u.WordArray,d=u.Hasher,m=s.algo,p=c.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),_=c.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),f=c.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),g=c.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=c.create([0,1518500249,1859775393,2400959708,2840853838]),y=c.create([1352829926,1548603684,1836072691,2053994217,0]),C=m.RIPEMD160=d.extend({_doReset:function(){this._hash=c.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var u=t+s,c=e[u];e[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var d,m,C,b,v,S,R,L,E,k,I=this._hash.words,T=h.words,D=y.words,x=p.words,$=_.words,P=f.words,N=g.words;S=d=I[0],R=m=I[1],L=C=I[2],E=b=I[3],k=v=I[4];for(var M,s=0;s<80;s+=1)M=d+e[t+x[s]]|0,M+=s<16?n(m,C,b)+T[0]:s<32?r(m,C,b)+T[1]:s<48?o(m,C,b)+T[2]:s<64?a(m,C,b)+T[3]:i(m,C,b)+T[4],M|=0,M=l(M,P[s]),M=M+v|0,d=v,v=b,b=l(C,10),C=m,m=M,M=S+e[t+$[s]]|0,M+=s<16?i(R,L,E)+D[0]:s<32?a(R,L,E)+D[1]:s<48?o(R,L,E)+D[2]:s<64?r(R,L,E)+D[3]:n(R,L,E)+D[4],M|=0,M=l(M,N[s]),M=M+k|0,S=k,k=E,E=l(L,10),L=R,R=M;M=I[1]+C+E|0,I[1]=I[2]+b+k|0,I[2]=I[3]+v+S|0,I[3]=I[4]+d+R|0,I[4]=I[0]+m+L|0,I[0]=M},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+14]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var o=this._hash,a=o.words,i=0;i<5;i++){var l=a[i];a[i]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return o},clone:function(){var e=d.clone.call(this);return e._hash=this._hash.clone(),e}});s.RIPEMD160=d._createHelper(C),s.HmacRIPEMD160=d._createHmacHelper(C)})(Math),(function(){var t=e,n=t.lib,r=n.Base,o=t.enc,a=o.Utf8,i=t.algo;i.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,typeof t=="string"&&(t=a.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),i=this._iKey=t.clone(),l=o.words,s=i.words,u=0;u<n;u++)l[u]^=1549556828,s[u]^=909522486;o.sigBytes=i.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var r=t.finalize(this._oKey.clone().concat(n));return r}})})(),(function(){var t=e,n=t.lib,r=n.Base,o=n.WordArray,a=t.algo,i=a.SHA1,l=a.HMAC,s=a.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=l.create(n.hasher,e),a=o.create(),i=o.create([1]),s=a.words,u=i.words,c=n.keySize,d=n.iterations;s.length<c;){var m=r.update(t).finalize(i);r.reset();for(var p=m.words,_=p.length,f=m,g=1;g<d;g++){f=r.finalize(f),r.reset();for(var h=f.words,y=0;y<_;y++)p[y]^=h[y]}a.concat(m),u[0]++}return a.sigBytes=4*c,a}});t.PBKDF2=function(e,t,n){return s.create(n).compute(e,t)}})(),(function(){var t=e,n=t.lib,r=n.Base,o=n.WordArray,a=t.algo,i=a.MD5,l=a.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=n.hasher.create(),a=o.create(),i=a.words,l=n.keySize,s=n.iterations;i.length<l;){u&&r.update(u);var u=r.update(e).finalize(t);r.reset();for(var c=1;c<s;c++)u=r.finalize(u),r.reset();a.concat(u)}return a.sigBytes=4*l,a}});t.EvpKDF=function(e,t,n){return l.create(n).compute(e,t)}})(),(function(){var t=e,n=t.lib,r=n.WordArray,o=t.algo,a=o.SHA256,i=o.SHA224=a.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}});t.SHA224=a._createHelper(i),t.HmacSHA224=a._createHmacHelper(i)})(),(function(t){var n=e,r=n.lib,o=r.Base,a=r.WordArray,i=n.x64={};i.Word=o.extend({init:function(e,t){this.high=e,this.low=t}}),i.WordArray=o.extend({init:function(e,n){e=this.words=e||[],n!=t?this.sigBytes=n:this.sigBytes=8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var o=e[r];n.push(o.high),n.push(o.low)}return a.create(n,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}})})(),(function(t){var n=e,r=n.lib,o=r.WordArray,a=r.Hasher,i=n.x64,l=i.Word,s=n.algo,u=[],c=[],d=[];(function(){for(var e=1,t=0,n=0;n<24;n++){u[e+5*t]=(n+1)*(n+2)/2%64;var r=t%5,o=(2*e+3*t)%5;e=r,t=o}for(var e=0;e<5;e++)for(var t=0;t<5;t++)c[e+5*t]=t+(2*e+3*t)%5*5;for(var a=1,i=0;i<24;i++){for(var s=0,m=0,p=0;p<7;p++){if(1&a){var _=(1<<p)-1;_<32?m^=1<<_:s^=1<<_-32}128&a?a=a<<1^113:a<<=1}d[i]=l.create(s,m)}})();var m=[];(function(){for(var e=0;e<25;e++)m[e]=l.create()})();var p=s.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new l.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,r=this.blockSize/2,o=0;o<r;o++){var a=e[t+2*o],i=e[t+2*o+1];a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);var l=n[o];l.high^=i,l.low^=a}for(var s=0;s<24;s++){for(var p=0;p<5;p++){for(var _=0,f=0,g=0;g<5;g++){var l=n[p+5*g];_^=l.high,f^=l.low}var h=m[p];h.high=_,h.low=f}for(var p=0;p<5;p++)for(var y=m[(p+4)%5],C=m[(p+1)%5],b=C.high,v=C.low,_=y.high^(b<<1|v>>>31),f=y.low^(v<<1|b>>>31),g=0;g<5;g++){var l=n[p+5*g];l.high^=_,l.low^=f}for(var S=1;S<25;S++){var l=n[S],R=l.high,L=l.low,E=u[S];if(E<32)var _=R<<E|L>>>32-E,f=L<<E|R>>>32-E;else var _=L<<E-32|R>>>64-E,f=R<<E-32|L>>>64-E;var k=m[c[S]];k.high=_,k.low=f}var I=m[0],T=n[0];I.high=T.high,I.low=T.low;for(var p=0;p<5;p++)for(var g=0;g<5;g++){var S=p+5*g,l=n[S],D=m[S],x=m[(p+1)%5+5*g],$=m[(p+2)%5+5*g];l.high=D.high^~x.high&$.high,l.low=D.low^~x.low&$.low}var l=n[0],P=d[s];l.high^=P.high,l.low^=P.low}},_doFinalize:function(){var e=this._data,n=e.words,r=(8*this._nDataBytes,8*e.sigBytes),a=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(t.ceil((r+1)/a)*a>>>5)-1]|=128,e.sigBytes=4*n.length,this._process();for(var i=this._state,l=this.cfg.outputLength/8,s=l/8,u=[],c=0;c<s;c++){var d=i[c],m=d.high,p=d.low;m=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8),p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),u.push(p),u.push(m)}return new o.init(u,l)},clone:function(){for(var e=a.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});n.SHA3=a._createHelper(p),n.HmacSHA3=a._createHmacHelper(p)})(Math),(function(){function t(){return i.create.apply(i,arguments)}var n=e,r=n.lib,o=r.Hasher,a=n.x64,i=a.Word,l=a.WordArray,s=n.algo,u=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],c=[];(function(){for(var e=0;e<80;e++)c[e]=t()})();var d=s.SHA512=o.extend({_doReset:function(){this._hash=new l.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],a=n[2],i=n[3],l=n[4],s=n[5],d=n[6],m=n[7],p=r.high,_=r.low,f=o.high,g=o.low,h=a.high,y=a.low,C=i.high,b=i.low,v=l.high,S=l.low,R=s.high,L=s.low,E=d.high,k=d.low,I=m.high,T=m.low,D=p,x=_,$=f,P=g,N=h,M=y,w=C,A=b,F=v,O=S,B=R,W=L,q=E,U=k,V=I,H=T,G=0;G<80;G++){var z=c[G];if(G<16)var j=z.high=0|e[t+2*G],K=z.low=0|e[t+2*G+1];else{var Q=c[G-15],X=Q.high,Y=Q.low,J=(X>>>1|Y<<31)^(X>>>8|Y<<24)^X>>>7,Z=(Y>>>1|X<<31)^(Y>>>8|X<<24)^(Y>>>7|X<<25),ee=c[G-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,oe=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ae=c[G-7],ie=ae.high,le=ae.low,se=c[G-16],ue=se.high,ce=se.low,K=Z+le,j=J+ie+(K>>>0<Z>>>0?1:0),K=K+oe,j=j+re+(K>>>0<oe>>>0?1:0),K=K+ce,j=j+ue+(K>>>0<ce>>>0?1:0);z.high=j,z.low=K}var de=F&B^~F&q,me=O&W^~O&U,pe=D&$^D&N^$&N,_e=x&P^x&M^P&M,fe=(D>>>28|x<<4)^(D<<30|x>>>2)^(D<<25|x>>>7),ge=(x>>>28|D<<4)^(x<<30|D>>>2)^(x<<25|D>>>7),he=(F>>>14|O<<18)^(F>>>18|O<<14)^(F<<23|O>>>9),ye=(O>>>14|F<<18)^(O>>>18|F<<14)^(O<<23|F>>>9),Ce=u[G],be=Ce.high,ve=Ce.low,Se=H+ye,Re=V+he+(Se>>>0<H>>>0?1:0),Se=Se+me,Re=Re+de+(Se>>>0<me>>>0?1:0),Se=Se+ve,Re=Re+be+(Se>>>0<ve>>>0?1:0),Se=Se+K,Re=Re+j+(Se>>>0<K>>>0?1:0),Le=ge+_e,Ee=fe+pe+(Le>>>0<ge>>>0?1:0);V=q,H=U,q=B,U=W,B=F,W=O,O=A+Se|0,F=w+Re+(O>>>0<A>>>0?1:0)|0,w=N,A=M,N=$,M=P,$=D,P=x,x=Se+Le|0,D=Re+Ee+(x>>>0<Se>>>0?1:0)|0}_=r.low=_+x,r.high=p+D+(_>>>0<x>>>0?1:0),g=o.low=g+P,o.high=f+$+(g>>>0<P>>>0?1:0),y=a.low=y+M,a.high=h+N+(y>>>0<M>>>0?1:0),b=i.low=b+A,i.high=C+w+(b>>>0<A>>>0?1:0),S=l.low=S+O,l.high=v+F+(S>>>0<O>>>0?1:0),L=s.low=L+W,s.high=R+B+(L>>>0<W>>>0?1:0),k=d.low=k+U,d.high=E+q+(k>>>0<U>>>0?1:0),T=m.low=T+H,m.high=I+V+(T>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[(r+128>>>10<<5)+30]=Math.floor(n/4294967296),t[(r+128>>>10<<5)+31]=n,e.sigBytes=4*t.length,this._process();var o=this._hash.toX32();return o},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});n.SHA512=o._createHelper(d),n.HmacSHA512=o._createHmacHelper(d)})(),(function(){var t=e,n=t.x64,r=n.Word,o=n.WordArray,a=t.algo,i=a.SHA512,l=a.SHA384=i.extend({_doReset:function(){this._hash=new o.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=16,e}});t.SHA384=i._createHelper(l),t.HmacSHA384=i._createHmacHelper(l)})(),e.lib.Cipher||(function(t){var n=e,r=n.lib,o=r.Base,a=r.WordArray,i=r.BufferedBlockAlgorithm,l=n.enc,s=(l.Utf8,l.Base64),u=n.algo,c=u.EvpKDF,d=r.Cipher=i.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function e(e){return typeof e=="string"?R:b}return function(t){return{encrypt:function(n,r,o){return e(r).encrypt(t,n,r,o)},decrypt:function(n,r,o){return e(r).decrypt(t,n,r,o)}}}})()}),m=(r.StreamCipher=d.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),n.mode={}),p=r.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),_=m.CBC=(function(){function e(e,n,r){var o=this._iv;if(o){var a=o;this._iv=t}else var a=this._prevBlock;for(var i=0;i<r;i++)e[n+i]^=a[i]}var n=p.extend();return n.Encryptor=n.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize;e.call(this,t,n,o),r.encryptBlock(t,n),this._prevBlock=t.slice(n,n+o)}}),n.Decryptor=n.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize,a=t.slice(n,n+o);r.decryptBlock(t,n),e.call(this,t,n,o),this._prevBlock=a}}),n})(),f=n.pad={},g=f.Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,o=r<<24|r<<16|r<<8|r,i=[],l=0;l<r;l+=4)i.push(o);var s=a.create(i,r);e.concat(s)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},h=(r.BlockCipher=d.extend({cfg:d.cfg.extend({mode:_,padding:g}),reset:function(){d.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=n.createEncryptor;else{var r=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==r?this._mode.init(this,t&&t.words):(this._mode=r.call(n,this,t&&t.words),this._mode.__creator=r)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{var t=this._process(!0);e.unpad(t)}return t},blockSize:4}),r.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),y=n.format={},C=y.OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var r=a.create([1398893684,1701076831]).concat(n).concat(t);else var r=t;return r.toString(s)},parse:function(e){var t=s.parse(e),n=t.words;if(n[0]==1398893684&&n[1]==1701076831){var r=a.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return h.create({ciphertext:t,salt:r})}},b=r.SerializableCipher=o.extend({cfg:o.extend({format:C}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=e.createEncryptor(n,r),a=o.finalize(t),i=o.cfg;return h.create({ciphertext:a,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var o=e.createDecryptor(n,r).finalize(t.ciphertext);return o},_parse:function(e,t){return typeof e=="string"?t.parse(e,this):e}}),v=n.kdf={},S=v.OpenSSL={execute:function(e,t,n,r){r||(r=a.random(8));var o=c.create({keySize:t+n}).compute(e,r),i=a.create(o.words.slice(t),4*n);return o.sigBytes=4*t,h.create({key:o,iv:i,salt:r})}},R=r.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:S}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=r.kdf.execute(n,e.keySize,e.ivSize);r.iv=o.iv;var a=b.encrypt.call(this,e,t,o.key,r);return a.mixIn(o),a},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var o=r.kdf.execute(n,e.keySize,e.ivSize,t.salt);r.iv=o.iv;var a=b.decrypt.call(this,e,t,o.key,r);return a}})})(),e.mode.CFB=(function(){function t(e,t,n,r){var o=this._iv;if(o){var a=o.slice(0);this._iv=void 0}else var a=this._prevBlock;r.encryptBlock(a,0);for(var i=0;i<n;i++)e[t+i]^=a[i]}var n=e.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(e,n){var r=this._cipher,o=r.blockSize;t.call(this,e,n,o,r),this._prevBlock=e.slice(n,n+o)}}),n.Decryptor=n.extend({processBlock:function(e,n){var r=this._cipher,o=r.blockSize,a=e.slice(n,n+o);t.call(this,e,n,o,r),this._prevBlock=a}}),n})(),e.mode.ECB=(function(){var t=e.lib.BlockCipherMode.extend();return t.Encryptor=t.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),t.Decryptor=t.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),t})(),e.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,r=4*t,o=r-n%r,a=n+o-1;e.clamp(),e.words[a>>>2]|=o<<24-a%4*8,e.sigBytes+=o},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso10126={pad:function(t,n){var r=4*n,o=r-t.sigBytes%r;t.concat(e.lib.WordArray.random(o-1)).concat(e.lib.WordArray.create([o<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso97971={pad:function(t,n){t.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(t,n)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.mode.OFB=(function(){var t=e.lib.BlockCipherMode.extend(),n=t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,o=this._iv,a=this._keystream;o&&(a=this._keystream=o.slice(0),this._iv=void 0),n.encryptBlock(a,0);for(var i=0;i<r;i++)e[t+i]^=a[i]}});return t.Decryptor=n,t})(),e.pad.NoPadding={pad:function(){},unpad:function(){}},(function(t){var n=e,r=n.lib,o=r.CipherParams,a=n.enc,i=a.Hex,l=n.format;l.Hex={stringify:function(e){return e.ciphertext.toString(i)},parse:function(e){var t=i.parse(e);return o.create({ciphertext:t})}}})(),(function(){var t=e,n=t.lib,r=n.BlockCipher,o=t.algo,a=[],i=[],l=[],s=[],u=[],c=[],d=[],m=[],p=[],_=[];(function(){for(var e=[],t=0;t<256;t++)t<128?e[t]=t<<1:e[t]=t<<1^283;for(var n=0,r=0,t=0;t<256;t++){var o=r^r<<1^r<<2^r<<3^r<<4;o=o>>>8^255&o^99,a[n]=o,i[o]=n;var f=e[n],g=e[f],h=e[g],y=257*e[o]^16843008*o;l[n]=y<<24|y>>>8,s[n]=y<<16|y>>>16,u[n]=y<<8|y>>>24,c[n]=y;var y=16843009*h^65537*g^257*f^16843008*n;d[o]=y<<24|y>>>8,m[o]=y<<16|y>>>16,p[o]=y<<8|y>>>24,_[o]=y,n?(n=f^e[e[e[h^f]]],r^=e[e[r]]):n=r=1}})();var f=[0,1,2,4,8,16,32,64,128,27,54],g=o.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=this._nRounds=n+6,o=4*(r+1),i=this._keySchedule=[],l=0;l<o;l++)if(l<n)i[l]=t[l];else{var s=i[l-1];l%n?n>6&&l%n==4&&(s=a[s>>>24]<<24|a[s>>>16&255]<<16|a[s>>>8&255]<<8|a[255&s]):(s=s<<8|s>>>24,s=a[s>>>24]<<24|a[s>>>16&255]<<16|a[s>>>8&255]<<8|a[255&s],s^=f[l/n|0]<<24),i[l]=i[l-n]^s}for(var u=this._invKeySchedule=[],c=0;c<o;c++){var l=o-c;if(c%4)var s=i[l];else var s=i[l-4];c<4||l<=4?u[c]=s:u[c]=d[a[s>>>24]]^m[a[s>>>16&255]]^p[a[s>>>8&255]]^_[a[255&s]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,l,s,u,c,a)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,d,m,p,_,i);var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,o,a,i,l){for(var s=this._nRounds,u=e[t]^n[0],c=e[t+1]^n[1],d=e[t+2]^n[2],m=e[t+3]^n[3],p=4,_=1;_<s;_++){var f=r[u>>>24]^o[c>>>16&255]^a[d>>>8&255]^i[255&m]^n[p++],g=r[c>>>24]^o[d>>>16&255]^a[m>>>8&255]^i[255&u]^n[p++],h=r[d>>>24]^o[m>>>16&255]^a[u>>>8&255]^i[255&c]^n[p++],y=r[m>>>24]^o[u>>>16&255]^a[c>>>8&255]^i[255&d]^n[p++];u=f,c=g,d=h,m=y}var f=(l[u>>>24]<<24|l[c>>>16&255]<<16|l[d>>>8&255]<<8|l[255&m])^n[p++],g=(l[c>>>24]<<24|l[d>>>16&255]<<16|l[m>>>8&255]<<8|l[255&u])^n[p++],h=(l[d>>>24]<<24|l[m>>>16&255]<<16|l[u>>>8&255]<<8|l[255&c])^n[p++],y=(l[m>>>24]<<24|l[u>>>16&255]<<16|l[c>>>8&255]<<8|l[255&d])^n[p++];e[t]=f,e[t+1]=g,e[t+2]=h,e[t+3]=y},keySize:8});t.AES=r._createHelper(g)})(),(function(){function t(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function n(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}var r=e,o=r.lib,a=o.WordArray,i=o.BlockCipher,l=r.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],m=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],p=l.DES=i.extend({_doReset:function(){for(var e=this._key,t=e.words,n=[],r=0;r<56;r++){var o=s[r]-1;n[r]=t[o>>>5]>>>31-o%32&1}for(var a=this._subKeys=[],i=0;i<16;i++){for(var l=a[i]=[],d=c[i],r=0;r<24;r++)l[r/6|0]|=n[(u[r]-1+d)%28]<<31-r%6,l[4+(r/6|0)]|=n[28+(u[r+24]-1+d)%28]<<31-r%6;l[0]=l[0]<<1|l[0]>>>31;for(var r=1;r<7;r++)l[r]=l[r]>>>4*(r-1)+3;l[7]=l[7]<<5|l[7]>>>27}for(var m=this._invSubKeys=[],r=0;r<16;r++)m[r]=a[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,r,o){this._lBlock=e[r],this._rBlock=e[r+1],t.call(this,4,252645135),t.call(this,16,65535),n.call(this,2,858993459),n.call(this,8,16711935),t.call(this,1,1431655765);for(var a=0;a<16;a++){for(var i=o[a],l=this._lBlock,s=this._rBlock,u=0,c=0;c<8;c++)u|=d[c][((s^i[c])&m[c])>>>0];this._lBlock=s,this._rBlock=l^u}var p=this._lBlock;this._lBlock=this._rBlock,this._rBlock=p,t.call(this,1,1431655765),n.call(this,8,16711935),n.call(this,2,858993459),t.call(this,16,65535),t.call(this,4,252645135),e[r]=this._lBlock,e[r+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});r.DES=i._createHelper(p);var _=l.TripleDES=i.extend({_doReset:function(){var e=this._key,t=e.words;this._des1=p.createEncryptor(a.create(t.slice(0,2))),this._des2=p.createEncryptor(a.create(t.slice(2,4))),this._des3=p.createEncryptor(a.create(t.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});r.TripleDES=i._createHelper(_)})(),(function(){function t(){for(var e=this._S,t=this._i,n=this._j,r=0,o=0;o<4;o++){t=(t+1)%256,n=(n+e[t])%256;var a=e[t];e[t]=e[n],e[n]=a,r|=e[(e[t]+e[n])%256]<<24-8*o}return this._i=t,this._j=n,r}var n=e,r=n.lib,o=r.StreamCipher,a=n.algo,i=a.RC4=o.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,r=this._S=[],o=0;o<256;o++)r[o]=o;for(var o=0,a=0;o<256;o++){var i=o%n,l=t[i>>>2]>>>24-i%4*8&255;a=(a+r[o]+l)%256;var s=r[o];r[o]=r[a],r[a]=s}this._i=this._j=0},_doProcessBlock:function(e,n){e[n]^=t.call(this)},keySize:8,ivSize:0});n.RC4=o._createHelper(i);var l=a.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)t.call(this)}});n.RC4Drop=o._createHelper(l)})(),e.mode.CTRGladman=(function(){function t(e){if((e>>24&255)===255){var t=e>>16&255,n=e>>8&255,r=255&e;t===255?(t=0,n===255?(n=0,r===255?r=0:++r):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=r}else e+=1<<24;return e}function n(e){return(e[0]=t(e[0]))===0&&(e[1]=t(e[1])),e}var r=e.lib.BlockCipherMode.extend(),o=r.Encryptor=r.extend({processBlock:function(e,t){var r=this._cipher,o=r.blockSize,a=this._iv,i=this._counter;a&&(i=this._counter=a.slice(0),this._iv=void 0),n(i);var l=i.slice(0);r.encryptBlock(l,0);for(var s=0;s<o;s++)e[t+s]^=l[s]}});return r.Decryptor=o,r})(),(function(){function t(){for(var e=this._X,t=this._C,n=0;n<8;n++)l[n]=t[n];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<l[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<l[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<l[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<l[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<l[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<l[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<l[6]>>>0?1:0)|0,this._b=t[7]>>>0<l[7]>>>0?1:0;for(var n=0;n<8;n++){var r=e[n]+t[n],o=65535&r,a=r>>>16,i=((o*o>>>17)+o*a>>>15)+a*a,u=((4294901760&r)*r|0)+((65535&r)*r|0);s[n]=i^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}var n=e,r=n.lib,o=r.StreamCipher,a=n.algo,i=[],l=[],s=[],u=a.Rabbit=o.extend({_doReset:function(){for(var e=this._key.words,n=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var o=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)t.call(this);for(var r=0;r<8;r++)a[r]^=o[r+4&7];if(n){var i=n.words,l=i[0],s=i[1],u=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),c=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=u>>>16|4294901760&c,m=c<<16|65535&u;a[0]^=u,a[1]^=d,a[2]^=c,a[3]^=m,a[4]^=u,a[5]^=d,a[6]^=c,a[7]^=m;for(var r=0;r<4;r++)t.call(this)}},_doProcessBlock:function(e,n){var r=this._X;t.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var o=0;o<4;o++)i[o]=16711935&(i[o]<<8|i[o]>>>24)|4278255360&(i[o]<<24|i[o]>>>8),e[n+o]^=i[o]},blockSize:4,ivSize:2});n.Rabbit=o._createHelper(u)})(),e.mode.CTR=(function(){var t=e.lib.BlockCipherMode.extend(),n=t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,o=this._iv,a=this._counter;o&&(a=this._counter=o.slice(0),this._iv=void 0);var i=a.slice(0);n.encryptBlock(i,0),a[r-1]=a[r-1]+1|0;for(var l=0;l<r;l++)e[t+l]^=i[l]}});return t.Decryptor=n,t})(),(function(){function t(){for(var e=this._X,t=this._C,n=0;n<8;n++)l[n]=t[n];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<l[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<l[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<l[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<l[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<l[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<l[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<l[6]>>>0?1:0)|0,this._b=t[7]>>>0<l[7]>>>0?1:0;for(var n=0;n<8;n++){var r=e[n]+t[n],o=65535&r,a=r>>>16,i=((o*o>>>17)+o*a>>>15)+a*a,u=((4294901760&r)*r|0)+((65535&r)*r|0);s[n]=i^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}var n=e,r=n.lib,o=r.StreamCipher,a=n.algo,i=[],l=[],s=[],u=a.RabbitLegacy=o.extend({_doReset:function(){var e=this._key.words,n=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var a=0;a<4;a++)t.call(this);for(var a=0;a<8;a++)o[a]^=r[a+4&7];if(n){var i=n.words,l=i[0],s=i[1],u=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),c=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=u>>>16|4294901760&c,m=c<<16|65535&u;o[0]^=u,o[1]^=d,o[2]^=c,o[3]^=m,o[4]^=u,o[5]^=d,o[6]^=c,o[7]^=m;for(var a=0;a<4;a++)t.call(this)}},_doProcessBlock:function(e,n){var r=this._X;t.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var o=0;o<4;o++)i[o]=16711935&(i[o]<<8|i[o]>>>24)|4278255360&(i[o]<<24|i[o]>>>8),e[n+o]^=i[o]},blockSize:4,ivSize:2});n.RabbitLegacy=o._createHelper(u)})(),e.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},e})}),null);
__d("MediaUploadFBCryptoJSHasher",["CryptoJS","MediaUploadTime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){throw new TypeError('"'+e+'" is read-only')}var s=(function(){function e(e,t){var n=t.currentTimeProvider;this.$2=e,this.$1=n}var t=e.prototype;return t.$3=function(){switch(this.$2.hashingAlgorithm){case"sha256":return r("CryptoJS").algo.SHA256;case"md5":return r("CryptoJS").algo.MD5;default:return null}},t.$4=function(){switch(this.$2.outputEncoding){case"base64":return r("CryptoJS").enc.Base64;case"hex":return r("CryptoJS").enc.Hex;default:return null}},t.$5=function(t,n,r){return new Promise(function(e){var o=new FileReader;o.onload=function(){o.result instanceof ArrayBuffer?e({isSuccess:!0,data:o.result}):e({isSuccess:!1,rawErrorCode:"INVALID_TYPE_FILE_READER"})},o.onerror=function(){e({isSuccess:!1,rawErrorObject:o.error})},o.readAsArrayBuffer(t.slice(n,n+r))})},t.$6=async function(t,n){for(var e=this.$2.takeFirstBytes==null?t.size:Math.min(this.$2.takeFirstBytes,t.size),o=0;o<e;){var a=Math.min(this.$2.maxChunkSize,e-o),i=await this.$5(t,o,a);if(i.isSuccess)n.update(r("CryptoJS").lib.WordArray.create(i.data));else return i;o+=a}return null},t.hash=async function(t){if(this.$2.maxFileSize!=null&&t.size>this.$2.maxFileSize)return{outcome:"FILE_TOO_LARGE"};var e=this.$3();if(e==null)return{outcome:"FAILURE",rawErrorCode:"INVALID_ALGORITHM"};var n=this.$4();if(n==null)return{outcome:"FAILURE",rawErrorCode:"UNSUPPORTED_OUTPUT_ENCODING"};var r=this.$1(),a=e.create();try{var i=await this.$6(t,a);if(i==null||i.isSuccess)return{outcome:"SUCCESS",value:{algorithm:this.$2.hashingAlgorithm,hashValue:a.finalize().toString(n),encoding:this.$2.outputEncoding,calculationTimeCost:o("MediaUploadTime").subtractTime(this.$1(),r)}};var l;return{outcome:"FAILURE",rawErrorCode:(l=i==null?void 0:i.rawErrorCode)!=null?l:"INTERNAL_ERROR",rawErrorObject:i==null?void 0:i.rawErrorObject}}catch(e){return{outcome:"FAILURE",rawErrorCode:"INTERNAL_ERROR",rawErrorObject:e}}},e})();l.default=s}),98);
__d("ResumableUploadServiceComet",["CometAsyncFetchError","ConstUriUtils","EventEmitter","Promise","ResumableUploadServiceState.enum","cometAsyncFetch","isStringNullOrEmpty","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s="rupload",u="facebook.com",c=(function(t){function a(e,n,o,a,i,l,c,d,m,p,_,f,g){var h;return h=t.call(this)||this,h.returnFullResponseToClient=!1,h.$ResumableUploadServiceComet$p_1=!1,h.consumer=e,h.accessToken=n,h.sessionKey=r("isStringNullOrEmpty")(o)?r("uuidv4")():o,h.contentKey=a||"",h.contentValue=i||"",h.serviceName=r("isStringNullOrEmpty")(l)?s:l,h.serviceDomain=r("isStringNullOrEmpty")(c)?u:c,h.receiveParameters=d,h.skipOffsetFetching=m,h.thriftParams=p!=null?p:new Map,h.tracingHeaderValue=_,h.customHttpHeaders=f!=null?f:new Map,h.returnFullResponseToClient=g!=null?g:!1,h.$ResumableUploadServiceComet$p_1=!1,h}babelHelpers.inheritsLoose(a,t),a.create=function(t){return new a(t.consumer,null,t.sessionKey||"",t.contentKey,t.contentValue,t.serviceName,t.serviceDomain,t.receiveParameters,t.skipOffsetFetching,t.thriftParams,t.tracingHeaderValue,t.customHttpHeaders,t.returnFullResponseToClient)};var i=a.prototype;return i.$ResumableUploadServiceComet$p_2=function(){var e,t,n={};if(((e=this.receiveParameters)==null?void 0:e.xpv_asset_id)!=null){var r;n.xpv_asset_id=String((r=this.receiveParameters)==null?void 0:r.xpv_asset_id)}if(((t=this.receiveParameters)==null?void 0:t.is_xpv_single_prod)!=null){var o;n.is_xpv_single_prod=String((o=this.receiveParameters)==null?void 0:o.is_xpv_single_prod)}return n},i.resume=function(a){var t=this;this.$ResumableUploadServiceComet$p_1=!1;var i=this.getServiceName(),l=o("ConstUriUtils").getUri("https://"+i+"/"+this.consumer+"/"+this.sessionKey);if(l!=null&&this.contentKey&&this.contentValue&&(l=l.addQueryParam(this.contentKey,this.contentValue)),l==null){var s=new Error("ResumableUploadService: Invalid uploadURI");throw s.stack,s}var u=l.toString(),c=function(){return r("cometAsyncFetch")(u,{data:{},getFullPayload:!0,method:"GET",requestHeaders:t.$ResumableUploadServiceComet$p_2(),withCredentials:!0})},d=function(n){var e=0;typeof n=="object"&&n!=null&&typeof n.offset=="number"&&(e=n.offset),t.emit(r("ResumableUploadServiceState.enum").START,{offset:e,sessionKey:t.sessionKey});var o=t.$ResumableUploadServiceComet$p_2();if(o["X-Entity-Name"]=encodeURIComponent(a.name),o["X-Entity-Type"]=a.type,o["X-Entity-Length"]=String(a.size),o.Offset=String(e),t.receiveParameters){var i=t.receiveParameters;o.start_offset=String(i.start_offset),o.end_offset=String(i.end_offset),o.composer_session_id=String(i.composer_session_id),o.id=String(i.upload_session_id),o.product_media_id=String(i.product_media_id),i.fb_region!=null&&(o["X-FB-Region"]=String(i.fb_region)),i.total_file_size!=null&&(o["X-Total-Asset-Size"]=String(i.total_file_size))}if(t.thriftParams.size>0&&(o["X-Thrift-Params"]=JSON.stringify(Object.fromEntries(t.thriftParams.entries()))),t.tracingHeaderValue!=null&&(o["x-fb-product-log"]=t.tracingHeaderValue),t.customHttpHeaders.size>0)for(var l of t.customHttpHeaders){var s=l[0],c=l[1];o[s]=c}var d=new AbortController;t.abortController=d;var m=function(o){var n=new ProgressEvent("upload-service",{loaded:o.loadedBytes+Number(e),total:a.size});t.emit(r("ResumableUploadServiceState.enum").PROGRESS,n)};return r("cometAsyncFetch")(u,{abortSignal:d.signal,data:{},formData:a.slice(e),getFullPayload:!0,method:"POST",onUploadProgress:m,requestHeaders:o,withCredentials:!0})},m=function(n){if(n==null){t.emit(r("ResumableUploadServiceState.enum").FAIL,"uploading failed");return}t.returnFullResponseToClient||n.h==null?t.emit(r("ResumableUploadServiceState.enum").SUCCESS,n):t.emit(r("ResumableUploadServiceState.enum").SUCCESS,n.h)},p=function(n){if(t.$ResumableUploadServiceComet$p_1!==!0)if(n instanceof r("CometAsyncFetchError")){var e={getError:function(){return n.errorCode},getErrorDescription:function(){return n.errorMsg},getErrorDescriptionString:function(){return n.errorMsg},getErrorIsWarning:function(){return!1},getErrorSummary:function(){return n.errorType},getPayload:function(){return null},getRequest:function(){return null},getResponseHeader:function(){return n.errorRawResponseHeaders},isBlockedAction:function(){return!1},isSilent:function(){return!1},isTransient:function(){return!0},toError:function(){return n}};t.emit(r("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,e,{method:"POST",offset:0})}else t.emit(r("ResumableUploadServiceState.enum").FAIL,n)},_=this.skipOffsetFetching==!0?(e||(e=n("Promise"))).resolve():c();return _.then(d,p).then(m,p)},i.getServiceName=function(){return this.serviceName+"."+this.serviceDomain},i.cancel=function(){this.$ResumableUploadServiceComet$p_1=!0,this.abortController&&this.abortController.abort(),this.emit(r("ResumableUploadServiceState.enum").CANCEL)},i.emitFileSizeWarning=function(t){this.emit(r("ResumableUploadServiceState.enum").FILE_TOO_LARGE,t)},a})(r("EventEmitter"));l.default=c}),98);
__d("VideoUploadCallbacksMixin",[],(function(t,n,r,o,a,i){"use strict";function e(e){return Array.isArray(e)?e:[e]}var l={inform:function(n,r){var t=this.__callbacksByType;if(t!=null){var o=e(n);o.forEach(function(e){var n=t[e];n!=null&&n.forEach(function(t){try{t(e,r)}catch(e){}})})}},subscribe:function(n,r){var t,o=this.__callbacksByType=(t=this.__callbacksByType)!=null?t:{},a=e(n);a.forEach(function(e){var t,n=o[e]=(t=o[e])!=null?t:[];n.push(r)});var i=!1;return{remove:function(){i!==!0&&(i=!0,a.forEach(function(e){var t=o[e];if(t!=null){var n=t.indexOf(r);n!==-1&&t.splice(n,1),t.length===0&&delete o[e]}}))}}}};a.exports=l}),null);
__d("VideoUploadLoggingConfigJSModuleWrapper",["VideoUploadLoggingConfig"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("VideoUploadLoggingConfig")}),98);
__d("getComposerUnsavedChangesAlert",["fbt","CometComposerDirtyTracker"],(function(t,n,r,o,a,i,l,s){"use strict";function e(e){return{primaryAction:function(n,r){o("CometComposerDirtyTracker").setIsComposerDirty(e.creationSessionID,!1),r()},primaryButtonLabel:s._(/*BTDS*/"Salir"),secondaryButtonLabel:s._(/*BTDS*/"Seguir editando"),title:s._(/*BTDS*/"\u00bfSalir de la p\u00e1gina?"),warnMessage:s._(/*BTDS*/"No has terminado de editar tu publicaci\u00f3n. \u00bfDeseas salir sin finalizar?")}}l.default=e}),226);
__d("useComposerTerminalEventLog",["RunComet","cometComposerLogger","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.useCallback,c=s.useEffect;function d(e,t){var n=o("react-compiler-runtime").c(6),a;n[0]!==t||n[1]!==e?(a=function(){if(e()){var n=t();n!=null&&r("cometComposerLogger")({fields:{terminalReason:"shutdown"},type:"COMPOSER_POST_TERMINAL"},n)}},n[0]=t,n[1]=e,n[2]=a):a=n[2];var i=a,l,s;n[3]!==i?(l=function(){var e=o("RunComet").onUnload(i);return(function(){e&&e.remove()})},s=[i],n[3]=i,n[4]=l,n[5]=s):(l=n[4],s=n[5]),c(l,s)}l.default=d}),98);/*FB_PKG_DELIM*/
__d("ArmadilloSignatures",["WASignalKeys","WASignalOther","WASignalSignatures","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n,r=(n=o("WASignalOther")).ensureSize(o("XPlatReactCrypto").getRandomValues(new Uint8Array(64)),64);return o("WASignalSignatures").makeSignature(o("WASignalKeys").makeKeyPairFromArrayBuffers(n.toBuffer(n.makeBytes(32)),n.toBuffer(e)),t,r)}function s(e,t,n){return o("WASignalSignatures").verifyMsgSignalVariant(o("WASignalSignatures").convertPublicKeyToSerializedPubKey(t),n,e)}l.armadilloSign=e,l.validateArmadilloSignature=s}),98);
__d("ArrayBuffer",["UInt8Array"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.map(function(e){return new Uint8Array(e)});return o("UInt8Array").concatBytes(t).buffer}l.mergeBuffers=e}),98);
__d("CreateEncryptionKeyPair",["CryptoLogger","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("CreateEncryptionKeyPair");function u(){return s.load().then(function(t){var r=t.generateKeys(t.KeyPurpose.Encryption);return(e||(e=n("Promise"))).resolve([r.sk.buffer,r.pk.buffer])}).catch(function(e){var t=o("CryptoLogger").CryptoLogger("create_encryption_key_pair");throw o("CryptoLogger").captureError(t,e).mustfix("failed to generate an encryption key pair"),e})}l.default=u}),98);
__d("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="30303731999218226"}),null);
__d("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql",["EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={defaultValue:null,kind:"LocalArgument",name:"request_uuid"},t={defaultValue:null,kind:"LocalArgument",name:"virtual_device_id"},r={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},a={alias:null,args:null,concreteType:"FetchVirtualDeviceInfoMinosEpochSerializablePayload",kind:"LinkedField",name:"minos_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"self_epoch_signature",storageKey:null}],storageKey:null},i=[{alias:null,args:[{fields:[{kind:"Variable",name:"request_uuid",variableName:"request_uuid"},{kind:"Variable",name:"virtual_device_id",variableName:"virtual_device_id"}],kind:"ObjectValue",name:"request"}],concreteType:"FetchVirtualDeviceInfoResponseWrapper",kind:"LinkedField",name:"fetch_virtual_device_info_for_device_addition_v2",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoError",kind:"LinkedField",name:"error",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoResponse",kind:"LinkedField",name:"data",plural:!1,selections:[{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoEncryptedSecretValues",kind:"LinkedField",name:"encrypted_secret_values",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_anon_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_root_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_storage_private_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mailbox_root_key_blob",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_oblivious_validation_token_blob",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_ocmf_client_state",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_orf_client_state_v2",storageKey:null}],storageKey:null},r,{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_epoch_id",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoSyncEpochsPayload",kind:"LinkedField",name:"sync_epochs",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},o,{alias:null,args:null,kind:"ScalarField",name:"epoch_auth_public_key",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoEpochDataSerializablePayload",kind:"LinkedField",name:"epoch_data_v2",plural:!1,selections:[o,{alias:null,args:null,kind:"ScalarField",name:"epoch_root_key",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_active_epoch",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_epoch_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"prev_epoch_id",storageKey:null},a],storageKey:null},a],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,t],kind:"Fragment",metadata:null,name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",selections:i,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[t,e],kind:"Operation",name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",selections:i},params:{id:n("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation"),metadata:{},name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBGetLSVirtualDevices",["ReQL"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.tables.encrypted_backups_virtual_devices))}l.getLSVirtualDevices=e}),98);
__d("LSCreateAuthKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("LSCreateAuthKeyPair.nop"),u=function(r,a){return s.load().then(function(t){var r=t.generateKeys(t.KeyPurpose.Encryption),o=r.pk,a=r.sk;return(e||(e=n("Promise"))).resolve([a.buffer,o.buffer])}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("create_auth_key_pair"),e).mustfix("failed to generate an auth key pair"),e})};u.__nop_name__="LSCreateAuthKeyPair",l.default=u}),98);
__d("LSCreateDebugToken.nop",["ArrayBuffer","Base64Utils","CryptoLogger","I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec","Promise","RetUtil","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("LSCryptoUtils").strToBuf("debug_token_type_"),c=o("LSCryptoUtils").strToBuf("debug_token_rkid"),d=o("LSCryptoUtils").strToBuf("debug_token_anon"),m=(s||(s=o("I64"))).of_string("32"),p=s.of_string("12");function _(e){return Array.from(e.keys()).reduce(function(t,n){var r=e.get(n);return r!=null&&(t[n]=r),t},{})}function f(e){return new Int32Array([new DataView(new Int32Array([e]).buffer).getInt32(0)]).buffer}function g(e,t){var n=t.length,r=o("ArrayBuffer").mergeBuffers([e,f(n)]);return o("ArrayBuffer").mergeBuffers([r,o("LSCryptoUtils").strToBuf(t)])}function h(e,t){var n=t.keys().sort();return n.reduce(function(e,n){var r=t.get(n);return r!=null?g(g(e,n),r):e},g(u,e))}function y(e,t,n,o,a){return r("LSCreateDerivedKeys.nop")(e,t,n,void 0,o,r("LSVec").ofArray([a])).then(function(e){var t=e[0];if(t!=null){var n=r("LSVec").toArray(t);return n.length===1?n[0]:void 0}})}function C(t,a,i,l,u){return(s||(s=o("I64"))).equal((s||(s=o("I64"))).zero,u)?y(t,a,d,l,m).then(function(e){return y(t,a,i,r("nullthrows")(e),(s||(s=o("I64"))).of_int32(i.byteLength))}):(e||(e=n("Promise"))).resolve(i)}function b(e,t,n,o,a,i,l){return y(e,t,n,o,a).then(function(n){return C(e,t,r("nullthrows")(n),i,l)})}var v=function(a,i,l,u,d,f,g){try{return(e||(e=n("Promise"))).all([y(a,i,h(u,g),l,m).then(function(e){return b(a,i,d,r("nullthrows")(e),p,l,f)}),b(a,i,c,l,p,l,f)]).then(function(e){var t=e[0],n=e[1];return o("RetUtil").getNullableRetResult(o("LSCryptoUtils").strToBuf(JSON.stringify({ctx:(s||(s=o("I64"))).equal((s||(s=o("I64"))).zero,f)?"anon":"auth",rkid:o("Base64Utils").fromArrayBuffer(r("nullthrows")(n)),scopes:_(g),type:u,val:o("Base64Utils").fromArrayBuffer(r("nullthrows")(t))})))})}catch(t){return o("CryptoLogger").CryptoLogger("create_debug_token").warn("getExn Error"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult())}};v.__nop_name__="LSCreateDebugToken",l.default=v}),98);
__d("LSCreateEncryptionKeyPair.nop",["CreateEncryptionKeyPair"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n){return r("CreateEncryptionKeyPair")()};e.__nop_name__="LSCreateEncryptionKeyPair",l.default=e}),98);
__d("LSCreateSignatureKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("LSCreateSignatureKeyPair.nop"),u=function(r,a){return s.load().then(function(t){var r=t.generateKeys(t.KeyPurpose.Signing);return(e||(e=n("Promise"))).resolve([r.sk.buffer,r.pk.buffer])}).catch(function(e){var t=o("CryptoLogger").CryptoLogger("create_signature_key_pair");throw o("CryptoLogger").captureError(t,e).mustfix("Failed to create signing key pair keys"),e})};u.__nop_name__="LSCreateSignatureKeyPair",l.default=u}),98);
__d("LSCreateSignatureWithArmadilloKey.nop",["ArmadilloSignatures","EBDeps","LSResult"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,a){return o("EBDeps").getDeps().getMAWIdentityKeys().then(function(e){var t=e.identityPrivateKey;return o("ArmadilloSignatures").armadilloSign(t,new Uint8Array(a))}).then(function(e){return r("LSResult")(e.buffer)})};e.__nop_name__="LSCreateSignatureWithArmadilloKey",l.default=e}),98);
__d("LSCreateSignature_v2.nop",["CryptoLogger","LSResult","Promise","UInt8Array","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("LSCreateSignature_v2.nop");function u(e){return r("LSResult")(e)}function c(e,t){return o("UInt8Array").concatBytes([t,e].map(function(e){return new Uint8Array(e)}))}var d=function(r,a,i,l,d){var t=o("CryptoLogger").CryptoLogger("create_signature_v2");return l.byteLength!==1?(t.mustfix("Bad aad for signing, should be 1 byte"),(e||(e=n("Promise"))).resolve(u(void 0))):s.load().then(function(r){var o=r.secretKeyFromBytes(new Uint8Array(i),r.KeyPurpose.Signing);return o!=null?r.sign(o,c(d,l)).then(function(t){return(e||(e=n("Promise"))).resolve(u(t.buffer))}):(t.mustfix("No Signature Private key"),(e||(e=n("Promise"))).resolve(u(void 0)))})};d.__nop_name__="LSCreateSignature_v2",l.default=d}),98);
__d("LSGetArmadilloPublicKey.nop",["CryptoLogger","EBDeps","Promise","RetUtil"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r,a){return o("EBDeps").getDeps().getMAWIdentityKeys().then(function(t){return(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(t.identityPublicKey.buffer))}).catch(function(t){var r=o("CryptoLogger").CryptoLogger("get_armadillo_keys");return r.catching(t).mustfix("Failed to get identity keys."),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult())})};s.__nop_name__="LSGetArmadilloPublicKey",l.default=s}),98);
__d("LSHandleWrongRecoveryCode",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] Beginning execution."),e[0]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_sproc_start"):t.resolve()},function(r){return e[0]!==void 0&&e[1]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_error_message",e[1]):t.resolve()},function(o){return t.sequence([function(r){return e[0]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[0],t.i64.cast([0,1415]),t.i64.cast([0,2]),e[1],void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,3])})},function(o){return e[2]?t.resolve(0):e[1]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",e[1]].join("")),r[7]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",e[1],r[7],t.i64.cast([0,3]))):t.resolve()},function(r){return e[0]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_sproc_end"):t.resolve()},function(e){return r[1]=t.i64.of_float(Date.now()),r[2]=t.i64.random(),r[4]="Finishing execution. Execution time: ",r[5]=t.i64.to_string(t.i64.sub(r[1],r[0])),r[6]=" ms",r[3]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ",r[3],r[4],r[3],r[5],r[3],r[6]].join("")),t.i64.eq(t.i64.mod_(r[2],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[7]=",",r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",[r[4],r[7],r[5],r[7],r[6]].join(""),r[8],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",e.__tables__=["secure_encrypted_backups_recovery_code_status"],a.exports=e}),null);
__d("LSIsValidEpochAnonIdFlow",[],(function(t,n,r,o,a,i){"use strict";var e=11;function l(t){if(t.byteLength>e)return!1;for(var n=new Int8Array(t),r=0,o=0;o<n.length;o++)r|=+(n[o]<48),r|=+(n[o]>57);return r===0}i.call=l}),66);
__d("LSIsValidEpochAnonId.nop",["LSIsValidEpochAnonIdFlow","LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l){return(e||(e=n("Promise"))).resolve(r("LSResult")(o("LSIsValidEpochAnonIdFlow").call(l)))};s.__nop_name__="LSIsValidEpochAnonId",l.default=s}),98);
__d("ObliviousConsistentMappingFunction",["FBLogger","UInt8Array","nullthrows","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("ristretto255").__setRef("ObliviousConsistentMappingFunction");function s(e){return e.some(function(e){return e!==0})}function u(e){for(;;){var t=e.getRandom();if(s(t))return t}return new Uint8Array(0)}var c=r("nullthrows")(o("UInt8Array").fromHexString("edd3f55c1a631258d69cf7a2def9de1400000000000000000000000000000010"));function d(e){return"ClientState has length "+String(e)+", expected "+String(32)}function m(e){return"ClientState is greater or equal to max: "+e.toString()}var p="ClientState is zero.";function _(e){var t=e.length;if(t!==32)throw r("FBLogger")("wmi_eb").mustfixThrow(d(t));var n=e.reduce(function(e,t){return e?!0:t>0},!1);if(!n)throw r("FBLogger")("wmi_eb").mustfixThrow(p);for(var o=!1,a=31;a>=0;--a)if(!o){var i=e[a],l=c[a];if(i>l)throw r("FBLogger")("wmi_eb").mustfixThrow("ClientState is greater or equal to max: "+e.toString());i<l&&(o=!0)}if(!o)throw r("FBLogger")("wmi_eb").mustfixThrow("ClientState is greater or equal to max: "+e.toString())}function f(t){return _(t),e.load().then(function(e){var n=u(e.scalar),r=e.scalar.mul(t,n),o=e.scalar.invert(n);return{evolveToken:o,newClientState:r}})}l.checkNonZero=s,l.maxState=c,l.buildInputLengthErrorMsg=d,l.buildInputValueErrorMsg=m,l.getInputZeroErrorMsg=p,l.clientEvolve=f}),98);
__d("LSOcmfClientEvolve_v2.nop",["CryptoLogger","ObliviousConsistentMappingFunction"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r){return o("ObliviousConsistentMappingFunction").clientEvolve(new Uint8Array(r)).then(function(e){return[e.newClientState.buffer,e.evolveToken.buffer]}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("ocmf_client_evolve_v2"),e).mustfix("Failed to evolve client."),e})};e.__nop_name__="LSOcmfClientEvolve_v2",l.default=e}),98);
__d("LSPublicEncryptionCreateDecryptedData.nop",["PublicEncryptionCreateDecryptedData"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o,a,i,l,s,u){return r("PublicEncryptionCreateDecryptedData")(o,a,i,l,s,u)};e.__nop_name__="LSPublicEncryptionCreateDecryptedData",l.default=e}),98);
__d("LSAddDeviceWithVirtualDeviceAndDecryptionKey",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Decode.nop","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSHandleWrongRecoveryCode","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIsValidEpochAnonId.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSPublicEncryptionCreateDecryptedData.nop","LSQplAnnotateInt.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSSymmetricEncryptionCreateDecryptedString.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(a){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Beginning execution."),e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_start"):t.resolve()},function(a){return t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(a,i){var l=a.done,s=a.value;return l?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_delete_client_state_start"):t.resolve()},function(e){return t.db.table(168).fetch().next().then(function(e,r){var o=e.done,a=e.value;return o?0:(r=a.item,t.storedProcedure(n("LSDeleteBackupOnClient"),r.backupId,void 0,!1,void 0,"null",!0))})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_delete_client_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_decrypt_virtual_device_secrets_start"):t.resolve()},function(r){return o[8]=e[3].get("encrypted_ocmf_client_state"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),o[8]).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[9]).then(function(e){var t;return t=e,o[10]=t[0],t})},function(r){return t.blobs.neq(o[10],void 0)?t.resolve(o[11]=o[10]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[8]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[11]=o[41]}])},function(r){return o[12]=e[3].get("encrypted_oblivious_validation_token_blob"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),o[12]).then(function(e){var t;return t=e,o[13]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[13]).then(function(e){var t;return t=e,o[14]=t[0],t})},function(r){return t.blobs.neq(o[14],void 0)?t.resolve(o[15]=o[14]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[12]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[15]=o[41]}])},function(r){return o[16]=e[3].get("encrypted_epoch_anon_id"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),o[16]).then(function(e){var t;return t=e,o[17]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[17]).then(function(e){var t;return t=e,o[18]=t[0],t})},function(r){return t.blobs.neq(o[18],void 0)?t.resolve(o[19]=o[18]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[16]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[19]=o[41]}])},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSIsValidEpochAnonId.nop"),o[19]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return o[20]=o[40]}]):t.resolve(o[20]=!1)},function(r){return o[20]?o[21]=o[19]:o[21]=void 0,o[22]=e[3].get("encrypted_epoch_root_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),o[22]).then(function(e){var t;return t=e,o[23]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[23]).then(function(e){var t;return t=e,o[24]=t[0],t})},function(r){return t.blobs.neq(o[24],void 0)?t.resolve(o[25]=o[24]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[22]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[25]=o[41]}])},function(r){return o[26]=e[3].get("encrypted_mailbox_root_key_blob"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),o[26]).then(function(e){var t;return t=e,o[27]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[27]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(r){return t.blobs.neq(o[28],void 0)?t.resolve(o[29]=o[28]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[26]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[29]=o[41]}])},function(r){return o[30]=e[3].get("encrypted_epoch_storage_private_key"),o[30]!==void 0?t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),o[30]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(r){return t.blobs.neq(o[41],void 0)?t.resolve(o[42]=o[41]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[30]).then(function(e){var t;return t=e,o[43]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[43]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return o[42]=o[44]}])},function(e){return o[31]=o[42]}]):t.resolve(o[31]=void 0)},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_decrypt_virtual_device_secrets_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_generate_keys_start"):t.resolve()},function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,o[32]=t[0],o[33]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,o[34]=t[0],o[35]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("MA=="),o[35]).then(function(e){var t;return t=e,o[36]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,o[37]=t[0],o[38]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("MQ=="),o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_generate_keys_end"):t.resolve()},function(a){return t.blobs.neq(o[11],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),o[11]).then(function(e){var t;return t=e,o[40]=t[0],o[41]=t[1],t})},function(e){var r;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,o[46]=t[0],o[47]=t[1],t})},function(e){var t;return t=[o[40],o[41],o[46],o[47]],o[42]=t[0],o[43]=t[1],o[44]=t[2],o[45]=t[3],t}]):t.resolve((r=[o[40],o[41],void 0,void 0],o[42]=r[0],o[43]=r[1],o[44]=r[2],o[45]=r[3],r))},function(a){return t.blobs.neq(o[21],void 0)?t.blobs.neq(o[25],void 0)?t.blobs.neq(o[15],void 0)?t.blobs.neq(o[29],void 0)?t.sequence([function(r){return e[12]!==void 0?(o[61]=e[12].get("epoch_head"),o[46]=o[61]):o[46]=void 0,o[47]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[48]=t[0],t})},function(e){return o[48]&&(o[61]=(o[47].push(t.i64.cast([0,0])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[49]=t[0],t})},function(e){return o[49]&&(o[61]=(o[47].push(t.i64.cast([0,2])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[50]=t[0],t})},function(e){return o[50]&&(o[61]=(o[47].push(t.i64.cast([0,3])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[51]=t[0],t})},function(e){return o[51]&&(o[61]=(o[47].push(t.i64.cast([0,4])),o[47])),o[52]="",o[53]=t.i64.of_int32(o[47].length),t.i64.gt(o[53],t.i64.cast([0,0]))?t.loopAsync(o[53],function(e){return o[61]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[47],o[61]).then(function(e){var t;return t=e,o[62]=t[0],o[63]=t[1],t})},function(e){return o[52]=[o[52],"_",t.i64.to_string(o[62])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",o[52],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("Mg=="),o[54]).then(function(e){var t;return t=e,o[55]=t[0],t})},function(e){return t.blobs.neq(o[55],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[55]).then(function(e){var t;return t=e,o[61]=t[0],t})},function(e){return o[56]=o[61]}]):t.resolve(o[56]=void 0)},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_cleanup_state_start"):t.resolve()},function(e){return t.forEach(t.db.table(168).fetch(),function(e){return e.delete()})},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_cleanup_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_optimisitc_client_state_start"):t.resolve()},function(n){return t.forEach(t.filter(t.db.table(168).fetch([[[e[1]]]]),function(n){return t.i64.eq(n.backupId,e[1])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(n){return t.db.table(168).add({backupId:e[1],devicePublicKeyBlob:o[33],devicePrivateKeyBlob:o[32],epochStoragePublicKeyBlob:o[35],epochStoragePrivateKeyBlob:o[34],epochAuthPublicKeyBlob:o[38],epochAuthPrivateKeyBlob:o[37],mailboxRootKeyBlob:o[29],ocmfClientStateBlob:o[42],obliviousValidationTokenBlob:o[15],encryptionVersion:t.i64.cast([0,0]),revisionVersion:t.i64.cast([0,1]),authorityLevel:t.i64.cast([0,20]),backupTenancy:e[7]})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_optimisitc_client_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_epoch_data_start"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_populate_epochs_table_start"):t.resolve()},function(n){return t.forEach(t.filter(t.db.table(169).fetch([[[e[2]]]]),function(n){return t.i64.eq(n.epochId,e[2])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(n){return t.db.table(169).add({epochId:e[2],authorityLevel:t.i64.cast([0,80]),backupId:e[1],epochAnonIdBlob:o[21],epochRootKeyBlob:o[25],epochStatus:t.i64.cast([0,1]),epochHead:o[46]})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_populate_epochs_table_end"):t.resolve()},function(r){return o[57]=e[5].keys(),o[58]=t.i64.of_int32(o[57].length),e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateInt.nop"),t.i64.cast([0,1021646192]),e[8],"num_epochs",o[58]):t.resolve()},function(a){return t.i64.eq(o[58],t.i64.cast([0,1]))?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_skipped"):t.resolve()},function(r){return o[61]=e[5].has(t.i64.to_string(e[2])),o[61]?t.resolve(0):((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] sync_epochs does not contain base epoch"),o[63]="sync_epochs does not contain base epoch",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[63]].join("")),o[62]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[63],o[62],t.i64.cast([0,3])))}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_start"):t.resolve()},function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Triggering epoch derivation."),o[61]=r("justknobx")._("1310"),t.resolve()},function(r){return o[61]===!1&&(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Epoch rotation is disabled for the user but received more than one epoch."),t.blobs.neq(o[31],void 0)?t.sequence([function(e){return o[65]="Starting epoch derivation at base epoch of anon id (base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[21]).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[66]=o[62]==null?"":o[62],o[63]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[63],o[65],o[63],o[66]].join("")),t.resolve()},function(r){return o[64]=e[5].get(t.i64.to_string(e[2])),o[64]!==void 0?t.sequence([function(n){return o[67]=o[64].get("minos_epoch"),o[67]!==void 0?(o[79]=o[67].get("epoch_head"),o[68]=o[79]):o[68]=void 0,o[69]=o[64].get("is_active_epoch"),o[69]?o[70]=t.i64.cast([0,1]):o[70]=t.i64.cast([0,2]),t.forEach(t.db.table(169).fetch([[[e[2]]]]),function(e){var n=e.update,r=e.item;return n({authorityLevel:t.i64.cast([0,80]),epochStatus:o[70],epochHead:o[68]})})},function(r){return o[71]=new t.Map,o[71].set("epoch_id",e[2]),o[71].set("authority_level",t.i64.cast([0,80])),o[71].set("backup_id",e[1]),o[71].set("epoch_anon_id_blob",o[21]),o[71].set("epoch_root_key_blob",o[25]),o[71].set("epoch_status",t.i64.cast([0,1])),o[71].set("epoch_head",o[46]),o[72]=o[71],o[73]=e[5].keys(),o[74]=t.i64.of_int32(o[73].length),t.i64.gt(o[74],t.i64.cast([0,0]))?t.loopAsync(o[74],function(r){return o[79]=r,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[73],o[79]).then(function(e){var t;return t=e,o[80]=t[0],o[81]=t[1],t})},function(r){return o[82]=o[72].get("epoch_id"),o[83]=o[72].get("backup_id"),o[84]=o[72].get("epoch_anon_id_blob"),o[85]=o[72].get("epoch_root_key_blob"),o[86]=o[72].get("epoch_status"),o[87]=o[72].get("authority_level"),o[88]=o[72].get("epoch_head"),o[89]=e[5].get(t.i64.to_string(o[82])),o[89]!==void 0?t.sequence([function(r){return o[98]=o[89].get("next_epoch_id"),t.i64.neq(o[98],void 0)?t.sequence([function(r){return o[106]=e[5].get(t.i64.to_string(o[98])),o[106]!==void 0?t.sequence([function(e){return o[114]=o[106].get("backup_id"),o[115]=o[106].get("is_active_epoch"),o[115]?o[116]=t.i64.cast([0,1]):o[116]=t.i64.cast([0,2]),o[117]=o[106].get("epoch_anon_id"),o[118]=o[106].get("minos_epoch"),o[118]!==void 0?(o[137]=o[118].get("epoch_head"),o[119]=o[137]):o[119]=void 0,o[120]=t.createArray(),o[137]=(o[120].push(t.i64.cast([0,32])),o[120]),o[137]=(o[120].push(t.i64.cast([0,32])),o[120]),o[121]="_",t.nativeOperation(n("LSGetBlobFromString.nop"),["epoch_chaining",o[121],t.blobs.to_string(o[84]),o[121],t.i64.to_string(o[82])].join("")).then(function(e){var t;return t=e,o[122]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[122],void 0,o[85],o[120]).then(function(e){var t;return t=e,o[123]=t[0],t})},function(e){return o[123]?o[124]=!1:o[124]=!0,o[124]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key."),o[138]="Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[138]].join("")),o[137]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[138],o[137],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[140]=t[0],t})},function(e){var t;return t=[o[139],o[140]],o[125]=t[0],o[126]=t[1],t}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[123],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[137]=t[0],o[138]=t[1],t})},function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[123],t.i64.cast([0,1])).then(function(e){var t;return t=e,o[139]=t[0],o[140]=t[1],t})},function(e){var t;return t=[o[137],o[139]],o[125]=t[0],o[126]=t[1],t}])},function(r){return o[127]=o[106].get("encrypted_epoch_key"),t.blobs.neq(o[127],void 0)?t.sequence([function(r){return o[137]=o[106].get("epoch_auth_public_key"),o[138]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSPublicEncryptionCreateDecryptedData.nop"),e[6],o[31],o[137],o[126],t.blobs.of_string(["epoch_","_",t.blobs.to_string(o[138])].join("")),o[127]).then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return t.blobs.neq(o[139],void 0)?t.resolve(o[140]=o[139]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Couldn't decrypt epoch key. Returning null entropy"),o[142]="Couldn't decrypt epoch key. Returning null entropy",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[142]].join("")),o[141]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[142],o[141],t.i64.cast([0,3]))},function(e){return o[140]=void 0}])},function(e){return o[128]=o[140]}]):t.sequence([function(e){return o[140]="encrypted_epoch_key is null. Can't generate epoch entropy. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){return o[128]=void 0}])},function(e){return t.blobs.neq(o[128],void 0)?t.sequence([function(e){return o[137]=t.createArray(),o[142]=(o[137].push(t.i64.cast([0,32])),o[137]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key").then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[138],o[125],o[128],o[137]).then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return o[139]?o[140]=!1:o[140]=!0,o[140]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Unable to generate epoch root key."),o[143]="Unable to generate epoch root key.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[143]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[143],o[142],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[141]=o[144]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[139],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[142]=t[0],o[143]=t[1],t})},function(e){return o[141]=o[142]}])},function(e){return o[129]=o[141]}]):t.sequence([function(e){return o[140]="epoch entropy is null. Can't generate epoch root key. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){return o[129]=void 0}])},function(e){return t.blobs.neq(o[129],void 0)?t.sequence([function(e){return t.filter(t.db.table(169).fetch([[[o[98]]]]),function(e){return t.i64.eq(e.epochId,o[98])&&t.i64.gt(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(e){var n=e.done,r=e.value;return n?t.db.table(169).put({epochId:o[98],backupId:o[114],epochAnonIdBlob:o[117],epochRootKeyBlob:o[129],epochStatus:o[116],authorityLevel:t.i64.cast([0,80]),epochHead:o[119]}):0})},function(e){var n;return n=[o[98],o[114],o[117],o[129],o[116],o[119],t.i64.cast([0,80])],o[130]=n[0],o[131]=n[1],o[132]=n[2],o[133]=n[3],o[134]=n[4],o[135]=n[5],o[136]=n[6],n}]):t.sequence([function(e){return o[140]="Epoch root key is null. Can't write the epoch to the table. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[130]=t[0],o[131]=t[1],o[132]=t[2],o[133]=t[3],o[134]=t[4],o[135]=t[5],o[136]=t[6],t}])},function(e){var t;return t=[o[130],o[131],o[132],o[133],o[134],o[135],o[136]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected error! New epoch is null even though we have a new_epoch_id value"),o[115]="Unexpected error! New epoch is null even though we have a new_epoch_id value",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[115]].join("")),o[114]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[115],o[114],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}])},function(e){var t;return t=[o[107],o[108],o[109],o[110],o[111],o[112],o[113]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}]):t.sequence([function(e){return o[108]="New epoch is null. This is expected if epoch_id is the root or last epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[106]=t[0],t})},function(e){return o[109]=o[106]==null?"":o[106],o[110]=" , is_forward = ",o[111]="1",o[107]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[107],o[108],o[107],o[109],o[107],o[110],o[107],o[111]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}])},function(e){var t;return t=[o[99],o[100],o[101],o[102],o[103],o[104],o[105]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}]):t.sequence([function(e){return o[100]="Unexpected error! server epoch is null even though we have epoch_id. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[101]=o[98]==null?"":o[98],o[99]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[99],o[100],o[99],o[101]].join("")),o[102]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[100],",",o[101]].join(""),o[102],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}])},function(e){return o[97]=new t.Map,o[97].set("epoch_id",o[90]),o[97].set("backup_id",o[91]),o[97].set("epoch_anon_id_blob",o[92]),o[97].set("epoch_root_key_blob",o[93]),o[97].set("epoch_status",o[94]),o[97].set("epoch_head",o[95]),o[97].set("authority_level",o[96]),o[72]=o[97]}])}):t.resolve()},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[79]=t[0],t})},function(e){return o[79]?o[80]=!0:o[80]=!1,o[80]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[82]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[82]].join("")),o[81]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[82],o[81],t.i64.cast([0,3]))):t.resolve()}])},function(r){return o[75]=new t.Map,o[75].set("epoch_id",e[2]),o[75].set("authority_level",t.i64.cast([0,80])),o[75].set("backup_id",e[1]),o[75].set("epoch_anon_id_blob",o[21]),o[75].set("epoch_root_key_blob",o[25]),o[75].set("epoch_status",t.i64.cast([0,1])),o[75].set("epoch_head",o[46]),o[76]=o[75],o[77]=e[5].keys(),o[78]=t.i64.of_int32(o[77].length),t.i64.gt(o[78],t.i64.cast([0,0]))?t.loopAsync(o[78],function(r){return o[79]=r,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[77],o[79]).then(function(e){var t;return t=e,o[80]=t[0],o[81]=t[1],t})},function(r){return o[82]=o[76].get("epoch_id"),o[83]=o[76].get("backup_id"),o[84]=o[76].get("epoch_anon_id_blob"),o[85]=o[76].get("epoch_root_key_blob"),o[86]=o[76].get("epoch_status"),o[87]=o[76].get("authority_level"),o[88]=o[76].get("epoch_head"),o[89]=e[5].get(t.i64.to_string(o[82])),o[89]!==void 0?t.sequence([function(r){return o[98]=o[89].get("prev_epoch_id"),t.i64.neq(o[98],void 0)?t.sequence([function(r){return o[106]=e[5].get(t.i64.to_string(o[98])),o[106]!==void 0?t.sequence([function(e){return o[114]=o[106].get("backup_id"),o[115]=o[106].get("is_active_epoch"),o[115]?o[116]=t.i64.cast([0,1]):o[116]=t.i64.cast([0,2]),o[117]=o[89].get("epoch_data_v2"),o[117]!==void 0?t.sequence([function(e){return o[125]=t.createArray(),o[144]=(o[125].push(t.i64.cast([0,32])),o[125]),t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[126]=t[0],t})},function(e){return o[126]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_data_storage","_",o[126]].join("")),void 0,o[85],o[125]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[144]?o[145]=!1:o[145]=!0,o[145]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[148]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[148]].join("")),o[147]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[148],o[147],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[149]=t[0],t})},function(e){return o[146]=o[149]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[144],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[147]=t[0],o[148]=t[1],t})},function(e){return o[146]=o[147]}])},function(e){return o[127]=o[146]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[145]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[145]].join("")),o[144]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[145],o[144],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[146]=t[0],t})},function(e){return o[127]=o[146]}])},function(e){return o[128]=o[117].get("epoch_anon_id"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),o[127],t.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),o[128]).then(function(e){var t;return t=e,o[129]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[129]).then(function(e){var t;return t=e,o[130]=t[0],t})},function(e){return t.blobs.neq(o[130],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSIsValidEpochAnonId.nop"),o[130]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[131]=o[144]}]):t.resolve(o[131]=!1)},function(e){return o[131]?o[132]=o[130]:o[132]=void 0,o[133]=o[117].get("epoch_root_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),o[127],t.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),o[133]).then(function(e){var t;return t=e,o[134]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[134]).then(function(e){var t;return t=e,o[135]=t[0],t})},function(e){return t.blobs.neq(o[132],void 0)?t.sequence([function(e){return t.blobs.neq(o[135],void 0)?t.resolve((o[145]=new t.Map,o[145].set("epoch_anon_id",o[132]),o[145].set("epoch_root_key",o[135]),o[144]=o[145])):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Error while decrypting epoch_root_key. Returning null"),o[146]="Error while decrypting epoch_root_key. Returning null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[146]].join("")),o[145]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[146],o[145],t.i64.cast([0,3]))},function(e){return o[144]=void 0}])},function(e){return o[136]=o[144]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Error while decrypting epoch_anon_id. Returning null"),o[145]="Error while decrypting epoch_anon_id. Returning null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[145]].join("")),o[144]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[145],o[144],t.i64.cast([0,3]))},function(e){return o[136]=void 0}])},function(e){return o[136]!==void 0?t.sequence([function(e){return o[144]=o[136].get("epoch_anon_id"),o[145]=o[136].get("epoch_root_key"),o[146]=o[106].get("minos_epoch"),o[146]!==void 0?(o[148]=o[146].get("epoch_head"),o[147]=o[148]):o[147]=void 0,t.filter(t.db.table(169).fetch([[[o[98]]]]),function(e){return t.i64.eq(e.epochId,o[98])&&t.i64.gt(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(e){var n=e.done,r=e.value;return n?t.db.table(169).put({epochId:o[98],backupId:o[114],epochAnonIdBlob:o[144],epochRootKeyBlob:o[145],epochStatus:o[116],authorityLevel:t.i64.cast([0,80]),epochHead:o[147]}):0})},function(e){var n;return n=[o[98],o[114],o[144],o[145],o[116],o[147],t.i64.cast([0,80])],o[137]=n[0],o[138]=n[1],o[139]=n[2],o[140]=n[3],o[141]=n[4],o[142]=n[5],o[143]=n[6],n}]):t.sequence([function(e){return o[146]="Error while decrypting epoch data of epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[147]=o[144]==null?"":o[144],o[145]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[145],o[146],o[145],o[147]].join("")),o[148]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[146],",",o[147]].join(""),o[148],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[137]=t[0],o[138]=t[1],o[139]=t[2],o[140]=t[3],o[141]=t[4],o[142]=t[5],o[143]=t[6],t}])},function(e){var t;return t=[o[137],o[138],o[139],o[140],o[141],o[142],o[143]],o[118]=t[0],o[119]=t[1],o[120]=t[2],o[121]=t[3],o[122]=t[4],o[123]=t[5],o[124]=t[6],t}]):t.sequence([function(e){return o[127]="Error while reading epoch_data_v2. This is expected if this is the root epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[125]=t[0],t})},function(e){return o[128]=o[125]==null?"":o[125],o[126]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[126],o[127],o[126],o[128]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[118]=t[0],o[119]=t[1],o[120]=t[2],o[121]=t[3],o[122]=t[4],o[123]=t[5],o[124]=t[6],t}])},function(e){var t;return t=[o[118],o[119],o[120],o[121],o[122],o[123],o[124]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected error! New epoch is null even though we have a new_epoch_id value"),o[115]="Unexpected error! New epoch is null even though we have a new_epoch_id value",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[115]].join("")),o[114]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[115],o[114],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}])},function(e){var t;return t=[o[107],o[108],o[109],o[110],o[111],o[112],o[113]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}]):t.sequence([function(e){return o[108]="New epoch is null. This is expected if epoch_id is the root or last epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[106]=t[0],t})},function(e){return o[109]=o[106]==null?"":o[106],o[110]=" , is_forward = ",o[111]="0",o[107]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[107],o[108],o[107],o[109],o[107],o[110],o[107],o[111]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}])},function(e){var t;return t=[o[99],o[100],o[101],o[102],o[103],o[104],o[105]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}]):t.sequence([function(e){return o[100]="Unexpected error! server epoch is null even though we have epoch_id. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[101]=o[98]==null?"":o[98],o[99]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[99],o[100],o[99],o[101]].join("")),o[102]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[100],",",o[101]].join(""),o[102],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}])},function(e){return o[97]=new t.Map,o[97].set("epoch_id",o[90]),o[97].set("backup_id",o[91]),o[97].set("epoch_anon_id_blob",o[92]),o[97].set("epoch_root_key_blob",o[93]),o[97].set("epoch_status",o[94]),o[97].set("epoch_head",o[95]),o[97].set("authority_level",o[96]),o[76]=o[97]}])}):t.resolve()},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[79]=t[0],t})},function(e){return o[79]?o[80]=!0:o[80]=!1,o[80]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[82]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[82]].join("")),o[81]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[82],o[81],t.i64.cast([0,3]))):t.resolve()}])}]):((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected Error. A base epoch exists on client but not found on server"),o[67]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils","Unexpected Error. A base epoch exists on client but not found on server",o[67],t.i64.cast([0,3])))}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch storage private key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch storage private key is null"),o[63]="epoch storage private key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[63]].join("")),o[62]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[63],o[62],t.i64.cast([0,3]))}])},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_end"):t.resolve()}])},function(r){return t.db.table(169).fetch([[[e[4]]]]).next().then(function(r,a){var i=r.done,l=r.value;return i?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: No epochs keys found."):t.resolve()},function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] No epochs keys found."),o[59]=void 0}]):(a=l.item,o[61]=new t.Map,o[61].set("epoch_root_key",a.epochRootKeyBlob),o[61].set("epoch_anon_id",a.epochAnonIdBlob),o[61].set("epoch_id",e[4]),o[61].set("epoch_head",a.epochHead),o[59]=o[61])})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_epoch_data_end"):t.resolve()},function(r){return o[59]!==void 0?t.sequence([function(e){return o[61]=o[59].get("epoch_anon_id"),o[62]=o[59].get("epoch_root_key"),o[63]=t.createArray(),o[69]=(o[63].push(t.i64.cast([0,32])),o[63]),t.nativeOperation(n("LSBase64Encode.nop"),o[61]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[64]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[64]].join("")),void 0,o[62],o[63]).then(function(e){var t;return t=e,o[69]=t[0],t})},function(e){return o[69]?o[70]=!1:o[70]=!0,o[70]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[73]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[73]].join("")),o[72]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[73],o[72],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[74]=t[0],t})},function(e){return o[71]=o[74]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[69],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[72]=t[0],o[73]=t[1],t})},function(e){return o[71]=o[72]}])},function(e){return o[65]=o[71]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[70]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[70]].join("")),o[69]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[70],o[69],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[71]=t[0],t})},function(e){return o[65]=o[71]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[65],o[33]).then(function(e){var t;return t=e,o[66]=t[0],t})},function(e){return o[67]=o[59].get("epoch_root_key"),t.blobs.neq(o[67],void 0)?t.sequence([function(e){return o[69]=t.createArray(),o[75]=(o[69].push(t.i64.cast([0,18])),o[69]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[67],o[69]).then(function(e){var t;return t=e,o[70]=t[0],t})},function(e){return o[70]!==void 0?t.sequence([function(e){return o[75]=t.i64.of_int32(o[70].length),t.i64.ge(o[75],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[70],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[77]=t[0],o[78]=t[1],t})},function(e){return o[76]=o[77]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[78]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[78]].join("")),o[77]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[78],o[77],t.i64.cast([0,3]))},function(e){return o[76]=void 0}])},function(e){return o[71]=o[76]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[76]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[76]].join("")),o[75]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[76],o[75],t.i64.cast([0,3]))},function(e){return o[71]=void 0}])},function(e){return t.blobs.neq(o[71],void 0)?o[72]=!0:o[72]=!1,o[72]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[71]).then(function(e){var t;return t=e,o[73]=t[0],t})},function(e){return o[73]!==void 0?o[74]=o[73]:o[74]="encodingfailed",o[68]=o[74]}]):t.resolve(o[68]="null")},function(r){return t.blobs.neq(o[66],void 0)?t.sequence([function(e){return o[69]=o[59].get("epoch_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[33]).then(function(e){var t;return t=e,o[70]=t[0],t})},function(e){return o[88]=o[70]==null?"":o[70],t.nativeOperation(n("LSBase64Encode.nop"),o[66]).then(function(e){var t;return t=e,o[71]=t[0],t})},function(e){return o[87]=o[71]==null?"":o[71],t.nativeOperation(n("LSBase64Encode.nop"),o[35]).then(function(e){var t;return t=e,o[72]=t[0],t})},function(e){return o[89]=o[72]==null?"":o[72],t.nativeOperation(n("LSBase64Encode.nop"),o[36]==null?t.blob("bnVsbA=="):o[36]).then(function(e){var t;return t=e,o[73]=t[0],t})},function(e){return o[90]=o[73]==null?"":o[73],t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[74]=t[0],t})},function(e){return o[91]=o[74]==null?"":o[74],t.nativeOperation(n("LSBase64Encode.nop"),o[39]==null?t.blob("bnVsbA=="):o[39]).then(function(e){var t;return t=e,o[75]=t[0],t})},function(e){return o[92]=o[75]==null?"":o[75],t.nativeOperation(n("LSBase64Encode.nop"),o[43]).then(function(e){var t;return t=e,o[76]=t[0],t})},function(r){return o[93]=o[76]==null?"":o[76],t.nativeOperation(n("LSBase64Encode.nop"),e[10]).then(function(e){var t;return t=e,o[77]=t[0],t})},function(e){return o[94]=o[77]==null?"":o[77],t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"private_key",o[32],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[78]=o[97]}]):t.resolve(o[78]=void 0)},function(e){return t.blobs.neq(o[78],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[78]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[79]=o[95]}]):t.resolve(o[79]=void 0)},function(e){return t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"ocmf_client_state",o[42],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[80]=o[97]}]):t.resolve(o[80]=void 0)},function(e){return t.blobs.neq(o[80],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[80]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[81]=o[95]}]):t.resolve(o[81]=void 0)},function(e){return t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"epoch_storage_private_key",o[34],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[82]=o[97]}]):t.resolve(o[82]=void 0)},function(e){return t.blobs.neq(o[82],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[82]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[83]=o[95]}]):t.resolve(o[83]=void 0)},function(r){return o[84]=new t.Map,o[84].set("supported_encryption_versions",o[47]),o[84].set("client_version",t.i64.cast([0,1])),o[84].set("version_sig",o[56]==null?"":o[56]),e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_issue_add_device_task_start"):t.resolve()},function(r){return t.i64.eq(e[7],t.i64.cast([0,2]))?t.resolve(o[85]=void 0):t.sequence([function(e){return t.nativeOperation(n("LSGetArmadilloPublicKey.nop")).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[85]=o[95]}])},function(e){return t.blobs.neq(o[85],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureWithArmadilloKey.nop"),o[33]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return t.blobs.neq(o[95],void 0)?t.resolve(o[96]=o[95]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),o[101]="Failed to create labyrinth signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[101]].join("")),o[100]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[101],o[100],t.i64.cast([0,3]))},function(e){return o[96]=void 0}])},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("Mw=="),o[85]).then(function(e){var t;return t=e,o[97]=t[0],t})},function(e){return t.blobs.neq(o[97],void 0)?t.resolve(o[98]=o[97]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),o[101]="Failed to create armadillo signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[101]].join("")),o[100]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[101],o[100],t.i64.cast([0,3]))},function(e){return o[98]=void 0}])},function(e){return t.blobs.neq(o[98],void 0)?(t.blobs.neq(o[96],void 0)?(o[101]=new t.Map,o[101].set("armadillo_public_key",o[85]),o[101].set("armadillo_key_signature",o[98]),o[101].set("labyrinth_key_signature",o[96]),o[100]=o[101]):o[100]=void 0,o[99]=o[100]):o[99]=void 0,o[86]=o[99]}]):t.resolve(o[86]=void 0)},function(r){return o[86]!==void 0?t.sequence([function(e){return o[95]=o[86].get("armadillo_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return o[97]=o[86].get("armadillo_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[97]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[99]=o[86].get("labyrinth_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[99]).then(function(e){var t;return t=e,o[100]=t[0],t})},function(r){return o[105]=t.i64.cast([0,1e3]),o[101]=o[105],o[102]=new t.Map,o[102].set("backup_id",e[1]),o[102].set("device_epoch_hmac",o[87]),o[102].set("epoch_root_key_fingerprint",o[68]),o[102].set("device_public_key",o[88]),o[102].set("epoch_storage_pubkey",o[89]),o[102].set("epoch_storage_pubkey_sig",o[90]),o[102].set("epoch_auth_pubkey",o[91]),o[102].set("epoch_auth_pubkey_sig",o[92]),o[102].set("ocmf_rotation_token",o[93]),o[102].set("virtual_device_id",o[94]),o[102].set("device_registration_id",e[11]),o[102].set("base_epoch_id",o[69]),o[102].set("encryption_version_data",o[84]),o[102].set("private_key_debug_token",o[79]),o[102].set("ocmf_client_state_debug_token",o[81]),o[102].set("epoch_storage_pvtkey_debug_token",o[83]),o[102].set("trace_id",e[8]),o[102].set("occam_only_eligible",!0),o[102].set("armadillo_public_key",o[96]==null?"":o[96]),o[102].set("armadillo_key_signature",o[98]==null?"":o[98]),o[102].set("labyrinth_key_signature",o[100]==null?"":o[100]),o[103]=t.toJSON(o[102]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50006]),o[103],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[101]).then(function(e){var t;return t=e,o[104]=t[0],t})}]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] failed to get armadillo key and device signatures"),o[99]=t.i64.cast([0,1e3]),o[95]=o[99],o[96]=new t.Map,o[96].set("backup_id",e[1]),o[96].set("device_epoch_hmac",o[87]),o[96].set("epoch_root_key_fingerprint",o[68]),o[96].set("device_public_key",o[88]),o[96].set("epoch_storage_pubkey",o[89]),o[96].set("epoch_storage_pubkey_sig",o[90]),o[96].set("epoch_auth_pubkey",o[91]),o[96].set("epoch_auth_pubkey_sig",o[92]),o[96].set("ocmf_rotation_token",o[93]),o[96].set("virtual_device_id",o[94]),o[96].set("device_registration_id",e[11]),o[96].set("base_epoch_id",o[69]),o[96].set("encryption_version_data",o[84]),o[96].set("private_key_debug_token",o[79]),o[96].set("ocmf_client_state_debug_token",o[81]),o[96].set("epoch_storage_pvtkey_debug_token",o[83]),o[96].set("trace_id",e[8]),o[96].set("occam_only_eligible",!0),o[97]=t.toJSON(o[96]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50006]),o[97],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[95]).then(function(e){var t;return t=e,o[98]=t[0],t}))},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_issue_add_device_task_end"):t.resolve()}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $device_epoch_hmac found to be null"):t.resolve()},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,4])})},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $device_epoch_hmac found to be null"),o[70]="$device_epoch_hmac found to be null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[70]].join("")),o[69]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[70],o[69],t.i64.cast([0,3]))}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $latest_epoch_data is null."):t.resolve()},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,4])})},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $latest_epoch_data is null."),o[62]="$latest_epoch_data is null.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[62]].join("")),o[61]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[62],o[61],t.i64.cast([0,3]))}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $mailbox root key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $mailbox root key is null"),o[47]="$mailbox root key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $mailbox root key is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: oblivious validation token is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] oblivious validation token is null"),o[47]="oblivious validation token is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] oblivious validation token is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch root key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch root key is null"),o[47]="epoch root key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch root key is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch anon id is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch anon id is null"),o[47]="epoch anon id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch anon id is null",!1)}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: orf client state v1 is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] orf client state v1 is null"),o[41]="orf client state v1 is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[41]].join("")),o[40]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[41],o[40],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] orf client state v1 is null",!1)}])},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_end"):t.resolve()}]):(i=s.item,t.sequence([function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] An authoritative row already exists, aborting execution of addDeviceFromVirtualDevice"),t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,2])})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_device_already_added"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_end"):t.resolve()}]))})},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_recovery_code_status","secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",["LSAddDeviceWithVirtualDeviceAndDecryptionKey","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSAddDeviceWithVirtualDeviceAndDecryptionKey"),a.taskId,a.backupId,a.epochId,a.encryptedSecretValues,a.lastEpochId,a.syncEpochs,a.epochStoragePublicKey,a.backupTenancy,a.traceId,a.blobDecryptionKey,a.virtualDeviceId,a.deviceRegistrationId,a.minosEpoch);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBAddDeviceGraphQL",["CometRelay","EBAPIQPLPoints","EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql","EBGetLSVirtualDevices","EBMinosCheckWasmFeatureSupport","FBLogger","I64","LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure","LSDict","LSEncryptedBackupsBackupTenancy","LSFactory","LSParseRecoveryCode_v2.nop","LSShape","LSVec","MWEncryptedBackupsDeviceRegistrationId","ReQL","WAArrayBufferUtils","WABase64","WAResultOrError","WorkerRelay","WorkerRelayNetwork","getErrorSafe","gkx","qex"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=e!==void 0?e:e=n("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql");function c(e){var t=e.backupId,n=e.qplFlow,r=e.recoveryCode,a=e.storage,i=e.userId;return o("WorkerRelayNetwork").getWorkerNetworkExecute().then(function(){return m({backupId:t,fetchQueryGraphQLFn:function(t,n){return o("WorkerRelay").createWorkerQuery(t,n)},qplFlow:n,recoveryCode:r,storage:a,userId:i})}).catch(function(){return o("WAResultOrError").makeError("worker-environment-error")})}function d(e){var t=e.backupId,n=e.environment,r=e.qplFlow,a=e.recoveryCode,i=e.storage,l=e.userId;return m({backupId:t,fetchQueryGraphQLFn:function(t,r){return o("CometRelay").fetchQuery(n,t,r,{fetchPolicy:"network-only"}).toPromise()},qplFlow:r,recoveryCode:a,storage:i,userId:l})}async function m(e){var t=e.backupId,n=e.fetchQueryGraphQLFn,a=e.qplFlow,l=e.recoveryCode,c=e.storage,d=e.userId,m=await o("EBMinosCheckWasmFeatureSupport").checkWasFeatureSupportAndQE();try{return g(c).then(function(e){var t=e!=null?e:d;return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_START),Promise.all([c.runInTransaction(function(e){return r("LSParseRecoveryCode_v2.nop")(e,0,l,t,r("LSVec").ofArray([]))},"readwrite","ui",void 0,i.id+":210"),Promise.resolve(t)])}).then(function(e){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_END);var l=e[0][0],d=e[0][1],g=e[1];if(l==null||d==null)return o("WAResultOrError").makeError("missing-mandatory-field");var h=o("WABase64").encodeB64(l);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_START),n(u,{request_uuid:g,virtual_device_id:h}).then(function(e){var n,u,g,h;if((e==null||(n=e.fetch_virtual_device_info_for_device_addition_v2)==null?void 0:n.ok)===!1){var y,C,b;return a.addAnnotations({string:{fetch_vd_info_error_code:(y=e==null||(C=e.fetch_virtual_device_info_for_device_addition_v2)==null||(C=C.error)==null?void 0:C.code)!=null?y:""}}),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_END),(e==null||(b=e.fetch_virtual_device_info_for_device_addition_v2)==null||(b=b.error)==null?void 0:b.code)==="NO_VIRTUAL_DEVICE_FOUND"?o("EBGetLSVirtualDevices").getLSVirtualDevices(c).then(function(e){return e.length>0&&a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_EXISTS),o("WAResultOrError").makeError("graphql-fetch-vd-error")}):o("WAResultOrError").makeError("graphql-fetch-vd-error")}a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_END);var v=e==null||(u=e.fetch_virtual_device_info_for_device_addition_v2)==null?void 0:u.data,S=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId(),R=(v==null?void 0:v.encrypted_secret_values)!=null?f(v==null?void 0:v.encrypted_secret_values):null,L=v==null?void 0:v.epoch_storage_public_key,E=v==null?void 0:v.epoch_id,k=v==null?void 0:v.last_epoch_id;if(v==null||S===""||R==null||E==null||L==null||k==null){var I=[];return v==null&&I.push("payload"),S===""&&I.push("deviceRegistrationId"),R==null&&I.push("validated_encrypted_secret_values"),E==null&&I.push("epoch_id"),L==null&&I.push("epoch_storage_public_key"),k==null&&I.push("last_epoch_id"),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_MISSING_GRAPHQL_FIELDS,{string_array:{missing_mandatory_field:I}}),o("WAResultOrError").makeError("missing-mandatory-field")}var T=new(r("LSDict"));v.sync_epochs.forEach(function(e){var t=p(e);t!=null&&e.epoch_id!=null&&T.set(e.epoch_id,o("LSShape").ofRecord(t))});var D=_({epoch_head:(g=v.minos_epoch)==null?void 0:g.epoch_head,self_epoch_signature:(h=v.minos_epoch)==null?void 0:h.self_epoch_signature});a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_START);var x={backupId:t,backupTenancy:(s||(s=o("I64"))).of_int32(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),blobDecryptionKey:d,deviceRegistrationId:S,encryptedSecretValues:o("LSShape").ofRecord(R),epochId:s.of_string(E),epochStoragePublicKey:o("WABase64").decodeB64(L),lastEpochId:s.of_string(k),syncEpochs:T,taskId:s.of_int32(0),traceId:a.getQPLAttrs().instanceKey.toString(),virtualDeviceId:l};return(m||r("gkx")("17219"))&&(x=babelHelpers.extends({},x,{minosEpoch:D})),c.runInTransaction(function(e){return r("LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure")(r("LSFactory")(e),x)},"readwrite",void 0,void 0,i.id+":383").then(function(){return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_END),o("WAResultOrError").makeResult()}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("vd-and-decryption-key-sproc-error")})}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("graphql-fetch-vd-error")})}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("parse-recovery-code-error")})}catch(e){var h=r("getErrorSafe")(e);return r("FBLogger")("wmi_eb").catching(h).mustfix("Runtime error performing EBAddDeviceGraphQL: %s",h.message),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_RUNTIME_ERROR,{string:{error_message:h.message}}),Promise.resolve(o("WAResultOrError").makeError("runtime-error"))}}function p(e){var t=e.backup_id,n=e.encrypted_epoch_key,a=e.epoch_anon_id,i=e.epoch_auth_public_key,l=e.epoch_data_v2,u=e.epoch_id,c=e.is_active_epoch,d=e.minos_epoch,m=e.next_epoch_id,p=e.prev_epoch_id;if(t==null||a==null||i==null||u==null||c==null)return null;var _=d==null?void 0:d.epoch_head,f=d==null?void 0:d.self_epoch_signature,g=_!=null&&f!=null?o("LSShape").ofRecord({epoch_head:o("WABase64").decodeB64(_),self_epoch_signature:o("WABase64").decodeB64(f)}):void 0,h=l==null?void 0:l.epoch_anon_id,y=l==null?void 0:l.epoch_root_key,C=h!=null&&y!=null?{epoch_anon_id:h,epoch_root_key:y}:null,b={backup_id:(s||(s=o("I64"))).of_string(t),encrypted_epoch_key:n!=null?o("WABase64").decodeB64(n):null,epoch_anon_id:o("WAArrayBufferUtils").stringToArrayBuffer(a),epoch_auth_public_key:o("WABase64").decodeB64(i),epoch_data_v2:C?o("LSShape").ofRecord(C):null,epoch_id:s.of_string(u),is_active_epoch:c,next_epoch_id:m!=null?(s||(s=o("I64"))).of_string(m):null,prev_epoch_id:p!=null?(s||(s=o("I64"))).of_string(p):null};return(r("qex")._("208")===!0||r("gkx")("17219"))&&(b=babelHelpers.extends({},b,{minos_epoch:g})),b}function _(e){var t=e.epoch_head,n=e.self_epoch_signature;return t==null||n==null?void 0:o("LSShape").ofRecord({epoch_head:o("WABase64").decodeB64(t),self_epoch_signature:o("WABase64").decodeB64(n)})}function f(e){var t=e.encrypted_epoch_anon_id,n=e.encrypted_epoch_root_key,r=e.encrypted_epoch_storage_private_key,o=e.encrypted_mailbox_root_key_blob,a=e.encrypted_oblivious_validation_token_blob,i=e.encrypted_ocmf_client_state,l=e.encrypted_orf_client_state_v2;return t==null||n==null||o==null||a==null||i==null?null:{encrypted_epoch_anon_id:t,encrypted_epoch_root_key:n,encrypted_epoch_storage_private_key:r,encrypted_mailbox_root_key_blob:o,encrypted_oblivious_validation_token_blob:a,encrypted_ocmf_client_state:i,encrypted_orf_client_state_v2:l}}function g(e){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.encrypted_backups)).then(function(e){var t=e==null?void 0:e.encryptionManagementDelegatorId;return t!=null?(s||(s=o("I64"))).to_string(t):null})}l.addDeviceGraphQLWorker=c,l.addDeviceGraphQL=d}),98);
__d("LSOnboardFromExistingDeviceStart",["LSGetLatestEpochKeys","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][onboardFromExistingDeviceStart] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.db.table(282).add({stateKey:"auto_restored",stateValue:"true"})},function(n){return t.db.table(185).add({pk:t.i64.cast([0,1]),backupId:e[0],deviceRegistrationId:e[2],taskId:t.i64.cast([0,1])})},function(e){return t.storedProcedure(n("LSGetLatestEpochKeys"),!1).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],t})},function(o){return r[2]!==void 0?t.sequence([function(o){return r[11]=r[2].get("epoch_keys"),r[12]=r[11].get("epoch_id"),r[13]=new t.Map,r[13].set("existing_device_id",e[1]),r[13].set("base_epoch_id",r[12]),r[14]=new t.Map,r[14].set("success",r[13]),r[15]=t.toJSON(r[14]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[15],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[4]=void 0}]):t.sequence([function(e){return r[3]!==void 0?t.sequence([function(e){return r[12]=r[3].get("error_message"),r[13]=r[3].get("error_code"),r[14]=new t.Map,r[14].set("error_code",r[13]),r[14].set("stored_procedure","onboardFromExistingDeviceStart"),r[14].set("error_message",r[12]),r[15]=new t.Map,r[15].set("failure",r[14]),r[16]=t.toJSON(r[15]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[16],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return r[18]=new t.Map,r[18].set("error_code",r[13]),r[18].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),r[18].set("error_message",""),r[11]=r[18]}]):t.sequence([function(e){return r[12]=new t.Map,r[12].set("error_code",t.i64.cast([0,603])),r[12].set("stored_procedure","onboardFromExistingDeviceStart"),r[12].set("error_message","Unknown error encountered"),r[13]=new t.Map,r[13].set("failure",r[12]),r[14]=t.toJSON(r[13]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[14],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[15]=t[0],t})},function(e){return r[16]=new t.Map,r[16].set("error_code",t.i64.cast([0,603])),r[16].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),r[16].set("error_message",""),r[11]=r[16]}])},function(e){return r[4]=r[11]}])},function(e){return r[5]=t.i64.of_float(Date.now()),r[6]=t.i64.random(),r[8]="Finishing execution. Execution time: ",r[9]=t.i64.to_string(t.i64.sub(r[5],r[0])),r[10]=" ms",r[7]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][onboardFromExistingDeviceStart] ",r[7],r[8],r[7],r[9],r[7],r[10]].join("")),t.i64.eq(t.i64.mod_(r[6],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[11]=",",r[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"onboardFromExistingDeviceStart",[r[8],r[11],r[9],r[11],r[10]].join(""),r[12],t.i64.cast([0,4]))):t.resolve()},function(e){return o[0]=r[4]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure",e.__tables__=["experiences_shared_state","device_metadata"],a.exports=e}),null);
__d("LSOnboardFromExistingDeviceStartStoredProcedure",["LSOnboardFromExistingDeviceStart","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOnboardFromExistingDeviceStart"),a.backupId,a.previousDeviceId,a.newDeviceRegistrationId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBAddDeviceWithKeys",["ClientConsistencyEventEmitter","CurrentAppID","EBAPIQPLPoints","EBDB","EBSMAPI","EBSMGatingUI","I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSOnboardFromExistingDeviceStartStoredProcedure","LSShape","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ODS","Promise","QPLFlow","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","err","getErrorSafe","justknobx","promiseDone","qpl","requireDeferred","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C=r("requireDeferred")("MWEBUseLocalStorage").__setRef("EBAddDeviceWithKeys");function b(t){var a=t.backupId,l=t.db,_=t.newDeviceRegistrationId,b=t.previousDeviceId,S=t.source,R=t.trackAddingDevice;return new(y||(y=n("Promise")))(function(t,n){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys start"]))),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"START_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC");var y=o("WAHashStringToNumber").hashStringToNumber(r("uuidv4")()),L=r("qpl")._(521473756,"2768"),E=S,k=o("QPLFlow").startQPLFlow(L,{annotations:{bool:{isEBAddDeviceWithKeys:!0,isInWorker:!1},string:{restore_type:E}},instanceKey:y,timeoutInMs:r("justknobx")._("2444")});k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"start"),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys caling LSOnboardFromExistingDeviceStartStoredProcedure"]))),l.runInTransaction(function(e){return r("LSOnboardFromExistingDeviceStartStoredProcedure")(r("LSFactory")(e),{backupId:a,newDeviceRegistrationId:_,previousDeviceId:b})},"readwrite",void 0,void 0,i.id+":103").then(function(e){var a=e[0];if(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC"),k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END),a!=null){var i,s=o("LSShape").toRecord(a).error_message;switch(r("QPLUserFlow").addPoint((i=o("MWChatEncryptedBackupsQPLEvents")).restoreDeviceAuthQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM"),r("QPLUserFlow").addPoint(i.restoreQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM"),o("MWChatEncryptedBackupsLogging").endFailure({errorName:s,event:i.restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({errorName:s,event:i.restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),k.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{string:{error_code:(g||(g=o("I64"))).to_string(o("LSShape").toRecord(a).error_code),error_message:s}}),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"fail"),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithKeys sproc failed, isInWorker: false, error: ",""])),s),r("promiseDone")(o("EBDB").clearEbStores()),o("CurrentAppID").getAppID()){case 772021112871879 .toString():r("ClientConsistencyEventEmitter").emit("hardRefresh","eb_autorestore_error");break;default:r("ClientConsistencyEventEmitter").emit("softRefresh","eb_autorestore_error")}n(r("err")(s))}k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_START);var _=o("ReQL").fromTableAscending(l.tables.secure_encrypted_backups_client_state).subscribe(function(e,a){if(a.operation==="delete"){_();var i="[wmi][ebsm] EBAPI addDeviceWithKeys subscription failed, isInWorker: false, error: client state deleted";v(i,k,E),n(r("err")(i))}else if(a.operation==="add"||a.operation==="put"){var s=a.value,u=s.authorityLevel,y=s.deviceId;(g||(g=o("I64"))).equal(u,(h||(h=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))&&(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_TASK"),k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_END),_(),r("promiseDone")(o("MWEncryptedBackupsSharedState").upsertEBSharedStateEntry({db:l,stateKey:r("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY})),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys client state row added"]))),R(y),C.onReady(function(e){var t=e.mwEBCreateLocalStorageEntry,n=e.mwEBDeleteLocalStorageEntry;t(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION),t(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2),n(r("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}),o("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:l,onFailure:function(){o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore failed"])))},onSuccess:function(){r("QPLUserFlow").addAnnotations(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"auto_restore"}}),o("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endSuccess({event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore success"])))}}),r("EBSMAPI").fetchBackupIds("EBAddDeviceWithKeys").catch(function(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["",""])),r("getErrorSafe")(e).message)}),k.endSuccess(),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"success"),t())}})}).catch(function(e){var t="[wmi][ebsm] EBAPI addDeviceWithKeys sproc error, isInWorker: false, error: "+r("getErrorSafe")(e).message;v(t,k,E),n(r("err")(t))})})}function v(e,t,n){o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{isBackendSetupOnFail:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:e,event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({errorName:e,event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),t.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{string:{error_message:e}}),(f||(f=o("ODS"))).bumpEntityKey(7319,n,"fail"),o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["",""])),e)}l.addDeviceWithEBKeys=b}),98);
__d("LSAddDevice",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetViewerFBID","LSHandleWrongRecoveryCode","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSParseRecoveryCode_v2.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Beginning execution."),e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_start"):t.resolve()},function(a){return r("justknobx")._("946")?t.sequence([function(e){return o[8]=t.createArray(),t.forEach(t.db.table(179).fetch(),function(e){var n=e.item;return t.sequence([function(e){return o[15]=n.taskId,t.db.table(2).fetch([[[o[15]]]]).next().then(function(e,t){var n=e.done,r=e.value;return n?o[13]=!1:(t=r.item,o[13]=!0)})},function(e){return o[13]?0:o[16]=(o[8].push(o[15]),o[8])}])})},function(e){return o[9]=t.i64.of_int32(o[8].length),t.i64.gt(o[9],t.i64.cast([0,0]))?t.loopAsync(o[9],function(e){return o[13]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[8],o[13]).then(function(e){var t;return t=e,o[14]=t[0],o[15]=t[1],t})},function(e){return t.forEach(t.db.table(179).fetch([[[o[14]]]]),function(e){return e.delete()})}])}):t.resolve()},function(e){return t.db.table(179).fetch().next().then(function(e,t){var n=e.done,r=e.value;return n?o[10]=!1:(t=r.item,o[10]=!0)})},function(r){return o[10]?t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: add device task already pending"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] add device task already pending"),o[14]="add device task already pending",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",o[14],o[13],t.i64.cast([0,3]))},function(e){return o[12]=t.i64.cast([0,1])}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_vd_error_correction_start"):t.resolve()},function(n){return o[13]=t.createArray(),t.forEach(t.filter(t.db.table(184).fetch(),function(n){return t.i64.eq(n.backupId,e[0])}),function(e){var n=e.item;return o[19]=new t.Map,o[19].set("virtual_device_id",n.virtualDeviceId),o[20]=(o[13].push(o[19]),o[13])})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_vd_error_correction_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_parse_recovery_code_start"):t.resolve()},function(e){return t.db.table(172).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[14]=void 0:(n=a.item,o[20]=n.encryptionManagementDelegatorId,t.i64.neq(o[20],void 0)?(t.i64.neq(o[20],t.i64.cast([0,0]))?o[21]=t.i64.to_string(o[20]):o[21]=void 0,o[19]=o[21]):o[19]=void 0,o[14]=o[19])})},function(e){return t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[16]=t[0],t})},function(r){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),e[1],o[14]==null?t.i64.to_string(o[16]):o[14],o[13]).then(function(e){var t;return t=e,o[17]=t[0],o[18]=t[1],t})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_parse_recovery_code_end"):t.resolve()},function(r){return t.blobs.neq(o[17],void 0)?t.blobs.neq(o[18],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[17]).then(function(e){var t;return t=e,o[19]=t[0],t})},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,1])})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_issue_fetch_virtual_device_task_start"):t.resolve()},function(r){return o[24]=t.i64.cast([0,1e3]),o[20]=o[24],o[21]=new t.Map,o[21].set("backup_id",e[0]),o[21].set("virtual_device_id",o[19]==null?"":o[19]),o[21].set("trace_id",void 0),o[22]=t.toJSON(o[21]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50007]),o[22],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[20]).then(function(e){var t;return t=e,o[23]=t[0],t})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_issue_fetch_virtual_device_task_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_device_registration_id_start"):t.resolve()},function(n){return t.db.table(185).add({pk:t.i64.cast([0,1]),backupId:e[0],deviceRegistrationId:e[2],taskId:o[23]})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_device_registration_id_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_recovery_code_data_start"):t.resolve()},function(e){return t.db.table(179).add({taskId:o[23],virtualDeviceId:o[17],blobDecryptionKey:o[18]})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_recovery_code_data_end"):t.resolve()}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: Invalid recovery code. blob_decryption_key is null"):t.resolve()},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. blob_decryption_key is null",!0)}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: Invalid recovery code. virtual_device_id is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. virtual_device_id is null"),o[20]="Invalid recovery code. virtual_device_id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",o[20]].join("")),o[19]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",o[20],o[19],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. virtual_device_id is null",!0)}])},function(e){return o[12]=t.i64.cast([0,0])}])},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_end"):t.resolve()},function(e){return o[1]=o[12]}]):t.sequence([function(r){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] addDeviceFlow is not enabled"),e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: add device flow is disabled"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_end"):t.resolve()},function(e){return o[1]=t.i64.cast([0,1])}])},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsAddDeviceStoredProcedure",e.__tables__=["secure_recovery_code_data","pending_tasks","encrypted_backups_virtual_devices","encrypted_backups","secure_encrypted_backups_recovery_code_status","device_metadata"];var s=e;l.default=s}),98);
__d("LSAddDeviceStoredProcedure",["LSAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSAddDevice"),a.backupId,a.recoveryCode,a.deviceRegistrationId,a.backupTenancy,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSEncryptedBackupsRecoveryCodeStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({OPTIMISTIC:1,VALID:2,INVALID:3,SYSTEM_ERROR:4});i.default=e}),66);
__d("MWEncryptedBackupsRecoveryCodeStatus",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.onFailure,a=t.onInvalidRecoveryCode,i=t.onSuccess,l=t.recoveryCodeStatusData;if((l==null?void 0:l.length)===1){var s=l[0].recoveryCodeStatus;switch((e||(e=o("I64"))).to_int32(s)){case r("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC:return r("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC;case r("LSEncryptedBackupsRecoveryCodeStatus").INVALID:return a==null||a(),r("LSEncryptedBackupsRecoveryCodeStatus").INVALID;case r("LSEncryptedBackupsRecoveryCodeStatus").VALID:return i==null||i(),r("LSEncryptedBackupsRecoveryCodeStatus").VALID;case r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR:return n==null||n(),r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR;default:n==null||n(),r("FBLogger")("wmi_eb").mustfix("Invalid Recovery Code Status type")}}}l.encryptedBackupsGetRecoveryCodeStatus=s}),98);
__d("EBAddDeviceWithRecoveryCode",["EBAPIQPLPoints","EBAddDeviceGraphQL","EBDeps","FBLogger","I64","LSAddDeviceStoredProcedure","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","MAWWaitForBackendSetup","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsRecoveryCodeStatus","ReQL","WALogger","WAResultOrError","isInstamadilloEB","justknobx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p=10;function _(e){var t=e.count,n=e.storage;return new Promise(function(e,a){if(t===p)return e();r("promiseDone")(o("ReQL").firstAsync(o("ReQL").fromTableAscending(n.tables.encrypted_backups)),function(r){var o=r==null?void 0:r.backupId;if(o!=null)return e(o);window.setTimeout(function(){e(_({count:t+1,storage:n}))},1e3)},function(e){return a(e)})})}function f(t){var n=t.environment,a=t.qplFlow,l=t.recoveryCode,p=t.userId,f=function(){},y=!1,C=new Promise(function(e,t){window.setTimeout(function(){y||(r("FBLogger")("wmi_eb").warn("Add device failed by timeout 90 sec"),h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TIMEOUT),e("ADD_DEVICE_TIMEOUT"))},r("justknobx")._("4226"))}),b=new Promise(async function(t,g){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_START);var y=await o("EBDeps").getDeps().getLSDB();a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_END),f=y.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(e,n){if(n.operation!=="delete"){var i=[n.value];a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_CHECK_RC_STATUS),o("MWEncryptedBackupsRecoveryCodeStatus").encryptedBackupsGetRecoveryCodeStatus({onFailure:function(){h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_TO_GET_RC_STATUS),f(),t("ADD_DEVICE_FAILED_TO_GET_RC_STATUS")},onInvalidRecoveryCode:function(){h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.INVALID_RECOVERY_CODE),f(),t("INVALID_RECOVERY_CODE")},onSuccess:function(){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_END),a.endSuccess({bool:{isBackendSetupOnSuccess:o("EBDeps").getDeps().isBackendSetupSuccessful()}}),f(),r("promiseDone")(o("EBDeps").getDeps().trackAddingNewDevice()),t("SUCCESS")},recoveryCodeStatusData:i})}}),r("promiseDone")(_({count:0,storage:y}),function(_){if(_!=null)if(r("isInstamadilloEB")()){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device sproc start"])));var b=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();return b===""?(h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_DEVICE_REGISTRATION_ID_NULL),f(),g("deviceRegistrationId is not defined")):(a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START),y.runInTransaction(function(e){return r("LSAddDeviceStoredProcedure")(r("LSFactory")(e),{backupId:_,backupTenancy:(d||(d=o("I64"))).of_int32(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),deviceRegistrationId:b,recoveryCode:l})},"readwrite",void 0,void 0,i.id+":232").then(function(e){var t=e[0];if(!(d||(d=o("I64"))).equal(t,(m||(m=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)))return h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{bool:{is_backend_setup:o("MAWWaitForBackendSetup").isBackendSetupSuccessful()}}),f(),g("Add device sproc failed");a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device sproc success"])))}).catch(function(e){throw a.addAnnotations({string:{error_message:e.message}}),e}))}else{o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql start"]))),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_START);var C=n!=null?o("EBAddDeviceGraphQL").addDeviceGraphQL({backupId:_,environment:n,qplFlow:a,recoveryCode:l,storage:y,userId:p}):o("EBAddDeviceGraphQL").addDeviceGraphQLWorker({backupId:_,qplFlow:a,recoveryCode:l,storage:y,userId:p});return C.then(function(e){if(e.success)a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql success"])));else return h(a,o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL,{string:{fail_result:e.error}}),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL),f(),t("ADD_DEVICE_GRAPHQL_ERROR")})}else return h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND),f(),t("ADD_DEVICE_ERROR_BACKUP_ID_NOT_DEFINED")},function(e){return r("FBLogger")("wmi_eb").catching(e).mustfix("Add device failed. Could not find backup."),h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_COULD_NOT_FIND_BACKUP,{string:{error_message:e.message}}),f(),t("ADD_DEVICE_ERROR_COULD_NOT_READ_BACKUP_TABLE")})});return Promise.race([b,C]).then(function(e){return y=!0,g(e)})}function g(e){return e==="SUCCESS"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError(e)}var h=function(t,n,r){t.endFail(n,babelHelpers.extends({},r!=null?r:{},{bool:{isBackendSetupOnFail:o("EBDeps").getDeps().isBackendSetupSuccessful()}}))};l.addDeviceWithRecoveryCode=f}),98);
__d("EBAddVirtualDevice",["EBDeps","EBLogger","I64","LSEncryptedBackupsOpStatus","LSEncryptedBackupsRecoveryCodeStatus","LSIntEnum","ReQL","WAResultOrError","promiseDone","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("MWEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeData").__setRef("EBAddVirtualDevice");async function c(t){var n=t.actionType,a=t.qplFlow,i=t.recoveryCodeData;a.addPoint("add_virtual_device_get_db_start");var l=await o("EBDeps").getDeps().getLSDB();return a.addPoint("add_virtual_device_get_db_end"),a.addPoint("add_virtual_device_sproc_start"),new Promise(function(t,c){return u.onReady(function(u){var c=l.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(){r("promiseDone")(o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(l.tables.secure_encrypted_backups_recovery_code_status)),function(n){if(n!=null&&n.length===1){var a=n[0].recoveryCodeStatus;return(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").VALID))?(c(),t(o("WAResultOrError").makeResult())):(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").INVALID))?(c(),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_INVALID"))):void 0}})});r("promiseDone")(u.initializeCreateExtraVirtualDeviceStoredProcedure(l,(e||(e=o("I64"))).of_int32(n),i),function(n){a.addPoint("add_virtual_device_sproc_end");var i=n[0];if(!(e||(e=o("I64"))).equal(i,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)))return(e||(e=o("I64"))).equal(i,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE))?(a.endFail("add_virtual_device_sproc_failure"),o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device - failure"),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_FAILURE"))):(a.addPoint("add_virtual_device_sproc_fail_unknown"),o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device - unknown"),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_UNKNOWN")))},function(){return o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device."),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_ERROR"))})})})}l.addVirtualDevice=c}),98);
__d("EBBatchRequestResignCdnUrlQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24784488421147370"}),null);
__d("EBBatchRequestResignCdnUrlQuery.graphql",["EBBatchRequestResignCdnUrlQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"request"}],t=[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"payloads",variableName:"request"}],concreteType:"XFBResignCdnUrlResponse",kind:"LinkedField",name:"batch_resigned_attachment_cdn_url",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"instance_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"path",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_message",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_enum",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EBBatchRequestResignCdnUrlQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EBBatchRequestResignCdnUrlQuery",selections:t},params:{id:n("EBBatchRequestResignCdnUrlQuery_facebookRelayOperation"),metadata:{},name:"EBBatchRequestResignCdnUrlQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBBatchRequestResignCdnUrl",["EBBatchRequestResignCdnUrlQuery.graphql","EBEnqueueResignCdnUrlRequests","FBLogger","WADirectPath","WAErrorMessage","WAMediaUtils","WAResultOrError","createWorkerQuery"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h=function(){return r("FBLogger")("wmi").tags(["labyrinth_web","resign_cdn_url"])};async function y(e){var t=o("EBEnqueueResignCdnUrlRequests").getGqlRestoredCdnUrlMap(),n=[];for(var r of t.entries()){var a=r[0],i=r[1];i.pending||n.push([a,i])}if(!(n.length<1)){var l=n.map(function(e){return{instance_key:e[0],payload:e[1].payload}});n.forEach(function(e){var t=e[0],n=e[1];o("EBEnqueueResignCdnUrlRequests").setGqlRestoredCdnUrlMap(t,{payload:n.payload,pending:!0,resolvable:n.resolvable})}),await C(e,l)}}async function C(e,t){if(!(t.length<1)){var n=o("EBEnqueueResignCdnUrlRequests").getGqlRestoredCdnUrlMap();e==null||e.addPoint("resign_cdn_url_query_start");try{var a,i,l=await r("createWorkerQuery")(v,{request:t.map(function(e){return{instance_key:e.instance_key,payload:e.payload.payload}})});e==null||e.addPoint("resign_cdn_url_query_end");var f=l==null||(a=l.viewer)==null||(a=a.messenger_default_encrypted_backup)==null||(a=a.mailbox)==null?void 0:a.batch_resigned_attachment_cdn_url;h().DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Received "," requests"])),f==null?void 0:f.length),e==null||e.addAnnotations({int:{resign_cdn_url_gql_batch_size:(i=f==null?void 0:f.length)!=null?i:0}}),f==null||f.forEach(function(t){var r=t.instance_key!=null?o("WAMediaUtils").stringToDeliveryObjectId(t.instance_key):null,a=t.path;if(r!=null){var i,l=o("WADirectPath").validateDirectPath(a);if(!l.success){var s;h().WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",", graphql error: ",""])),l.error,t.exception_message),e==null||e.addAnnotations({string:{resign_cdn_url_exception_enum:(s=t.exception_enum)!=null?s:"unknown"}})}var m=(i=n.get(r))==null?void 0:i.resolvable;m!=null?m.resolve(l):h().MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["No resolvable found for instance key: ",""])),r),n.delete(r)}else h().MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url came back with no instance key, ",""])),a)})}catch(r){var g=o("WAErrorMessage").maybeGetMessageFromError(r);e==null||e.addPoint("resign_cdn_url_query_fail"),e==null||e.addAnnotations({string:{resign_cdn_url_gql_error:g}}),h().WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),g),t.forEach(function(e){var t,r=(t=n.get(o("WAMediaUtils").stringToDeliveryObjectId(e.instance_key)))==null?void 0:t.resolvable;r!=null?r.resolve(o("WAResultOrError").makeError("resign-cdn-url-gql-error")):h().MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["No resolvable found during error for instance key: ",""])),e.instance_key)})}finally{t.forEach(function(e){var t,r=o("WAMediaUtils").stringToDeliveryObjectId(e.instance_key),a=(t=n.get(r))==null?void 0:t.resolvable;(a==null?void 0:a.isSettled)===!1&&h().MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Resolvable was not properly settled"]))),n.delete(o("WAMediaUtils").stringToDeliveryObjectId(e.instance_key))})}}}async function b(e,t,n){e==null||e.addPoint("resign_cdn_url_query_start");try{var a,i=await r("createWorkerQuery")(v,{request:[{instance_key:t,payload:n.payload}]});e==null||e.addPoint("resign_cdn_url_query_end");var l=i==null||(a=i.viewer)==null||(a=a.messenger_default_encrypted_backup)==null||(a=a.mailbox)==null?void 0:a.batch_resigned_attachment_cdn_url;(l==null?void 0:l.length)!==1&&(e==null||e.addPoint("resign_cdn_url_should_have_one_response"));var s=l==null?void 0:l[0],u=s==null?void 0:s.path,c=o("WADirectPath").validateDirectPath(u);if(!c.success){var d;h().WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",", graphql error: ",""])),c.error,s==null?void 0:s.exception_message),e==null||e.addAnnotations({string:{resign_cdn_url_exception_enum:(d=s==null?void 0:s.exception_enum)!=null?d:"unknown"}})}return c}catch(t){var m=o("WAErrorMessage").maybeGetMessageFromError(t);return e==null||e.addPoint("resign_cdn_url_query_fail"),e==null||e.addAnnotations({string:{resign_cdn_url_gql_error:m}}),h().WARN(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),m),o("WAResultOrError").makeError("resign-cdn-url-gql-error")}}var v=e!==void 0?e:e=n("EBBatchRequestResignCdnUrlQuery.graphql");l.batchedResignCdnUrlFromMap=y,l.batchedResignCdnUrlWithGraphQL=C,l.resignCdnUrlWithGraphQL=b}),98);
__d("EBEnqueueResignCdnUrlRequests",["EBBatchRequestResignCdnUrl","WACustomError","WAPromiseDelays","WAPromiseTimeout","WAResolvable","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){var e=!0;return{get:function(){return e},set:function(n){e=n}}})(),s=(function(){var e=window.performance.now();return{get:function(){return e},set:function(n){e=n}}})(),u=new Map,c=r("justknobx")._("4662"),d=r("justknobx")._("3244");function m(t,n,r){var a,i=(a=u.get(t))==null?void 0:a.resolvable;if(i!=null)return r==null||r.addPoint("resign_cdn_url_map_hit"),p({mediaDownloadFlow:r,objectId:t,payload:n,promise:i.promise});var l=new(o("WAResolvable")).Resolvable,s=u.size===0;return u.set(t,{payload:n,pending:!1,resolvable:l}),e.get()?(_(s),p({mediaDownloadFlow:r,objectId:t,payload:n,promise:l.promise})):p({mediaDownloadFlow:r,objectId:t,payload:n,promise:l.promise})}function p(e){var t=e.mediaDownloadFlow,n=e.objectId,r=e.payload,a=e.promise;return o("WAPromiseTimeout").promiseTimeout(a,d).then(function(e){return!e.success&&e.error==="direct-path-undefined"?(u.delete(n),o("WAPromiseDelays").delayMs(d).then(function(){return o("EBBatchRequestResignCdnUrl").resignCdnUrlWithGraphQL(t,n,r)})):e}).catch(function(e){var a=e instanceof Error&&["NetworkTransportError","NetworkTimeoutError","NetworkRequestError"].includes(e.name);if(e instanceof o("WACustomError").TimeoutError||a)return t==null||t.addPoint("resign-cdn-url-gql-timeout"),u.delete(n),o("EBBatchRequestResignCdnUrl").resignCdnUrlWithGraphQL(t,n,r);throw t==null||t.addPoint("resign-cdn-url-gql-unexpected-error"),t==null||t.addAnnotations({string:{resign_cdn_url_payload_fail_reason:e.message}}),e})}function _(t,n){if(e.set(!1),t)return e.set(!0),s.set(window.performance.now()),o("EBBatchRequestResignCdnUrl").batchedResignCdnUrlFromMap(n);var r=Math.max(c-(window.performance.now()-s.get()),0);return o("WAPromiseDelays").delayMs(r).then(function(){return e.set(!0),s.set(window.performance.now()),o("EBBatchRequestResignCdnUrl").batchedResignCdnUrlFromMap(n)})}function f(){return u}function g(e,t){u.set(e,t)}l.enqueueResignCdnUrl=m,l.getGqlRestoredCdnUrlMap=f,l.setGqlRestoredCdnUrlMap=g}),98);
__d("EBCreateResignCDNUrlPayload",["CreateDerivedKeys","EBBase64Encode","EBWorkerEBDBApi","GetBlobFromInt64BE","Hmac_v2","I64","LSVec","OcmfClientMap","OpeEncrypt","TruncateSortKey","WAArrayBufferUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s="thread_ope_key",u="__DEVICE_ID_PLACEHOLDER__";async function c(e){var t=e.accessTokenSecret,n=e.deliveryObjectId,r=e.mediaType,a=e.messageId,i=e.primaryKeySecret,l=e.productType,s=e.sort,c=s===void 0?!1:s,m=e.sortOrderMs,p=e.threadId,_=await d({accessTokenSecret:t,deliveryObjectId:n,mediaType:r,messageId:a,primaryKeySecret:i,productType:l,sortOrderMs:m,threadId:p});if(!_.success)return _;var f=_.value,g=f.device_id,h=babelHelpers.extends({},f,{device_id:u}),y=c?JSON.stringify(h,Object.keys(h).sort()):JSON.stringify(h);return o("WAResultOrError").makeResult(y.replace('"'+u+'"',String(g)))}async function d(e){var t=e.accessTokenSecret,n=e.deliveryObjectId,a=e.mediaType,i=e.messageId,l=e.primaryKeySecret,s=e.productType,u=e.sortOrderMs,c=e.threadId,d=await o("EBWorkerEBDBApi").getSecureEBClientState();if(d==null)return o("WAResultOrError").makeError("no-eb-client-state");var _=String(d.backupId),f=d.deviceId;if(f==null)return o("WAResultOrError").makeError("no-device-id");var g=r("EBBase64Encode")(d.mailboxRootKeyBlob),h=r("EBBase64Encode")(d.ocmfClientStateBlob),y=await Promise.all([m("attachment_key_scope",JSON.stringify([_,n]),d.ocmfClientStateBlob),m("mailbox_id_scope",_,d.ocmfClientStateBlob),m("message_id_scope",i,d.ocmfClientStateBlob),m("attachment_token_salt_scope",i,d.ocmfClientStateBlob),m("attachment_key_salt_scope",JSON.stringify([_,n]),d.ocmfClientStateBlob),m("attachment_token_salt_scope",JSON.stringify([i,n]),d.ocmfClientStateBlob),m("thread_id_scope",c,d.ocmfClientStateBlob),p(d.mailboxRootKeyBlob,u,c)]),C=y[0],b=y[1],v=y[2],S=y[3],R=y[4],L=y[5],E=y[6],k=y[7];return k==null?o("WAResultOrError").makeError("no-encrypted-sort-key"):o("WAResultOrError").makeResult({access_token_secret:t,attachment_index_key:r("EBBase64Encode")(C),backup_ent_fbid:-8,backup_id:_,delivery_object_id:n,device_id:f,isOpenEB:0,mailbox_partial_id:r("EBBase64Encode")(b),media_type:a,message_partial_id:r("EBBase64Encode")(v),primary_key_secret:l,product_type:s,raw_identifiers:{otid:i,server_thread_key:null,timestamp:u.toString()},raw_tokens:{mailbox_root_key:g,ocmf_client_state_blob:h},salt_partial_access_token:r("EBBase64Encode")(L),salt_partial_attachment_index_key:r("EBBase64Encode")(R),salt_partial_id:r("EBBase64Encode")(S),sort_key:k,thread_id:c,thread_partial_id:r("EBBase64Encode")(E)})}function m(e,t,n){return r("Hmac_v2")(o("WAArrayBufferUtils").stringToArrayBuffer(e),o("WAArrayBufferUtils").stringToArrayBuffer(t)).then(function(e){return r("OcmfClientMap")(n,e[0])})}async function p(t,n,a){var i=new TextEncoder().encode(s+"_"+a).buffer,l=(await o("CreateDerivedKeys").CreateDerivedKeys(i,void 0,t,[(e||(e=o("I64"))).of_int32(32)]))[0];if(l==null)return null;var u=await o("GetBlobFromInt64BE").GetBlobFromInt64BE(e.of_float(n)),c=await o("TruncateSortKey").TruncateSortKey(u[0]),d=await o("OpeEncrypt").OpeEncrypt(r("LSVec").toArray(l)[0],c[0],e.of_int32(16)),m=Array.from(new Uint8Array(d[0])),p=m.map(function(e){return e.toString(16).padStart(2,"0")});return p.join("").toUpperCase()}l.createStringifiedMediaRestorePayloadFromEBDB=c}),98);
__d("EBDeleteBackupsOnClient",["EBAPIQPLPoints","EBDeps","EBSMAPI","QPLFlow","Random","ReQL","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.reason,n=o("Random").uint32(),a=o("QPLFlow").startQPLFlow(r("qpl")._(521485243,"1081"),{annotations:{string:{reason:t}},instanceKey:n});try{var i;a.addPoint((i=o("EBAPIQPLPoints")).EBDeleteBackupsOnClientQPLPoints.GET_DB_START);var l=await o("EBDeps").getDeps().getLSDB();a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.GET_DB_END),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.TRANSACTION_START),await l.runInTransaction(async function(e){var t,n;a.addPoint((t=o("EBAPIQPLPoints")).EBDeleteBackupsOnClientQPLPoints.CLEAR_CLIENT_STATE_START);var r=await(n=o("ReQL")).toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_client_state));await Promise.all(r.map(function(t){return e.secure_encrypted_backups_client_state.delete(t.backupId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_CLIENT_STATE_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_EPOCHS_START);var i=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_epochs));await Promise.all(i.map(function(t){return e.secure_encrypted_backups_epochs.delete(t.epochId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_EPOCHS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_START);var l=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_generated_recovery_code));await Promise.all(l.map(function(t){return e.secure_encrypted_backups_generated_recovery_code.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_ENCRYPTED_BACKUPS_START);var s=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups));await Promise.all(s.map(function(t){return e.encrypted_backups.put(babelHelpers.extends({},t,{backupId:void 0}))})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_ENCRYPTED_BACKUPS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_METADATA_START);var u=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups_metadata));await Promise.all(u.map(function(t){return e.encrypted_backups_metadata.delete(t.backupId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_METADATA_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_VIRTUAL_DEVICES_START);var c=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups_virtual_devices));await Promise.all(c.map(function(t){return e.encrypted_backups_virtual_devices.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_VIRTUAL_DEVICES_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_STATUS_START);var d=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_recovery_code_status));await Promise.all(d.map(function(t){return e.secure_encrypted_backups_recovery_code_status.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_STATUS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_PENDING_BACKUPS_START);var m=await n.toArrayAsync(n.fromTableAscending(e.pending_backups_context_v2));await Promise.all(m.map(async function(t){var n=t.pendingBackupTaskId;n!=null&&await e.pending_tasks.delete(n)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_PENDING_BACKUPS_END)},"readwrite"),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.TRANSACTION_END),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.FETCH_BACKUP_IDS_START),await r("EBSMAPI").fetchBackupIds("deleteBackupsOnClient"),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.FETCH_BACKUP_IDS_END),a.endSuccess()}catch(e){var s=r("getErrorSafe")(e);throw a.endFail("runtime_error",{string:{error_message:s.message}}),e}}l.deleteBackupsOnClient=e}),98);
__d("LSDeleteBackups",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] Beginning execution."),r("justknobx")._("803")?t.sequence([function(r){return t.db.table(168).fetch([[[e[0]]]]).next().then(function(r,a){var i=r.done,l=r.value;return i?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] Row not found in client state table for the backupidDeleting the backup without deleting mailbox"),o[9]=new t.Map,o[9].set("backup_id",e[0]),o[9].set("trace_id",e[1]),o[9].set("backup_deletion_source",e[2]),o[10]=t.toJSON(o[9]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50011]),o[10],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[11]=t[0],t})):(a=l.item,t.sequence([function(r){return o[13]=a.deviceId,t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(e[0])).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),o[9]).then(function(e){var t;return t=e,o[10]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),a.ocmfClientStateBlob,o[10]).then(function(e){var t;return t=e,o[11]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[11]).then(function(e){var t;return t=e,o[12]=t[0],t})},function(r){return t.i64.neq(o[13],void 0)?(o[14]=new t.Map,o[14].set("device_id",o[13]),o[14].set("mailbox_partial_id",o[12]==null?"":o[12]),o[14].set("trace_id",e[1]),o[14].set("backup_deletion_source",e[2]),o[15]=t.toJSON(o[14]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50014]),o[15],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[16]=t[0],t})):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] device_id is null"),o[15]="device_id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] ","",o[15]].join("")),o[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupsStoredProcedure",o[15],o[14],t.i64.cast([0,3]))},function(r){return o[16]=new t.Map,o[16].set("backup_id",e[0]),o[16].set("trace_id",e[1]),o[16].set("backup_deletion_source",e[2]),o[17]=t.toJSON(o[16]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50011]),o[17],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[18]=t[0],t})}])}]))})},function(e){return o[1]=t.i64.cast([0,0])}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] backup deletion flow is not enabled"),o[1]=t.i64.cast([0,1])))},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupsStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsDeleteBackupsStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"];var s=e;l.default=s}),98);
__d("LSDeleteBackupsStoredProcedure",["LSDeleteBackups","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSDeleteBackups"),a.backupId,a.traceId,a.backupDeletionSource);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("encryptedBackupsDeleteBackupsStoredProcedure",["LSDeleteBackupsStoredProcedure","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSResult","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(async function(l){var s=r("LSResult")((e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE));if(l!=null){var u=l.backupId;u!=null&&(s=await t.runInTransaction(function(t){return r("LSDeleteBackupsStoredProcedure")(r("LSFactory")(t),{backupDeletionSource:(e||(e=o("LSIntEnum"))).ofNumber(n),backupId:u,traceId:a})},"readwrite",void 0,void 0,i.id+":37"))}return s})}l.default=s}),98);
__d("EBDeleteEncryptedBackup",["EBAPIQPLPoints","EBDeps","EBSMAPI","LSEncryptedBackupsOpStatus","LSIntEnum","WAResultOrError","WATagsLogger","encryptedBackupsDeleteBackupsStoredProcedure","getSafeQplErrorMessage","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["EB","EBAPIDeleteEncryptedBackup"]);async function c(t){var n=t.qplFlow,a=t.reason;n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_GET_DB_START);var i=await o("EBDeps").getDeps().getLSDB();return n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_GET_DB_END),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_START),new Promise(function(t,l){r("encryptedBackupsDeleteBackupsStoredProcedure")(i,a,n.getQPLAttrs().instanceKey.toString()).then(function(e){var a=e[0];if(a===(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_FAIL),n.endFail("delete_eb_sproc_fail"),t(o("WAResultOrError").makeError("DELETE_EB_SPROC_FAIL"));return}n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_SUCCESS);var l=i.tables.encrypted_backups.subscribe(function(e,a){if(a.operation==="put"){if(a.value.backupId==null)return n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_TASK_SUCCESS),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_START),r("promiseDone")(r("EBSMAPI").fetchBackupIds("EBDeleteEncryptedBackup"),function(){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_END),n.endSuccess()},function(){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_END),n.endFail("fetch_backup_ids_fail")}),t(o("WAResultOrError").makeResult()),l();n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_NON_DELETE_OPERATION)}else n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_NON_PUT_OPERATION)},void 0,["backupId"])}).catch(function(r){u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Exception while calling deleteBackups stored procedure: ",""])),r),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_ERROR,{string:{error:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(r)}}),n.endFail("delete_eb_sproc_error"),t(o("WAResultOrError").makeError("DELETE_EB_SPROC_ERROR"))})})}l.deleteEncryptedBackup=c}),98);
__d("EBFetchBackupIdsSharedFragmentQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25164225499885252"}),null);
__d("EBFetchBackupIdsSharedFragmentQuery.graphql",["EBFetchBackupIdsSharedFragmentQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EBFetchBackupIdsSharedFragmentQuery",selections:[{args:null,kind:"FragmentSpread",name:"EBFetchBackupIdsSharedFragment"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"EBFetchBackupIdsSharedFragmentQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},e],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[e],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},e],storageKey:null}]},params:{id:n("EBFetchBackupIdsSharedFragmentQuery_facebookRelayOperation"),metadata:{},name:"EBFetchBackupIdsSharedFragmentQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBFetchBackupIdsSharedFragment.graphql",["EBFetchBackupIdsSharedFragmentQuery.graphql"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:{refetch:{connection:null,fragmentPathInResult:[],operation:n("EBFetchBackupIdsSharedFragmentQuery.graphql")}},name:"EBFetchBackupIdsSharedFragment",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[e],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null}],storageKey:null}],type:"Query",abstractKey:null}})();a.exports=e}),null);
__d("EBFetchBackupIdsSharedQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25051902717827282"}),null);
__d("EBFetchBackupIdsSharedQuery.graphql",["EBFetchBackupIdsSharedQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EBFetchBackupIdsSharedQuery",selections:[{args:null,kind:"FragmentSpread",name:"EBFetchBackupIdsSharedFragment"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"EBFetchBackupIdsSharedQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},e],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[e],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},e],storageKey:null}]},params:{id:n("EBFetchBackupIdsSharedQuery_facebookRelayOperation"),metadata:{},name:"EBFetchBackupIdsSharedQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("LSEncryptedBackupsOnboardingDecision",[],(function(t,n,r,o,a,i){var e=Object.freeze({FAILURE:-1,NO_DECISION_MADE:0,BACKUP_CREATED:1,STORE_ON_DEVICE_ONLY:2});i.default=e}),66);
__d("LSEncryptedBackupsVirtualDeviceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({OFFLINE:1,HSM:2,BLOCK_STORE:3,KEYCHAIN:5,ICLOUD_KVS:6,GOOGLE_DRIVE:7,CLOUDKIT:8,ICLOUD_DRIVE:9,PASSKEY:10,ICLOUD_KEYCHAIN:11,GOOGLE_ONE_AUTO_BACKUP:12,SECURITY_QUESTION_HSM:13,TRUSTED_CONTACT:14,META_OWNED:15,AUTOMATIC_EB:16,META_PRELOADS:17});i.default=e}),66);
__d("EBFetchBackupIdsShared",["Base64Utils","EBDeps","EBFetchBackupIdsSharedFragment.graphql","EBFetchBackupIdsSharedQuery.graphql","FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOnboardingDecision","LSEncryptedBackupsVirtualDeviceType","LSIntEnum","LSShape","LSVec","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=r("requireDeferred")("mwEBUpdateBackupsTable").__setRef("EBFetchBackupIdsShared"),m=e!==void 0?e:e=n("EBFetchBackupIdsSharedFragment.graphql"),p=s!==void 0?s:s=n("EBFetchBackupIdsSharedQuery.graphql");function _(e){if(e!=null){var t=e,n=r("LSEncryptedBackupsOnboardingDecision")[t];return n}}function f(e){if(e!=null){var t=e,n=r("LSEncryptedBackupsBackupTenancy")[t];return(u||(u=o("LSIntEnum"))).ofNumber(n)}}function g(e){var t=e.xfb_backup,n=t==null?void 0:t.id;if(t!=null&&n!=null){var a,i,l=!1;(t==null?void 0:t.has_otc_eligible_devices)!=null?l=t==null?void 0:t.has_otc_eligible_devices:r("FBLogger")("wmi_eb").mustfix("failed to retrieve has_otc_eligible_devices. defaulting to false");var s=f(t.backup_tenancy),d=[o("LSShape").ofRecord(s!=null?{backup_id:(c||(c=o("I64"))).of_string(n),backup_tenancy:s}:{backup_id:(c||(c=o("I64"))).of_string(n)})],m=[];t.virtual_devices.forEach(function(e){var t,a,i=e==null?void 0:e.client_generated_id;if(n==null||i==null||(e==null?void 0:e.device_type)==null){r("FBLogger")("wmi_eb").warn("Invalid virtual device fetched in fetchBackupIdsGraphQL.");return}var l="REQUIRES_MIGRATION",s=(e==null?void 0:e.migration_status)===l,d=e==null?void 0:e.device_type,p=r("LSEncryptedBackupsVirtualDeviceType")[d];m.push(o("LSShape").ofRecord({backup_id:(c||(c=o("I64"))).of_string(n),virtual_device_ids:r("LSVec").ofArray([o("LSShape").ofRecord({virtual_device_id:o("Base64Utils").toArrayBuffer(i)})]),virtual_devices:r("LSVec").ofArray([o("LSShape").ofRecord({creation_time:(t=e==null?void 0:e.creation_time)!=null?t:void 0,device_created_on:(a=e==null?void 0:e.device_created_on)!=null?a:void 0,requires_hsm_migration:s,virtual_device_id:o("Base64Utils").toArrayBuffer(i),virtual_device_type:(u||(u=o("LSIntEnum"))).ofNumber(p)})])}))});var p=[];(a=t.devices)==null||a.edges.forEach(function(e){var t;(e==null||(t=e.node)==null?void 0:t.id)!=null&&p.push(o("LSShape").ofRecord({device_id:(c||(c=o("I64"))).of_string(e.node.id)}))});var g=t.encryption_management_delegator_id!=null?(c||(c=o("I64"))).of_string(t.encryption_management_delegator_id):void 0;return{backupIds:d,deviceIds:p,encryptionManagementDelegatorId:g,hasOtcEligibleDevices:l,isUserOptedOut:(i=t.is_user_opted_out)!=null?i:void 0,virtualDevices:m}}else{var h,y=_((h=e.xfb_eb_user_preferences)==null?void 0:h.onboarding_decision)===r("LSEncryptedBackupsOnboardingDecision").STORE_ON_DEVICE_ONLY;return{backupIds:[],deviceIds:[],hasOtcEligibleDevices:!1,isUserOptedOut:y,virtualDevices:[]}}}async function h(e){var t=e.storage,n=e.transformedData,o=await d.load();await o({backupIds:r("LSVec").ofArray(n.backupIds),deviceIds:r("LSVec").ofArray(n.deviceIds),encryptionManagementDelegatorId:n.encryptionManagementDelegatorId,hasOtcEligibleDevices:n.hasOtcEligibleDevices,isSuccess:!0,isUserOptedOut:n.isUserOptedOut,storage:t,virtualDevices:r("LSVec").ofArray(n.virtualDevices)})}async function y(e){var t=e.data,n=e.qplFlow;n.addPoint("eb_fetch_backup_ids_gql_transform_data_start");var r=g(t);n.addPoint("eb_fetch_backup_ids_gql_transform_data_end"),n.addPoint("eb_fetch_backup_ids_gql_update_table_start");var a=await o("EBDeps").getDeps().getLSDB();await h({storage:a,transformedData:r}),n.addPoint("eb_fetch_backup_ids_gql_update_table_end")}l.fetchBackupIdsRefetchableFragment=m,l.fetchBackupIdsQuery=p,l.onboardingDecisionTypeToEnum=_,l.backupTenancyTypeToEnum=f,l.transformBackupDataForLS=g,l.updateBackupsTableWithTransformedData=h,l.processBackupDataGraphQL=y}),98);
__d("EBFetchBackupIdsGraphQL",["EBCreateGraphQLFetchFnUnified","EBFetchBackupIdsShared","FBLogger","MWEBODSEntityName.enum","ODS","WARetryableError","err","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(e){var t=e.fetchQueryGraphQLFn,n=e.qplFlow;n.addPoint("eb_fetch_backup_ids_gql_query_start");var a=await t(o("EBFetchBackupIdsShared").fetchBackupIdsQuery,{});if(n.addPoint("eb_fetch_backup_ids_gql_query_end"),a==null)throw n.endFail("eb_fetch_backup_ids_gql_null_response"),r("err")("[wmi][ebapi] GraphQL response is null");await o("EBFetchBackupIdsShared").processBackupDataGraphQL({data:a,qplFlow:n}),n.addPoint("eb_fetch_backup_ids_gql_success"),n.endSuccess()}async function u(t,n){(e||(e=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MW_EBSM_FETCH_BACKUP_IDS,t+".graphql");var a=await o("EBCreateGraphQLFetchFnUnified").createGraphQlFetchFnUnified();return s({fetchQueryGraphQLFn:a,qplFlow:n}).catch(function(e){if(e instanceof r("WARetryableError"))return u(t,n);throw n.endFail("eb_fetch_backup_ids_gql_error",{string:{error:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}}),r("FBLogger")("wmi_eb").catching(e).mustfix("GraphQL fetch backup ids failed: %s",e.message),e})}l.fetchBackupIdsGraphQL=u}),98);
__d("EBFetchBackupIds",["EBDeps","EBFetchBackupIdsGraphQL","I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","MWEBODSEntityName.enum","ODS","err","gkx","justknobx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,n){(e||(e=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MW_EBSM_FETCH_BACKUP_IDS,t+".sproc"),n.addPoint("eb_fetch_backup_ids_get_storage_start");var a=await o("EBDeps").getDeps().getLSDB();return n.addPoint("eb_fetch_backup_ids_get_storage_ended"),new Promise(function(e,t){var i,l=a.tables.encrypted_backups.subscribe(function(t,a){if(a.operation==="delete"||!(s||(s=o("I64"))).equal(a.value.authorityLevel,(u||(u=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))){a.operation==="delete"?n.addPoint("eb_fetch_backup_ids_delete_detected"):n.addPoint("eb_fetch_backup_ids_authority_level_not_auth");return}l(),window.clearTimeout(i),n.addPoint("eb_fetch_backup_ids_success"),n.endSuccess(),e()});n.addPoint("eb_fetch_backup_ids_sproc_start"),r("promiseDone")(a.runInTransaction(function(e){return r("LSFetchBackupIdsStoredProcedure")(r("LSFactory")(e),{backupTenancy:(u||(u=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1}).then(function(){n.addPoint("eb_fetch_backup_ids_sproc_ended"),i=window.setTimeout(function(){n.endFail("eb_fetch_backup_ids_timeout"),t(r("err")("[wmi][ebapi] Timeout fetching backup ids"))},r("justknobx")._("3868"))})},"readwrite"))})}function d(e,t){return r("gkx")("15291")?o("EBFetchBackupIdsGraphQL").fetchBackupIdsGraphQL(e,t):c(e,t)}l.fetchBackupIds=d}),98);
__d("EBGenerateRecoveryCode",["Base64Utils","EBDeps","LSEncryptedBackupsOpStatus","LSFactory","LSGenerateRecoveryCodeStoredProcedure","LSIntEnum","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=await o("EBDeps").getDeps().getLSDB(),a=t.virtualDeviceType;return n.runInTransaction(function(e){return r("LSGenerateRecoveryCodeStoredProcedure")(r("LSFactory")(e),{virtualDeviceType:a})},"readwrite",void 0,void 0,i.id+":35").then(function(t){var n=t[0],a=t[1],i=t[2];return(e||(e=o("LSIntEnum"))).toNumber(a)!==r("LSEncryptedBackupsOpStatus").SUCCESS?o("WAResultOrError").makeError("sproc_failure"):o("WAResultOrError").makeResult({recoveryCode:n,virtualDeviceId:i!=null?o("Base64Utils").fromArrayBuffer(i):void 0})})}l.generateRecoveryCode=s}),98);
__d("EBGetEBStateQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="23909871918604871"}),null);
__d("EBGetEBStateQuery.graphql",["EBGetEBStateQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},t={alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null},e,{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},e,{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EBGetEBStateQuery",selections:[{kind:"RequiredField",field:t,action:"LOG",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"EBGetEBStateQuery",selections:[t]},params:{id:n("EBGetEBStateQuery_facebookRelayOperation"),metadata:{},name:"EBGetEBStateQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBGetEBState",["EBGetEBStateQuery.graphql","FBLogger","MAWOneTimeCodeGating","RelayHooks","WAResultOrError","XPlatRelayEnvironment","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e!==void 0?e:e=n("EBGetEBStateQuery.graphql");async function u(){try{var e,t,n,a,i,l,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k=await o("RelayHooks").fetchQuery(o("XPlatRelayEnvironment").getRelayEnvironment(),s,{}).toPromise().then(function(e){return e}),I=k==null||(e=k.viewer)==null?void 0:e.backup_state;if(I===1||I===0)return o("WAResultOrError").makeResult({backupStatus:I});var T=(t=k==null||(n=k.viewer)==null||(n=n.encrypted_backup)==null?void 0:n.virtual_devices)!=null?t:[],D=T.filter(function(e){return e.device_type==="HSM"}),x=T.filter(function(e){return e.device_type==="OFFLINE"});return o("WAResultOrError").makeResult({backupStatus:(k==null||(a=k.viewer)==null?void 0:a.backup_state)!=null?k.viewer.backup_state:0,ebState:{backupMetadata:{backupId:(i=k==null||(l=k.viewer)==null||(l=l.encrypted_backup)==null?void 0:l.id)!=null?i:"",creationTime:(u=k==null||(c=k.viewer)==null||(c=c.encrypted_backup)==null?void 0:c.backup_creation_time)!=null?u:0,deviceCreatedOn:(d=D[0].device_created_on)!=null?d:"",removalStatus:"",requiresHsmMigration:D[0].migration_status!=="DOES_NOT_REQUIRE_MIGRATION",virtualDeviceCreationTime:(m=(p=D[0])==null?void 0:p.creation_time)!=null?m:0,virtualDeviceId:(_=(f=D[0])==null?void 0:f.id)!=null?_:"",virtualDeviceType:(g=(h=D[0])==null?void 0:h.device_type)!=null?g:""},backupTenancy:(y=k==null||(C=k.viewer)==null||(C=C.encrypted_backup)==null?void 0:C.backup_tenancy)!=null?y:"PRODUCTION",hasOtcEligibleDevices:!!(o("MAWOneTimeCodeGating").isOneTimeCodeEnabled()&&(k==null||(b=k.viewer)==null||(b=b.encrypted_backup)==null?void 0:b.has_otc_eligible_devices)!==!1),hasSeenEbAutoRestoreNotice:(v=k==null||(S=k.viewer)==null||(S=S.encrypted_backup)==null?void 0:S.has_seen_eb_auto_restore_notice)!=null?v:!1,isPINCodeRegistered:((R=D[0])==null?void 0:R.id)!=null,isUserOptedOut:(L=k==null||(E=k.viewer)==null||(E=E.encrypted_backup)==null?void 0:E.is_user_opted_out)!=null?L:!1,offlineDevicesCount:x.length}})}catch(e){return r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Failed to check EB enabled"),o("WAResultOrError").makeResult({backupStatus:0})}}l.GetEbState=u}),98);
__d("LSCreateMinosEpochParams.nop",["EBMinosCheckWasmFeatureSupport","EBMinosQplFlow","FBLogger","MAWCurrentUser","WAResultOrError","cr:5968","cr:6443","err","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=n("cr:5968")||n("cr:6443"),u=async function(n,a,i,l,u,c,d){var t,m=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupport();if(s==null)throw r("err")("createMinosEpochParamsType error: gk is off but still called");if(!m)throw r("err")("createMinosEpochParamsType error: wasm is not supported");var p=o("EBMinosQplFlow").startMinosCreateEpochParamsQpl(),_=await s.createMinosEpochParamsType({epochAnonId:l,epochRootKeyBlob:i,previousEpochAnonId:c,previousEpochHead:d,previousEpochRootKeyBlob:u,qplFlow:p,rawUserFbid:o("MAWCurrentUser").getID()}).catch(function(t){var n=r("FBLogger")("minos"),a=r("getErrorSafe")(t);return n.catching(a).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["createMinosEpochParamsType runtime-error"]))),o("WAResultOrError").makeError({errorName:"runtime-error",failReason:a.message})});if(!_.success){var f;throw p.endFailWithError(_.error.errorName,_.error.failReason),r("err")("createMinosEpochParamsType error: "+_.error.errorName+" "+((f=_.error.failReason)!=null?f:""))}return p.endSuccess(),[_.value.mailboxEncryptionPk,_.value.mailboxSigningPk,_.value.mailboxAuthPk,_.value.epochHead,_.value.selfEpochSignature,(t=_.value.previousEpochSignature)!=null?t:void 0]};u.__nop_name__="LSCreateMinosEpochParamsType",l.default=u}),98);
__d("LSOcmfClientInit_v2.nop",["CryptoLogger","LSResult","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("ristretto255").__setRef("LSOcmfClientInit_v2.nop"),s=function(n,a){return e.load().then(function(e){return r("LSResult")(e.scalar.getRandom().buffer)}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("ocmf_client_init_v2"),e).mustfix("Failed to init OCMF client."),e})};s.__nop_name__="LSOcmfClientInit_v2",l.default=s}),98);
__d("LSRandom.nop",["CryptoLogger","I64","LSMaxInt32","LSResult","Promise","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(a,i,l){var t=o("CryptoLogger").CryptoLogger("ope_encrypt");if((s||(s=o("I64"))).gt(l,r("LSMaxInt32")))return t.mustfix("numBytes '"+String(l)+"' too large. Returning an empty array"),(e||(e=n("Promise"))).resolve(r("LSResult")(new Uint8Array(0).buffer));for(var u=(s||(s=o("I64"))).to_int32(l),c=new Uint8Array(u),d=65536,m=0;m<u;m+=d){var p=c.subarray(m,m+Math.min(u-m,d));o("XPlatReactCrypto").getRandomValues(p)}return(e||(e=n("Promise"))).resolve(r("LSResult")(c.buffer))};u.__nop_name__="LSRandom",l.default=u}),98);
__d("LSGenerateInitialDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientInit_v2.nop","LSOcmfClientMap.nop","LSRandom.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialDeviceSetupPayload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[33]=new t.Map,r[33].set("error_msg","Expected a nonempty query result"),r[33].set("code",t.i64.cast([0,3])),r[33].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[34]=t.createArray(),r[35]=(r[34].push(r[33]),r[34]),o=[void 0,r[34]],r[2]=o[0],r[3]=o[1]):(n=l.item,r[33]=new t.Map,r[33].set("backup_id",n.backupId),r[33].set("device_public_key_blob",n.devicePublicKeyBlob),r[33].set("device_private_key_blob",n.devicePrivateKeyBlob),r[33].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[33].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[33].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[33].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[33].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[33].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[33].set("orf_client_state_v2_blob",void 0),r[33].set("orf_v2_authority_level",void 0),r[33].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[33].set("device_id",n.deviceId),r[33].set("backup_tenancy",n.backupTenancy),r[33].set("encryption_version",n.encryptionVersion),r[33].set("revision_version",n.revisionVersion),r[33].set("initialize_restore_result",void 0),r[33].set("device_creation_timestamp_sec",void 0),r[33].set("authority_level",n.authorityLevel),a=[r[33],void 0],r[2]=a[0],r[3]=a[1])})},function(e){return r[5]=new t.Map,r[5].set("value",r[2]),r[5].set("errors",r[3]),r[6]=r[5].get("value"),r[6]!==void 0?t.sequence([function(e){return r[33]=r[6].get("backup_id"),r[34]=r[6].get("device_public_key_blob"),r[35]=r[6].get("device_private_key_blob"),r[36]=r[6].get("epoch_storage_public_key_blob"),r[37]=r[6].get("epoch_storage_private_key_blob"),r[38]=r[6].get("epoch_auth_public_key_blob"),r[39]=r[6].get("epoch_auth_private_key_blob"),r[40]=r[6].get("mailbox_root_key_blob"),r[41]=r[6].get("ocmf_client_state_blob"),r[42]=r[6].get("orf_client_state_v2_blob"),r[43]=r[6].get("orf_v2_authority_level"),r[44]=r[6].get("oblivious_validation_token_blob"),r[45]=r[6].get("device_id"),r[46]=r[6].get("backup_tenancy"),r[47]=r[6].get("encryption_version"),r[48]=r[6].get("revision_version"),r[49]=r[6].get("initialize_restore_result"),r[50]=r[6].get("device_creation_timestamp_sec"),r[51]=r[6].get("authority_level"),t.i64.neq(r[45],void 0)?t.sequence([function(e){return r[70]=void 0,t.i64.neq(r[70],void 0)?t.resolve(r[71]=r[70]):t.sequence([function(e){return r[74]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[75]=t[0],t})},function(e){return r[75]&&(r[84]=(r[74].push(t.i64.cast([0,0])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[76]=t[0],t})},function(e){return r[76]&&(r[84]=(r[74].push(t.i64.cast([0,2])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[77]=t[0],t})},function(e){return r[77]&&(r[84]=(r[74].push(t.i64.cast([0,3])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[78]=t[0],t})},function(e){return r[78]&&(r[84]=(r[74].push(t.i64.cast([0,4])),r[74])),r[79]=t.createArray(),r[80]=t.i64.of_int32(r[74].length),t.i64.gt(r[80],t.i64.cast([0,0]))?t.loopAsync(r[80],function(e){return r[84]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[74],r[84]).then(function(e){var t;return t=e,r[85]=t[0],r[86]=t[1],t})},function(e){return r[87]=(r[79].push(r[85]),r[79])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[84]=t.createArray(),r[85]=t.i64.of_int32(r[79].length),t.i64.gt(r[85],t.i64.cast([0,0]))?t.loopAsync(r[85],function(e){return r[87]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[79],r[87]).then(function(e){var t;return t=e,r[88]=t[0],r[89]=t[1],t})},function(e){return r[90]=(r[84].push(t.i64.to_string(r[88])),r[84])}])}):t.resolve()},function(e){return r[86]=r[84].join(","),r[81]=r[86]}])},function(e){return r[79].some(function(e){return t.i64.eq(r[47],e)})?r[82]=r[47]:r[82]=void 0,t.i64.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[71]=r[83]}])},function(e){var n;return t.i64.neq(r[71],void 0)?r[72]=r[71]:r[72]=t.i64.cast([0,0]),t.i64.neq(r[46],void 0)?r[73]=r[46]:r[73]=t.i64.cast([0,1]),n=[r[33],r[45],r[40],r[41],void 0,void 0,r[72],r[73],r[38],r[39],r[34],r[35],r[36],r[37],r[44],r[51],void 0,void 0],r[52]=n[0],r[53]=n[1],r[54]=n[2],r[55]=n[3],r[56]=n[4],r[57]=n[5],r[58]=n[6],r[59]=n[7],r[60]=n[8],r[61]=n[9],r[62]=n[10],r[63]=n[11],r[64]=n[12],r[65]=n[13],r[66]=n[14],r[67]=n[15],r[68]=n[16],r[69]=n[17]}]):t.sequence([function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(e){return r[70]=t.i64.random(),r[71]=t.i64.random(),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[72]=t[0],r[73]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[74]=t[0],r[75]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[76]=t[0],r[77]=t[1],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[78]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[79]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[80]=t[0],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[82]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]&&(r[109]=(r[82].push(t.i64.cast([0,0])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[84]=t[0],t})},function(e){return r[84]&&(r[109]=(r[82].push(t.i64.cast([0,2])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return r[85]&&(r[109]=(r[82].push(t.i64.cast([0,3])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]&&(r[109]=(r[82].push(t.i64.cast([0,4])),r[82])),r[87]=t.i64.of_int32(r[82].length),t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[82],t.i64.sub(r[87],t.i64.cast([0,1]))).then(function(e){var t;return t=e,r[88]=t[0],r[89]=t[1],t})},function(e){return t.forEach(t.filter(t.db.table(168).fetch([[[r[70]]]]),function(e){return t.i64.eq(e.backupId,r[70])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[70],deviceId:r[71],devicePublicKeyBlob:r[73],devicePrivateKeyBlob:r[72],epochStoragePublicKeyBlob:r[75],epochStoragePrivateKeyBlob:r[74],epochAuthPublicKeyBlob:r[77],epochAuthPrivateKeyBlob:r[76],mailboxRootKeyBlob:r[78],ocmfClientStateBlob:r[79],obliviousValidationTokenBlob:r[81],authorityLevel:t.i64.cast([0,20]),encryptionVersion:r[88],revisionVersion:t.i64.cast([0,1]),backupTenancy:t.i64.cast([0,1])})},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[90]=a[0],r[91]=a[1],r[92]=a[2],r[93]=a[3],r[94]=a[4],r[95]=a[5],r[96]=a[6],r[97]=a[7],r[98]=a[8],r[99]=a[9],r[100]=a[10],r[101]=a[11],r[102]=a[12],r[103]=a[13],r[104]=a[14],r[105]=a[15],r[106]=a[16],r[107]=a[17],a):(o=l.item,t.sequence([function(e){return r[114]=o.backupTenancy,r[113]=o.encryptionVersion,r[109]=void 0,t.i64.neq(r[109],void 0)?t.resolve(r[110]=r[109]):t.sequence([function(e){return r[115]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[116]=t[0],t})},function(e){return r[116]&&(r[125]=(r[115].push(t.i64.cast([0,0])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[117]=t[0],t})},function(e){return r[117]&&(r[125]=(r[115].push(t.i64.cast([0,2])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[118]=t[0],t})},function(e){return r[118]&&(r[125]=(r[115].push(t.i64.cast([0,3])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[119]=t[0],t})},function(e){return r[119]&&(r[125]=(r[115].push(t.i64.cast([0,4])),r[115])),r[120]=t.createArray(),r[121]=t.i64.of_int32(r[115].length),t.i64.gt(r[121],t.i64.cast([0,0]))?t.loopAsync(r[121],function(e){return r[125]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[115],r[125]).then(function(e){var t;return t=e,r[126]=t[0],r[127]=t[1],t})},function(e){return r[128]=(r[120].push(r[126]),r[120])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[125]=t.createArray(),r[126]=t.i64.of_int32(r[120].length),t.i64.gt(r[126],t.i64.cast([0,0]))?t.loopAsync(r[126],function(e){return r[128]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[120],r[128]).then(function(e){var t;return t=e,r[129]=t[0],r[130]=t[1],t})},function(e){return r[131]=(r[125].push(t.i64.to_string(r[129])),r[125])}])}):t.resolve()},function(e){return r[127]=r[125].join(","),r[122]=r[127]}])},function(e){return r[120].some(function(e){return t.i64.eq(r[113],e)})?r[123]=r[113]:r[123]=void 0,t.i64.neq(r[123],void 0)?r[124]=r[123]:r[124]=void 0,r[110]=r[124]}])},function(e){var n;return t.i64.neq(r[110],void 0)?r[111]=r[110]:r[111]=t.i64.cast([0,0]),t.i64.neq(r[114],void 0)?r[112]=r[114]:r[112]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[111],r[112],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[90]=n[0],r[91]=n[1],r[92]=n[2],r[93]=n[3],r[94]=n[4],r[95]=n[5],r[96]=n[6],r[97]=n[7],r[98]=n[8],r[99]=n[9],r[100]=n[10],r[101]=n[11],r[102]=n[12],r[103]=n[13],r[104]=n[14],r[105]=n[15],r[106]=n[16],r[107]=n[17]}]))})},function(e){var t;return t=[r[90],r[91],r[92],r[93],r[94],r[95],r[96],r[97],r[98],r[99],r[100],r[101],r[102],r[103],r[104],r[105],r[106],r[107]],r[52]=t[0],r[53]=t[1],r[54]=t[2],r[55]=t[3],r[56]=t[4],r[57]=t[5],r[58]=t[6],r[59]=t[7],r[60]=t[8],r[61]=t[9],r[62]=t[10],r[63]=t[11],r[64]=t[12],r[65]=t[13],r[66]=t[14],r[67]=t[15],r[68]=t[16],r[69]=t[17],t}])},function(e){var t;return t=[r[52],r[53],r[54],r[55],r[56],r[57],r[58],r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69]],r[7]=t[0],r[8]=t[1],r[9]=t[2],r[10]=t[3],r[11]=t[4],r[12]=t[5],r[13]=t[6],r[14]=t[7],r[15]=t[8],r[16]=t[9],r[17]=t[10],r[18]=t[11],r[19]=t[12],r[20]=t[13],r[21]=t[14],r[22]=t[15],r[23]=t[16],r[24]=t[17],t}]):t.sequence([function(e){return r[33]=r[5].get("errors"),r[34]=r[5].get("errors"),t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(e){return r[35]=t.i64.random(),r[36]=t.i64.random(),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[37]=t[0],r[38]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[39]=t[0],r[40]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return r[47]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[48]&&(r[74]=(r[47].push(t.i64.cast([0,0])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return r[49]&&(r[74]=(r[47].push(t.i64.cast([0,2])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return r[50]&&(r[74]=(r[47].push(t.i64.cast([0,3])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return r[51]&&(r[74]=(r[47].push(t.i64.cast([0,4])),r[47])),r[52]=t.i64.of_int32(r[47].length),t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[47],t.i64.sub(r[52],t.i64.cast([0,1]))).then(function(e){var t;return t=e,r[53]=t[0],r[54]=t[1],t})},function(e){return t.forEach(t.filter(t.db.table(168).fetch([[[r[35]]]]),function(e){return t.i64.eq(e.backupId,r[35])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[35],deviceId:r[36],devicePublicKeyBlob:r[38],devicePrivateKeyBlob:r[37],epochStoragePublicKeyBlob:r[40],epochStoragePrivateKeyBlob:r[39],epochAuthPublicKeyBlob:r[42],epochAuthPrivateKeyBlob:r[41],mailboxRootKeyBlob:r[43],ocmfClientStateBlob:r[44],obliviousValidationTokenBlob:r[46],authorityLevel:t.i64.cast([0,20]),encryptionVersion:r[53],revisionVersion:t.i64.cast([0,1]),backupTenancy:t.i64.cast([0,1])})},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[55]=a[0],r[56]=a[1],r[57]=a[2],r[58]=a[3],r[59]=a[4],r[60]=a[5],r[61]=a[6],r[62]=a[7],r[63]=a[8],r[64]=a[9],r[65]=a[10],r[66]=a[11],r[67]=a[12],r[68]=a[13],r[69]=a[14],r[70]=a[15],r[71]=a[16],r[72]=a[17],a):(o=l.item,t.sequence([function(e){return r[79]=o.backupTenancy,r[78]=o.encryptionVersion,r[74]=void 0,t.i64.neq(r[74],void 0)?t.resolve(r[75]=r[74]):t.sequence([function(e){return r[80]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[81]&&(r[90]=(r[80].push(t.i64.cast([0,0])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return r[82]&&(r[90]=(r[80].push(t.i64.cast([0,2])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]&&(r[90]=(r[80].push(t.i64.cast([0,3])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[84]=t[0],t})},function(e){return r[84]&&(r[90]=(r[80].push(t.i64.cast([0,4])),r[80])),r[85]=t.createArray(),r[86]=t.i64.of_int32(r[80].length),t.i64.gt(r[86],t.i64.cast([0,0]))?t.loopAsync(r[86],function(e){return r[90]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[80],r[90]).then(function(e){var t;return t=e,r[91]=t[0],r[92]=t[1],t})},function(e){return r[93]=(r[85].push(r[91]),r[85])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[90]=t.createArray(),r[91]=t.i64.of_int32(r[85].length),t.i64.gt(r[91],t.i64.cast([0,0]))?t.loopAsync(r[91],function(e){return r[93]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[85],r[93]).then(function(e){var t;return t=e,r[94]=t[0],r[95]=t[1],t})},function(e){return r[96]=(r[90].push(t.i64.to_string(r[94])),r[90])}])}):t.resolve()},function(e){return r[92]=r[90].join(","),r[87]=r[92]}])},function(e){return r[85].some(function(e){return t.i64.eq(r[78],e)})?r[88]=r[78]:r[88]=void 0,t.i64.neq(r[88],void 0)?r[89]=r[88]:r[89]=void 0,r[75]=r[89]}])},function(e){var n;return t.i64.neq(r[75],void 0)?r[76]=r[75]:r[76]=t.i64.cast([0,0]),t.i64.neq(r[79],void 0)?r[77]=r[79]:r[77]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[76],r[77],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[55]=n[0],r[56]=n[1],r[57]=n[2],r[58]=n[3],r[59]=n[4],r[60]=n[5],r[61]=n[6],r[62]=n[7],r[63]=n[8],r[64]=n[9],r[65]=n[10],r[66]=n[11],r[67]=n[12],r[68]=n[13],r[69]=n[14],r[70]=n[15],r[71]=n[16],r[72]=n[17]}]))})},function(e){var t;return t=[r[55],r[56],r[57],r[58],r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69],r[70],r[71],r[72]],r[7]=t[0],r[8]=t[1],r[9]=t[2],r[10]=t[3],r[11]=t[4],r[12]=t[5],r[13]=t[6],r[14]=t[7],r[15]=t[8],r[16]=t[9],r[17]=t[10],r[18]=t[11],r[19]=t[12],r[20]=t[13],r[21]=t[14],r[22]=t[15],r[23]=t[16],r[24]=t[17],t}])},function(o){var a;return t.i64.neq(r[7],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[18],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[17],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[19],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[15],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[10],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[9],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[18],t.blob("MA=="),r[19]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[18],t.blob("MQ=="),r[15]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(r[7])).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[47]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[10],r[48]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[49]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(n){var o;return r[51]=new t.Map,r[51].set("optimistic_backup_id",r[7]),r[51].set("device_private_key",r[18]),r[51].set("device_public_key",r[17]),r[51].set("epoch_storage_public_key",r[19]),r[51].set("epoch_storage_public_key_sig",r[45]==null?t.blob("bnVsbA=="):r[45]),r[51].set("epoch_auth_public_key",r[15]),r[51].set("epoch_auth_public_key_sig",r[46]==null?t.blob("bnVsbA=="):r[46]),r[51].set("ocmf_client_state",r[10]),r[51].set("mailbox_partial_id",r[50]==null?"":r[50]),r[51].set("mailbox_root_key",r[9]),r[51].set("device_registration_id",e[0]),r[51].set("orf_client_state_v2",void 0),o=[r[51],void 0],r[43]=o[0],r[44]=o[1]}]):t.resolve((r[45]=new t.Map,r[45].set("error_code",t.i64.cast([0,9])),r[45].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[45].set("error_message",""),a=[void 0,r[45]],r[43]=a[0],r[44]=a[1]))},function(e){var t;return t=[r[43],r[44]],r[41]=t[0],r[42]=t[1],t}]):t.resolve((r[43]=new t.Map,r[43].set("error_code",t.i64.cast([0,9])),r[43].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[43].set("error_message",""),a=[void 0,r[43]],r[41]=a[0],r[42]=a[1]))},function(e){var t;return t=[r[41],r[42]],r[39]=t[0],r[40]=t[1],t}]):t.resolve((r[41]=new t.Map,r[41].set("error_code",t.i64.cast([0,9])),r[41].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[41].set("error_message",""),a=[void 0,r[41]],r[39]=a[0],r[40]=a[1]))},function(e){var t;return t=[r[39],r[40]],r[37]=t[0],r[38]=t[1],t}]):t.resolve((r[39]=new t.Map,r[39].set("error_code",t.i64.cast([0,9])),r[39].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[39].set("error_message",""),a=[void 0,r[39]],r[37]=a[0],r[38]=a[1]))},function(e){var t;return t=[r[37],r[38]],r[35]=t[0],r[36]=t[1],t}]):t.resolve((r[37]=new t.Map,r[37].set("error_code",t.i64.cast([0,9])),r[37].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[37].set("error_message",""),a=[void 0,r[37]],r[35]=a[0],r[36]=a[1]))},function(e){var t;return t=[r[35],r[36]],r[33]=t[0],r[34]=t[1],t}]):t.resolve((r[35]=new t.Map,r[35].set("error_code",t.i64.cast([0,9])),r[35].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[35].set("error_message",""),a=[void 0,r[35]],r[33]=a[0],r[34]=a[1]))},function(e){var t;return t=[r[33],r[34]],r[25]=t[0],r[26]=t[1],t}]):t.resolve((r[33]=new t.Map,r[33].set("error_code",t.i64.cast([0,9])),r[33].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[33].set("error_message",""),a=[void 0,r[33]],r[25]=a[0],r[26]=a[1]))},function(e){return r[27]=t.i64.of_float(Date.now()),r[28]=t.i64.random(),r[30]="Finishing execution. Execution time: ",r[31]=t.i64.to_string(t.i64.sub(r[27],r[0])),r[32]=" ms",r[29]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialDeviceSetupPayload] ",r[29],r[30],r[29],r[31],r[29],r[32]].join("")),t.i64.eq(t.i64.mod_(r[28],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[33]=",",r[34]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialDeviceSetupPayload",[r[30],r[33],r[31],r[33],r[32]].join(""),r[34],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[25],r[26]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSCreateSymmetricEncryptionSecretKey.nop",["CryptoLogger","LSResult","Promise","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i){return(e||(e=n("Promise"))).resolve(r("LSResult")(o("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer)).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("create_symmetric_encryption_secret_key"),e).mustfix("Creation of symmetric encryption secret key failed"),e})};s.__nop_name__="LSCreateSymmetricEncryptionSecretKey",l.default=s}),98);
__d("LSGetNextEpochAnonId.nop",["CryptoLogger","LSCryptoUtils","LSResult","Promise","XPlatReactTextDecoder"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l){var t=o("LSCryptoUtils").strToBuf("0"),s;if(l!=null){var u=l;if(u.byteLength===0)s=t;else{var c=new(o("XPlatReactTextDecoder")).TextDecoder,d=c.decode(u),m=Number.parseInt(d,10),p=m+1;s=o("LSCryptoUtils").strToBuf(String(p))}}else s=t;return(e||(e=n("Promise"))).resolve(r("LSResult")(s)).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("get_next_epoch_anonid"),e).mustfix("Getting next epoch anon id failed"),e})};s.__nop_name__="LSGetNextEpochAnonId",l.default=s}),98);
__d("LSStoreEpoch",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.sequence([function(r){return n[1]="Storing newly derived epoch ",n[2]=t.blobs.to_string(e[2]),n[3]=" authority_level:",n[4]=t.i64.to_string(e[5]),n[5]=" status:",n[6]=t.i64.to_string(e[4]),n[0]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsStoreEpochStoredProcedure] ",n[0],n[1],n[0],n[2],n[0],n[3],n[0],n[4],n[0],n[5],n[0],n[6]].join("")),t.resolve()},function(n){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsStoreEpochStoredProcedure] Storing epoch in epochs table (regular execution)"),t.filter(t.db.table(169).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.epochId,e[0])&&t.i64.gt(n.authorityLevel,e[5])}).next().then(function(n){var r=n.done,o=n.value;return r?t.db.table(169).put({epochId:e[0],backupId:e[1],epochAnonIdBlob:e[2],epochRootKeyBlob:e[3],epochStatus:e[4],epochHead:e[7],authorityLevel:e[5]}):0})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSEncryptedBackupsStoreEpochStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSGenerateInitialEpochSetupPayload",["LSCreateMinosEpochParams.nop","LSCreateSymmetricEncryptionSecretKey.nop","LSGetNextEpochAnonId.nop","LSLogMebClientEvent.nop","LSStoreEpoch","gkx","qex"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialEpochSetupPayload] Beginning execution."),o[1]=t.i64.of_float(Date.now()),t.filter(t.db.table(169).fetch(),function(e){return t.i64.eq(e.epochStatus,t.i64.cast([0,1]))&&t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}).next().then(function(a,i){var l,s=a.done,u=a.value;return s?t.sequence([function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Generating new initial epoch."),t.nativeOperation(n("LSGetNextEpochAnonId.nop"),void 0).then(function(e){var t;return t=e,o[16]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSymmetricEncryptionSecretKey.nop")).then(function(e){var t;return t=e,o[17]=t[0],t})},function(e){return o[21]=(function(e){return e==null?void 0:e})(r("qex")._("201")),o[21]!==void 0?o[18]=o[21]:o[18]=!1,o[18]&&r("gkx")("16269")?t.sequence([function(e){return t.nativeOperation(n("LSCreateMinosEpochParams.nop"),o[17],o[16],void 0,void 0,void 0).then(function(e){var t;return t=e,o[22]=t[0],o[23]=t[1],o[24]=t[2],o[25]=t[3],o[26]=t[4],o[27]=t[5],t})},function(e){return o[19]=o[25]}]):t.resolve(o[19]=void 0)},function(r){return o[20]=t.i64.random(),t.storedProcedure(n("LSStoreEpoch"),o[20],e[0],o[16],o[17],t.i64.cast([0,1]),t.i64.cast([0,20]),!1,o[19])},function(e){var t;return t=[o[20],o[16],o[17],void 0,void 0,o[19]],o[2]=t[0],o[3]=t[1],o[4]=t[2],o[5]=t[3],o[6]=t[4],o[7]=t[5],t}]):(i=u.item,(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Using local optimistic initial epoch."),l=[i.epochId,i.epochAnonIdBlob,i.epochRootKeyBlob,void 0,void 0,i.epochHead],o[2]=l[0],o[3]=l[1],o[4]=l[2],o[5]=l[3],o[6]=l[4],o[7]=l[5])})},function(e){return o[9]=new t.Map,o[9].set("optimistic_epoch_id",o[2]),o[9].set("epoch_anon_id",o[3]),o[9].set("epoch_root_key",o[4]),o[10]=t.i64.of_float(Date.now()),o[11]=t.i64.random(),o[13]="Finishing execution. Execution time: ",o[14]=t.i64.to_string(t.i64.sub(o[10],o[0])),o[15]=" ms",o[12]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialEpochSetupPayload] ",o[12],o[13],o[12],o[14],o[12],o[15]].join("")),t.i64.eq(t.i64.mod_(o[11],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[16]=",",o[17]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialEpochSetupPayload",[o[13],o[16],o[14],o[16],o[15]].join(""),o[17],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[o[9],void 0],a[0]=t[0],a[1]=t[1],t}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSGetOpenEpochKeys",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSDeleteBackupOnClient","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Beginning execution."),r[11]="Querying latest epoch keys with authority level: ",e[0]?r[1]="OPTIMISTIC":r[1]="AUTHORITATIVE",r[2]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",r[2],r[11],r[2],r[1]].join("")),t.resolve()},function(o){return e[0]?r[3]="OPTIMISTIC":r[3]="AUTHORITATIVE",t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]?r[17]=!0:r[17]=!1,r[17]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[19]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[19],r[18],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]?r[17]=!0:r[17]=!1,r[17]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[19]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[19],r[18],t.i64.cast([0,3]))):t.resolve()}])},function(n){return r[4]=t.createArray(),t.forEach(t.filter(t.db.table(169).fetch(),function(n){return e[0]||t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))}),function(e){var n=e.item;return r[16]=(r[4].push(t.blobs.to_string(n.epochAnonIdBlob)),r[4])})},function(e){return r[5]=t.i64.of_int32(r[4].length),t.i64.gt(r[5],t.i64.cast([0,0]))?t.sequence([function(e){return r[16]=t.i64.of_int32(r[4].length),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return r[21]?r[22]=!0:r[22]=!1,r[22]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[24]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[24]].join("")),r[23]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[24],r[23],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[4],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[17]=t[0],r[18]=t[1],t})},function(e){return r[19]=r[17],r[20]=t.i64.of_int32(r[4].length),t.i64.gt(r[20],t.i64.cast([0,0]))?t.loopAsync(r[20],function(e){return r[21]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[4],r[21]).then(function(e){var t;return t=e,r[22]=t[0],r[23]=t[1],t})},function(e){return t.i64.eq([0,r[19].length],[0,r[22].length])?(r[19]===r[22]?r[25]=r[19]:(r[19]>r[22]?r[26]=r[19]:r[26]=r[22],r[25]=r[26]),r[24]=r[25]):(t.i64.gt([0,r[19].length],[0,r[22].length])?r[25]=r[19]:r[25]=r[22],r[24]=r[25]),r[19]=r[24]}])}):t.resolve()},function(e){return r[6]=r[19]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Epoch anon ID list is empty."),r[17]="Epoch anon ID list is empty.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",r[17]].join("")),r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",r[17],r[16],t.i64.cast([0,3]))},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]?r[19]=!0:r[19]=!1,r[19]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[21]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[21]].join("")),r[20]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[21],r[20],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[6]=void 0}])},function(e){return r[6]!==void 0?t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]?r[17]=!0:r[17]=!1,r[17]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[19]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[19],r[18],t.i64.cast([0,3]))):t.resolve()}]):t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]?r[17]=!0:r[17]=!1,r[17]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[19]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[19],r[18],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[12]=t.blobs.of_string(r[6]),t.blobs.neq(r[12],void 0)?t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]?r[19]=!0:r[19]=!1,r[19]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[21]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[21]].join("")),r[20]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[21],r[20],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.filter(t.db.table(169).fetch(),function(e){return t.blobs.eq(e.epochAnonIdBlob,r[12])}).next().then(function(e,o){var a=e.done,i=e.value;return a?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction."),r[19]="Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",r[19],r[18],t.i64.cast([0,3]))},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return r[20]?r[21]=!0:r[21]=!1,r[21]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[23]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[23]].join("")),r[22]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[23],r[22],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[16]=void 0}]):(o=i.item,t.sequence([function(e){return r[22]=o.epochAnonIdBlob,r[20]="Using latest epoch: ",r[21]=t.blobs.to_string(r[22]),r[18]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",r[18],r[20],r[18],r[21]].join("")),t.resolve()},function(e){return r[19]=new t.Map,r[19].set("epoch_id",o.epochId),r[19].set("epoch_root_key",o.epochRootKeyBlob),r[19].set("epoch_anon_id",r[22]),r[16]=r[19]}]))})},function(e){return r[7]=r[16]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client."),r[17]="No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",r[17]].join("")),r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",r[17],r[16],t.i64.cast([0,3]))},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]?r[19]=!0:r[19]=!1,r[19]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[21]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[21]].join("")),r[20]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[21],r[20],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),void 0,"get_open_epoch_keys",!0,void 0,"Attempted to fetch epoch keys when there are no epochs on the client.",!1)},function(e){return r[7]=void 0}])},function(e){return r[8]=t.i64.of_float(Date.now()),r[9]=t.i64.random(),r[13]="Finishing execution. Execution time: ",r[14]=t.i64.to_string(t.i64.sub(r[8],r[0])),r[15]=" ms",r[10]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",r[10],r[13],r[10],r[14],r[10],r[15]].join("")),t.i64.eq(t.i64.mod_(r[9],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[16]=",",r[17]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",[r[13],r[16],r[14],r[16],r[15]].join(""),r[17],t.i64.cast([0,4]))):t.resolve()},function(e){return o[0]=r[7]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSHandleCreateVirtualDeviceFailure",["LSAppendDataTraceAddon","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] Beginning execution."),t.sequence([function(r){return e[2]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[2],t.i64.cast([0,1412]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(o){return e[1]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] Failure when creating virtual device, deleting backup"),r[8]="Failure when creating virtual device, deleting backup",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ","",r[8]].join("")),r[7]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",r[8],r[7],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSDeleteBackupOnClient"),e[0],void 0,!1,e[2],void 0,!1)}]):t.sequence([function(o){return r[7]="Failure when creating virtual device",r[7]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ","",r[7]].join("")),r[8]=t.createArray(),e[2]!==void 0&&(r[9]=(r[8].push(e[2]),r[8])),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",r[7],r[8],t.i64.cast([0,3]))):t.resolve()},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,3])})}])},function(o){return t.sequence([function(r){return e[2]!==void 0?t.nativeOperation(n("LSFlushDataTrace.nop"),e[2]):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[1]=t.i64.of_float(Date.now()),r[2]=t.i64.random(),r[4]="Finishing execution. Execution time: ",r[5]=t.i64.to_string(t.i64.sub(r[1],r[0])),r[6]=" ms",r[3]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ",r[3],r[4],r[3],r[5],r[3],r[6]].join("")),t.i64.eq(t.i64.mod_(r[2],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[7]=",",r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",[r[4],r[7],r[5],r[7],r[6]].join(""),r[8],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",e.__tables__=["secure_encrypted_backups_recovery_code_status"],a.exports=e}),null);
__d("LSGenerateInitialVirtualDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSGetOpenEpochKeys","LSGetViewerFBID","LSHandleCreateVirtualDeviceFailure","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSParseRecoveryCode_v2.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),e[1]!==void 0?t.sequence([function(o){return r[10]=e[1].get("recovery_code"),r[11]=e[1].get("virtual_device_type"),r[12]=e[1].get("cloud_service_account"),r[13]=e[1].get("hsm_pin_normalization_status"),r[14]=e[1].get("security_question_type"),r[15]=e[1].get("trusted_contact_id"),r[16]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),r[10],t.i64.to_string(r[17]),r[16]).then(function(e){var t;return t=e,r[18]=t[0],r[19]=t[1],t})},function(o){return t.blobs.neq(r[19],void 0)?t.sequence([function(o){return t.blobs.neq(r[18],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!0).then(function(e){var t;return t=e,r[24]=t[0],t})},function(o){return r[24]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[34]=new t.Map,r[34].set("error_msg","Expected a nonempty query result"),r[34].set("code",t.i64.cast([0,3])),r[34].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[35]=t.createArray(),r[36]=(r[35].push(r[34]),r[35]),o=[void 0,r[35]],r[27]=o[0],r[28]=o[1]):(n=l.item,r[34]=new t.Map,r[34].set("backup_id",n.backupId),r[34].set("device_public_key_blob",n.devicePublicKeyBlob),r[34].set("device_private_key_blob",n.devicePrivateKeyBlob),r[34].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[34].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[34].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[34].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[34].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[34].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[34].set("orf_client_state_v2_blob",void 0),r[34].set("orf_v2_authority_level",void 0),r[34].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[34].set("device_id",n.deviceId),r[34].set("backup_tenancy",n.backupTenancy),r[34].set("encryption_version",n.encryptionVersion),r[34].set("revision_version",n.revisionVersion),r[34].set("initialize_restore_result",void 0),r[34].set("device_creation_timestamp_sec",void 0),r[34].set("authority_level",n.authorityLevel),a=[r[34],void 0],r[27]=a[0],r[28]=a[1])})},function(e){var o;return r[30]=new t.Map,r[30].set("value",r[27]),r[30].set("errors",r[28]),r[31]=r[30].get("value"),r[31]!==void 0?t.sequence([function(e){var o;return r[34]=r[31].get("backup_id"),r[35]=r[31].get("device_public_key_blob"),r[36]=r[31].get("device_private_key_blob"),r[37]=r[31].get("epoch_storage_public_key_blob"),r[38]=r[31].get("epoch_storage_private_key_blob"),r[39]=r[31].get("epoch_auth_public_key_blob"),r[40]=r[31].get("epoch_auth_private_key_blob"),r[41]=r[31].get("mailbox_root_key_blob"),r[42]=r[31].get("ocmf_client_state_blob"),r[43]=r[31].get("orf_client_state_v2_blob"),r[44]=r[31].get("orf_v2_authority_level"),r[45]=r[31].get("oblivious_validation_token_blob"),r[46]=r[31].get("device_id"),r[47]=r[31].get("backup_tenancy"),r[48]=r[31].get("encryption_version"),r[49]=r[31].get("revision_version"),r[50]=r[31].get("initialize_restore_result"),r[51]=r[31].get("device_creation_timestamp_sec"),r[52]=r[31].get("authority_level"),t.i64.neq(r[46],void 0)?t.sequence([function(e){return r[55]=void 0,t.i64.neq(r[55],void 0)?t.resolve(r[56]=r[55]):t.sequence([function(e){return r[107]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[108]=t[0],t})},function(e){return r[108]&&(r[117]=(r[107].push(t.i64.cast([0,0])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[109]&&(r[117]=(r[107].push(t.i64.cast([0,2])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[110]=t[0],t})},function(e){return r[110]&&(r[117]=(r[107].push(t.i64.cast([0,3])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[111]=t[0],t})},function(e){return r[111]&&(r[117]=(r[107].push(t.i64.cast([0,4])),r[107])),r[112]=t.createArray(),r[113]=t.i64.of_int32(r[107].length),t.i64.gt(r[113],t.i64.cast([0,0]))?t.loopAsync(r[113],function(e){return r[117]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[107],r[117]).then(function(e){var t;return t=e,r[118]=t[0],r[119]=t[1],t})},function(e){return r[120]=(r[112].push(r[118]),r[112])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[117]=t.createArray(),r[118]=t.i64.of_int32(r[112].length),t.i64.gt(r[118],t.i64.cast([0,0]))?t.loopAsync(r[118],function(e){return r[120]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[112],r[120]).then(function(e){var t;return t=e,r[121]=t[0],r[122]=t[1],t})},function(e){return r[123]=(r[117].push(t.i64.to_string(r[121])),r[117])}])}):t.resolve()},function(e){return r[119]=r[117].join(","),r[114]=r[119]}])},function(e){return r[112].some(function(e){return t.i64.eq(r[48],e)})?r[115]=r[48]:r[115]=void 0,t.i64.neq(r[115],void 0)?r[116]=r[115]:r[116]=void 0,r[56]=r[116]}])},function(e){return t.i64.neq(r[56],void 0)?r[57]=r[56]:r[57]=t.i64.cast([0,0]),t.i64.neq(r[47],void 0)?r[58]=r[47]:r[58]=t.i64.cast([0,1]),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[59]=t[0],r[60]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[61]=t[0],r[62]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[59],t.blob("MA=="),r[62]).then(function(e){var t;return t=e,r[63]=t[0],t})},function(e){return r[64]=r[24].get("epoch_anon_id"),r[65]=r[24].get("epoch_root_key"),r[66]=t.createArray(),r[107]=(r[66].push(t.i64.cast([0,32])),r[66]),t.nativeOperation(n("LSBase64Encode.nop"),r[64]).then(function(e){var t;return t=e,r[67]=t[0],t})},function(e){return r[67]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[67]].join("")),void 0,r[65],r[66]).then(function(e){var t;return t=e,r[107]=t[0],t})},function(e){return r[107]?r[108]=!1:r[108]=!0,r[108]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[111]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[111]].join("")),r[110]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[111],r[110],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[112]=t[0],t})},function(e){return r[109]=r[112]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[107],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[110]=t[0],r[111]=t[1],t})},function(e){return r[109]=r[110]}])},function(e){return r[68]=r[109]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[108]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[68]=r[109]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[68],r[60]).then(function(e){var t;return t=e,r[69]=t[0],t})},function(e){return t.blobs.neq(r[69],void 0)?t.resolve(r[70]=r[69]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] device_epoch_hmac is null!"),r[108]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[70]=r[109]}])},function(e){return r[71]=r[24].get("epoch_root_key"),r[72]=t.createArray(),r[107]=(r[72].push(t.i64.cast([0,18])),r[72]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[71],r[72]).then(function(e){var t;return t=e,r[73]=t[0],t})},function(e){return r[73]!==void 0?t.sequence([function(e){return r[107]=t.i64.of_int32(r[73].length),t.i64.ge(r[107],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[73],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[109]=t[0],r[110]=t[1],t})},function(e){return r[108]=r[109]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[110]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[110]].join("")),r[109]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[110],r[109],t.i64.cast([0,3]))},function(e){return r[108]=void 0}])},function(e){return r[74]=r[108]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[108]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[108],r[107],t.i64.cast([0,3]))},function(e){return r[74]=void 0}])},function(e){return t.blobs.neq(r[74],void 0)?r[75]=!0:r[75]=!1,r[75]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[42]).then(function(e){var t;return t=e,r[76]=t[0],r[77]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[107]=t[0],r[108]=t[1],t})},function(e){var t;return t=[r[76],r[77],r[107],r[108]],r[78]=t[0],r[79]=t[1],r[80]=t[2],r[81]=t[3],t}]):t.resolve((o=[r[76],r[77],void 0,void 0],r[78]=o[0],r[79]=o[1],r[80]=o[2],r[81]=o[3],o))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[59]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),r[82]==null?"":r[82]).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]!==void 0?r[84]=r[83]:r[84]="",r[84]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_device_private_key is empty!"),r[108]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[61]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),r[85]==null?"":r[85]).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]!==void 0?r[87]=r[86]:r[87]="",r[87]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_storage_private_key is empty!"),r[108]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[78]).then(function(e){var t;return t=e,r[88]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),r[88]==null?"":r[88]).then(function(e){var t;return t=e,r[89]=t[0],t})},function(e){return r[89]!==void 0?r[90]=r[89]:r[90]="",r[90]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),r[108]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[91]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),r[91]==null?"":r[91]).then(function(e){var t;return t=e,r[92]=t[0],t})},function(e){return r[92]!==void 0?r[93]=r[92]:r[93]="",r[93]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_oblivious_validation_token is empty!"),r[108]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[94]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),r[94]==null?"":r[94]).then(function(e){var t;return t=e,r[95]=t[0],t})},function(e){return r[95]!==void 0?r[96]=r[95]:r[96]="",r[96]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_mailbox_root_key is empty!"),r[108]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return r[97]=r[24].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[97]).then(function(e){var t;return t=e,r[98]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),r[98]==null?"":r[98]).then(function(e){var t;return t=e,r[99]=t[0],t})},function(e){return r[99]!==void 0?r[100]=r[99]:r[100]="",r[100]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_anon_id is empty!"),r[108]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return r[101]=r[24].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[101]).then(function(e){var t;return t=e,r[102]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),r[102]==null?"":r[102]).then(function(e){var t;return t=e,r[103]=t[0],t})},function(e){return r[103]!==void 0?r[104]=r[103]:r[104]="",r[104]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_root_key is empty!"),r[108]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){var n;return r[105]=new t.Map,r[105].set("encrypted_device_private_key",r[84]),r[105].set("encrypted_epoch_storage_private_key",r[87]),r[105].set("encrypted_ocmf_client_state",r[90]),r[105].set("encrypted_orf_client_state_v2",void 0),r[105].set("encrypted_oblivious_validation_token_blob",r[93]),r[105].set("encrypted_mailbox_root_key_blob",r[96]),r[105].set("encrypted_epoch_anon_id",r[100]),r[105].set("encrypted_epoch_root_key",r[104]),r[106]=new t.Map,r[106].set("virtual_device_public_key",r[60]),r[106].set("virtual_device_id",r[18]),r[106].set("virtual_device_epoch_storage_public_key",r[62]),r[106].set("virtual_device_epoch_storage_public_key_sig",r[63]==null?t.blob("bnVsbA=="):r[63]),r[106].set("device_epoch_hmac",r[70]),r[106].set("epoch_root_key_fingerprint",r[74]),r[106].set("virtual_device_type",r[11]),r[106].set("action_type",t.i64.cast([0,1])),r[106].set("ocmf_rotation_token",r[79]),r[106].set("encrypted_secret_values_payload",r[105]),r[106].set("cloud_service_account",r[12]),r[106].set("hsm_pin_normalization_status",r[13]),r[106].set("security_question_type",r[14]),r[106].set("trusted_contact_id",r[15]),n=[r[106],void 0],r[53]=n[0],r[54]=n[1]}]):t.resolve((r[55]=new t.Map,r[55].set("error_code",t.i64.cast([0,9])),r[55].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[55].set("error_message",""),o=[void 0,r[55]],r[53]=o[0],r[54]=o[1]))},function(e){var t;return t=[r[53],r[54]],r[32]=t[0],r[33]=t[1],t}]):t.resolve((r[34]=r[30].get("errors"),r[35]=r[30].get("errors"),r[36]=new t.Map,r[36].set("error_code",t.i64.cast([0,9])),r[36].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[36].set("error_message",""),o=[void 0,r[36]],r[32]=o[0],r[33]=o[1]))},function(e){var t;return t=[r[32],r[33]],r[25]=t[0],r[26]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Epoch keys are unavailable."),r[28]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[28]].join("")),r[27]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[28],r[27],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[29]=new t.Map,r[29].set("error_code",t.i64.cast([0,11])),r[29].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[29].set("error_message",""),n=[void 0,r[29]],r[25]=n[0],r[26]=n[1]}])},function(e){var t;return t=[r[25],r[26]],r[22]=t[0],r[23]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[25]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[25]].join("")),r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[25],r[24],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,10])),r[26].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[26].set("error_message",""),n=[void 0,r[26]],r[22]=n[0],r[23]=n[1]}])},function(e){var t;return t=[r[22],r[23]],r[20]=t[0],r[21]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[23]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[23]].join("")),r[22]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[23],r[22],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,10])),r[24].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[24].set("error_message",""),n=[void 0,r[24]],r[20]=n[0],r[21]=n[1]}])},function(e){var t;return t=[r[20],r[21]],r[2]=t[0],r[3]=t[1],t}]):t.sequence([function(o){return t.db.table(174).fetch([[[t.i64.cast([0,1])]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] No recovery code found in recovery code table"),r[14]="No recovery code found in recovery code table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[14]].join("")),r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[14],r[13],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[15]=new t.Map,r[15].set("error_code",t.i64.cast([0,501])),r[15].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[15].set("error_message",""),n=[void 0,r[15]],r[10]=n[0],r[11]=n[1]}]):(a=l.item,t.sequence([function(e){return r[13]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),a.recoveryCode,t.i64.to_string(r[14]),r[13]).then(function(e){var t;return t=e,r[15]=t[0],r[16]=t[1],t})},function(o){return t.blobs.neq(r[16],void 0)?t.sequence([function(o){return t.blobs.neq(r[15],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!0).then(function(e){var t;return t=e,r[21]=t[0],t})},function(o){return r[21]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[31]=new t.Map,r[31].set("error_msg","Expected a nonempty query result"),r[31].set("code",t.i64.cast([0,3])),r[31].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[32]=t.createArray(),r[33]=(r[32].push(r[31]),r[32]),o=[void 0,r[32]],r[24]=o[0],r[25]=o[1]):(n=l.item,r[31]=new t.Map,r[31].set("backup_id",n.backupId),r[31].set("device_public_key_blob",n.devicePublicKeyBlob),r[31].set("device_private_key_blob",n.devicePrivateKeyBlob),r[31].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[31].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[31].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[31].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[31].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[31].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[31].set("orf_client_state_v2_blob",void 0),r[31].set("orf_v2_authority_level",void 0),r[31].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[31].set("device_id",n.deviceId),r[31].set("backup_tenancy",n.backupTenancy),r[31].set("encryption_version",n.encryptionVersion),r[31].set("revision_version",n.revisionVersion),r[31].set("initialize_restore_result",void 0),r[31].set("device_creation_timestamp_sec",void 0),r[31].set("authority_level",n.authorityLevel),a=[r[31],void 0],r[24]=a[0],r[25]=a[1])})},function(e){var o;return r[27]=new t.Map,r[27].set("value",r[24]),r[27].set("errors",r[25]),r[28]=r[27].get("value"),r[28]!==void 0?t.sequence([function(e){var o;return r[31]=r[28].get("backup_id"),r[32]=r[28].get("device_public_key_blob"),r[33]=r[28].get("device_private_key_blob"),r[34]=r[28].get("epoch_storage_public_key_blob"),r[35]=r[28].get("epoch_storage_private_key_blob"),r[36]=r[28].get("epoch_auth_public_key_blob"),r[37]=r[28].get("epoch_auth_private_key_blob"),r[38]=r[28].get("mailbox_root_key_blob"),r[39]=r[28].get("ocmf_client_state_blob"),r[40]=r[28].get("orf_client_state_v2_blob"),r[41]=r[28].get("orf_v2_authority_level"),r[42]=r[28].get("oblivious_validation_token_blob"),r[43]=r[28].get("device_id"),r[44]=r[28].get("backup_tenancy"),r[45]=r[28].get("encryption_version"),r[46]=r[28].get("revision_version"),r[47]=r[28].get("initialize_restore_result"),r[48]=r[28].get("device_creation_timestamp_sec"),r[49]=r[28].get("authority_level"),t.i64.neq(r[43],void 0)?t.sequence([function(e){return r[52]=void 0,t.i64.neq(r[52],void 0)?t.resolve(r[53]=r[52]):t.sequence([function(e){return r[104]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[105]=t[0],t})},function(e){return r[105]&&(r[114]=(r[104].push(t.i64.cast([0,0])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[106]&&(r[114]=(r[104].push(t.i64.cast([0,2])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[107]=t[0],t})},function(e){return r[107]&&(r[114]=(r[104].push(t.i64.cast([0,3])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[108]=t[0],t})},function(e){return r[108]&&(r[114]=(r[104].push(t.i64.cast([0,4])),r[104])),r[109]=t.createArray(),r[110]=t.i64.of_int32(r[104].length),t.i64.gt(r[110],t.i64.cast([0,0]))?t.loopAsync(r[110],function(e){return r[114]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[104],r[114]).then(function(e){var t;return t=e,r[115]=t[0],r[116]=t[1],t})},function(e){return r[117]=(r[109].push(r[115]),r[109])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[114]=t.createArray(),r[115]=t.i64.of_int32(r[109].length),t.i64.gt(r[115],t.i64.cast([0,0]))?t.loopAsync(r[115],function(e){return r[117]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[109],r[117]).then(function(e){var t;return t=e,r[118]=t[0],r[119]=t[1],t})},function(e){return r[120]=(r[114].push(t.i64.to_string(r[118])),r[114])}])}):t.resolve()},function(e){return r[116]=r[114].join(","),r[111]=r[116]}])},function(e){return r[109].some(function(e){return t.i64.eq(r[45],e)})?r[112]=r[45]:r[112]=void 0,t.i64.neq(r[112],void 0)?r[113]=r[112]:r[113]=void 0,r[53]=r[113]}])},function(e){return t.i64.neq(r[53],void 0)?r[54]=r[53]:r[54]=t.i64.cast([0,0]),t.i64.neq(r[44],void 0)?r[55]=r[44]:r[55]=t.i64.cast([0,1]),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[56]=t[0],r[57]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[58]=t[0],r[59]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[56],t.blob("MA=="),r[59]).then(function(e){var t;return t=e,r[60]=t[0],t})},function(e){return r[61]=r[21].get("epoch_anon_id"),r[62]=r[21].get("epoch_root_key"),r[63]=t.createArray(),r[104]=(r[63].push(t.i64.cast([0,32])),r[63]),t.nativeOperation(n("LSBase64Encode.nop"),r[61]).then(function(e){var t;return t=e,r[64]=t[0],t})},function(e){return r[64]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[64]].join("")),void 0,r[62],r[63]).then(function(e){var t;return t=e,r[104]=t[0],t})},function(e){return r[104]?r[105]=!1:r[105]=!0,r[105]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[108]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[106]=r[109]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[104],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[107]=t[0],r[108]=t[1],t})},function(e){return r[106]=r[107]}])},function(e){return r[65]=r[106]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[105]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[105],r[104],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[65]=r[106]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[65],r[57]).then(function(e){var t;return t=e,r[66]=t[0],t})},function(e){return t.blobs.neq(r[66],void 0)?t.resolve(r[67]=r[66]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] device_epoch_hmac is null!"),r[105]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[67]=r[106]}])},function(e){return r[68]=r[21].get("epoch_root_key"),r[69]=t.createArray(),r[104]=(r[69].push(t.i64.cast([0,18])),r[69]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[68],r[69]).then(function(e){var t;return t=e,r[70]=t[0],t})},function(e){return r[70]!==void 0?t.sequence([function(e){return r[104]=t.i64.of_int32(r[70].length),t.i64.ge(r[104],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[70],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[106]=t[0],r[107]=t[1],t})},function(e){return r[105]=r[106]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[107]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[107]].join("")),r[106]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[107],r[106],t.i64.cast([0,3]))},function(e){return r[105]=void 0}])},function(e){return r[71]=r[105]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[105]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[105],r[104],t.i64.cast([0,3]))},function(e){return r[71]=void 0}])},function(e){return t.blobs.neq(r[71],void 0)?r[72]=!0:r[72]=!1,r[72]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[39]).then(function(e){var t;return t=e,r[73]=t[0],r[74]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[104]=t[0],r[105]=t[1],t})},function(e){var t;return t=[r[73],r[74],r[104],r[105]],r[75]=t[0],r[76]=t[1],r[77]=t[2],r[78]=t[3],t}]):t.resolve((o=[r[73],r[74],void 0,void 0],r[75]=o[0],r[76]=o[1],r[77]=o[2],r[78]=o[3],o))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[79]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),r[79]==null?"":r[79]).then(function(e){var t;return t=e,r[80]=t[0],t})},function(e){return r[80]!==void 0?r[81]=r[80]:r[81]="",r[81]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_device_private_key is empty!"),r[105]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[58]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),r[82]==null?"":r[82]).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]!==void 0?r[84]=r[83]:r[84]="",r[84]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_storage_private_key is empty!"),r[105]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[75]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),r[85]==null?"":r[85]).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]!==void 0?r[87]=r[86]:r[87]="",r[87]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),r[105]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[42]).then(function(e){var t;return t=e,r[88]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),r[88]==null?"":r[88]).then(function(e){var t;return t=e,r[89]=t[0],t})},function(e){return r[89]!==void 0?r[90]=r[89]:r[90]="",r[90]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_oblivious_validation_token is empty!"),r[105]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[38]).then(function(e){var t;return t=e,r[91]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),r[91]==null?"":r[91]).then(function(e){var t;return t=e,r[92]=t[0],t})},function(e){return r[92]!==void 0?r[93]=r[92]:r[93]="",r[93]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_mailbox_root_key is empty!"),r[105]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return r[94]=r[21].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[94]).then(function(e){var t;return t=e,r[95]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),r[95]==null?"":r[95]).then(function(e){var t;return t=e,r[96]=t[0],t})},function(e){return r[96]!==void 0?r[97]=r[96]:r[97]="",r[97]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_anon_id is empty!"),r[105]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return r[98]=r[21].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[98]).then(function(e){var t;return t=e,r[99]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),r[99]==null?"":r[99]).then(function(e){var t;return t=e,r[100]=t[0],t})},function(e){return r[100]!==void 0?r[101]=r[100]:r[101]="",r[101]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_root_key is empty!"),r[105]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){var n;return r[102]=new t.Map,r[102].set("encrypted_device_private_key",r[81]),r[102].set("encrypted_epoch_storage_private_key",r[84]),r[102].set("encrypted_ocmf_client_state",r[87]),r[102].set("encrypted_orf_client_state_v2",void 0),r[102].set("encrypted_oblivious_validation_token_blob",r[90]),r[102].set("encrypted_mailbox_root_key_blob",r[93]),r[102].set("encrypted_epoch_anon_id",r[97]),r[102].set("encrypted_epoch_root_key",r[101]),r[103]=new t.Map,r[103].set("virtual_device_public_key",r[57]),r[103].set("virtual_device_id",r[15]),r[103].set("virtual_device_epoch_storage_public_key",r[59]),r[103].set("virtual_device_epoch_storage_public_key_sig",r[60]==null?t.blob("bnVsbA=="):r[60]),r[103].set("device_epoch_hmac",r[67]),r[103].set("epoch_root_key_fingerprint",r[71]),r[103].set("virtual_device_type",a.virtualDeviceType),r[103].set("action_type",t.i64.cast([0,1])),r[103].set("ocmf_rotation_token",r[76]),r[103].set("encrypted_secret_values_payload",r[102]),r[103].set("cloud_service_account",a.cloudServiceAccount),r[103].set("hsm_pin_normalization_status",a.hsmPinNormalizationStatus),r[103].set("security_question_type",void 0),r[103].set("trusted_contact_id",void 0),n=[r[103],void 0],r[50]=n[0],r[51]=n[1]}]):t.resolve((r[52]=new t.Map,r[52].set("error_code",t.i64.cast([0,9])),r[52].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[52].set("error_message",""),o=[void 0,r[52]],r[50]=o[0],r[51]=o[1]))},function(e){var t;return t=[r[50],r[51]],r[29]=t[0],r[30]=t[1],t}]):t.resolve((r[31]=r[27].get("errors"),r[32]=r[27].get("errors"),r[33]=new t.Map,r[33].set("error_code",t.i64.cast([0,9])),r[33].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[33].set("error_message",""),o=[void 0,r[33]],r[29]=o[0],r[30]=o[1]))},function(e){var t;return t=[r[29],r[30]],r[22]=t[0],r[23]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Epoch keys are unavailable."),r[25]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[25]].join("")),r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[25],r[24],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,11])),r[26].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[26].set("error_message",""),n=[void 0,r[26]],r[22]=n[0],r[23]=n[1]}])},function(e){var t;return t=[r[22],r[23]],r[19]=t[0],r[20]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[22]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[22]].join("")),r[21]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[22],r[21],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[23]=new t.Map,r[23].set("error_code",t.i64.cast([0,10])),r[23].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[23].set("error_message",""),n=[void 0,r[23]],r[19]=n[0],r[20]=n[1]}])},function(e){var t;return t=[r[19],r[20]],r[17]=t[0],r[18]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[20]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[20]].join("")),r[19]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[20],r[19],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[21]=new t.Map,r[21].set("error_code",t.i64.cast([0,10])),r[21].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[21].set("error_message",""),n=[void 0,r[21]],r[17]=n[0],r[18]=n[1]}])},function(e){var t;return t=[r[17],r[18]],r[10]=t[0],r[11]=t[1],t}]))})},function(e){var t;return t=[r[10],r[11]],r[2]=t[0],r[3]=t[1],t}])},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialVirtualDeviceSetupPayload",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_generated_recovery_code"],a.exports=e}),null);
__d("LSInitializeBackupV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateMinosEpochParams.nop","LSCreateSignature_v2.nop","LSGenerateInitialDeviceSetupPayload","LSGenerateInitialEpochSetupPayload","LSGenerateInitialVirtualDeviceSetupPayload","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","gkx","qex"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][initializeBackupV2] Beginning execution."),o[1]=t.i64.of_float(Date.now()),t.storedProcedure(n("LSGenerateInitialDeviceSetupPayload"),e[0]).then(function(e){var t;return t=e,o[2]=t[0],o[3]=t[1],t})},function(r){var a,i,l;return o[2]!==void 0?t.sequence([function(e){return o[15]=o[2].get("device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[15]).then(function(e){var t;return t=e,o[16]=t[0],t})},function(e){return o[17]=o[2].get("epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[17]).then(function(e){var t;return t=e,o[18]=t[0],t})},function(e){return o[19]=o[2].get("epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[19]).then(function(e){var t;return t=e,o[20]=t[0],t})},function(e){return o[21]=o[2].get("epoch_auth_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[21]).then(function(e){var t;return t=e,o[22]=t[0],t})},function(e){return o[23]=o[2].get("epoch_auth_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[23]).then(function(e){var t;return t=e,o[24]=t[0],t})},function(e){return o[25]=o[2].get("ocmf_client_state"),t.nativeOperation(n("LSBase64Encode.nop"),o[25]).then(function(e){var t;return t=e,o[26]=t[0],t})},function(e){return o[27]=o[2].get("mailbox_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[27]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(e){return o[29]=o[2].get("device_private_key"),o[30]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[31]=t[0],t})},function(e){return o[31]&&(o[44]=(o[30].push(t.i64.cast([0,0])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[32]=t[0],t})},function(e){return o[32]&&(o[44]=(o[30].push(t.i64.cast([0,2])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[33]=t[0],t})},function(e){return o[33]&&(o[44]=(o[30].push(t.i64.cast([0,3])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[34]=t[0],t})},function(e){return o[34]&&(o[44]=(o[30].push(t.i64.cast([0,4])),o[30])),o[35]="",o[36]=t.i64.of_int32(o[30].length),t.i64.gt(o[36],t.i64.cast([0,0]))?t.loopAsync(o[36],function(e){return o[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[30],o[44]).then(function(e){var t;return t=e,o[45]=t[0],o[46]=t[1],t})},function(e){return o[35]=[o[35],"_",t.i64.to_string(o[45])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",o[35],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[29],t.blob("Mg=="),o[37]).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return t.blobs.neq(o[38],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return o[39]=o[44]}]):t.resolve(o[39]=void 0)},function(n){var r;return o[40]=o[2].get("optimistic_backup_id"),o[41]=o[2].get("mailbox_partial_id"),o[42]=new t.Map,o[42].set("supported_encryption_versions",o[30]),o[42].set("client_version",t.i64.cast([0,1])),o[42].set("version_sig",o[39]==null?"":o[39]),o[43]=new t.Map,o[43].set("device_public_key",o[16]==null?"":o[16]),o[43].set("epoch_storage_public_key",o[18]==null?"":o[18]),o[43].set("epoch_storage_public_key_sig",o[20]==null?"":o[20]),o[43].set("epoch_auth_public_key",o[22]==null?"":o[22]),o[43].set("epoch_auth_public_key_sig",o[24]==null?"":o[24]),o[43].set("device_registration_id",e[0]),o[43].set("ocmf_client_state",o[26]==null?"":o[26]),o[43].set("mailbox_partial_id",o[41]),o[43].set("mailbox_root_key",o[28]==null?"":o[28]),o[43].set("encryption_version_data",o[42]),r=[o[43],o[40],!0,t.i64.cast([0,0])],o[4]=r[0],o[5]=r[1],o[6]=r[2],o[7]=r[3]}]):t.resolve((o[3]!==void 0?(o[19]=o[3].get("error_code"),a=[void 0,t.i64.cast([-1,4294967295]),!1,o[19]],o[15]=a[0],o[16]=a[1],o[17]=a[2],o[18]=a[3]):(i=[void 0,t.i64.cast([-1,4294967295]),!1,t.i64.cast([0,12])],o[15]=i[0],o[16]=i[1],o[17]=i[2],o[18]=i[3]),l=[o[15],o[16],o[17],o[18]],o[4]=l[0],o[5]=l[1],o[6]=l[2],o[7]=l[3]))},function(a){return o[6]?t.sequence([function(a){return o[4]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var r,a,i=e.done,l=e.value;return i?(o[25]=new t.Map,o[25].set("error_msg","Expected a nonempty query result"),o[25].set("code",t.i64.cast([0,3])),o[25].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),o[26]=t.createArray(),o[27]=(o[26].push(o[25]),o[26]),r=[void 0,o[26]],o[16]=r[0],o[17]=r[1]):(n=l.item,o[25]=new t.Map,o[25].set("backup_id",n.backupId),o[25].set("device_public_key_blob",n.devicePublicKeyBlob),o[25].set("device_private_key_blob",n.devicePrivateKeyBlob),o[25].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),o[25].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),o[25].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),o[25].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),o[25].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),o[25].set("ocmf_client_state_blob",n.ocmfClientStateBlob),o[25].set("orf_client_state_v2_blob",void 0),o[25].set("orf_v2_authority_level",void 0),o[25].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),o[25].set("device_id",n.deviceId),o[25].set("backup_tenancy",n.backupTenancy),o[25].set("encryption_version",n.encryptionVersion),o[25].set("revision_version",n.revisionVersion),o[25].set("initialize_restore_result",void 0),o[25].set("device_creation_timestamp_sec",void 0),o[25].set("authority_level",n.authorityLevel),a=[o[25],void 0],o[16]=a[0],o[17]=a[1])})},function(e){var a;return o[19]=new t.Map,o[19].set("value",o[16]),o[19].set("errors",o[17]),o[20]=o[19].get("value"),o[20]!==void 0?t.sequence([function(e){var a;return o[25]=o[20].get("backup_id"),o[26]=o[20].get("device_public_key_blob"),o[27]=o[20].get("device_private_key_blob"),o[28]=o[20].get("epoch_storage_public_key_blob"),o[29]=o[20].get("epoch_storage_private_key_blob"),o[30]=o[20].get("epoch_auth_public_key_blob"),o[31]=o[20].get("epoch_auth_private_key_blob"),o[32]=o[20].get("mailbox_root_key_blob"),o[33]=o[20].get("ocmf_client_state_blob"),o[34]=o[20].get("orf_client_state_v2_blob"),o[35]=o[20].get("orf_v2_authority_level"),o[36]=o[20].get("oblivious_validation_token_blob"),o[37]=o[20].get("device_id"),o[38]=o[20].get("backup_tenancy"),o[39]=o[20].get("encryption_version"),o[40]=o[20].get("revision_version"),o[41]=o[20].get("initialize_restore_result"),o[42]=o[20].get("device_creation_timestamp_sec"),o[43]=o[20].get("authority_level"),t.i64.neq(o[37],void 0)?t.sequence([function(e){return o[47]=void 0,t.i64.neq(o[47],void 0)?t.resolve(o[48]=o[47]):t.sequence([function(e){return o[58]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[59]=t[0],t})},function(e){return o[59]&&(o[68]=(o[58].push(t.i64.cast([0,0])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[60]=t[0],t})},function(e){return o[60]&&(o[68]=(o[58].push(t.i64.cast([0,2])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[61]=t[0],t})},function(e){return o[61]&&(o[68]=(o[58].push(t.i64.cast([0,3])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[62]&&(o[68]=(o[58].push(t.i64.cast([0,4])),o[58])),o[63]=t.createArray(),o[64]=t.i64.of_int32(o[58].length),t.i64.gt(o[64],t.i64.cast([0,0]))?t.loopAsync(o[64],function(e){return o[68]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[58],o[68]).then(function(e){var t;return t=e,o[69]=t[0],o[70]=t[1],t})},function(e){return o[71]=(o[63].push(o[69]),o[63])}])}):t.resolve()},function(e){return t.sequence([function(e){return o[68]=t.createArray(),o[69]=t.i64.of_int32(o[63].length),t.i64.gt(o[69],t.i64.cast([0,0]))?t.loopAsync(o[69],function(e){return o[71]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[63],o[71]).then(function(e){var t;return t=e,o[72]=t[0],o[73]=t[1],t})},function(e){return o[74]=(o[68].push(t.i64.to_string(o[72])),o[68])}])}):t.resolve()},function(e){return o[70]=o[68].join(","),o[65]=o[70]}])},function(e){return o[63].some(function(e){return t.i64.eq(o[39],e)})?o[66]=o[39]:o[66]=void 0,t.i64.neq(o[66],void 0)?o[67]=o[66]:o[67]=void 0,o[48]=o[67]}])},function(e){return t.i64.neq(o[48],void 0)?o[49]=o[48]:o[49]=t.i64.cast([0,0]),t.i64.neq(o[38],void 0)?o[50]=o[38]:o[50]=t.i64.cast([0,1]),o[51]=new t.Map,o[51].set("device_id",o[37]),o[51].set("public_key",o[26]),o[52]=t.createArray(),o[58]=(o[52].push(o[51]),o[52]),t.storedProcedure(n("LSGenerateInitialEpochSetupPayload"),o[25],o[52]).then(function(e){var t;return t=e,o[53]=t[0],o[54]=t[1],t})},function(e){var a,i,l;return o[53]!==void 0?t.sequence([function(e){return o[58]=o[53].get("epoch_anon_id"),o[59]=o[53].get("epoch_root_key"),t.blobs.neq(o[59],void 0)?t.sequence([function(e){return o[78]=t.createArray(),o[84]=(o[78].push(t.i64.cast([0,18])),o[78]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[59],o[78]).then(function(e){var t;return t=e,o[79]=t[0],t})},function(e){return o[79]!==void 0?t.sequence([function(e){return o[84]=t.i64.of_int32(o[79].length),t.i64.ge(o[84],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[79],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[86]=t[0],o[87]=t[1],t})},function(e){return o[85]=o[86]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[87]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[87]].join("")),o[86]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[87],o[86],t.i64.cast([0,3]))},function(e){return o[85]=void 0}])},function(e){return o[80]=o[85]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[85]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[85]].join("")),o[84]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[85],o[84],t.i64.cast([0,3]))},function(e){return o[80]=void 0}])},function(e){return t.blobs.neq(o[80],void 0)?o[81]=!0:o[81]=!1,o[81]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[80]).then(function(e){var t;return t=e,o[82]=t[0],t})},function(e){return o[82]!==void 0?o[83]=o[82]:o[83]="encodingfailed",o[60]=o[83]}]):t.resolve(o[60]="null")},function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[52],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[61]=t[0],o[62]=t[1],t})},function(e){return o[63]=o[61].get("public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[63]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[65]=o[61].get("public_key"),o[66]=t.createArray(),o[78]=(o[66].push(t.i64.cast([0,32])),o[66]),t.nativeOperation(n("LSBase64Encode.nop"),o[58]).then(function(e){var t;return t=e,o[67]=t[0],t})},function(e){return o[67]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[67]].join("")),void 0,o[59],o[66]).then(function(e){var t;return t=e,o[78]=t[0],t})},function(e){return o[78]?o[79]=!1:o[79]=!0,o[79]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[82]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[82]].join("")),o[81]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[82],o[81],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[83]=t[0],t})},function(e){return o[80]=o[83]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[78],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[81]=t[0],o[82]=t[1],t})},function(e){return o[80]=o[81]}])},function(e){return o[68]=o[80]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[79]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[79]].join("")),o[78]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[79],o[78],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[80]=t[0],t})},function(e){return o[68]=o[80]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[68],o[65]).then(function(e){var t;return t=e,o[69]=t[0],t})},function(e){return o[77]=(function(e){return e==null?void 0:e})(r("qex")._("201")),o[77]!==void 0?o[70]=o[77]:o[70]=!1,o[70]&&r("gkx")("16269")?t.sequence([function(e){return t.nativeOperation(n("LSCreateMinosEpochParams.nop"),o[59],o[58],void 0,void 0,void 0).then(function(e){var t;return t=e,o[78]=t[0],o[79]=t[1],o[80]=t[2],o[81]=t[3],o[82]=t[4],o[83]=t[5],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[78]).then(function(e){var t;return t=e,o[84]=t[0],t})},function(e){return o[84]!==void 0?o[85]=o[84]:o[85]="",t.nativeOperation(n("LSBase64Encode.nop"),o[80]).then(function(e){var t;return t=e,o[86]=t[0],t})},function(e){return o[86]!==void 0?o[87]=o[86]:o[87]="",t.nativeOperation(n("LSBase64Encode.nop"),o[79]).then(function(e){var t;return t=e,o[88]=t[0],t})},function(e){return o[88]!==void 0?o[89]=o[88]:o[89]="",t.nativeOperation(n("LSBase64Encode.nop"),o[81]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return o[90]!==void 0?o[91]=o[90]:o[91]="",t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),void 0).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[98]!==void 0?o[99]=o[98]:o[99]="",o[92]=o[99]}]):t.resolve(o[92]=void 0)},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[82]).then(function(e){var t;return t=e,o[93]=t[0],t})},function(e){return o[93]!==void 0?o[94]=o[93]:o[94]="",t.blobs.neq(o[83],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[83]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[98]!==void 0?o[99]=o[98]:o[99]="",o[95]=o[99]}]):t.resolve(o[95]=void 0)},function(e){return o[96]=new t.Map,o[96].set("mailbox_encryption_public_key",o[85]),o[96].set("mailbox_auth_public_key",o[87]),o[96].set("mailbox_signing_public_key",o[89]),o[96].set("epoch_head",o[91]),o[96].set("previous_epoch_head",o[92]),o[96].set("self_signature",o[94]),o[96].set("prev_signature",o[95]),o[96]!==void 0?t.resolve(o[97]=o[96]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochUtils] Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair"),o[99]="Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochUtils] ","",o[99]].join("")),o[98]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochUtils",o[99],o[98],t.i64.cast([0,3]))},function(e){return o[97]=void 0}])},function(e){return o[71]=o[97]}]):t.resolve(o[71]=void 0)},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[58]).then(function(e){var t;return t=e,o[72]=t[0],t})},function(e){return o[73]=o[53].get("optimistic_epoch_id"),t.blobs.neq(o[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[69]).then(function(e){var t;return t=e,o[78]=t[0],t})},function(e){return o[74]=o[78]}]):t.resolve(o[74]=void 0)},function(e){var n;return o[75]=new t.Map,o[75].set("device_pub",o[64]==null?"":o[64]),o[75].set("hmac",o[74]==null?"":o[74]),o[75].set("encrypted_epoch_key",void 0),o[75].set("epoch_root_key_fingerprint",o[60]),o[76]=new t.Map,o[76].set("epoch_data",""),o[76].set("epoch_anon_id",o[72]==null?"":o[72]),o[76].set("minos_epoch_creation_params",o[71]),o[76].set("optimistic_epoch_id",o[73]),o[76].set("membership",o[75]),n=[o[76],!0,t.i64.cast([0,0])],o[55]=n[0],o[56]=n[1],o[57]=n[2]}]):t.resolve((o[54]!==void 0?(o[61]=o[54].get("error_code"),a=[void 0,!1,o[61]],o[58]=a[0],o[59]=a[1],o[60]=a[2]):(i=[void 0,!1,t.i64.cast([0,14])],o[58]=i[0],o[59]=i[1],o[60]=i[2]),l=[o[58],o[59],o[60]],o[55]=l[0],o[56]=l[1],o[57]=l[2]))},function(e){var t;return t=[o[55],o[56],o[57]],o[44]=t[0],o[45]=t[1],o[46]=t[2],t}]):t.resolve((a=[void 0,!1,t.i64.cast([0,9])],o[44]=a[0],o[45]=a[1],o[46]=a[2],a))},function(e){var t;return t=[o[44],o[45],o[46]],o[21]=t[0],o[22]=t[1],o[23]=t[2],t}]):t.resolve((o[25]=o[19].get("errors"),o[26]=o[19].get("errors"),a=[void 0,!1,t.i64.cast([0,9])],o[21]=a[0],o[22]=a[1],o[23]=a[2]))},function(r){return o[22]?t.sequence([function(r){return o[21]!==void 0?t.sequence([function(r){return t.storedProcedure(n("LSGenerateInitialVirtualDeviceSetupPayload"),o[5],e[2]).then(function(e){var t;return t=e,o[26]=t[0],o[27]=t[1],t})},function(e){var r,a,i;return o[26]!==void 0?t.sequence([function(e){return o[32]=o[26].get("virtual_device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[32]).then(function(e){var t;return t=e,o[33]=t[0],t})},function(e){return o[34]=o[26].get("virtual_device_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[34]).then(function(e){var t;return t=e,o[35]=t[0],t})},function(e){return o[36]=o[26].get("virtual_device_epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[36]).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[38]=o[26].get("virtual_device_epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(e){return o[40]=o[26].get("device_epoch_hmac"),t.nativeOperation(n("LSBase64Encode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[42]=o[26].get("epoch_root_key_fingerprint"),t.blobs.neq(o[42],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[42]).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return o[43]=o[54]}]):t.resolve(o[43]=void 0)},function(e){return o[44]=o[26].get("ocmf_rotation_token"),t.nativeOperation(n("LSBase64Encode.nop"),o[44]).then(function(e){var t;return t=e,o[45]=t[0],t})},function(e){var n;return o[46]=o[26].get("encrypted_secret_values_payload"),o[47]=o[26].get("virtual_device_type"),o[48]=o[26].get("action_type"),o[49]=o[26].get("cloud_service_account"),o[50]=o[26].get("hsm_pin_normalization_status"),o[51]=o[26].get("security_question_type"),o[52]=o[26].get("trusted_contact_id"),o[53]=new t.Map,o[53].set("virtual_device_public_key",o[33]==null?"":o[33]),o[53].set("virtual_device_id",o[35]==null?"":o[35]),o[53].set("virtual_device_epoch_storage_public_key",o[37]==null?"":o[37]),o[53].set("virtual_device_epoch_storage_public_key_sig",o[39]==null?"":o[39]),o[53].set("encrypted_secret_values",o[46]),o[53].set("device_epoch_hmac",o[41]==null?"":o[41]),o[53].set("epoch_root_key_fingerprint",o[43]),o[53].set("ocmf_rotation_token",o[45]==null?"":o[45]),o[53].set("virtual_device_type",o[47]),o[53].set("action_type",o[48]),o[53].set("cloud_service_account",o[49]),o[53].set("hsm_pin_normalization_status",o[50]),o[53].set("security_question_type",o[51]),o[53].set("trusted_contact_id",o[52]),n=[o[53],!0,t.i64.cast([0,0])],o[28]=n[0],o[29]=n[1],o[30]=n[2]}]):t.resolve((o[27]!==void 0?(o[35]=o[27].get("error_code"),r=[void 0,!1,o[35]],o[32]=r[0],o[33]=r[1],o[34]=r[2]):(a=[void 0,!1,t.i64.cast([0,16])],o[32]=a[0],o[33]=a[1],o[34]=a[2]),i=[o[32],o[33],o[34]],o[28]=i[0],o[29]=i[1],o[30]=i[2]))},function(r){return o[29]?t.sequence([function(r){return o[28]!==void 0?t.sequence([function(r){return o[33]=new t.Map,o[33].set("optimistic_backup_id",o[5]),o[33].set("device_payload",o[4]),o[33].set("epoch_payload",o[21]),o[33].set("virtual_device_payload",o[28]),o[38]=t.i64.cast([0,1e3]),o[34]=o[38],o[35]=new t.Map,o[35].set("success",o[33]),o[35].set("request_id",e[1]),o[36]=t.toJSON(o[35]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[36],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[34]).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[32]=t.i64.cast([0,0])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null virtual device payload"),o[34]="Null virtual device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[34]].join("")),o[33]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[34],o[33],t.i64.cast([0,3]))},function(r){return o[35]=new t.Map,o[35].set("error_code",o[30]),o[35].set("error_message","Null virtual device payload"),o[35].set("stored_procedure","initializeBackupV2"),o[36]=new t.Map,o[36].set("failure",o[35]),o[36].set("request_id",e[1]),o[37]=t.toJSON(o[36]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[37],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return o[32]=t.i64.cast([0,1])}])},function(e){return o[31]=o[32]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create virtual device payload"),o[33]="Could not create virtual device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[33]].join("")),o[32]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[33],o[32],t.i64.cast([0,3]))},function(r){return o[34]=new t.Map,o[34].set("error_code",o[30]),o[34].set("error_message","Could not create virtual device payload"),o[34].set("stored_procedure","initializeBackupV2"),o[35]=new t.Map,o[35].set("failure",o[34]),o[35].set("request_id",e[1]),o[36]=t.toJSON(o[35]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[36],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[31]=t.i64.cast([0,1])}])},function(e){return o[25]=o[31]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null epoch payload"),o[27]="Null epoch payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[27]].join("")),o[26]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[27],o[26],t.i64.cast([0,3]))},function(r){return o[28]=new t.Map,o[28].set("error_code",o[23]),o[28].set("error_message","Null epoch payload"),o[28].set("stored_procedure","initializeBackupV2"),o[29]=new t.Map,o[29].set("failure",o[28]),o[29].set("request_id",e[1]),o[30]=t.toJSON(o[29]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[30],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[31]=t[0],t})},function(e){return o[25]=t.i64.cast([0,1])}])},function(e){return o[24]=o[25]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create epoch payload"),o[26]="Could not create epoch payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[26]].join("")),o[25]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[26],o[25],t.i64.cast([0,3]))},function(r){return o[27]=new t.Map,o[27].set("error_code",o[23]),o[27].set("error_message","Could not create epoch payload"),o[27].set("stored_procedure","initializeBackupV2"),o[28]=new t.Map,o[28].set("failure",o[27]),o[28].set("request_id",e[1]),o[29]=t.toJSON(o[28]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[29],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[30]=t[0],t})},function(e){return o[24]=t.i64.cast([0,1])}])},function(e){return o[15]=o[24]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null device payload"),o[17]="Null device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[17]].join("")),o[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[17],o[16],t.i64.cast([0,3]))},function(r){return o[18]=new t.Map,o[18].set("error_code",o[7]),o[18].set("error_message","Null device payload"),o[18].set("stored_procedure","initializeBackupV2"),o[19]=new t.Map,o[19].set("failure",o[18]),o[19].set("request_id",e[1]),o[20]=t.toJSON(o[19]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[20],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[21]=t[0],t})},function(e){return o[15]=t.i64.cast([0,1])}])},function(e){return o[8]=o[15]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create device payload"),o[16]="Could not create device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[16]].join("")),o[15]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[16],o[15],t.i64.cast([0,3]))},function(r){return o[17]=new t.Map,o[17].set("error_code",o[7]),o[17].set("error_message","Could not create device payload"),o[17].set("stored_procedure","initializeBackupV2"),o[18]=new t.Map,o[18].set("failure",o[17]),o[18].set("request_id",e[1]),o[19]=t.toJSON(o[18]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[19],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[20]=t[0],t})},function(e){return o[8]=t.i64.cast([0,1])}])},function(e){return o[9]=t.i64.of_float(Date.now()),o[10]=t.i64.random(),o[12]="Finishing execution. Execution time: ",o[13]=t.i64.to_string(t.i64.sub(o[9],o[0])),o[14]=" ms",o[11]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][initializeBackupV2] ",o[11],o[12],o[11],o[13],o[11],o[14]].join("")),t.i64.eq(t.i64.mod_(o[10],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[15]=",",o[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"initializeBackupV2",[o[12],o[15],o[13],o[15],o[14]].join(""),o[16],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[8]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsInitializeBackupV2StoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"];var s=e;l.default=s}),98);
__d("LSInitializeBackupV2StoredProcedure",["LSInitializeBackupV2","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSInitializeBackupV2"),a.deviceRegistrationId,a.requestId,a.recoveryCodeData);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MWEncryptedBackupsInitializeBackup",["LSFactory","LSInitializeBackupV2StoredProcedure","LSShape"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a){return e.runInTransaction(function(e){return r("LSInitializeBackupV2StoredProcedure")(r("LSFactory")(e),{deviceRegistrationId:t,recoveryCodeData:a?o("LSShape").ofRecord(a):void 0,requestId:n!=null?n:""})},"readwrite",void 0,void 0,i.id+":28")}l.initializeBackupStoredProcedure=e}),98);
__d("EBInitializeBackup",["EBAPIQPLPoints","EBDeps","EBLogger","EBMainThreadEBDBApiDeferred","EBSMAPI","I64","LSAuthorityLevel","LSEncryptedBackupsOpStatus","LSIntEnum","MAWTraceUtils","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeBackup","Random","RecoveryCodeDB","WAResultOrError","getErrorSafe","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e,t){var n=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),a=o("Random").uint32();await n.runInTransaction(["persisted_recovery_code"],"readwrite",async function(n){var o=await n.stores.persisted_recovery_code.readAll(),i=o.filter(function(e){return e.virtualDeviceType===t&&e.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC}).map(function(e){return e.pk});i.length>0&&await n.stores.persisted_recovery_code.bulkDelete(i),await n.stores.persisted_recovery_code.bulkPut([{authorityLevel:r("LSAuthorityLevel").OPTIMISTIC,pk:a,recoveryCode:e,virtualDeviceType:t}])},"EBDB - persist recovery code optimistic")}async function c(e,t){var n=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB();await n.runInTransaction(["persisted_recovery_code"],"readwrite",async function(n){var o=await n.stores.persisted_recovery_code.readAll(),a=o.find(function(n){return n.recoveryCode===e&&n.virtualDeviceType===t&&n.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC});a!=null&&await n.stores.persisted_recovery_code.bulkPut([babelHelpers.extends({},a,{authorityLevel:r("LSAuthorityLevel").AUTHORITATIVE})])},"RecoveryCodeDB - update recovery code to authoritative")}async function d(e){var t=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB();await t.runInTransaction(["persisted_recovery_code"],"readwrite",async function(t){var n=await t.stores.persisted_recovery_code.readAll(),o=n.filter(function(t){return t.virtualDeviceType===e&&t.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC}).map(function(e){return e.pk});o.length>0&&await t.stores.persisted_recovery_code.bulkDelete(o)},"RecoveryCodeDB - cleanup recovery code optimistic")}var m=!1,p=new Map;async function _(t,n,a){if(r("justknobx")._("5261")&&m===!0)return o("EBLogger").EBLogger().warn("initializeBackup: init in progress"),t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_RUNNING),Promise.resolve(o("WAResultOrError").makeError("init_in_progress"));m=!0;var i=null;try{if((e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))){var l=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),_=await l.runInTransaction(["persisted_recovery_code"],"readonly",async function(e){var t=await e.stores.persisted_recovery_code.readAll(),n=t.find(function(e){return e.virtualDeviceType===16&&e.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC});return n!=null?{pk:n.pk,recoveryCode:n.recoveryCode}:null},"RecoveryCodeDB - read existing optimistic recovery code");t.addAnnotations({bool:{is_auto_eb_retry:_!=null}});var f=r("justknobx")._("776");if(_!=null&&f)return o("EBLogger").EBLogger().mustfix("Auto EB initBackup retry prevented by killswitch: wmi/armadillo:stop_auto_eb_initbackup_retry"),t.endFail("auto_eb_retry_prevented_by_killswitch"),await d(16),m=!1,Promise.resolve(o("WAResultOrError").makeError("auto_eb_init_failed"));if(_!=null)i=_.recoveryCode,t.addAnnotations({int:{recovery_code_db_pk:_.pk}});else{var g=await r("EBSMAPI").generateRecoveryCode({virtualDeviceType:n});if(g.success===!1)return t.endFail("generate_recovery_code_failure"),m=!1,g;g.success===!0&&(i=g.value.recoveryCode,await u(i,16))}}}catch(a){var h=r("getErrorSafe")(a);return t.endFail("auto_eb_init_failed"),o("EBLogger").EBLogger().catching(h).mustfix("Auto EB init failed."),(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),m=!1,Promise.resolve(o("WAResultOrError").makeError("auto_eb_init_failed"))}var y=function(){},C=new Promise(function(e,n){window.setTimeout(function(){y(),o("EBLogger").EBLogger().warn("Init backup failed by timeout"),t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_TIMEOUT),e(o("WAResultOrError").makeError("timed_out"))},r("justknobx")._("4211"))}),b=new Promise(async function(l,u){var m=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(t.addAnnotations({string:{deviceRegistrationId:m}}),m===""){t.endFail("device_registration_id_null"),l(o("WAResultOrError").makeError("device_registration_id_null"));return}t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.GET_DB_START);var _=await o("EBDeps").getDeps().getLSDB();t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.GET_DB_END),y=_.tables.secure_encrypted_backups_client_state.subscribe(async function(a,u){if(u.operation==="delete"){t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SUBSCRIPTION_DELETE,{int:{deleteAuthorityLevel:(e||(e=o("I64"))).to_int32(u.prevValue.authorityLevel),deleteBackupId:e.to_int32(u.prevValue.backupId),deleteInputVirtualDeviceType:e.to_int32(n)}});return}var d=u.value,m=d.authorityLevel,p=d.backupId;(e||(e=o("I64"))).equal(m,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))?(t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_END),i!=null&&(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await c(i,16),y(),t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_START),r("EBSMAPI").fetchBackupIds("EBInitializeBackup").finally(function(){t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_END),t.endSuccess(),o("EBMainThreadEBDBApiDeferred").addNewDevice()}),l(o("WAResultOrError").makeResult(p))):t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.OPTIMISTIC_CLIENT_STATE,{int:{ocsAuthorityLevel:(e||(e=o("I64"))).to_int32(m),ocsBackupId:e.to_int32(p),ocsInputVirtualDeviceType:e.to_int32(n)},string:{ocsOperation:u.operation}})}),p.set(t.getQPLAttrs().instanceKey.toString(),{clientStateUnsubscribe:y,qplFlow:t,resolve:l}),t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_START);var f=await o("MWEncryptedBackupsInitializeBackup").initializeBackupStoredProcedure(_,m,o("MAWTraceUtils").stringToTraceId(t.getQPLAttrs().instanceKey.toString()),a),g=f[0];if((e||(e=o("I64"))).equal(g,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE))){t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_FAIL),(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),l(o("WAResultOrError").makeError("sproc_failure"));return}t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_END,{int:{sproc_status:(e||(e=o("I64"))).to_int32(g)}})});return Promise.race([b,C]).then(function(e){return e}).finally(function(){p.delete(t.getQPLAttrs().instanceKey.toString()),m=!1})}async function f(t,n,r){var a=p.get(t);a!=null&&(a.resolve(o("WAResultOrError").makeError("initialize_backup_fail")),a.qplFlow.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_FAIL,{string:{errorMsg:n}}),a.clientStateUnsubscribe()),r!=null&&(e||(e=o("I64"))).equal(r,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),p.delete(t)}l.initializeBackup=_,l.resolveInitializeBackupPromiseWithError=f}),98);
__d("EBMinosWasmDeriveAttachmentTokenPrimaryKey",["EBMinosWasmDeriveAttachmentAccessTokenSecret","EBMinosWasmDeriveAttachmentPrimaryKeySecret","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=await o("EBMinosWasmDeriveAttachmentPrimaryKeySecret").deriveAttachmentPrimaryKeySecret({mediaKey:e});if(!t.success)return o("WAResultOrError").makeError("derive-primary-key-secret-error");var n=await o("EBMinosWasmDeriveAttachmentAccessTokenSecret").deriveAttachmentAccessTokenSecret({mediaKey:e});return n.success?o("WAResultOrError").makeResult({accessToken:n.value,primaryKey:t.value}):o("WAResultOrError").makeError("derive-access-token-secret-error")}l.deriveAttachmentTokenPrimaryKeySecret=e}),98);
__d("LSFindBackup",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsFindBackupStoredProcedure] Beginning execution."),t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[1]=a[0],r[2]=a[1],r[3]=a[2],r[4]=a[3],r[5]=a[4],r[6]=a[5],r[7]=a[6],r[8]=a[7],r[9]=a[8],r[10]=a[9],r[11]=a[10],r[12]=a[11],r[13]=a[12],r[14]=a[13],r[15]=a[14],r[16]=a[15],r[17]=a[16],r[18]=a[17],a):(o=l.item,t.sequence([function(e){return r[32]=o.backupTenancy,r[31]=o.encryptionVersion,r[27]=void 0,t.i64.neq(r[27],void 0)?t.resolve(r[28]=r[27]):t.sequence([function(e){return r[33]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[34]=t[0],t})},function(e){return r[34]&&(r[43]=(r[33].push(t.i64.cast([0,0])),r[33])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[35]=t[0],t})},function(e){return r[35]&&(r[43]=(r[33].push(t.i64.cast([0,2])),r[33])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return r[36]&&(r[43]=(r[33].push(t.i64.cast([0,3])),r[33])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[37]=t[0],t})},function(e){return r[37]&&(r[43]=(r[33].push(t.i64.cast([0,4])),r[33])),r[38]=t.createArray(),r[39]=t.i64.of_int32(r[33].length),t.i64.gt(r[39],t.i64.cast([0,0]))?t.loopAsync(r[39],function(e){return r[43]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[33],r[43]).then(function(e){var t;return t=e,r[44]=t[0],r[45]=t[1],t})},function(e){return r[46]=(r[38].push(r[44]),r[38])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[43]=t.createArray(),r[44]=t.i64.of_int32(r[38].length),t.i64.gt(r[44],t.i64.cast([0,0]))?t.loopAsync(r[44],function(e){return r[46]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[38],r[46]).then(function(e){var t;return t=e,r[47]=t[0],r[48]=t[1],t})},function(e){return r[49]=(r[43].push(t.i64.to_string(r[47])),r[43])}])}):t.resolve()},function(e){return r[45]=r[43].join(","),r[40]=r[45]}])},function(e){return r[38].some(function(e){return t.i64.eq(r[31],e)})?r[41]=r[31]:r[41]=void 0,t.i64.neq(r[41],void 0)?r[42]=r[41]:r[42]=void 0,r[28]=r[42]}])},function(e){var n;return t.i64.neq(r[28],void 0)?r[29]=r[28]:r[29]=t.i64.cast([0,0]),t.i64.neq(r[32],void 0)?r[30]=r[32]:r[30]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[29],r[30],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[1]=n[0],r[2]=n[1],r[3]=n[2],r[4]=n[3],r[5]=n[4],r[6]=n[5],r[7]=n[6],r[8]=n[7],r[9]=n[8],r[10]=n[9],r[11]=n[10],r[12]=n[11],r[13]=n[12],r[14]=n[13],r[15]=n[14],r[16]=n[15],r[17]=n[16],r[18]=n[17]}]))})},function(e){return t.i64.neq(r[1],void 0)?r[20]=t.i64.to_string(r[1]):r[20]=void 0,r[21]=t.i64.of_float(Date.now()),r[22]=t.i64.random(),r[24]="Finishing execution. Execution time: ",r[25]=t.i64.to_string(t.i64.sub(r[21],r[0])),r[26]=" ms",r[23]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsFindBackupStoredProcedure] ",r[23],r[24],r[23],r[25],r[23],r[26]].join("")),t.i64.eq(t.i64.mod_(r[22],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[27]=",",r[28]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFindBackupStoredProcedure",[r[24],r[27],r[25],r[27],r[26]].join(""),r[28],t.i64.cast([0,4]))):t.resolve()},function(e){return o[0]=r[20]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsFindBackupStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"],a.exports=e}),null);
__d("LSCreateResignCDNUrlPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDerivedKeys.nop","LSFindBackup","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return e[10]?t.sequence([function(o){var a;return t.blobs.neq(e[11],void 0)?t.sequence([function(o){var a;return t.i64.neq(e[8],void 0)?t.sequence([function(o){var a;return e[9]!==void 0?t.sequence([function(o){var a;return t.blobs.neq(e[12],void 0)?t.sequence([function(o){return r[10]=t.createArray(),r[19]=(r[10].push(e[9]),r[10]),r[19]=(r[10].push(e[1]),r[10]),r[11]=t.toJSON(r[10]),r[12]=t.createArray(),r[19]=(r[12].push(t.i64.cast([0,32])),r[12]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",e[5]].join("")).then(function(e){var t;return t=e,r[13]=t[0],t})},function(o){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[13],void 0,e[12],r[12]).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return r[14]?r[15]=!1:r[15]=!0,r[15]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),r[20]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[20]].join("")),r[19]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[20],r[19],t.i64.cast([0,3]))},function(e){return r[16]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[14],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[19]=t[0],r[20]=t[1],t})},function(e){return r[16]=r[19]}])},function(o){var a;return t.blobs.neq(r[16],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSGetBlobFromInt64BE.nop"),e[6]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return t.nativeOperation(n("LSTruncateSortKey.nop"),r[19]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return t.nativeOperation(n("LSOpeEncrypt.nop"),r[16],r[20],t.i64.cast([0,16])).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return t.nativeOperation(n("LSBinaryToHex.nop"),r[21]).then(function(e){var t;return t=e,r[22]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[11]).then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),r[23]).then(function(e){var t;return t=e,r[24]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[24]).then(function(e){var t;return t=e,r[25]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[25]).then(function(e){var t;return t=e,r[26]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[9]).then(function(e){var t;return t=e,r[27]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[27]).then(function(e){var t;return t=e,r[28]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[28]).then(function(e){var t;return t=e,r[29]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[29]).then(function(e){var t;return t=e,r[30]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[31]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWVzc2FnZV9pZF9zY29wZQ=="),r[31]).then(function(e){var t;return t=e,r[32]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[32]).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[33]).then(function(e){var t;return t=e,r[34]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[35]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[35]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[36]).then(function(e){var t;return t=e,r[37]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[37]).then(function(e){var t;return t=e,r[38]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[5]).then(function(e){var t;return t=e,r[39]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("dGhyZWFkX2lkX3Njb3Bl"),r[39]).then(function(e){var t;return t=e,r[40]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[40]).then(function(e){var t;return t=e,r[41]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[42]=t[0],t})},function(o){return r[43]=new t.Map,r[43].set("attachment_index_key",r[26]==null?"":r[26]),r[43].set("backup_ent_fbid",e[0]),r[43].set("delivery_object_id",e[1]),r[43].set("device_id",e[8]),r[43].set("mailbox_partial_id",r[30]==null?"":r[30]),r[43].set("media_type",e[3]),r[43].set("message_partial_id",r[34]==null?"":r[34]),r[43].set("product_type",e[2]),r[43].set("salt_partial_id",r[38]==null?"":r[38]),r[43].set("sort_key",r[22]==null?"":r[22]),r[43].set("thread_partial_id",r[42]==null?"":r[42]),r[43].set("isOpenEB",e[10]===!0),r[44]=new t.Map,r[44].set("otid",e[4]),r[44].set("server_thread_key",e[7]),r[44].set("timestamp",t.i64.to_string(e[6])),t.nativeOperation(n("LSBase64Encode.nop"),e[11]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(o){return t.nativeOperation(n("LSBase64Encode.nop"),e[12]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(o){return r[47]=new t.Map,r[47].set("ocmf_client_state_blob",r[45]==null?"":r[45]),r[47].set("mailbox_root_key",r[46]==null?"":r[46]),r[48]=t.createArray(),r[60]=(r[48].push(e[4]),r[48]),r[60]=(r[48].push(e[1]),r[48]),r[49]=t.toJSON(r[48]),r[43].set("raw_identifiers",r[44]),r[43].set("backup_id",e[9]),r[43].set("thread_id",e[5]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[49]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[50]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[51]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[52]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[43].set("salt_partial_access_token",r[53]==null?"":r[53]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[11]).then(function(e){var t;return t=e,r[54]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),r[54]).then(function(e){var t;return t=e,r[55]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[55]).then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(n){var o;return r[43].set("salt_partial_attachment_index_key",r[57]==null?"":r[57]),r[43].set("raw_tokens",r[47]),e[13]!==void 0&&r[43].set("access_token_secret",e[13]),e[14]!==void 0&&r[43].set("primary_key_secret",e[14]),r[58]=t.toJSON(r[43]),r[59]=new t.Map,r[59].set("payload",r[58]),o=[r[59],void 0],r[17]=o[0],r[18]=o[1]}]):t.resolve((r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,25])),r[19].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[19].set("error_message","OPE key is null for IssueAttachmentRestoreTask"),a=[void 0,r[19]],r[17]=a[0],r[18]=a[1]))},function(e){var t;return t=[r[17],r[18]],r[8]=t[0],r[9]=t[1],t}]):t.resolve((r[10]=new t.Map,r[10].set("error_code",t.i64.cast([0,20])),r[10].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[10].set("error_message","Missing mailbox_root_key for IssueAttachmentRestoreTask"),a=[void 0,r[10]],r[8]=a[0],r[9]=a[1]))},function(e){var t;return t=[r[8],r[9]],r[6]=t[0],r[7]=t[1],t}]):t.resolve((r[8]=new t.Map,r[8].set("error_code",t.i64.cast([0,1])),r[8].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[8].set("error_message","Missing backup_id for IssueAttachmentRestoreTask"),a=[void 0,r[8]],r[6]=a[0],r[7]=a[1]))},function(e){var t;return t=[r[6],r[7]],r[4]=t[0],r[5]=t[1],t}]):t.resolve((r[6]=new t.Map,r[6].set("error_code",t.i64.cast([0,24])),r[6].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[6].set("error_message","Missing device_id for IssueAttachmentRestoreTask"),a=[void 0,r[6]],r[4]=a[0],r[5]=a[1]))},function(e){var t;return t=[r[4],r[5]],r[2]=t[0],r[3]=t[1],t}]):t.resolve((r[4]=new t.Map,r[4].set("error_code",t.i64.cast([0,22])),r[4].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[4].set("error_message","Missing ocmf_client_state_blob for IssueAttachmentRestoreTask"),a=[void 0,r[4]],r[2]=a[0],r[3]=a[1]))},function(e){var t;return t=[r[2],r[3]],r[0]=t[0],r[1]=t[1],t}]):t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[2]=a[0],r[3]=a[1],r[4]=a[2],r[5]=a[3],r[6]=a[4],r[7]=a[5],r[8]=a[6],r[9]=a[7],r[10]=a[8],r[11]=a[9],r[12]=a[10],r[13]=a[11],r[14]=a[12],r[15]=a[13],r[16]=a[14],r[17]=a[15],r[18]=a[16],r[19]=a[17],a):(o=l.item,t.sequence([function(e){return r[29]=o.backupTenancy,r[28]=o.encryptionVersion,r[24]=void 0,t.i64.neq(r[24],void 0)?t.resolve(r[25]=r[24]):t.sequence([function(e){return r[30]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[31]=t[0],t})},function(e){return r[31]&&(r[40]=(r[30].push(t.i64.cast([0,0])),r[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[32]=t[0],t})},function(e){return r[32]&&(r[40]=(r[30].push(t.i64.cast([0,2])),r[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return r[33]&&(r[40]=(r[30].push(t.i64.cast([0,3])),r[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[34]=t[0],t})},function(e){return r[34]&&(r[40]=(r[30].push(t.i64.cast([0,4])),r[30])),r[35]=t.createArray(),r[36]=t.i64.of_int32(r[30].length),t.i64.gt(r[36],t.i64.cast([0,0]))?t.loopAsync(r[36],function(e){return r[40]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[30],r[40]).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return r[43]=(r[35].push(r[41]),r[35])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[40]=t.createArray(),r[41]=t.i64.of_int32(r[35].length),t.i64.gt(r[41],t.i64.cast([0,0]))?t.loopAsync(r[41],function(e){return r[43]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[35],r[43]).then(function(e){var t;return t=e,r[44]=t[0],r[45]=t[1],t})},function(e){return r[46]=(r[40].push(t.i64.to_string(r[44])),r[40])}])}):t.resolve()},function(e){return r[42]=r[40].join(","),r[37]=r[42]}])},function(e){return r[35].some(function(e){return t.i64.eq(r[28],e)})?r[38]=r[28]:r[38]=void 0,t.i64.neq(r[38],void 0)?r[39]=r[38]:r[39]=void 0,r[25]=r[39]}])},function(e){var n;return t.i64.neq(r[25],void 0)?r[26]=r[25]:r[26]=t.i64.cast([0,0]),t.i64.neq(r[29],void 0)?r[27]=r[29]:r[27]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[26],r[27],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[2]=n[0],r[3]=n[1],r[4]=n[2],r[5]=n[3],r[6]=n[4],r[7]=n[5],r[8]=n[6],r[9]=n[7],r[10]=n[8],r[11]=n[9],r[12]=n[10],r[13]=n[11],r[14]=n[12],r[15]=n[13],r[16]=n[14],r[17]=n[15],r[18]=n[16],r[19]=n[17]}]))})},function(e){return t.storedProcedure(n("LSFindBackup")).then(function(e){var t;return t=e,r[21]=t[0],t})},function(o){var a;return t.blobs.neq(r[5],void 0)?t.sequence([function(o){var a;return t.i64.neq(r[3],void 0)?t.sequence([function(o){var a;return r[21]!==void 0?t.sequence([function(o){var a;return t.blobs.neq(r[4],void 0)?t.sequence([function(o){return r[30]=t.createArray(),r[39]=(r[30].push(r[21]),r[30]),r[39]=(r[30].push(e[1]),r[30]),r[31]=t.toJSON(r[30]),r[32]=t.createArray(),r[39]=(r[32].push(t.i64.cast([0,32])),r[32]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",e[5]].join("")).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[33],void 0,r[4],r[32]).then(function(e){var t;return t=e,r[34]=t[0],t})},function(e){return r[34]?r[35]=!1:r[35]=!0,r[35]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),r[40]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[40]].join("")),r[39]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[40],r[39],t.i64.cast([0,3]))},function(e){return r[36]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[34],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[39]=t[0],r[40]=t[1],t})},function(e){return r[36]=r[39]}])},function(o){var a;return t.blobs.neq(r[36],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSGetBlobFromInt64BE.nop"),e[6]).then(function(e){var t;return t=e,r[39]=t[0],t})},function(e){return t.nativeOperation(n("LSTruncateSortKey.nop"),r[39]).then(function(e){var t;return t=e,r[40]=t[0],t})},function(e){return t.nativeOperation(n("LSOpeEncrypt.nop"),r[36],r[40],t.i64.cast([0,16])).then(function(e){var t;return t=e,r[41]=t[0],t})},function(e){return t.nativeOperation(n("LSBinaryToHex.nop"),r[41]).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[31]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),r[43]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[44]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[21]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[47]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[48]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[49]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWVzc2FnZV9pZF9zY29wZQ=="),r[51]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[52]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[53]).then(function(e){var t;return t=e,r[54]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[55]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[55]).then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[57]).then(function(e){var t;return t=e,r[58]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[5]).then(function(e){var t;return t=e,r[59]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("dGhyZWFkX2lkX3Njb3Bl"),r[59]).then(function(e){var t;return t=e,r[60]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[60]).then(function(e){var t;return t=e,r[61]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[61]).then(function(e){var t;return t=e,r[62]=t[0],t})},function(o){return r[63]=new t.Map,r[63].set("attachment_index_key",r[46]==null?"":r[46]),r[63].set("backup_ent_fbid",e[0]),r[63].set("delivery_object_id",e[1]),r[63].set("device_id",r[3]),r[63].set("mailbox_partial_id",r[50]==null?"":r[50]),r[63].set("media_type",e[3]),r[63].set("message_partial_id",r[54]==null?"":r[54]),r[63].set("product_type",e[2]),r[63].set("salt_partial_id",r[58]==null?"":r[58]),r[63].set("sort_key",r[42]==null?"":r[42]),r[63].set("thread_partial_id",r[62]==null?"":r[62]),r[63].set("isOpenEB",e[10]===!0),r[64]=new t.Map,r[64].set("otid",e[4]),r[64].set("server_thread_key",e[7]),r[64].set("timestamp",t.i64.to_string(e[6])),t.nativeOperation(n("LSBase64Encode.nop"),r[5]).then(function(e){var t;return t=e,r[65]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[4]).then(function(e){var t;return t=e,r[66]=t[0],t})},function(o){return r[67]=new t.Map,r[67].set("ocmf_client_state_blob",r[65]==null?"":r[65]),r[67].set("mailbox_root_key",r[66]==null?"":r[66]),r[68]=t.createArray(),r[80]=(r[68].push(e[4]),r[68]),r[80]=(r[68].push(e[1]),r[68]),r[69]=t.toJSON(r[68]),r[63].set("raw_identifiers",r[64]),r[63].set("backup_id",r[21]),r[63].set("thread_id",e[5]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[69]).then(function(e){var t;return t=e,r[70]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[70]).then(function(e){var t;return t=e,r[71]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[71]).then(function(e){var t;return t=e,r[72]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[72]).then(function(e){var t;return t=e,r[73]=t[0],t})},function(e){return r[63].set("salt_partial_access_token",r[73]==null?"":r[73]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[31]).then(function(e){var t;return t=e,r[74]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),r[74]).then(function(e){var t;return t=e,r[75]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[75]).then(function(e){var t;return t=e,r[76]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[76]).then(function(e){var t;return t=e,r[77]=t[0],t})},function(n){var o;return r[63].set("salt_partial_attachment_index_key",r[77]==null?"":r[77]),r[63].set("raw_tokens",r[67]),e[13]!==void 0&&r[63].set("access_token_secret",e[13]),e[14]!==void 0&&r[63].set("primary_key_secret",e[14]),r[78]=t.toJSON(r[63]),r[79]=new t.Map,r[79].set("payload",r[78]),o=[r[79],void 0],r[37]=o[0],r[38]=o[1]}]):t.resolve((r[39]=new t.Map,r[39].set("error_code",t.i64.cast([0,25])),r[39].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[39].set("error_message","OPE key is null for IssueAttachmentRestoreTask"),a=[void 0,r[39]],r[37]=a[0],r[38]=a[1]))},function(e){var t;return t=[r[37],r[38]],r[28]=t[0],r[29]=t[1],t}]):t.resolve((r[30]=new t.Map,r[30].set("error_code",t.i64.cast([0,20])),r[30].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[30].set("error_message","Missing mailbox_root_key for IssueAttachmentRestoreTask"),a=[void 0,r[30]],r[28]=a[0],r[29]=a[1]))},function(e){var t;return t=[r[28],r[29]],r[26]=t[0],r[27]=t[1],t}]):t.resolve((r[28]=new t.Map,r[28].set("error_code",t.i64.cast([0,1])),r[28].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[28].set("error_message","Missing backup_id for IssueAttachmentRestoreTask"),a=[void 0,r[28]],r[26]=a[0],r[27]=a[1]))},function(e){var t;return t=[r[26],r[27]],r[24]=t[0],r[25]=t[1],t}]):t.resolve((r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,24])),r[26].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[26].set("error_message","Missing device_id for IssueAttachmentRestoreTask"),a=[void 0,r[26]],r[24]=a[0],r[25]=a[1]))},function(e){var t;return t=[r[24],r[25]],r[22]=t[0],r[23]=t[1],t}]):t.resolve((r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,22])),r[24].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[24].set("error_message","Missing ocmf_client_state_blob for IssueAttachmentRestoreTask"),a=[void 0,r[24]],r[22]=a[0],r[23]=a[1]))},function(e){var t;return t=[r[22],r[23]],r[0]=t[0],r[1]=t[1],t}])},function(e){var t;return t=[r[0],r[1]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"],a.exports=e}),null);
__d("LSCreateResignCDNUrlPayloadStoredProcedure",["LSCreateResignCDNUrlPayload","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSCreateResignCDNUrlPayload"),a.backupEntFbid,a.deliveryObjectId,a.productType,a.mediaType,a.messageId,a.threadId,a.sortOrder,a.serverThreadKey,a.deviceId,a.backupId,a.isOpenEb,a.ocmfClientState,a.mailboxRootKey,a.accessTokenSecret,a.primaryKeySecret);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBLSResignCdnUrl",["Base64Utils","EBCreateResignCDNUrlPayload","EBEnqueueResignCdnUrlRequests","EBLS","EBMinosCheckWasmFeatureSupport","EBMinosWasmDeriveAttachmentTokenPrimaryKey","FBLogger","I64","LSCreateResignCDNUrlPayloadStoredProcedure","LSFactory","LSShape","MAWConfig","WAJids","WAResultOrError","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S=function(){return r("FBLogger")("wmi").tags(["labyrinth_web","resign_cdn_url"])},R="-8",L=(v||(v=o("I64"))).of_string(R);async function E(t){var n=t.chatJid,a=t.deliveryObjectId,l=t.externalId,_=t.mediaDownloadFlow,f=t.mediaKey,g=t.mediaType,h=t.sortOrderMs;S().INFO(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL"])));var y=await o("EBMinosCheckWasmFeatureSupport").checkWasFeatureSupportAndQE();_==null||_.addPoint("resign_cdn_url_gql_ebls_start");var C=(await o("EBLS").init()).db;_==null||_.addPoint("resign_cdn_url_gql_ebls_end");var b=null,R=null;if(y){var E=await o("EBMinosWasmDeriveAttachmentTokenPrimaryKey").deriveAttachmentTokenPrimaryKeySecret(f);E.success?(b=o("Base64Utils").fromArrayBuffer(E.value.accessToken),R=o("Base64Utils").fromArrayBuffer(E.value.primaryKey)):S().WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),E.error)}var k={accessTokenSecret:b,backupEntFbid:L,deliveryObjectId:a,mediaType:g,messageId:l,primaryKeySecret:R,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,sortOrder:(v||(v=o("I64"))).of_float(h),threadId:o("WAJids").threadIdForChatJid(n)};_==null||_.addPoint("resign_cdn_url_gql_payload_start");var I=[C.runInTransaction(function(e){return r("LSCreateResignCDNUrlPayloadStoredProcedure")(r("LSFactory")(e),k)},"readwrite",void 0,void 0,i.id+":108").then(function(e){var t=e[0],n=e[1];if(t!=null)return o("LSShape").toRecord(t);var r=n==null?{}:o("LSShape").toRecord(n);return S().MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload. stored procedure: ",", error code: ",", error message: ",""])),r.stored_procedure,r.error_code,r.error_message),null}).catch(function(e){var t=r("getErrorSafe")(e);return _==null||_.addPoint("resign_cdn_url_gql_lsdb_payload_fail"),S().catching(t).MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to create lsdb payload"]))),null}),o("EBCreateResignCDNUrlPayload").createStringifiedMediaRestorePayloadFromEBDB({accessTokenSecret:b,deliveryObjectId:a,mediaType:g,messageId:l,primaryKeySecret:R,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,sortOrderMs:h,threadId:o("WAJids").threadIdForChatJid(n)}).then(function(e){return e.success?{payload:e.value}:(_==null||_.addPoint("resign_cdn_url_gql_ebdb_payload_fail"),_==null||_.addAnnotations({string:{payload_fail_error:e.error}}),null)}).catch(function(e){var t=r("getErrorSafe")(e);return S().catching(t).MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to create ebdb payload"]))),_==null||_.addAnnotations({string:{payload_fail_error:t.message}}),null})],T=await Promise.all(I),D=T[0],x=T[1],$=D!=null?D:x;if(D==null&&x!=null&&(_==null||_.addPoint("resign_cdn_url_fallback_to_ebdb")),$==null)return _==null||_.addPoint("resign_cdn_url_gql_payload_fail"),o("WAResultOrError").makeError("create-payload-failed");_==null||_.addPoint("resign_cdn_url_gql_payload_end"),_==null||_.addPoint("resign_cdn_url_gql_restore_start");var P=await o("EBEnqueueResignCdnUrlRequests").enqueueResignCdnUrl(a,$,_);return P.success?(_==null||_.addPoint("resign_cdn_url_gql_restore_end"),S().INFO(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL succeeded"]))),o("WAResultOrError").makeResult(P.value)):(S().MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),P.error),_==null||_.addPoint("resign_cdn_url_gql_restore_fail"),P)}function k(e,t){var n=[];for(var r in e)e[r]instanceof Object?t[r]instanceof Object?n.push.apply(n,k(e[r],t[r])):n.push(r):e[r]!==t[r]&&n.push(r);return n}async function I(e){var t=e.chatJid,n=e.deliveryObjectId,r=e.externalId,a=e.mediaDownloadFlow,i=e.mediaKey,l=e.mediaType,s=e.sortOrderMs,u=await o("EBMinosCheckWasmFeatureSupport").checkWasFeatureSupportAndQE(),c=null,d=null;if(u){var m=await o("EBMinosWasmDeriveAttachmentTokenPrimaryKey").deriveAttachmentTokenPrimaryKeySecret(i);m.success?(c=o("Base64Utils").fromArrayBuffer(m.value.accessToken),d=o("Base64Utils").fromArrayBuffer(m.value.primaryKey)):S().WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["",""])),m.error)}var p={accessTokenSecret:c,chatJid:t,deliveryObjectId:n,externalId:r,mediaDownloadFlow:a,mediaType:l,primaryKeySecret:d,sortOrderMs:s},f=await D(p);if(f==null)return T(p);var g=await $({deliveryObjectId:n,mediaDownloadFlow:a,payload:f});return g.success?g:T(p)}async function T(e){var t;(t=e.mediaDownloadFlow)==null||t.addPoint("resign_cdn_url_fallback_to_ls");var n=await x(e);return n==null?o("WAResultOrError").makeError("create-payload-failed"):$({deliveryObjectId:e.deliveryObjectId,mediaDownloadFlow:e.mediaDownloadFlow,payload:n})}function D(e){var t=e.accessTokenSecret,n=e.chatJid,a=e.deliveryObjectId,i=e.externalId,l=e.mediaDownloadFlow,s=e.mediaType,u=e.primaryKeySecret,c=e.sortOrderMs;return l==null||l.addPoint("resign_cdn_url_gql_payload_start"),o("EBCreateResignCDNUrlPayload").createStringifiedMediaRestorePayloadFromEBDB({accessTokenSecret:t,deliveryObjectId:a,mediaType:s,messageId:i,primaryKeySecret:u,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,sortOrderMs:c,threadId:o("WAJids").threadIdForChatJid(n)}).then(function(e){return e.success?(l==null||l.addPoint("resign_cdn_url_gql_payload_end"),{payload:e.value}):(l==null||l.addAnnotations({string:{payload_fail_error:e.error}}),l==null||l.addPoint("resign_cdn_url_gql_payload_fail"),null)}).catch(function(e){var t=r("getErrorSafe")(e);return S().catching(t).MUSTFIX(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload"]))),l==null||l.addAnnotations({string:{payload_fail_error:t.message}}),l==null||l.addPoint("resign_cdn_url_gql_payload_fail"),null})}function x(e){var t=e.accessTokenSecret,n=e.chatJid,a=e.deliveryObjectId,l=e.externalId,s=e.mediaDownloadFlow,u=e.mediaType,c=e.primaryKeySecret,d=e.sortOrderMs;return s==null||s.addPoint("resign_cdn_url_gql_payload_start"),o("EBLS").init().then(function(e){return e.db.runInTransaction(function(e){return r("LSCreateResignCDNUrlPayloadStoredProcedure")(r("LSFactory")(e),{accessTokenSecret:t,backupEntFbid:L,deliveryObjectId:a,mediaType:u,messageId:l,primaryKeySecret:c,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,sortOrder:(v||(v=o("I64"))).of_float(d),threadId:o("WAJids").threadIdForChatJid(n)})},"readwrite",void 0,void 0,i.id+":362").then(function(e){var t=e[0],n=e[1];if(t!=null)return s==null||s.addPoint("resign_cdn_url_gql_payload_end"),o("LSShape").toRecord(t);var r=n==null?{}:o("LSShape").toRecord(n);return S().MUSTFIX(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload. stored procedure: ",", error code: ",", error message: ",""])),r.stored_procedure,r.error_code,r.error_message),s==null||s.addPoint("resign_cdn_url_gql_payload_fail"),null})}).catch(function(e){var t=r("getErrorSafe")(e);return S().catching(t).MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload"]))),s==null||s.addAnnotations({string:{payload_fail_error:t.message}}),s==null||s.addPoint("resign_cdn_url_gql_payload_fail"),null})}function $(e){var t=e.deliveryObjectId,n=e.mediaDownloadFlow,a=e.payload;return n==null||n.addPoint("resign_cdn_url_gql_restore_start"),o("EBEnqueueResignCdnUrlRequests").enqueueResignCdnUrl(t,a,n).then(function(e){return e.success?(n==null||n.addPoint("resign_cdn_url_gql_restore_end"),S().INFO(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with GraphQL succeeded"]))),e):(S().MUSTFIX(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with GraphQL failed: ",""])),e.error),n==null||n.addPoint("resign_cdn_url_gql_restore_fail"),e)}).catch(function(e){var t=r("getErrorSafe")(e);return S().catching(t).MUSTFIX(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Failed to resign cdn url"]))),n==null||n.addAnnotations({string:{resign_cdn_url_gql_restore_error:t.message}}),n==null||n.addPoint("resign_cdn_url_gql_restore_fail"),o("WAResultOrError").makeError("resign-cdn-url-runtime-error")})}l.DEPRECATED_eblsResignCdnUrlWithGraphQL=E,l.getPayloadMismatches=k,l.resignCdnUrlUsingEbdb=I}),98);
__d("EBOptOut",["EBAPIQPLPoints","EBDeps","EBSMAPI","ReQL","WAResultOrError","promiseDone","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("encryptedBackupsOptOutOfBackup").__setRef("EBOptOut");function s(t){var n=t.qplFlow;return new Promise(function(t,a){return void e.load().then(async function(e){n.addPoint("eb_opt_out_get_db_start");var a=await o("EBDeps").getDeps().getLSDB();n.addPoint("eb_opt_out_get_db_end"),r("promiseDone")(e.optOutOfBackupStoredProcedure(a),function(e){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_SPROC_END);var i=a.tables.secure_encrypted_backups_client_state.subscribe(function(){r("promiseDone")(o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)),function(e){if(e!=null)if(e.length===0)r("promiseDone")(r("EBSMAPI").fetchBackupIds("useEncryptedBackupsOptOutOfBackupDeferred.react").finally(function(){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_TASK_END),n.endSuccess(),i(),t(o("WAResultOrError").makeResult())}));else{n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_ROW_EXISTS);return}else n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_ROW_NULL),n.endFail("opt_out_backup_row_null"),i(),t(o("WAResultOrError").makeError("EB_OPT_OUT_CLIENT_STATE_NULL"))})})},function(){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_SPROC_FAIL),n.endFail("opt_out_backup_sproc_fail"),t(o("WAResultOrError").makeError("EB_OPT_OUT_SPROC_FAILURE"))})})})}l.ebOptOut=s}),98);
__d("LSGenerateLocalKeys",["LSArrayGetObjectAt","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateLocalKeys] Beginning execution."),r[1]=t.i64.of_float(Date.now()),e[0]?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[29]=new t.Map,r[29].set("error_msg","Expected a nonempty query result"),r[29].set("code",t.i64.cast([0,3])),r[29].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[30]=t.createArray(),r[31]=(r[30].push(r[29]),r[30]),o=[void 0,r[30]],r[17]=o[0],r[18]=o[1]):(n=l.item,r[29]=new t.Map,r[29].set("backup_id",n.backupId),r[29].set("device_public_key_blob",n.devicePublicKeyBlob),r[29].set("device_private_key_blob",n.devicePrivateKeyBlob),r[29].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[29].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[29].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[29].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[29].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[29].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[29].set("orf_client_state_v2_blob",void 0),r[29].set("orf_v2_authority_level",void 0),r[29].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[29].set("device_id",n.deviceId),r[29].set("backup_tenancy",n.backupTenancy),r[29].set("encryption_version",n.encryptionVersion),r[29].set("revision_version",n.revisionVersion),r[29].set("initialize_restore_result",void 0),r[29].set("device_creation_timestamp_sec",void 0),r[29].set("authority_level",n.authorityLevel),a=[r[29],void 0],r[17]=a[0],r[18]=a[1])})},function(e){return r[20]=new t.Map,r[20].set("value",r[17]),r[20].set("errors",r[18]),r[21]=r[20].get("value"),r[21]!==void 0?t.sequence([function(e){return r[29]=r[21].get("backup_id"),r[30]=r[21].get("device_public_key_blob"),r[31]=r[21].get("device_private_key_blob"),r[32]=r[21].get("epoch_storage_public_key_blob"),r[33]=r[21].get("epoch_storage_private_key_blob"),r[34]=r[21].get("epoch_auth_public_key_blob"),r[35]=r[21].get("epoch_auth_private_key_blob"),r[36]=r[21].get("mailbox_root_key_blob"),r[37]=r[21].get("ocmf_client_state_blob"),r[38]=r[21].get("orf_client_state_v2_blob"),r[39]=r[21].get("orf_v2_authority_level"),r[40]=r[21].get("oblivious_validation_token_blob"),r[41]=r[21].get("device_id"),r[42]=r[21].get("backup_tenancy"),r[43]=r[21].get("encryption_version"),r[44]=r[21].get("revision_version"),r[45]=r[21].get("initialize_restore_result"),r[46]=r[21].get("device_creation_timestamp_sec"),r[47]=r[21].get("authority_level"),t.i64.neq(r[41],void 0)?t.sequence([function(e){return r[55]=void 0,t.i64.neq(r[55],void 0)?t.resolve(r[56]=r[55]):t.sequence([function(e){return r[59]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[60]=t[0],t})},function(e){return r[60]&&(r[69]=(r[59].push(t.i64.cast([0,0])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[61]=t[0],t})},function(e){return r[61]&&(r[69]=(r[59].push(t.i64.cast([0,2])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[62]=t[0],t})},function(e){return r[62]&&(r[69]=(r[59].push(t.i64.cast([0,3])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[63]=t[0],t})},function(e){return r[63]&&(r[69]=(r[59].push(t.i64.cast([0,4])),r[59])),r[64]=t.createArray(),r[65]=t.i64.of_int32(r[59].length),t.i64.gt(r[65],t.i64.cast([0,0]))?t.loopAsync(r[65],function(e){return r[69]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[59],r[69]).then(function(e){var t;return t=e,r[70]=t[0],r[71]=t[1],t})},function(e){return r[72]=(r[64].push(r[70]),r[64])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[69]=t.createArray(),r[70]=t.i64.of_int32(r[64].length),t.i64.gt(r[70],t.i64.cast([0,0]))?t.loopAsync(r[70],function(e){return r[72]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[64],r[72]).then(function(e){var t;return t=e,r[73]=t[0],r[74]=t[1],t})},function(e){return r[75]=(r[69].push(t.i64.to_string(r[73])),r[69])}])}):t.resolve()},function(e){return r[71]=r[69].join(","),r[66]=r[71]}])},function(e){return r[64].some(function(e){return t.i64.eq(r[43],e)})?r[67]=r[43]:r[67]=void 0,t.i64.neq(r[67],void 0)?r[68]=r[67]:r[68]=void 0,r[56]=r[68]}])},function(e){var n;return t.i64.neq(r[56],void 0)?r[57]=r[56]:r[57]=t.i64.cast([0,0]),t.i64.neq(r[42],void 0)?r[58]=r[42]:r[58]=t.i64.cast([0,1]),n=[!0,r[30],r[31],r[32],r[33],r[34],r[35]],r[48]=n[0],r[49]=n[1],r[50]=n[2],r[51]=n[3],r[52]=n[4],r[53]=n[5],r[54]=n[6]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 24"),r[56]="Fetching keys locally failed. Reason: 24",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] ","",r[56]].join("")),r[55]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure",r[56],r[55],t.i64.cast([0,3]))},function(e){var n;return n=[!1,t.blob("ZGV2aWNlX3B1YmxpY19rZXk="),t.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),t.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],r[48]=n[0],r[49]=n[1],r[50]=n[2],r[51]=n[3],r[52]=n[4],r[53]=n[5],r[54]=n[6],n}])},function(e){var t;return t=[r[48],r[49],r[50],r[51],r[52],r[53],r[54]],r[22]=t[0],r[23]=t[1],r[24]=t[2],r[25]=t[3],r[26]=t[4],r[27]=t[5],r[28]=t[6],t}]):t.sequence([function(e){return r[29]=r[20].get("errors"),r[30]=r[20].get("errors"),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 1"),r[32]="Fetching keys locally failed. Reason: 1",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] ","",r[32]].join("")),r[31]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure",r[32],r[31],t.i64.cast([0,3]))},function(e){var n;return n=[!1,t.blob("ZGV2aWNlX3B1YmxpY19rZXk="),t.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),t.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],r[22]=n[0],r[23]=n[1],r[24]=n[2],r[25]=n[3],r[26]=n[4],r[27]=n[5],r[28]=n[6],n}])},function(e){var t;return t=[r[22],r[23],r[24],r[25],r[26],r[27],r[28]],r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],r[6]=t[4],r[7]=t[5],r[8]=t[6],t}]):t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[17]=t[0],r[18]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[19]=t[0],r[20]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[21]=t[0],r[22]=t[1],t})},function(e){var t;return t=[!0,r[18],r[17],r[20],r[19],r[22],r[21]],r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],r[6]=t[4],r[7]=t[5],r[8]=t[6],t}])},function(e){var o;return r[2]?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[4],t.blob("MA=="),r[5]).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[4],t.blob("MQ=="),r[7]).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){var n;return r[19]=new t.Map,r[19].set("device_private_key",r[4]),r[19].set("device_public_key",r[3]),r[20]=new t.Map,r[20].set("epoch_storage_private_key",r[6]),r[20].set("epoch_storage_public_key",r[5]),r[21]=new t.Map,r[21].set("epoch_auth_private_key",r[8]),r[21].set("epoch_auth_public_key",r[7]),r[22]=new t.Map,r[22].set("device_key",r[19]),r[22].set("epoch_storage_key",r[20]),r[22].set("epoch_storage_public_key_sig",r[17]==null?t.blob("bnVsbA=="):r[17]),r[22].set("epoch_auth_key",r[21]),r[22].set("epoch_auth_public_key_sig",r[18]==null?t.blob("bnVsbA=="):r[18]),n=[r[22],void 0],r[9]=n[0],r[10]=n[1]}]):t.resolve((r[17]=new t.Map,r[17].set("error_code",t.i64.cast([0,9])),r[17].set("stored_procedure","LSEncryptedBackupsGenerateLocalKeysStoredProcedure"),r[17].set("error_message",""),o=[void 0,r[17]],r[9]=o[0],r[10]=o[1]))},function(e){return r[11]=t.i64.of_float(Date.now()),r[12]=t.i64.random(),r[14]="Finishing execution. Execution time: ",r[15]=t.i64.to_string(t.i64.sub(r[11],r[0])),r[16]=" ms",r[13]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateLocalKeys] ",r[13],r[14],r[13],r[15],r[13],r[16]].join("")),t.i64.eq(t.i64.mod_(r[12],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[17]=",",r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateLocalKeys",[r[14],r[17],r[15],r[17],r[16]].join(""),r[18],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[9],r[10]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateLocalKeysStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"],a.exports=e}),null);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGenerateLocalKeys","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Beginning execution."),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return r[8]?r[9]=!0:r[9]=!1,r[9]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[11]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[11]].join("")),r[10]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[11],r[10],t.i64.cast([0,3]))):t.resolve()}])},function(o){return t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(e){return t.db.table(168).fetch().next().then(function(e,r){var o=e.done,a=e.value;return o?0:(r=a.item,t.storedProcedure(n("LSDeleteBackupOnClient"),r.backupId,void 0,!1,void 0,"null",!0))})},function(o){return r[8]=e[0].get("backup_id"),t.storedProcedure(n("LSGenerateLocalKeys"),!1).then(function(e){var t;return t=e,r[9]=t[0],r[10]=t[1],t})},function(o){return r[9]!==void 0?t.sequence([function(e){return r[11]=r[9].get("device_key"),r[12]=r[9].get("epoch_storage_key"),r[13]=r[9].get("epoch_auth_key"),r[14]=r[11].get("device_private_key"),r[15]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]&&(r[44]=(r[15].push(t.i64.cast([0,0])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return r[17]&&(r[44]=(r[15].push(t.i64.cast([0,2])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]&&(r[44]=(r[15].push(t.i64.cast([0,3])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return r[19]&&(r[44]=(r[15].push(t.i64.cast([0,4])),r[15])),r[20]="",r[21]=t.i64.of_int32(r[15].length),t.i64.gt(r[21],t.i64.cast([0,0]))?t.loopAsync(r[21],function(e){return r[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[15],r[44]).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return r[20]=[r[20],"_",t.i64.to_string(r[45])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",r[20],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,r[22]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[14],t.blob("Mg=="),r[22]).then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return t.blobs.neq(r[23],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[23]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return r[24]=r[44]}]):t.resolve(r[24]=void 0)},function(o){return r[25]=e[0].get("temp_ocmf_client_state"),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[25]).then(function(e){var t;return t=e,r[26]=t[0],r[27]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[44]=t[0],r[45]=t[1],t})},function(e){var t;return t=[r[26],r[27],r[44],r[45]],r[28]=t[0],r[29]=t[1],r[30]=t[2],r[31]=t[3],t}]):t.resolve((o=[r[26],r[27],void 0,void 0],r[28]=o[0],r[29]=o[1],r[30]=o[2],r[31]=o[3],o))},function(n){return r[32]=r[11].get("device_public_key"),r[33]=r[11].get("device_private_key"),r[34]=r[12].get("epoch_storage_public_key"),r[35]=r[12].get("epoch_storage_private_key"),r[36]=r[13].get("epoch_auth_public_key"),r[37]=r[13].get("epoch_auth_private_key"),r[38]=e[0].get("mailbox_root_key"),r[39]=e[0].get("oblivious_validation_token"),t.forEach(t.filter(t.db.table(168).fetch([[[r[8]]]]),function(e){return t.i64.eq(e.backupId,r[8])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[8],devicePublicKeyBlob:r[32],devicePrivateKeyBlob:r[33],epochStoragePublicKeyBlob:r[34],epochStoragePrivateKeyBlob:r[35],epochAuthPublicKeyBlob:r[36],epochAuthPrivateKeyBlob:r[37],mailboxRootKeyBlob:r[38],ocmfClientStateBlob:r[28],obliviousValidationTokenBlob:r[39],authorityLevel:t.i64.cast([0,20]),backupTenancy:t.i64.cast([0,1]),revisionVersion:t.i64.cast([0,1]),encryptionVersion:t.i64.cast([0,0])})},function(o){return r[40]=e[0].get("add_peer_epoch_data"),r[41]=t.i64.of_int32(r[40].length),t.i64.gt(r[41],t.i64.cast([0,0]))?t.loopAsync(r[41],function(e){return r[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[40],r[44]).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return r[47]=r[45].get("epoch_id"),r[48]=r[45].get("epoch_anon_id"),r[49]=r[45].get("epoch_root_key"),r[50]=r[45].get("epoch_status"),r[51]=r[45].get("epoch_head"),t.forEach(t.filter(t.db.table(169).fetch([[[r[47]]]]),function(e){return t.i64.eq(e.epochId,r[47])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(e){return t.db.table(169).add({epochId:r[47],authorityLevel:t.i64.cast([0,80]),backupId:r[8],epochAnonIdBlob:r[48],epochRootKeyBlob:r[49],epochStatus:r[50],epochHead:r[51]})}])}):t.resolve()},function(e){return t.count(t.db.table(169).fetch()).then(function(e){return r[42]=e})},function(e){return t.i64.le(r[42],t.i64.cast([0,1]))?t.sequence([function(e){return t.db.table(169).fetch().next().then(function(e,o){var a=e.done,i=e.value;return a?t.sequence([function(e){return r[46]="No epoch available in epochs table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[46]].join("")),r[47]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[46]].join(""),r[47],t.i64.cast([0,3]))},function(e){return r[44]=void 0}]):(o=i.item,r[46]=new t.Map,r[46].set("epoch_id",o.epochId),r[46].set("backup_id",o.backupId),r[46].set("epoch_anon_id_blob",o.epochAnonIdBlob),r[46].set("epoch_root_key_blob",o.epochRootKeyBlob),r[46].set("epoch_status",o.epochStatus),r[46].set("epoch_head",o.epochHead),r[46].set("authority_level",o.authorityLevel),r[44]=r[46])})},function(e){return r[43]=r[44]}]):t.sequence([function(e){return r[44]="Multiple epochs available in epochs table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[44]].join("")),r[45]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[44]].join(""),r[45],t.i64.cast([0,3]))},function(e){return r[43]=void 0}])},function(o){return r[43]!==void 0?t.sequence([function(e){return r[44]=r[43].get("epoch_anon_id_blob"),r[45]=r[43].get("epoch_root_key_blob"),r[46]=r[11].get("device_public_key"),r[47]=t.createArray(),r[51]=(r[47].push(t.i64.cast([0,32])),r[47]),t.nativeOperation(n("LSBase64Encode.nop"),r[44]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[48]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[48]].join("")),void 0,r[45],r[47]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return r[51]?r[52]=!1:r[52]=!0,r[52]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[55]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[55]].join("")),r[54]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[55],r[54],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return r[53]=r[56]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[51],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[54]=t[0],r[55]=t[1],t})},function(e){return r[53]=r[54]}])},function(e){return r[49]=r[53]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[52]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[52]].join("")),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[52],r[51],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[49]=r[53]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[49],r[46]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(o){return t.blobs.neq(r[50],void 0)?t.sequence([function(e){return r[51]=r[11].get("device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[51]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[50]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[54]=r[43].get("epoch_root_key_blob"),t.blobs.neq(r[54],void 0)?t.sequence([function(e){return r[81]=t.createArray(),r[87]=(r[81].push(t.i64.cast([0,18])),r[81]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[54],r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return r[82]!==void 0?t.sequence([function(e){return r[87]=t.i64.of_int32(r[82].length),t.i64.ge(r[87],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[82],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[89]=t[0],r[90]=t[1],t})},function(e){return r[88]=r[89]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[90]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[90]].join("")),r[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[90],r[89],t.i64.cast([0,3]))},function(e){return r[88]=void 0}])},function(e){return r[83]=r[88]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[88]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[88]].join("")),r[87]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[88],r[87],t.i64.cast([0,3]))},function(e){return r[83]=void 0}])},function(e){return t.blobs.neq(r[83],void 0)?r[84]=!0:r[84]=!1,r[84]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),r[83]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return r[85]!==void 0?r[86]=r[85]:r[86]="encodingfailed",r[55]=r[86]}]):t.resolve(r[55]="null")},function(e){return r[56]=r[12].get("epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(e){return r[58]=r[9].get("epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),r[58]).then(function(e){var t;return t=e,r[59]=t[0],t})},function(e){return r[60]=r[13].get("epoch_auth_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[60]).then(function(e){var t;return t=e,r[61]=t[0],t})},function(e){return r[62]=r[9].get("epoch_auth_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),r[62]).then(function(e){var t;return t=e,r[63]=t[0],t})},function(o){return r[64]=r[11].get("device_private_key"),r[65]=e[0].get("mailbox_root_key"),r[66]=r[12].get("epoch_storage_private_key"),t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"private_key",r[64],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[67]=r[83]}]):t.resolve(r[67]=void 0)},function(e){return t.blobs.neq(r[67],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[67]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[68]=r[81]}]):t.resolve(r[68]=void 0)},function(e){return t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"ocmf_client_state",r[28],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[69]=r[83]}]):t.resolve(r[69]=void 0)},function(e){return t.blobs.neq(r[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[69]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[70]=r[81]}]):t.resolve(r[70]=void 0)},function(e){return t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"epoch_storage_private_key",r[66],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[71]=r[83]}]):t.resolve(r[71]=void 0)},function(e){return t.blobs.neq(r[71],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[71]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[72]=r[81]}]):t.resolve(r[72]=void 0)},function(o){return r[73]=e[0].get("backup_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[29]).then(function(e){var t;return t=e,r[74]=t[0],t})},function(o){return r[75]=e[0].get("server_data_id"),r[76]=r[43].get("epoch_id"),r[77]=new t.Map,r[77].set("supported_encryption_versions",r[15]),r[77].set("client_version",t.i64.cast([0,1])),r[77].set("version_sig",r[24]==null?"":r[24]),r[78]=new t.Map,r[78].set("backup_id",r[73]),r[78].set("device_epoch_hmac",r[53]==null?"":r[53]),r[78].set("epoch_root_key_fingerprint",r[55]),r[78].set("device_public_key",r[52]==null?"":r[52]),r[78].set("epoch_auth_pubkey",r[61]==null?"":r[61]),r[78].set("epoch_auth_pubkey_sig",r[63]==null?"":r[63]),r[78].set("epoch_storage_pubkey",r[57]==null?"":r[57]),r[78].set("epoch_storage_pubkey_sig",r[59]==null?"":r[59]),r[78].set("ocmf_rotation_token",r[74]==null?"":r[74]),r[78].set("server_data_id",r[75]),r[78].set("device_registration_id",e[1]),r[78].set("base_epoch_id",r[76]),r[78].set("encryption_version_data",r[77]),r[78].set("private_key_debug_token",r[68]),r[78].set("ocmf_client_state_debug_token",r[70]),r[78].set("epoch_storage_pvtkey_debug_token",r[72]),r[78].set("trace_id",void 0),r[78].set("occam_only_eligible",!0),r[79]=t.toJSON(r[78]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50017]),r[79],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[80]=t[0],t})}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null"),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","$device_epoch_hmac found to be null",r[51],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition"),r[44]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! There should be exactly one open epoch. Deleting local state and terminating device addition",r[44],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition"),r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! Error in generating the keys. Deleting local state and terminating device addition",r[11],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):(a=l.item,r[8]="An authoritative row already exists, aborting execution of add peer device",r[8]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[8]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",r[8],r[9],t.i64.cast([0,3]))):t.resolve())})},function(e){return r[2]=t.i64.of_float(Date.now()),r[3]=t.i64.random(),r[5]="Finishing execution. Execution time: ",r[6]=t.i64.to_string(t.i64.sub(r[2],r[0])),r[7]=" ms",r[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ",r[4],r[5],r[4],r[6],r[4],r[7]].join("")),t.i64.eq(t.i64.mod_(r[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[8]=",",r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[5],r[8],r[6],r[8],r[7]].join(""),r[9],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSDeserializeSecretsAndAddDevice",["LSArrayGetObjectAt","LSBase64Decode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSFinishAddPeerDevice","LSQplInteractionHelper.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return t.nativeOperation(n("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_START",t.i64.cast([0,0]),void 0)},function(o){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),e[0]).then(function(e){var t;return t=e,r[0]=t[0],t})},function(e){return t.nativeOperation(n("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_END",t.i64.cast([0,0]),void 0)},function(e){return r[1]=r[0].get("temp_ocmf_client_state"),t.nativeOperation(n("LSBase64Decode.nop"),r[1]).then(function(e){var t;return t=e,r[2]=t[0],t})},function(e){return r[3]=r[0].get("mailbox_root_key"),t.nativeOperation(n("LSBase64Decode.nop"),r[3]).then(function(e){var t;return t=e,r[4]=t[0],t})},function(e){return r[5]=r[0].get("oblivious_validation_token"),t.nativeOperation(n("LSBase64Decode.nop"),r[5]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[7]=t.createArray(),r[8]=r[0].get("add_peer_epoch_data_serializable"),r[9]=t.i64.of_int32(r[8].length),t.i64.gt(r[9],t.i64.cast([0,0]))?t.loopAsync(r[9],function(e){return r[14]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[8],r[14]).then(function(e){var t;return t=e,r[15]=t[0],r[16]=t[1],t})},function(e){return r[17]=r[15].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Decode.nop"),r[17]).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[19]=r[15].get("epoch_root_key"),t.nativeOperation(n("LSBase64Decode.nop"),r[19]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return r[21]=r[15].get("epoch_id"),r[22]=r[15].get("epoch_status"),r[23]=new t.Map,r[23].set("epoch_id",r[21]),r[23].set("epoch_anon_id",r[18]==null?t.blob(""):r[18]),r[23].set("epoch_root_key",r[20]==null?t.blob(""):r[20]),r[23].set("epoch_status",r[22]),r[24]=r[15].get("epoch_head"),r[24]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSBase64Decode.nop"),r[24]).then(function(e){var t;return t=e,r[25]=t[0],t})},function(e){return r[23].set("epoch_head",r[25])}]):t.resolve()},function(e){return r[25]=(r[7].push(r[23]),r[7])}])}):t.resolve()},function(o){return r[10]=r[0].get("backup_id"),r[11]=r[0].get("server_data_id"),r[12]=new t.Map,r[12].set("backup_id",r[10]),r[12].set("server_data_id",r[11]),r[12].set("temp_ocmf_client_state",r[2]==null?t.blob(""):r[2]),r[12].set("mailbox_root_key",r[4]==null?t.blob(""):r[4]),r[12].set("oblivious_validation_token",r[6]==null?t.blob(""):r[6]),r[12].set("add_peer_epoch_data",r[7]),r[12]!==void 0?t.sequence([function(o){return t.storedProcedure(n("LSFinishAddPeerDevice"),r[12],e[1])},function(e){return r[13]=!0}]):t.resolve(r[13]=!1)},function(e){return o[0]=r[13]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsDeserializeSecretsAndAddDeviceStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSDeserializeSecretsAndAddDeviceStoredProcedure",["LSDeserializeSecretsAndAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSDeserializeSecretsAndAddDevice"),a.serializedPayload,a.deviceRegistrationId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBOtcAddDevice",["EBAPIQPLPoints","EBDeps","EBLogger","EBMainThreadEBDBApiDeferred","I64","LSDeserializeSecretsAndAddDeviceStoredProcedure","LSEncryptedBackupsRecoveryCodeStatus","LSFactory","LSIntEnum","ReQL","WAResultOrError","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t){var n=t.initiatorId,a=t.qplFlow,i=t.secrets,l=function(){};a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_START);var u=await o("EBDeps").getDeps().getLSDB();return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_START),new Promise(function(t,d){return u.runInTransaction(function(e){return r("LSDeserializeSecretsAndAddDeviceStoredProcedure")(r("LSFactory")(e),{deviceRegistrationId:n,serializedPayload:i})},"readwrite").then(function(n){var i=n[0];if(a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_END),!i)return a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_FAILURE),t(c("OTC_ADD_DEVICE_SPROC_FAILURE"));l=o("ReQL").fromTableAscending(u.tables.secure_encrypted_backups_recovery_code_status).subscribe(function(n,i){if(i.operation==="add"||i.operation==="put"){l();var u=i.value.recoveryCodeStatus;if((e||(e=o("I64"))).equal(u,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").VALID)))a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SUCCESS),a.endSuccess(),o("EBMainThreadEBDBApiDeferred").addNewDevice(),t(c("SUCCESS"));else if((e||(e=o("I64"))).equal(u,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR)))a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SYSTEM_ERROR),o("EBLogger").EBLogger().mustfix("PAKE: LSEncryptedBackupsFinishAddPeerDeviceTask task failed"),t(c("OTC_ADD_DEVICE_SYSTEM_ERROR"));else{var d="PAKE: Unexpected recovery code status: "+(e||(e=o("I64"))).to_int32(u);a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS,{string:{errorMessage:d}}),o("EBLogger").EBLogger("wmi_eb").mustfix(d),t(c("OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS",d))}}})}).catch(function(e){l(),t(c("OTC_ADD_DEVICE_SPROC_ERROR",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)))})})}function c(e,t){return e==="SUCCESS"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError({errorMessage:t,status:e})}l.otcAddDevice=u}),98);
__d("EBRepairEpochQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25352669137720538"}),null);
__d("EBRepairEpochQuery.graphql",["EBRepairEpochQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null}],r={alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"request",variableName:"input"}],concreteType:"XFBRepairEpochResponse",kind:"LinkedField",name:"repair_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_success",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"target_device_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_sync_reason",storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:t,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:t,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null},{alias:null,args:null,concreteType:"XFBMinosEpoch",kind:"LinkedField",name:"to_minos_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"self_epoch_signature",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"error_code",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EBRepairEpochQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[r],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EBRepairEpochQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:n("EBRepairEpochQuery_facebookRelayOperation"),metadata:{},name:"EBRepairEpochQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBRepairEpochQuery",["EBRepairEpochQuery.graphql","WAResultOrError","createWorkerQuery"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var a,i=e!==void 0?e:e=n("EBRepairEpochQuery.graphql"),l=await r("createWorkerQuery")(i,{input:t}),s=l==null||(a=l.viewer)==null||(a=a.encrypted_backup)==null||(a=a.mailbox)==null?void 0:a.repair_epoch;return(s==null?void 0:s.is_success)===!0&&(s==null?void 0:s.epoch_derivation_set)!=null?o("WAResultOrError").makeResult(s.epoch_derivation_set):(s==null?void 0:s.exception_string)!=null?o("WAResultOrError").makeError({errorCode:s.error_code,message:s.exception_string}):o("WAResultOrError").makeError({message:"Repair epoch failed"})}l.RepairEpochQuery=s}),98);
__d("EBRepairEpochs",["Base64Utils","EBAPIQPLPoints","EBDeps","EBDeriveAndStoreEpochs","EBEpochUtils","EBGetClientState","EBRepairEpochQuery","I64","LSAuthorityLevel","LSIntEnum","QPLFlow","Random","ReQL","WAResultOrError","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(){var t=await o("EBDeps").getDeps().getLSDB(),n=o("Random").uint32(),a=String(n),i=o("QPLFlow").startQPLFlow(r("qpl")._(521474335,"1476"),{annotations:{string:{traceId:a}},instanceKey:n});try{i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_CLIENT_STATE_START);var l=await o("EBGetClientState").getClientState(t);if(i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_CLIENT_STATE_END),l==null)return i.endFail("client_state_is_missing"),o("WAResultOrError").makeError({message:"Client state is missing"});var u=l.backupId,c=l.device_id;if(u==null||c==null)return i.endFail("backup_id_or_device_id_is_missing"),o("WAResultOrError").makeError({message:"Backup ID or device ID is missing"});i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_EPOCHS_START);var d=await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_epochs));i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_EPOCHS_END);var m=await Promise.all(d.filter(function(t){return(e||(e=o("I64"))).equal(t.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))}).map(async function(t){var n=await o("EBEpochUtils").getFingerPrint(t.epochRootKeyBlob,"MEBEpochRootKey");return{epoch_id:(e||(e=o("I64"))).to_string(t.epochId),fingerprint:{sensitive_string_value:o("Base64Utils").fromArrayBuffer(n)}}}));i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.REPAIR_EPOCH_QUERY_START);var p=await o("EBRepairEpochQuery").RepairEpochQuery({backup_id:(e||(e=o("I64"))).to_string(u),device_id:e.to_string(c),locally_available_epochs:m,trace_id:a});if(i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.REPAIR_EPOCH_QUERY_END),!p.success){var _;return i.endFail("repair_epoch_query_failed",{string:{error_code:String((_=p.error.errorCode)!=null?_:"none"),error_message:p.error.message}}),p}return i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.DERIVE_AND_STORE_EPOCHS_START),await o("EBDeriveAndStoreEpochs").deriveAndStoreEpochsNonLS(t,p.value),i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.DERIVE_AND_STORE_EPOCHS_END),i.endSuccess(),p}catch(e){var f=r("getErrorSafe")(e);return i.endFail("runtime_error",{string:{error_message:f.message}}),o("WAResultOrError").makeError({message:f.message})}}l.EBRepairEpochs=u}),98);
__d("LSGetRemoveVirtualDeviceRequestStatus",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.islc(t.filter(t.db.table(184).fetch(),function(n){return t.blobs.eq(n.virtualDeviceId,e[0])}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(o,a){var i=o.done,l=o.value;return i?r[0]=t.i64.cast([0,3]):(a=l.item,t.sequence([function(o){return r[3]=a.removalStatus,t.i64.eq(r[3],t.i64.cast([0,1]))?t.resolve(r[2]=t.i64.cast([0,1])):t.sequence([function(o){return t.i64.eq(r[3],t.i64.cast([0,2]))?t.resolve(r[4]=t.i64.cast([0,0])):t.sequence([function(o){return t.i64.eq(r[3],t.i64.cast([0,3]))?t.resolve(r[5]=t.i64.cast([0,2])):t.sequence([function(o){return r[6]=["Unknown RemoveVirtualDeviceStatus found ",t.i64.to_string(r[3])].join(""),r[6]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure] ","",r[6]].join("")),r[7]=t.createArray(),e[1]!==void 0&&(r[8]=(r[7].push(e[1]),r[7])),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure",r[6],r[7],t.i64.cast([0,3]))):t.resolve()},function(e){return r[5]=t.i64.cast([-1,4294967295])}])},function(e){return r[4]=r[5]}])},function(e){return r[2]=r[4]}])},function(e){return r[0]=r[2]}]))})},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure",e.__tables__=["encrypted_backups_virtual_devices"],a.exports=e}),null);
__d("LSGetRemoveVirtualDeviceRequestStatusStoredProcedure",["LSGetRemoveVirtualDeviceRequestStatus","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSGetRemoveVirtualDeviceRequestStatus"),a.virtualDeviceId,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSRemoveVirtualDevice",["LSAppendDataTraceAddon","LSBase64Encode.nop","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return r[5]?r[6]=!0:r[6]=!1,r[6]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[8]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[8]].join("")),r[7]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[8],r[7],t.i64.cast([0,3]))):t.resolve()}])},function(n){return e[1]!==void 0?r[0]=e[1]:r[0]="vd_removal:remove_vd_task",t.islc(t.filter(t.db.table(184).fetch(),function(n){return t.blobs.eq(n.virtualDeviceId,e[0])}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[1]=n[0],r[2]=n[1],n):(t=i.item,o=[t.pk,t.backupId],r[1]=o[0],r[2]=o[1])})},function(o){return t.i64.neq(r[2],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSBase64Encode.nop"),e[0]).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return r[6]=new t.Map,r[6].set("backup_id",r[2]),r[6].set("virtual_device_id",r[5]==null?"":r[5]),r[6].set("removal_reason",r[0]),r[6].set("trace_id",void 0),r[7]=t.toJSON(r[6]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50024]),r[7],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return t.i64.neq(r[1],void 0)?t.forEach(t.db.table(184).fetch([[[r[1]]]]),function(e){var n=e.update,r=e.item;return n({removalStatus:t.i64.cast([0,2])})}):t.resolve()},function(e){return r[4]=t.i64.cast([0,0])}]):t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[6]?r[7]=!0:r[7]=!1,r[7]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[9]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[9]].join("")),r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[9],r[8],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[5]="Backup not found",r[5]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure] ","",r[5]].join("")),r[6]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure",r[5],r[6],t.i64.cast([0,3]))):t.resolve()},function(e){return r[4]=t.i64.cast([0,1])}])},function(e){return o[0]=r[4]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure",e.__tables__=["encrypted_backups_virtual_devices"],a.exports=e}),null);
__d("LSRemoveVirtualDeviceStoredProcedure",["LSRemoveVirtualDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSRemoveVirtualDevice"),a.virtualDeviceId,a.removalReason,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBRevokeVirtualDevice",["Base64Utils","EBAPIQPLPoints","EBDeps","I64","LSEncryptedBackupsOpStatus","LSFactory","LSGetRemoveVirtualDeviceRequestStatusStoredProcedure","LSIntEnum","LSRemoveVirtualDeviceStoredProcedure","WAResultOrError","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t,n){var a,i=function(){},l=(a=n.getQPLAttrs().instanceKey.toString())!=null?a:"";n.addPoint(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_START);var u=await o("EBDeps").getDeps().getLSDB();n.addPoint(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_END);var c=o("Base64Utils").toArrayBuffer(t),d=function(t){return u.runInTransaction(function(e){return r("LSGetRemoveVirtualDeviceRequestStatusStoredProcedure")(r("LSFactory")(e),{traceId:l,virtualDeviceId:t})},"readonly").then(function(e){return e[0]})};return u.runInTransaction(function(e){return r("LSRemoveVirtualDeviceStoredProcedure")(r("LSFactory")(e),{traceId:l,virtualDeviceId:c})},"readwrite").then(function(t){var a=t[0];return(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS))?new Promise(function(e,t){i=u.tables.encrypted_backups_virtual_devices.subscribe(function(){d(c).then(function(t){switch((s||(s=o("LSIntEnum"))).toNumber(t)){case 0:return;case 2:case-1:i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_STATUS_INTERNAL_ERROR),e(o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_GET_STATUS_INTERNAL_ERROR"));return;case 1:case 3:i(),n.endSuccess(),e(o("WAResultOrError").makeResult());return}}).catch(function(t){i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_ERROR,{string:{errorMessage:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(t)}}),e(o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_GET_SPROC_ERROR"))})})}):(i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE),o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE"))},function(e){return i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_SPROC_ERROR,{string:{errorMessage:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}}),o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE")})}l.revokeVirtualDevice=u}),98);
__d("LSSyncEpochs",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] Beginning execution."),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[13]=t[0],t})},function(e){return r[13]?r[14]=!0:r[14]=!1,r[14]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[16]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[16]].join("")),r[15]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[16],r[15],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[13]=new t.Map,r[13].set("error_msg","Expected a nonempty query result"),r[13].set("code",t.i64.cast([0,3])),r[13].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[14]=t.createArray(),r[15]=(r[14].push(r[13]),r[14]),o=[void 0,r[14]],r[1]=o[0],r[2]=o[1]):(n=l.item,r[13]=new t.Map,r[13].set("backup_id",n.backupId),r[13].set("device_public_key_blob",n.devicePublicKeyBlob),r[13].set("device_private_key_blob",n.devicePrivateKeyBlob),r[13].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[13].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[13].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[13].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[13].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[13].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[13].set("orf_client_state_v2_blob",void 0),r[13].set("orf_v2_authority_level",void 0),r[13].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[13].set("device_id",n.deviceId),r[13].set("backup_tenancy",n.backupTenancy),r[13].set("encryption_version",n.encryptionVersion),r[13].set("revision_version",n.revisionVersion),r[13].set("initialize_restore_result",void 0),r[13].set("device_creation_timestamp_sec",void 0),r[13].set("authority_level",n.authorityLevel),a=[r[13],void 0],r[1]=a[0],r[2]=a[1])})},function(e){return r[4]=new t.Map,r[4].set("value",r[1]),r[4].set("errors",r[2]),r[5]=r[4].get("value"),r[5]!==void 0?t.sequence([function(e){return r[13]=r[5].get("backup_id"),r[14]=r[5].get("device_public_key_blob"),r[15]=r[5].get("device_private_key_blob"),r[16]=r[5].get("epoch_storage_public_key_blob"),r[17]=r[5].get("epoch_storage_private_key_blob"),r[18]=r[5].get("epoch_auth_public_key_blob"),r[19]=r[5].get("epoch_auth_private_key_blob"),r[20]=r[5].get("mailbox_root_key_blob"),r[21]=r[5].get("ocmf_client_state_blob"),r[22]=r[5].get("orf_client_state_v2_blob"),r[23]=r[5].get("orf_v2_authority_level"),r[24]=r[5].get("oblivious_validation_token_blob"),r[25]=r[5].get("device_id"),r[26]=r[5].get("backup_tenancy"),r[27]=r[5].get("encryption_version"),r[28]=r[5].get("revision_version"),r[29]=r[5].get("initialize_restore_result"),r[30]=r[5].get("device_creation_timestamp_sec"),r[31]=r[5].get("authority_level"),t.i64.neq(r[25],void 0)?t.sequence([function(e){return r[33]=void 0,t.i64.neq(r[33],void 0)?t.resolve(r[34]=r[33]):t.sequence([function(e){return r[41]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return r[42]&&(r[51]=(r[41].push(t.i64.cast([0,0])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[43]&&(r[51]=(r[41].push(t.i64.cast([0,2])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return r[44]&&(r[51]=(r[41].push(t.i64.cast([0,3])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return r[45]&&(r[51]=(r[41].push(t.i64.cast([0,4])),r[41])),r[46]=t.createArray(),r[47]=t.i64.of_int32(r[41].length),t.i64.gt(r[47],t.i64.cast([0,0]))?t.loopAsync(r[47],function(e){return r[51]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[41],r[51]).then(function(e){var t;return t=e,r[52]=t[0],r[53]=t[1],t})},function(e){return r[54]=(r[46].push(r[52]),r[46])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[51]=t.createArray(),r[52]=t.i64.of_int32(r[46].length),t.i64.gt(r[52],t.i64.cast([0,0]))?t.loopAsync(r[52],function(e){return r[54]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[46],r[54]).then(function(e){var t;return t=e,r[55]=t[0],r[56]=t[1],t})},function(e){return r[57]=(r[51].push(t.i64.to_string(r[55])),r[51])}])}):t.resolve()},function(e){return r[53]=r[51].join(","),r[48]=r[53]}])},function(e){return r[46].some(function(e){return t.i64.eq(r[27],e)})?r[49]=r[27]:r[49]=void 0,t.i64.neq(r[49],void 0)?r[50]=r[49]:r[50]=void 0,r[34]=r[50]}])},function(e){return t.i64.neq(r[34],void 0)?r[35]=r[34]:r[35]=t.i64.cast([0,0]),t.i64.neq(r[26],void 0)?r[36]=r[26]:r[36]=t.i64.cast([0,1]),t.filter(t.db.table(2).fetch(),function(e){return e.context==="50013"}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[37]=!1:(t=o.item,r[37]=!0)})},function(e){return t.filter(t.db.table(2).fetch(),function(e){return e.context==="50025"}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[39]=!1:(t=o.item,r[39]=!0)})},function(e){return r[37]||r[39]?(r[41]="Another sync job is already in progress. Terminating this.",r[41]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[41]].join("")),r[42]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[41],r[42],t.i64.cast([0,3]))):t.resolve()):t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return r[49]?r[50]=!0:r[50]=!1,r[50]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[52]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[52]].join("")),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[52],r[51],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[41]=t.createArray(),t.forEach(t.filter(t.db.table(169).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),function(e){var t=e.item;return r[49]=(r[41].push(t.epochId),r[41])})},function(e){return r[47]="Queried locally available epochs. Count: ",r[42]=t.i64.of_int32(r[41].length),r[48]=t.i64.to_string(r[42]),r[43]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochClientUtils] ",r[43],r[47],r[43],r[48]].join("")),t.resolve()},function(e){return r[44]=new t.Map,r[44].set("backup_id",r[13]),r[44].set("device_id",r[25]),r[44].set("locally_available_epochs",r[41]),r[44].set("trace_id",void 0),r[45]=t.toJSON(r[44]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50025]),r[45],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[46]=t[0],t})}])},function(e){return r[32]=!0}]):t.sequence([function(e){return r[33]=["Failed to load client state: ","","NULL_DEVICE_ID"].join(""),r[33]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[33]].join("")),r[34]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[33],r[34],t.i64.cast([0,3]))):t.resolve()},function(e){return r[32]=!1}])},function(e){return r[6]=r[32]}]):t.sequence([function(e){return r[13]=r[4].get("errors"),r[14]=r[4].get("errors"),r[15]=["Failed to load client state: ","","BACKUP_NOT_FOUND"].join(""),r[15]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[15]].join("")),r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[15],r[16],t.i64.cast([0,3]))):t.resolve()},function(e){return r[6]=!1}])},function(e){return r[7]=t.i64.of_float(Date.now()),r[8]=t.i64.random(),r[10]="Finishing execution. Execution time: ",r[11]=t.i64.to_string(t.i64.sub(r[7],r[0])),r[12]=" ms",r[9]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ",r[9],r[10],r[9],r[11],r[9],r[12]].join("")),t.i64.eq(t.i64.mod_(r[8],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[13]=",",r[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",[r[10],r[13],r[11],r[13],r[12]].join(""),r[14],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsSyncEpochsStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","pending_tasks","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSSyncEpochsStoredProcedure",["LSSyncEpochs","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t){var a=t.storedProcedure(r("LSSyncEpochs"));return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}l.default=s}),98);
__d("EBSyncEpochs",["EBAPIQPLPoints","EBDeps","LSFactory","LSSyncEpochsStoredProcedure","QPLFlow","Random","WAResultOrError","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map;function s(t,n){if(n==null){for(var r of e.entries()){var a=r[0],i=r[1];i.unsub(),window.clearTimeout(i.timeout),i.resolve(o("WAResultOrError").makeError(t)),e.delete(a)}return}var l=e.get(n);l!=null&&(l.unsub(),window.clearTimeout(l.timeout),l.resolve(o("WAResultOrError").makeError(t)),e.delete(n))}async function u(){var t=await o("EBDeps").getDeps().getLSDB(),n,a=o("Random").uint32(),l=String(a),s=o("QPLFlow").startQPLFlow(r("qpl")._(521475098,"1328"),{annotations:{string:{traceId:l}},instanceKey:a});return new Promise(async function(a,u){var c=t.tables.secure_encrypted_backups_epochs.subscribe(function(t,r){if(r.operation!=="delete")return c(),window.clearTimeout(n),e.delete(l),s.endSuccess(),a(o("WAResultOrError").makeResult())});s.addPoint(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_SPROC_START),await t.runInTransaction(function(e){return r("LSSyncEpochsStoredProcedure")(r("LSFactory")(e))},"readwrite",void 0,void 0,i.id+":95").then(function(){s.addPoint(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_SPROC_END),n=window.setTimeout(function(){return e.delete(l),s.endFail(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_TIMEOUT),u(o("WAResultOrError").makeError("timeout"))},12e4),e.set(l,{resolve:a,timeout:n,unsub:c})}).catch(function(t){var n=r("getErrorSafe")(t);return c(),e.delete(l),u(o("WAResultOrError").makeError(n.message))})})}l.resolveSyncEpochsWithError=s,l.EBSyncEpochs=u}),98);
__d("LSCreateExtraVirtualDeviceWithRecoveryCodeData",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSGetOpenEpochKeys","LSGetViewerFBID","LSHandleCreateVirtualDeviceFailure","LSHmac_v2.nop","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSParseRecoveryCode_v2.nop","LSSymmetricEncryptionCreateEncryptedString.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(a){return t.sequence([function(n){return o[0]=e[2].get("recovery_code"),o[1]=e[2].get("virtual_device_type"),o[2]=e[2].get("cloud_service_account"),o[3]=e[2].get("hsm_pin_normalization_status"),o[4]=e[2].get("security_question_type"),o[5]=e[2].get("trusted_contact_id"),t.db.table(168).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[6]=t.i64.cast([0,1]):(n=a.item,o[9]=n.backupTenancy,t.i64.neq(o[9],void 0)?o[8]=o[9]:o[8]=t.i64.cast([0,1]),o[6]=o[8])})},function(a){return t.i64.eq(o[6],t.i64.cast([0,1]))&&o[0]==="1SHADOWTESTINGRECOVERYCODE00000000000000"?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Used."),o[9]="Invalid Recovery Code Used.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[9]].join("")),o[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[9],o[8],t.i64.cast([0,3]))):t.sequence([function(e){return o[8]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),o[0],t.i64.to_string(o[9]),o[8]).then(function(e){var t;return t=e,o[10]=t[0],o[11]=t[1],t})},function(a){return t.blobs.neq(o[11],void 0)?t.blobs.neq(o[10],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!1).then(function(e){var t;return t=e,o[12]=t[0],t})},function(a){return o[12]!==void 0?t.sequence([function(a){return o[79]=r("justknobx")._("1310"),e[3]!==void 0?o[79]?t.sequence([function(r){return e[3]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[3],t.i64.cast([0,2866]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!0:o[90]=!1,o[90]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[92]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[92]].join("")),o[91]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[92],o[91],t.i64.cast([0,3]))):t.resolve()}]):t.sequence([function(r){return e[3]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[3],t.i64.cast([0,2867]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!0:o[90]=!1,o[90]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[92]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[92]].join("")),o[91]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[92],o[91],t.i64.cast([0,3]))):t.resolve()}]):t.resolve()},function(e){return o[79]?t.resolve():t.sequence([function(e){return t.count(t.db.table(169).fetch()).then(function(e){return o[89]=e})},function(e){return t.i64.gt(o[89],t.i64.cast([0,1]))?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Multiple rows in $epoch_tables."),o[91]="Multiple rows in $epoch_tables.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[91]].join("")),o[90]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[91],o[90],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,o[13]=t[0],o[14]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,o[15]=t[0],o[16]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[13],t.blob("MA=="),o[16]).then(function(e){var t;return t=e,o[17]=t[0],t})},function(r){return o[80]=t.blob(""),o[81]=t.blob(""),o[82]=t.blob(""),t.db.table(168).fetch([[[e[1]]]]).next().then(function(e,r){var a,i=e.done,l=e.value;return i?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Row with backupid not found in client state table"),o[90]="Row with backupid not found in client state table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))},function(e){var t;return t=[o[80],o[81],void 0,o[82]],o[18]=t[0],o[19]=t[1],o[20]=t[2],o[21]=t[3],t}]):(r=l.item,a=[r.obliviousValidationTokenBlob,r.mailboxRootKeyBlob,r.deviceId,r.ocmfClientStateBlob],o[18]=a[0],o[19]=a[1],o[20]=a[2],o[21]=a[3])})},function(e){return t.blobs.eq(o[18],o[80])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] oblivious_token is empty!"),o[90]="oblivious_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.blobs.eq(o[19],o[81])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] mailbox_root_key is empty!"),o[90]="mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.blobs.eq(o[21],o[82])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ocmf_client_state is empty!"),o[90]="ocmf_client_state is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[23]=o[12].get("epoch_anon_id"),o[24]=o[12].get("epoch_root_key"),o[25]=t.createArray(),o[89]=(o[25].push(t.i64.cast([0,32])),o[25]),t.nativeOperation(n("LSBase64Encode.nop"),o[23]).then(function(e){var t;return t=e,o[26]=t[0],t})},function(e){return o[26]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[26]].join("")),void 0,o[24],o[25]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!1:o[90]=!0,o[90]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[93]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[93]].join("")),o[92]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[93],o[92],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return o[91]=o[94]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[89],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[92]=t[0],o[93]=t[1],t})},function(e){return o[91]=o[92]}])},function(e){return o[27]=o[91]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[90]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[90],o[89],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return o[27]=o[91]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[27],o[14]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(e){return t.blobs.neq(o[28],void 0)?t.resolve(o[29]=o[28]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] device_epoch_hmac is null!"),o[90]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return o[29]=o[91]}])},function(e){return o[30]=o[12].get("epoch_root_key"),t.blobs.neq(o[30],void 0)?t.sequence([function(e){return o[89]=t.createArray(),o[95]=(o[89].push(t.i64.cast([0,18])),o[89]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[30],o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return o[90]!==void 0?t.sequence([function(e){return o[95]=t.i64.of_int32(o[90].length),t.i64.ge(o[95],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[90],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[97]=t[0],o[98]=t[1],t})},function(e){return o[96]=o[97]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[98]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[98]].join("")),o[97]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[98],o[97],t.i64.cast([0,3]))},function(e){return o[96]=void 0}])},function(e){return o[91]=o[96]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[96]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[96]].join("")),o[95]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[96],o[95],t.i64.cast([0,3]))},function(e){return o[91]=void 0}])},function(e){return t.blobs.neq(o[91],void 0)?o[92]=!0:o[92]=!1,o[92]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[91]).then(function(e){var t;return t=e,o[93]=t[0],t})},function(e){return o[93]!==void 0?o[94]=o[93]:o[94]="encodingfailed",o[31]=o[94]}]):t.resolve(o[31]="null")},function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),o[21]).then(function(e){var t;return t=e,o[32]=t[0],o[33]=t[1],t})},function(e){var r;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,o[89]=t[0],o[90]=t[1],t})},function(e){var t;return t=[o[32],o[33],o[89],o[90]],o[34]=t[0],o[35]=t[1],o[36]=t[2],o[37]=t[3],t}]):t.resolve((r=[o[32],o[33],void 0,void 0],o[34]=r[0],o[35]=r[1],o[36]=r[2],o[37]=r[3],r))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[13]).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),o[38]==null?"":o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(e){return o[39]!==void 0?o[40]=o[39]:o[40]="",o[40]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_device_private_key is empty!"),o[90]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[15]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),o[41]==null?"":o[41]).then(function(e){var t;return t=e,o[42]=t[0],t})},function(e){return o[42]!==void 0?o[43]=o[42]:o[43]="",o[43]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_storage_private_key is empty!"),o[90]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[34]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),o[44]==null?"":o[44]).then(function(e){var t;return t=e,o[45]=t[0],t})},function(e){return o[45]!==void 0?o[46]=o[45]:o[46]="",o[46]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),o[90]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[18]).then(function(e){var t;return t=e,o[47]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),o[47]==null?"":o[47]).then(function(e){var t;return t=e,o[48]=t[0],t})},function(e){return o[48]!==void 0?o[49]=o[48]:o[49]="",o[49]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_oblivious_validation_token is empty!"),o[90]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[19]).then(function(e){var t;return t=e,o[50]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),o[50]==null?"":o[50]).then(function(e){var t;return t=e,o[51]=t[0],t})},function(e){return o[51]!==void 0?o[52]=o[51]:o[52]="",o[52]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_mailbox_root_key is empty!"),o[90]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[53]=o[12].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[53]).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),o[54]==null?"":o[54]).then(function(e){var t;return t=e,o[55]=t[0],t})},function(e){return o[55]!==void 0?o[56]=o[55]:o[56]="",o[56]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_anon_id is empty!"),o[90]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[57]=o[12].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[57]).then(function(e){var t;return t=e,o[58]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),o[58]==null?"":o[58]).then(function(e){var t;return t=e,o[59]=t[0],t})},function(e){return o[59]!==void 0?o[60]=o[59]:o[60]="",o[60]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_root_key is empty!"),o[90]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[61]=new t.Map,o[61].set("encrypted_device_private_key",o[40]),o[61].set("encrypted_epoch_storage_private_key",o[43]),o[61].set("encrypted_ocmf_client_state",o[46]),o[61].set("encrypted_orf_client_state_v2",void 0),o[61].set("encrypted_oblivious_validation_token_blob",o[49]),o[61].set("encrypted_mailbox_root_key_blob",o[52]),o[61].set("encrypted_epoch_anon_id",o[56]),o[61].set("encrypted_epoch_root_key",o[60]),t.nativeOperation(n("LSBase64Encode.nop"),o[10]).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[83]=o[62]==null?"":o[62],t.nativeOperation(n("LSBase64Encode.nop"),o[14]).then(function(e){var t;return t=e,o[63]=t[0],t})},function(e){return o[84]=o[63]==null?"":o[63],t.nativeOperation(n("LSBase64Encode.nop"),o[16]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[85]=o[64]==null?"":o[64],t.nativeOperation(n("LSBase64Encode.nop"),o[17]==null?t.blob("bnVsbA=="):o[17]).then(function(e){var t;return t=e,o[65]=t[0],t})},function(e){return o[86]=o[65]==null?"":o[65],t.nativeOperation(n("LSBase64Encode.nop"),o[29]).then(function(e){var t;return t=e,o[66]=t[0],t})},function(e){return o[87]=o[66]==null?"":o[66],t.nativeOperation(n("LSBase64Encode.nop"),o[35]).then(function(e){var t;return t=e,o[67]=t[0],t})},function(e){return o[88]=o[67]==null?"":o[67],t.nativeOperation(n("LSGetBlobFromString.nop"),o[0]).then(function(e){var t;return t=e,o[68]=t[0],t})},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"private_key",o[13],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[69]=o[91]}]):t.resolve(o[69]=void 0)},function(e){return t.blobs.neq(o[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[69]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[70]=o[89]}]):t.resolve(o[70]=void 0)},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"ocmf_client_state",o[34],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[71]=o[91]}]):t.resolve(o[71]=void 0)},function(e){return t.blobs.neq(o[71],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[71]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[72]=o[89]}]):t.resolve(o[72]=void 0)},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"epoch_storage_private_key",o[15],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[73]=o[91]}]):t.resolve(o[73]=void 0)},function(e){return t.blobs.neq(o[73],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[73]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[74]=o[89]}]):t.resolve(o[74]=void 0)},function(e){return t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[75]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(o[75])).then(function(e){var t;return t=e,o[76]=t[0],t})},function(e){return t.blobs.neq(o[76],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[76],"recovery_code",o[68],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[77]=o[91]}]):t.resolve(o[77]=void 0)},function(e){return t.blobs.neq(o[77],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[77]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[78]=o[89]}]):t.resolve(o[78]=void 0)},function(r){return t.i64.neq(o[20],void 0)?t.sequence([function(e){return o[89]=o[12].get("epoch_id"),t.db.table(168).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[90]=t.i64.cast([0,1]):(n=a.item,o[95]=n.backupTenancy,t.i64.neq(o[95],void 0)?o[94]=o[95]:o[94]=t.i64.cast([0,1]),o[90]=o[94])})},function(e){return t.i64.eq(o[90],t.i64.cast([0,2]))?t.resolve(o[92]=void 0):t.sequence([function(e){return t.nativeOperation(n("LSGetArmadilloPublicKey.nop")).then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return o[92]=o[94]}])},function(e){return t.blobs.neq(o[92],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureWithArmadilloKey.nop"),o[14]).then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return t.blobs.neq(o[94],void 0)?t.resolve(o[95]=o[94]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),o[100]="Failed to create labyrinth signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[100]].join("")),o[99]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[100],o[99],t.i64.cast([0,3]))},function(e){return o[95]=void 0}])},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[13],t.blob("Mw=="),o[92]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?t.resolve(o[97]=o[96]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),o[100]="Failed to create armadillo signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[100]].join("")),o[99]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[100],o[99],t.i64.cast([0,3]))},function(e){return o[97]=void 0}])},function(e){return t.blobs.neq(o[97],void 0)?(t.blobs.neq(o[95],void 0)?(o[100]=new t.Map,o[100].set("armadillo_public_key",o[92]),o[100].set("armadillo_key_signature",o[97]),o[100].set("labyrinth_key_signature",o[95]),o[99]=o[100]):o[99]=void 0,o[98]=o[99]):o[98]=void 0,o[93]=o[98]}]):t.resolve(o[93]=void 0)},function(r){return o[93]!==void 0?t.sequence([function(e){return o[94]=o[93].get("armadillo_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[94]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[96]=o[93].get("armadillo_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[96]).then(function(e){var t;return t=e,o[97]=t[0],t})},function(e){return o[98]=o[93].get("labyrinth_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[98]).then(function(e){var t;return t=e,o[99]=t[0],t})},function(r){return o[100]=new t.Map,o[100].set("backup_id",e[1]),o[100].set("request_device_id",o[20]),o[100].set("virtual_device_id",o[83]),o[100].set("encrypted_secret_values",o[61]),o[100].set("public_key",o[84]),o[100].set("epoch_storage_pubkey",o[85]),o[100].set("epoch_storage_pubkey_sig",o[86]),o[100].set("device_epoch_hmac",o[87]),o[100].set("epoch_root_key_fingerprint",o[31]),o[100].set("ocmf_rotation_token",o[88]),o[100].set("is_init",!1),o[100].set("epoch_id",o[89]),o[100].set("virtual_device_type",o[1]),o[100].set("action_type",e[0]),o[100].set("private_key_debug_token",o[70]),o[100].set("ocmf_client_state_debug_token",o[72]),o[100].set("epoch_storage_pvtkey_debug_token",o[74]),o[100].set("recovery_code_debug_token",o[78]),o[100].set("trace_id",e[3]),o[100].set("cloud_service_account",o[2]),o[100].set("hsm_pin_normalization_status",o[3]),o[100].set("security_question_type",o[4]),o[100].set("trusted_contact_id",o[5]),o[100].set("armadillo_public_key",o[95]==null?"":o[95]),o[100].set("armadillo_key_signature",o[97]==null?"":o[97]),o[100].set("labyrinth_key_signature",o[99]==null?"":o[99]),o[101]=t.toJSON(o[100]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50004]),o[101],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[3],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[102]=t[0],t})}]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] failed to get armadillo key and device signatures"),o[94]=new t.Map,o[94].set("backup_id",e[1]),o[94].set("request_device_id",o[20]),o[94].set("virtual_device_id",o[83]),o[94].set("encrypted_secret_values",o[61]),o[94].set("public_key",o[84]),o[94].set("epoch_storage_pubkey",o[85]),o[94].set("epoch_storage_pubkey_sig",o[86]),o[94].set("device_epoch_hmac",o[87]),o[94].set("epoch_root_key_fingerprint",o[31]),o[94].set("ocmf_rotation_token",o[88]),o[94].set("is_init",!1),o[94].set("epoch_id",o[89]),o[94].set("virtual_device_type",o[1]),o[94].set("action_type",e[0]),o[94].set("private_key_debug_token",o[70]),o[94].set("ocmf_client_state_debug_token",o[72]),o[94].set("epoch_storage_pvtkey_debug_token",o[74]),o[94].set("recovery_code_debug_token",o[78]),o[94].set("trace_id",e[3]),o[94].set("cloud_service_account",o[2]),o[94].set("hsm_pin_normalization_status",o[3]),o[94].set("security_question_type",o[4]),o[94].set("trusted_contact_id",o[5]),o[95]=t.toJSON(o[94]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50004]),o[95],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[3],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[96]=t[0],t}))}]):t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Epoch keys are unavailable."),o[14]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[14],o[13],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Provided"),o[13]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[13]].join("")),o[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[13],o[12],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Provided"),o[13]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[13]].join("")),o[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[13],o[12],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}])}])}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure",["LSCreateExtraVirtualDeviceWithRecoveryCodeData","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSCreateExtraVirtualDeviceWithRecoveryCodeData"),a.actionType,a.backupId,a.recoveryCodeData,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSOptOutOfBackup",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] Beginning execution."),r("justknobx")._("1099")?t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[11]=t[0],t})},function(e){return o[11]?o[12]=!0:o[12]=!1,o[12]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[14]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[14],o[13],t.i64.cast([0,3]))):t.resolve()}])},function(r){return o[8]=new t.Map,o[8].set("backup_id",e[0]),o[8].set("trace_id",void 0),o[9]=t.toJSON(o[8]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_opt_out",t.i64.cast([0,50019]),o[9],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[10]=t[0],t})},function(e){return o[1]=t.i64.cast([0,0])}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] backup opt out flow is not enabled"),o[1]=t.i64.cast([0,1])))},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsOptOutOfBackupStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsOptOutOfBackupStoredProcedure",e.__tables__=[];var s=e;l.default=s}),98);
__d("LSOptOutOfBackupStoredProcedure",["LSOptOutOfBackup","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptOutOfBackup"),a.backupId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSUpdateBackupsTable",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSDeleteAndReenrollDeviceState","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure] Beginning execution."),t.sequence([function(r){return e[5]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[5],t.i64.cast([0,1467]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(o){return e[0]?t.sequence([function(e){return t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[7]=!1:(t=o.item,r[7]=!0)})},function(o){return r[7]?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[11]=a[0],r[12]=a[1],r[13]=a[2],r[14]=a[3],r[15]=a[4],r[16]=a[5],r[17]=a[6],r[18]=a[7],r[19]=a[8],r[20]=a[9],r[21]=a[10],r[22]=a[11],r[23]=a[12],r[24]=a[13],r[25]=a[14],r[26]=a[15],r[27]=a[16],r[28]=a[17],a):(o=l.item,t.sequence([function(e){return r[37]=o.backupTenancy,r[36]=o.encryptionVersion,r[32]=void 0,t.i64.neq(r[32],void 0)?t.resolve(r[33]=r[32]):t.sequence([function(e){return r[38]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[39]=t[0],t})},function(e){return r[39]&&(r[48]=(r[38].push(t.i64.cast([0,0])),r[38])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[40]=t[0],t})},function(e){return r[40]&&(r[48]=(r[38].push(t.i64.cast([0,2])),r[38])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[41]=t[0],t})},function(e){return r[41]&&(r[48]=(r[38].push(t.i64.cast([0,3])),r[38])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return r[42]&&(r[48]=(r[38].push(t.i64.cast([0,4])),r[38])),r[43]=t.createArray(),r[44]=t.i64.of_int32(r[38].length),t.i64.gt(r[44],t.i64.cast([0,0]))?t.loopAsync(r[44],function(e){return r[48]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[38],r[48]).then(function(e){var t;return t=e,r[49]=t[0],r[50]=t[1],t})},function(e){return r[51]=(r[43].push(r[49]),r[43])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[48]=t.createArray(),r[49]=t.i64.of_int32(r[43].length),t.i64.gt(r[49],t.i64.cast([0,0]))?t.loopAsync(r[49],function(e){return r[51]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[43],r[51]).then(function(e){var t;return t=e,r[52]=t[0],r[53]=t[1],t})},function(e){return r[54]=(r[48].push(t.i64.to_string(r[52])),r[48])}])}):t.resolve()},function(e){return r[50]=r[48].join(","),r[45]=r[50]}])},function(e){return r[43].some(function(e){return t.i64.eq(r[36],e)})?r[46]=r[36]:r[46]=void 0,t.i64.neq(r[46],void 0)?r[47]=r[46]:r[47]=void 0,r[33]=r[47]}])},function(e){var n;return t.i64.neq(r[33],void 0)?r[34]=r[33]:r[34]=t.i64.cast([0,0]),t.i64.neq(r[37],void 0)?r[35]=r[37]:r[35]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[34],r[35],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[11]=n[0],r[12]=n[1],r[13]=n[2],r[14]=n[3],r[15]=n[4],r[16]=n[5],r[17]=n[6],r[18]=n[7],r[19]=n[8],r[20]=n[9],r[21]=n[10],r[22]=n[11],r[23]=n[12],r[24]=n[13],r[25]=n[14],r[26]=n[15],r[27]=n[16],r[28]=n[17]}]))})},function(o){return r[30]=!1,r[31]=t.i64.of_int32(e[3].length),t.i64.gt(r[31],t.i64.cast([0,0]))?t.loopAsync(r[31],function(o){return r[32]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[3],r[32]).then(function(e){var t;return t=e,r[33]=t[0],r[34]=t[1],t})},function(e){return r[35]=r[33].get("device_id"),r[30]=r[30]||t.i64.eq(r[12],r[35])}])}):t.resolve()},function(o){return r[30]?t.resolve():((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure] Client device id not in the list of device ids associated with the backupDeleting backup client state"),t.i64.neq(r[12],void 0),t.storedProcedure(n("LSDeleteBackupOnClient"),void 0,void 0,!1,e[5],void 0,!0))}]):t.resolve()},function(e){return t.forEach(t.filter(t.db.table(184).fetch(),function(e){return t.i64.neq(e.removalStatus,t.i64.cast([0,2]))}),function(e){return e.delete()})},function(o){return r[9]=t.i64.of_int32(e[2].length),t.i64.gt(r[9],t.i64.cast([0,0]))?t.loopAsync(r[9],function(o){return r[11]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[2],r[11]).then(function(e){var t;return t=e,r[12]=t[0],r[13]=t[1],t})},function(e){return r[14]=r[12].get("virtual_devices"),r[14]?r[15]=!1:r[15]=!0,r[15]?t.resolve():(r[16]=t.i64.of_int32(r[14].length),t.i64.gt(r[16],t.i64.cast([0,0]))?t.loopAsync(r[16],function(e){return r[17]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[14],r[17]).then(function(e){var t;return t=e,r[18]=t[0],r[19]=t[1],t})},function(e){return r[20]=r[18].get("virtual_device_id"),r[21]=r[18].get("virtual_device_type"),r[22]=r[18].get("creation_time"),r[23]=r[18].get("device_created_on"),r[24]=r[18].get("cloud_service_account"),r[25]=r[18].get("hsm_pin_normalization_status"),r[26]=r[18].get("requires_hsm_migration"),r[27]=r[18].get("hsm_migration_status"),r[28]=r[18].get("security_question_type"),r[29]=r[18].get("trusted_contact_id"),r[30]=r[18].get("recovery_code"),r[31]=r[12].get("backup_id"),t.count(t.filter(t.db.table(184).fetch(),function(e){return t.i64.eq(e.backupId,r[31])&&t.blobs.eq(e.virtualDeviceId,r[20])})).then(function(e){return r[32]=e})},function(e){return t.i64.eq(r[32],t.i64.cast([0,0]))?(r[33]=r[12].get("backup_id"),t.db.table(184).add({pk:void 0,backupId:r[33],virtualDeviceId:r[20],virtualDeviceType:r[21],creationTime:r[22],deviceCreatedOn:r[23],requiresHsmMigration:r[26]})):t.resolve()}])}):t.resolve())}])}):t.resolve()},function(e){return t.forEach(t.db.table(172).fetch(),function(e){return e.delete()})},function(o){return r[10]=t.i64.of_int32(e[1].length),t.i64.gt(r[10],t.i64.cast([0,0]))?t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[11]=t[0],r[12]=t[1],t})},function(e){return r[13]=r[11].get("backup_id"),r[14]=r[11].get("backup_tenancy"),t.forEach(t.filter(t.db.table(172).fetch([[[t.i64.cast([0,1])]]]),function(e){return t.i64.eq(e.pk,t.i64.cast([0,1]))&&t.i64.lt(e.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(n){return t.db.table(172).add({pk:t.i64.cast([0,1]),backupId:r[13],authorityLevel:t.i64.cast([0,80]),backupTenancy:r[14],isUserOptedOut:e[6],hasOtcEligibleDevices:e[7],encryptionManagementDelegatorId:e[8]})}]):t.sequence([function(e){return t.forEach(t.filter(t.db.table(172).fetch([[[t.i64.cast([0,1])]]]),function(e){return t.i64.eq(e.pk,t.i64.cast([0,1]))&&t.i64.lt(e.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(n){return t.db.table(172).add({pk:t.i64.cast([0,1]),authorityLevel:t.i64.cast([0,80]),isUserOptedOut:e[6],hasOtcEligibleDevices:e[7],encryptionManagementDelegatorId:e[8]})}])}]):t.sequence([function(o){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure] Fetch backup task did not succeed."),r[7]=t.createArray(),e[5]!==void 0&&(r[8]=(r[7].push(e[5]),r[7])),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsUpdateBackupsTableStoredProcedure","Fetch backup task did not succeed.",r[7],t.i64.cast([0,3]))},function(e){return t.forEach(t.db.table(172).fetch(),function(e){return e.delete()})},function(e){return t.forEach(t.filter(t.db.table(172).fetch([[[t.i64.cast([0,1])]]]),function(e){return t.i64.eq(e.pk,t.i64.cast([0,1]))&&t.i64.lt(e.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(e){return t.db.table(172).add({pk:t.i64.cast([0,1]),backupId:t.i64.cast([-1,4294967295]),authorityLevel:t.i64.cast([0,80]),hasOtcEligibleDevices:!1})},function(o){return t.sequence([function(r){return e[5]!==void 0?t.nativeOperation(n("LSFlushDataTrace.nop"),e[5]):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return r[8]?r[9]=!0:r[9]=!1,r[9]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[11]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[11]].join("")),r[10]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[11],r[10],t.i64.cast([0,3]))):t.resolve()}])}])},function(o){return t.sequence([function(r){return e[5]!==void 0?t.nativeOperation(n("LSFlushDataTrace.nop"),e[5]):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[1]=t.i64.of_float(Date.now()),r[2]=t.i64.random(),r[4]="Finishing execution. Execution time: ",r[5]=t.i64.to_string(t.i64.sub(r[1],r[0])),r[6]=" ms",r[3]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure] ",r[3],r[4],r[3],r[5],r[3],r[6]].join("")),t.i64.eq(t.i64.mod_(r[2],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[7]=",",r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsUpdateBackupsTableStoredProcedure",[r[4],r[7],r[5],r[7],r[6]].join(""),r[8],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsUpdateBackupsTableStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","encrypted_backups_virtual_devices","encrypted_backups"],a.exports=e}),null);
__d("LSUpdateBackupsTableStoredProcedure",["LSSynchronousPromise","LSUpdateBackupsTable","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSUpdateBackupsTable"),a.isSuccess,a.backupIds,a.virtualDevices,a.deviceIds,a.backupMetadata,a.traceId,a.isUserOptedOut,a.hasOtcEligibleDevices,a.encryptionManagementDelegatorId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWEBFrontendQPLLogger",["EBEnableUnifiedAttachment","EBUnifyLegacyMediaUpload","ExecutionEnvironment","FBLogger","MAWBridgeSafeActionsWorkerAndUI","MAWEBUploadTrackingUtils","MWEBODSEntityName.enum","ODS","QPLUserFlow","WAHashStringToNumber","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t,n){e!=null&&((s||(s=r("ExecutionEnvironment"))).isInWorker?(y("point",t),o("MAWEBUploadTrackingUtils").handleBridgeEbUploadTrackingQPL("point",e,t,n)):o("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("addEbUploadTrackingWorkerQPL",{annotations:n,pointName:t,qplInstanceKey:e,qplType:"point"}))}function c(e,t){(s||(s=r("ExecutionEnvironment"))).isInWorker?(y("success","upload_tracking_completed"),o("MAWEBUploadTrackingUtils").handleBridgeEbUploadTrackingQPL("success",e,"upload_tracking_completed",t)):o("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("addEbUploadTrackingWorkerQPL",{annotations:t,pointName:"upload_tracking_completed",qplInstanceKey:e,qplType:"success"})}function d(e,t,n){(s||(s=r("ExecutionEnvironment"))).isInWorker?(y("fail",t),o("MAWEBUploadTrackingUtils").handleBridgeEbUploadTrackingQPL("fail",e,t,n)):o("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("addEbUploadTrackingWorkerQPL",{annotations:n,pointName:t,qplInstanceKey:e,qplType:"fail"})}function m(e){var t=e.deliveryObjectId,n=e.flow,a=e.mediaType,i=e.messageId,l=e.threadId,s=e.traceId;if(_(n)){var u=o("WAHashStringToNumber").hashStringToNumber(s),c={bool:{is_legacy_hardening:o("EBUnifyLegacyMediaUpload").getEnableUnifyLegacyMediaUpload(),is_unified_attachment:o("EBEnableUnifiedAttachment").getEbEnableUnifiedAttachment()},string:{deliveryObjectId:t,flow:n,mediaType:a,messageId:i,threadId:l,traceId:s}};r("QPLUserFlow").start(r("qpl")._(521480391,"1167"),{annotations:c,instanceKey:u})}}function p(e,t,n,a){if(e!=null&&_(n)){var i=o("WAHashStringToNumber").hashStringToNumber(e);if(t){r("QPLUserFlow").endSuccess(r("qpl")._(521480391,"1167"),{instanceKey:i});return}r("QPLUserFlow").endFailure(r("qpl")._(521480391,"1167"),"upload_attachment_backup_failed",{annotations:{string:{error:a!=null?a:"upload_attachment_backup_failed"}},instanceKey:i})}}function _(e){return e==="unified"&&o("EBEnableUnifiedAttachment").getEbEnableUnifiedAttachment()||e==="old"&&!o("EBEnableUnifiedAttachment").getEbEnableUnifiedAttachment()}function f(e,t){e.forEach(function(e){if(e.uploadTrackingInstanceKey!=null){var n={string:{traceId:e.traceId}};u(e.uploadTrackingInstanceKey,t,n)}})}function g(e){return{addAnnotations:function(n){h(e,n)},addPoint:function(n,r){u(e,n,r)},endCancel:function(n,r){d(e,""+(n!=null?n:""),r)},endFail:function(n,r){d(e,n,r)},endSuccess:function(n){c(e,n)},getQPLAttrs:function(){return{instanceKey:e}},isActive:function(){return!0},start:function(){}}}function h(e,t){r("FBLogger")("EBFrontendQPLLogger").warn("addAnnotations not implemented for EB Frontend QPL")}function y(t,n){(e||(e=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_FRONTEND_QPL_IN_WORKER,t+"."+n)}l.addPointEBUploadTracking=u,l.endEBUploadTracking=c,l.failEBUploadTracking=d,l.startFlowUploadAttachmentBackup=m,l.endFlowUploadAttachmentBackup=p,l.addPointForUploadMessageArray=f,l.makeEBFrontendQplFlowFromInstanceKey=g}),98);
__d("MWEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeData",["LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSShape","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t,n,a){var l=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups));if(l==null)return[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)];var s=l.backupId;return s!=null?(await t.runInTransaction(function(e){return r("LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure")(r("LSFactory")(e),{actionType:n,backupId:s,recoveryCodeData:o("LSShape").ofRecord(a),traceId:void 0})},"readwrite",void 0,void 0,i.id+":41"),[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)]):[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)]}l.initializeCreateExtraVirtualDeviceStoredProcedure=s}),98);
__d("X25519",["$InternalEnum","Promise","WACryptoCurve25519Dependencies","WASignalKeys","WASignalOther","WASignalSignatures"],(function(t,n,r,o,a,i,l){"use strict";var e,s=n("$InternalEnum").Mirrored(["Encryption","Signing"]),u=n("$InternalEnum")({PublicKey:0,PrivateKey:1,Signature:2});function c(e,t){if(t===s.Encryption)return[];var n=1;switch(e){case u.PublicKey:n=1;break;case u.PrivateKey:n=2;break;case u.Signature:n=3;break}return[255,n]}function d(e,t,n){var r=c(t,n),o=r.length;if(o<=0)return e;var a=new Uint8Array(o+e.byteLength);return a.set(Array.from(r)),a.set(e,o),a}function m(e,t,n){var r=c(t,n).length;return e.slice(r)}function p(e,t){return{privateKey:d(e.privateKey,u.PrivateKey,t),publicKey:d(e.publicKey,u.PublicKey,t)}}function _(e){var t=p(o("WASignalKeys").makeKeyPair(),e);return{pk:t.publicKey,sk:t.privateKey}}function f(e,t){if(t===s.Encryption)return 32;switch(e){case u.PublicKey:case u.PrivateKey:return 32;case u.Signature:return 64}}function g(e,t,n){var r=c(t,n),o=r.length,a=f(t,n),i=a!=null?o+a:0;if(e.length!==i)return!1;var l=e.subarray(0,o),s=new Uint8Array(r);return s.length===l.length&&s.every(function(e,t){return e===l[t]})}function h(e,t){if(g(e,u.PublicKey,t))return e}function y(e,t){if(g(e,u.PrivateKey,t))return e}function C(e,t){var n=h(e.pkBytes,t),r=y(e.skBytes,t);if(n!=null&&r!=null)return{pk:n,sk:r}}function b(t,r){var a=m(t,u.PrivateKey,s.Signing);return o("WASignalSignatures").signMsg(o("WASignalKeys").makeKeyPairFrom(o("WASignalOther").ensureSize(a,32)),r).then(function(t){var r=d(t,u.Signature,s.Signing);return(e||(e=n("Promise"))).resolve(r)})}function v(e){if(g(e,u.Signature,s.Signing))return e}function S(e,t,n){var r=m(t,u.PublicKey,s.Signing);return o("WASignalSignatures").verifyMsgSignalVariant(o("WASignalKeys").serializeIdentity(r),n,o("WASignalOther").ensureSize(m(e,u.Signature,s.Signing),64))}function R(t,r){var a=r,i=t;return!g(i,u.PublicKey,s.Encryption)||!g(a,u.PrivateKey,s.Encryption)?(e||(e=n("Promise"))).resolve():o("WACryptoCurve25519Dependencies").calculateAgreement(i,a).then(function(t){return(e||(e=n("Promise"))).resolve(new Uint8Array(t))})}l.KeyPurpose=s,l.generateKeys=_,l.publicKeyFromBytes=h,l.secretKeyFromBytes=y,l.keysFromBytes=C,l.sign=b,l.signatureFromBytes=v,l.verify=S,l.exchangeKeys=R}),98);
__d("PublicKeyCrypto",["Promise","UInt8Array","X25519"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,r){return(e||(e=n("Promise"))).all([t,r]).then(function(t){return(e||(e=n("Promise"))).resolve(t[0]!=null&&t[1]!=null?o("UInt8Array").concatBytes([t[0],t[1]]):void 0)})}function u(e,t,n){return s(o("X25519").exchangeKeys(n,e),o("X25519").exchangeKeys(n,t))}function c(e,t,n){return s(o("X25519").exchangeKeys(n,e),o("X25519").exchangeKeys(t,e))}l.senderDeriveSharedSecret=u,l.receiverDeriveSharedSecret=c}),98);
__d("WASmaxInAbPropsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","error");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQErrorResponseMixin=e}),98);
__d("WASmaxInAbPropsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",400);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorBadRequestMixin=e}),98);
__d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","feature-not-implemented");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",501);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorFeatureNotImplementedMixin=e}),98);
__d("WASmaxInAbPropsNoRetryErrors",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestMixin","WASmaxInAbPropsIQErrorFeatureNotImplementedMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInAbPropsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:t.value});var n=o("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[t,n])}l.parseNoRetryErrors=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry",["WAResultOrError","WASmaxInAbPropsIQErrorResponseMixin","WASmaxInAbPropsNoRetryErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInAbPropsNoRetryErrors").parseNoRetryErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorNoRetryErrors:i.value})):i}l.parseGetExperimentConfigResponseErrorNoRetry=e}),98);
__d("WASmaxInAbPropsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","internal-server-error");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",500);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorInternalServerErrorMixin=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry",["WAResultOrError","WASmaxInAbPropsIQErrorInternalServerErrorMixin","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInAbPropsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(r.value);if(!a.success)return a;var i=o("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorIQErrorInternalServerErrorMixin:a.value},i.value)):i}l.parseGetExperimentConfigResponseErrorRetry=e}),98);
__d("WASmaxInAbPropsExperimentConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"config_code",1,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"config_value");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"config_expo_key",0,void 0);return a.success?o("WAResultOrError").makeResult({configCode:n.value,configValue:r.value,configExpoKey:a.value}):a}l.parseExperimentConfigMixin=e}),98);
__d("WASmaxInAbPropsSamplingConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"event_code",1,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"sampling_weight",-1e4,1e4);return r.success?o("WAResultOrError").makeResult({eventCode:n.value,samplingWeight:r.value}):r}l.parseSamplingConfigMixin=e}),98);
__d("WASmaxInAbPropsConfigs",["WAResultOrError","WASmaxInAbPropsExperimentConfigMixin","WASmaxInAbPropsSamplingConfigMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInAbPropsExperimentConfigMixin").parseExperimentConfigMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"ExperimentConfig",value:t.value});var n=o("WASmaxInAbPropsSamplingConfigMixin").parseSamplingConfigMixin(e);return n.success?o("WAResultOrError").makeResult({name:"SamplingConfig",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["ExperimentConfig","SamplingConfig"],[t,n])}l.parseConfigs=e}),98);
__d("WASmaxInAbPropsEnums",[],(function(t,n,r,o,a,i){var e={false:"false",true:"true"};i.ENUM_FALSE_TRUE=e}),66);
__d("WASmaxInAbPropsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQResultResponseMixin=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseSuccess",["WAResultOrError","WASmaxInAbPropsConfigs","WASmaxInAbPropsEnums","WASmaxInAbPropsIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxInAbPropsConfigs").parseConfigs(e);return n.success?o("WAResultOrError").makeResult({configs:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"erid");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(e,1,100);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"props");if(!a.success)return a;var i=o("WASmaxParseUtils").optionalChildWithTag(t,"erid",s);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,a.value,"protocol","1");if(!l.success)return l;var u=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,a.value,"ab_key");if(!u.success)return u;var c=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,a.value,"hash");if(!c.success)return c;var d=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,a.value,"refresh",0,void 0);if(!d.success)return d;var m=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,a.value,"refresh_id",0,void 0);if(!m.success)return m;var p=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrStringEnum,a.value,"delta_update",o("WASmaxInAbPropsEnums").ENUM_FALSE_TRUE);if(!p.success)return p;var _=o("WASmaxInAbPropsIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!_.success)return _;var f=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"prop",0,1/0,e);return f.success?o("WAResultOrError").makeResult(babelHelpers.extends({propsProtocol:l.value,propsAbKey:u.value,propsHash:c.value,propsRefresh:d.value,propsRefreshId:m.value,propsDeltaUpdate:p.value},_.value,{erid:i.value,propsProp:f.value})):f}l.parseGetExperimentConfigResponseSuccessPropsProp=e,l.parseGetExperimentConfigResponseSuccessErid=s,l.parseGetExperimentConfigResponseSuccess=u}),98);
__d("WASmaxOutAbPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQGetRequestMixin=s}),98);
__d("WASmaxOutAbPropsGetExperimentConfigRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAbPropsBaseIQGetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.propsHash,n=e.propsRefreshId,r=o("WASmaxOutAbPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{xmlns:"abt",to:o("WAWap").S_WHATSAPP_NET},o("WASmaxJsx").smax("props",{protocol:"1",hash:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),refresh_id:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n)})));return r}l.makeGetExperimentConfigRequest=e}),98);
__d("WASmaxAbPropsGetExperimentConfigRPC",["WAComms","WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry","WASmaxInAbPropsGetExperimentConfigResponseErrorRetry","WASmaxInAbPropsGetExperimentConfigResponseSuccess","WASmaxOutAbPropsGetExperimentConfigRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e,t){var n=o("WASmaxOutAbPropsGetExperimentConfigRequest").makeGetExperimentConfigRequest(e),r=await o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInAbPropsGetExperimentConfigResponseSuccess").parseGetExperimentConfigResponseSuccess(r,n);if(a.success)return{name:"GetExperimentConfigResponseSuccess",value:a.value};var i=o("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry").parseGetExperimentConfigResponseErrorNoRetry(r,n);if(i.success)return{name:"GetExperimentConfigResponseErrorNoRetry",value:i.value};var l=o("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry").parseGetExperimentConfigResponseErrorRetry(r,n);if(l.success)return{name:"GetExperimentConfigResponseErrorRetry",value:l.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("GetExperimentConfig",{Success:a,ErrorNoRetry:i,ErrorRetry:l}))}l.sendGetExperimentConfigRPC=e}),98);
__d("WAGetAbPropsProtocol",["WALogger","WAResultOrError","WASmaxAbPropsGetExperimentConfigRPC"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=await o("WASmaxAbPropsGetExperimentConfigRPC").sendGetExperimentConfigRPC(t);if(n.name==="GetExperimentConfigResponseSuccess"){var r=n.value,a=r.propsAbKey,i=r.propsHash,l=r.propsRefresh,s=r.propsRefreshId,c=r.propsProp,d=r.erid,m=r.propsDeltaUpdate,p=u(c),_=p.newProps,f=p.samplingConfigs;return o("WAResultOrError").makeResult({abKey:a,hash:i,refresh:l,refreshId:s,props:_,samplingConfigs:f,erid:d==null?void 0:d.elementValue,isDeltaUpdate:m==="true"})}return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getAbPropsProtocol failed ",""])),n.value),o("WAResultOrError").makeError()}function u(e){var t=[],n=[];return e.forEach(function(e){var r=e.configs;if(r.name==="ExperimentConfig"){var o;t.push({configCode:r.value.configCode,configValue:r.value.configValue,configExpoKey:(o=r.value.configExpoKey)==null?void 0:o.toString()})}else r.name==="SamplingConfig"&&n.push({eventCode:r.value.eventCode,samplingWeight:r.value.samplingWeight})}),{newProps:t,samplingConfigs:n}}l.getAbPropsProtocol=s}),98);
__d("WAAbPropsSync",["WAAbProps","WAAbPropsHelpers","WAGetAbPropsProtocol","WALogger","WAPromiseManagement","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WAPromiseManagement").cacheWhilePending(function(){return"abProps"},m);function m(e){var t=e.sendHash,n=t===void 0?!0:t,r=e.eventFlow;return r==null||r.addPoint("sync_ab_props",{bool:{sendHash:n}}),n==null||n===!1?_(null,r):o("WAAbProps").getHash().then(function(e){return _(e,r)})}var p=m;async function _(t,n){n==null||n.addPoint("fetch_ab_props");var r=await o("WAGetAbPropsProtocol").getAbPropsProtocol({propsHash:t});if(!r.success)o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["fetchAbProps failed"])));else{var a=r.value,i=a.abKey,l=a.hash,u=a.refresh,c=a.props,d=o("WAAbPropsHelpers").parseAbProps(o("WAAbProps").getConfig(),c);n==null||n.addPoint("save_ab_props");var m=await f(i,l,u,d);m.success===!1&&(m.error,o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncAbProps: detected no hash"]))))}var p=await o("WAAbProps").getRefreshSecs();return{seconds:p}}async function f(e,t,n,r){var a=await o("WAAbProps").getAbProps(),i={abKey:e!=null?e:a.abKey,hash:t!=null?t:a.hash,refresh:o("WAAbPropsHelpers").maybeUpdateRefresh(n),lastSyncTime:o("WATimeUtils").unixTime(),propValues:a.propValues,propExpoKeys:a.propExpoKeys,internalExpoKeys:a.internalExpoKeys,expoKeyStr:a.expoKeyStr};if(t==null)return await o("WAAbProps").setAbProps(i),o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: detected no hash"]))),o("WAResultOrError").makeError("noHash");o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: updating ab configs"])));var l=r.values,s=r.expoKeys,d=o("WAAbPropsHelpers").maybeUpdatePropValues(l,a.propValues,o("WAAbProps").getConfig()),m=o("WAAbPropsHelpers").maybeUpdateExpoKeys(s,a.propExpoKeys,o("WAAbProps").getConfig()),p=m.propExpoKeys,_=m.expoKeysToDelete,f,g,h=o("WAAbPropsHelpers").maybeUpdateInternalExpoKeys(_,a.internalExpoKeys);return h!=null&&(f=h.internalExpoKeys,g=h.expoKeyStr),await o("WAAbProps").setAbProps(babelHelpers.extends({},i,{propValues:d,propExpoKeys:p,internalExpoKeys:f,expoKeyStr:g})),o("WAResultOrError").makeResult()}l.syncAbProps=d,l.syncAbPropsDebug=p}),98);
__d("WASmaxInDevicesFetchSelfResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:i.value})):i}l.parseFetchSelfResponseError=e}),98);
__d("WASmaxInDevicesDeviceInfoMixin",["WAResultOrError","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"platform");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"manufacturer");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(e){var t=o("WASmaxParseUtils").assertTag(e,"model");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function c(e){var t=o("WASmaxParseUtils").assertTag(e,"seen");if(!t.success)return t;var n=o("WASmaxParseUtils").contentInt(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function d(e){var t=o("WASmaxParseUtils").assertTag(e,"creation");if(!t.success)return t;var n=o("WASmaxParseUtils").contentInt(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function m(e){var t=o("WASmaxParseUtils").assertTag(e,"ip");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function p(e){var t=o("WASmaxParseUtils").assertTag(e,"location");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"latitude");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"longitude");if(!r.success)return r;var a=o("WASmaxParseUtils").contentString(e);return a.success?o("WAResultOrError").makeResult({latitude:n.value,longitude:r.value,elementValue:a.value}):a}function _(t){var n=o("WASmaxParseUtils").assertTag(t,"device");if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"platform",e);if(!r.success)return r;var a=o("WASmaxParseUtils").optionalChildWithTag(t,"manufacturer",s);if(!a.success)return a;var i=o("WASmaxParseUtils").optionalChildWithTag(t,"model",u);if(!i.success)return i;var l=o("WASmaxParseUtils").optionalChildWithTag(t,"seen",c);if(!l.success)return l;var _=o("WASmaxParseUtils").optionalChildWithTag(t,"creation",d);if(!_.success)return _;var f=o("WASmaxParseUtils").optionalChildWithTag(t,"ip",m);if(!f.success)return f;var g=o("WASmaxParseUtils").optionalChildWithTag(t,"location",p);if(!g.success)return g;var h=o("WASmaxParseUtils").attrIntRange(t,"id",1,999);if(!h.success)return h;var y=o("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(t);return y.success?o("WAResultOrError").makeResult(babelHelpers.extends({id:h.value},y.value,{platform:r.value,manufacturer:a.value,model:i.value,seen:l.value,creation:_.value,ip:f.value,location:g.value})):y}l.parseDeviceInfoPlatform=e,l.parseDeviceInfoManufacturer=s,l.parseDeviceInfoModel=u,l.parseDeviceInfoSeen=c,l.parseDeviceInfoCreation=d,l.parseDeviceInfoIp=m,l.parseDeviceInfoLocation=p,l.parseDeviceInfoMixin=_}),98);
__d("WASmaxInDevicesFetchSelfResponseSuccess",["WAResultOrError","WASmaxInDevicesDeviceInfoMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"device");if(!t.success)return t;var n=o("WASmaxInDevicesDeviceInfoMixin").parseDeviceInfoMixin(e);return n.success,n}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"self");if(!a.success)return a;var i=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!i.success)return i;var l=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"device",1,25,e);return l.success?o("WAResultOrError").makeResult(babelHelpers.extends({},i.value,{selfDevice:l.value})):l}l.parseFetchSelfResponseSuccessSelfDevice=e,l.parseFetchSelfResponseSuccess=s}),98);
__d("WASmaxOutDevicesFetchSelfRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQGetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxJsx").smax("self",null)));return e}l.makeFetchSelfRequest=e}),98);
__d("WASmaxDevicesFetchSelfRPC",["WAComms","WASmaxInDevicesFetchSelfResponseError","WASmaxInDevicesFetchSelfResponseSuccess","WASmaxOutDevicesFetchSelfRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e){var t=o("WASmaxOutDevicesFetchSelfRequest").makeFetchSelfRequest(),n=await o("WAComms").sendSmaxStanza(t,e),r=o("WASmaxInDevicesFetchSelfResponseSuccess").parseFetchSelfResponseSuccess(n,t);if(r.success)return{name:"FetchSelfResponseSuccess",value:r.value};var a=o("WASmaxInDevicesFetchSelfResponseError").parseFetchSelfResponseError(n,t);if(a.success)return{name:"FetchSelfResponseError",value:a.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("FetchSelf",{Success:r,Error:a}))}l.sendFetchSelfRPC=e}),98);
__d("WAGetCurrentUserDeviceList",["WAAssertUnreachable","WAGlobals","WAJids","WALogger","WAPersistedJobManager","WASignalKeys","WASmaxDevicesFetchSelfRPC","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){if(t.isCurrentDevice&&n.isCurrentDevice)return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Two devices were detected as isCurrentDevice in getCurrentUserDeviceList"]))),0;if(t.isCurrentDevice)return-1;if(n.isCurrentDevice)return 1;if(t.lastSeen!=null&&n.lastSeen==null)return-1;if(t.lastSeen==null&&n.lastSeen!=null)return 1;if(t.lastSeen!=null&&n.lastSeen!=null){var r=t.lastSeen,a=n.lastSeen;return a.getTime()-r.getTime()}return 0}async function u(e){var t=await o("WASmaxDevicesFetchSelfRPC").sendFetchSelfRPC();switch(t.name){case"FetchSelfResponseError":{var n=t.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;switch(n.name){case"RetryableIQError":{var a=n.value.backoff;throw a!=null?new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{delay:a,type:"constant"},jitter:0}):new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{first:o("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1})}default:{n.name;var i=n.value.code;throw r("err")("Failed with an error code "+i)}}}case"FetchSelfResponseSuccess":{var l=o("WAJids").extractDeviceId(o("WAGlobals").getMyDeviceJid());return t.value.selfDevice.map(function(e){var t,n,r,a,i,s=e.creation,u=e.elementValue,c=e.id,d=e.ip,m=e.location,p=e.manufacturer,_=e.model,f=e.platform,g=e.seen;return{creationTime:s==null?null:o("WATimeUtils").toDate(o("WATimeUtils").castToUnixTime(s.elementValue)),id:o("WAJids").interpretAsDeviceId(c),identityKey:o("WASignalKeys").serializeIdentity(u),ipAddress:(t=d==null?void 0:d.elementValue)!=null?t:null,isCurrentDevice:c===l,lastSeen:g==null?null:o("WATimeUtils").toDate(o("WATimeUtils").castToUnixTime(g.elementValue)),latitude:m==null?null:parseFloat(m.latitude),location:(n=m==null?void 0:m.elementValue)!=null?n:null,longitude:m==null?null:parseFloat(m.longitude),manufacturer:(r=p==null?void 0:p.elementValue)!=null?r:null,model:(a=_==null?void 0:_.elementValue)!=null?a:null,platform:(i=f==null?void 0:f.elementValue)!=null?i:null}}).sort(s)}default:return r("WAAssertUnreachable")(t.name)}}l.getCurrentUserDeviceList=u}),98);
__d("WAPublishAppDataProtocol",["FBLogger","WABridge","WAEncUserMsg","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAOdsEnums","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["sendAppDataFanout"]);async function c(t,n){var a=n.messagePayload,i=n.identities,l=n.externalId,c=i.get(o("WAGlobals").getMyUserJid());if(c==null)throw r("FBLogger")("wmi").mustfixThrow("Missing my user identities");var d=Array.from(c.entries()).map(function(e){var t=e[0],n=e[1];return{identity:n,jid:t}}),m=[{devicesInfo:d,user:o("WAGlobals").getMyUserJid()}],p=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return o("WAEncUserMsg").encryptUserMsg(m,{messageBytes:a.messageBytes,type:"appdata"},{cryptoManager:t})},{operationType:"encrypt",flush:!0}),_=p.phash,f=!1,g=[];p.participants!=null&&p.participants.forEach(function(e){e.type==="pkmsg"&&(f=!0),g.push({toJid:e.to,encTypeIndividualMixinArgs:{encType:e.type,encElementValue:e.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(e.v,10)}})});var h={appdataTo:o("WAGlobals").getMyUserJid(),toArgs:g},y={peerPeerFanout:h},C=void 0;if(f){var b=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo(),v=b==null?void 0:b.identityKey;if(v==null)throw u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]))),r("FBLogger")("wmi").mustfixThrow("No public identity key");C={deviceIdentityElementValue:v}}var S={appdataDeviceListCheck:"true"},R={appdataId:l,peerMsgTypesArgs:y,deviceIdentityMixinArgs:C,withDeviceListCheckMixinArgs:S},L=await o("WASmaxAppdataPublishPeerRPC").sendPeerRPC(R);switch(L.name){case"PeerResponseSuccess":{var E,k=(E=L.value.deviceListStaleMixin)==null?void 0:E.phash;return k!=null&&_!=null&&k!==_?(u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"])),_,k),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"}),{type:"success",ts:o("WATimeUtils").castToUnixTime(L.value.t),phash:{type:"mismatch",local:_,server:k},count:null,reportingMeta:null}):{type:"success",ts:o("WATimeUtils").castToUnixTime(L.value.t),phash:{type:"ok"},count:null,reportingMeta:null}}default:throw L.name,r("FBLogger")("wmi").mustfixThrow("Failed to send appdata %s",L.value.error)}}l.publishAppData=c}),98);
__d("WASaveReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WADbTransactor").makeSignalTransactor({receipts:o("MAWTransactionMode").READWRITE},"saveReceipt",function(e){return(function(t){return e.receipts.put({msgId:t.id.externalId.toString(),permittedIdentitiesPerDevice:t.permittedIdentitiesPerDevice,recipientDevices:t.recipientDevices,waMsgId:o("WAMsg").craftWAMsgIdString(t.id)}).then(function(){})})});l.saveReceipt=e}),98);
__d("WAPublishMessage",["FBLogger","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e,t){var n=e.identities,r=e.messagePayload,a={author:r.protocolMsgId.author,chat:r.protocolMsgId.chat,externalId:r.protocolMsgId.externalId},i=await o("WALoadReceiptApi").loadReceipt(a);if(i.success)return i.value;var l=new Map;for(var s of n){var u=s[0],c=s[1];for(var d of c){var m=d[0],p=d[1];m!==o("WAGlobals").getMyDeviceJid()&&l.set(m,{pubKey:p})}}var _=new Set,f={permittedIdentitiesPerDevice:l,recipientDevices:_,id:a};return t.addPoint("save_receipts_start"),await o("WASaveReceiptApi").saveReceipt(f),t.addPoint("save_receipts_end"),f}async function c(t,n){var a=t.messagePayload,i=t.identities,l=t.sendIdentity,s=l===void 0?!1:l;n.addPoint("prepare_receipt_start");var c=await u({messagePayload:a,identities:i},n);n.addPoint("prepare_receipt_end"),n.addPoint("calculate_recipients_start");var p=a.frankingKey,_=a.frankingVersion,f=a.messageBytes,g=a.backupDirective,h=a.messageType,y=a.protocolMsgId,C=d(c.permittedIdentitiesPerDevice),b=h.type==="text"&&h.invitedParticipantUserJid!=null?C.filter(function(e){return e.user===h.invitedParticipantUserJid||e.user===o("WAGlobals").getMyUserJid()}):C;n.addPoint("calculate_recipients_end",{int:{recipientsCount:b.length}});var v=h.type==="text"&&h.invitedParticipantUserJid!=null?h.invitedParticipantUserJid:y.chat,S=y.chat===o("WAGlobals").getMyUserJid();if(b.length===0&&!S)throw r("FBLogger")("wmi").mustfixThrow("Trying to send a message with no recipients");if(b.length===0&&S)return{serverResponse:{type:"success",ts:o("WATimeUtils").unixTime(),phash:{type:"ok"},count:null,reportingMeta:null},encryption:{type:"user",messageTo:o("WAGlobals").getMyUserJid(),participants:[],phash:""}};var R=s?await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return m(t)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null,L=await(h.isRevoked===!0?Promise.resolve(null):o("WAGenReportingMeta").genReportingMeta(f.bytes,p,_)),E=await o("WASendMsgInternal").sendMessageV2({type:"chat",messageBytes:f,chat:v,deviceIdentity:R,messageType:h,protocolMsgId:y,externalId:y.externalId,recipients:b,reportingMeta:L,backupDirective:g},n),k=E.serverResponse;return k.type==="success"&&await o("WASentBytesCache").sentBytesCache().saveSentBytes({ts:k.ts,frankingKey:p,frankingVersion:_,messageBytes:f,backupDirective:g,messageType:h,protocolMsgId:y,waMsgId:o("WAMsg").craftWAMsgIdString({author:y.author,chat:y.chat,externalId:y.externalId})}).catch(function(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""])),t)}),E}function d(e){var t=new Map;return e.forEach(function(e,n){var r=e.pubKey,a=o("WAJids").extractUserJid(n),i={identity:r,jid:n},l=t.get(a)||[];l.push(i),t.set(a,l)}),Array.from(t,function(e){var t=e[0],n=e[1];return{devicesInfo:n,user:t}})}async function m(e){try{var t=await e.storage.loadIdentities(o("WAGlobals").getMyUserJid()),n=t.get(o("WAGlobals").getMyDeviceJid());if(n!=null)return n;throw r("err")("missing-identity")}catch(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""])),e)}}l.publishMessage=c}),98);
__d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestMixin","WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:t.value});var n=o("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorBadRequest","IQErrorItemNotFound"],[t,n])}l.parseIQErrorBadRequestOrItemNotFoundMixinGroup=e}),98);
__d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup").parseIQErrorBadRequestOrItemNotFoundMixinGroup(e);return n.success?o("WAResultOrError").makeResult({iQErrorBadRequestOrItemNotFoundMixinGroup:n.value}):n}l.parseNonRetryableRemoveDeviceIQErrorMixin=e}),98);
__d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"RetryableIQError",value:t.value});var n=o("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin").parseNonRetryableRemoveDeviceIQErrorMixin(e);return n.success?o("WAResultOrError").makeResult({name:"NonRetryableRemoveDeviceIQError",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["RetryableIQError","NonRetryableRemoveDeviceIQError"],[t,n])}l.parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup=e}),98);
__d("WASmaxInDevicesRemoveResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup").parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup:i.value})):i}l.parseRemoveResponseError=e}),98);
__d("WASmaxInDevicesRemoveResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(e,t);return r.success,r}l.parseRemoveResponseSuccess=e}),98);
__d("WASmaxOutDevicesKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyElementValue,n=o("WASmaxJsx").smax("smax$any",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeKeyDataMixin=s}),98);
__d("WASmaxOutDevicesIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutDevicesKeyDataMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutDevicesKeyDataMixin").mergeKeyDataMixin(o("WASmaxJsx").smax("identity",null),e));return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIdentityKeyMixin=s}),98);
__d("WASmaxOutDevicesRemoveRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WASmaxOutDevicesIdentityKeyMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.removeId,n=e.identityKeyMixinArgs,r=o("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxOutDevicesIdentityKeyMixin").mergeIdentityKeyMixin(o("WASmaxJsx").smax("remove",{id:o("WAWap").INT(t)}),n)));return r}l.makeRemoveRequest=e}),98);
__d("WASmaxDevicesRemoveRPC",["WAComms","WASmaxInDevicesRemoveResponseError","WASmaxInDevicesRemoveResponseSuccess","WASmaxOutDevicesRemoveRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e,t){var n=o("WASmaxOutDevicesRemoveRequest").makeRemoveRequest(e),r=await o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInDevicesRemoveResponseSuccess").parseRemoveResponseSuccess(r,n);if(a.success)return{name:"RemoveResponseSuccess",value:a.value};var i=o("WASmaxInDevicesRemoveResponseError").parseRemoveResponseError(r,n);if(i.success)return{name:"RemoveResponseError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Remove",{Success:a,Error:i}))}l.sendRemoveRPC=e}),98);
__d("WARemoveDevice",["WALogger","WAPersistedJobManager","WAPushSafeTypes","WAResultOrError","WASignalOther","WASmaxDevicesRemoveRPC","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t,n){var r=o("WAPushSafeTypes").unsafeNotNullable(n),a=r.deviceId,i=r.identity;o("WALogger").DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["removeDevice called for device "," and identity ",""])),a,i);var l=o("WASignalOther").sliceBytes(i,1,32),u=await o("WASmaxDevicesRemoveRPC").sendRemoveRPC({removeId:a,identityKeyMixinArgs:{anyElementValue:l}});if(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["removeDevice result for ",": "," "])),a,u),u.name==="RemoveResponseSuccess")return o("WAResultOrError").makeResult();u.name;var c=u.value.errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup;if(c.name!=="RetryableIQError")return o("WAResultOrError").makeError();c.name;var d=c.value.backoff;throw d!=null?new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"constant",delay:d},jitter:0}):new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"exponential",first:o("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}l.removeDevice=u}),98);
__d("WARemoveCurrentDevice",["WAGetCurrentUserDeviceInfoApi","WAGlobals","WALogger","WARemoveDevice","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=async function(n){o("WALogger").DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["removeCurrentDevice called for current device"])));var t=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo();if(t==null)return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["There is no stored user info, it was already deleted or this job was called twice, possibly from another tab"]))),o("WAResultOrError").makeResult();var r=t.deviceId,a=t.identityKey,i=await o("WARemoveDevice").removeDevice(n,{deviceId:r,identity:a});return i.success&&await o("WAGlobals").getDependencies().clearSignalAndTempStores(),o("WAResultOrError").makeResult()};l.removeCurrentDevice=u}),98);
__d("WASendAppDataFanoutProtocol",["WAAsMessageApplication","WABridge","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["sendAppDataFanout"]),f=24;function g(t,n){var r=n.contents,a=n.externalId,i=n.permittedIdentitiesPerDevice,l=n.checkPhash,s=l===void 0?"checkPhash":l;return h(r,a,i,s).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return _.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to devices with error: ",""])),n),o("WAResultOrError").makeError("runtime-error")})}async function h(e,t,n,r){r===void 0&&(r="checkPhash"),_.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""])),t);var a=o("WAConvertAppData").convertAppData(e),i={bytes:o("WAAsMessageApplication").castToMessageApplicationBytes(o("encodeProtobuf").encodeProtobuf(o("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArrayView()),version:"v3"},l=[],g=Array.from(n.entries()).map(function(e){var t=e[0],n=e[1];return{identity:n.pubKey,jid:t}}),h=f;g.length>h&&(_.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to "," devices"])),g.length),_.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to more than the allowed "," devices"])),h),g=g.slice(0,h));var y=[{devicesInfo:g,user:o("WAGlobals").getMyUserJid()}],C=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return o("WAEncUserMsg").encryptUserMsg(y,{messageBytes:i,type:"appdata"},{cryptoManager:t})},{operationType:"encrypt",flush:!0}),b=C.phash,v=!1;C.participants!=null&&C.participants.forEach(function(e){e.type==="pkmsg"&&(v=!0),l.push({toJid:e.to,encTypeIndividualMixinArgs:{encType:e.type,encElementValue:e.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(e.v,10)}})});var S={appdataTo:o("WAGlobals").getMyUserJid(),toArgs:l},R={peerPeerFanout:S},L=void 0;if(v){var E=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo(),k=E==null?void 0:E.identityKey;if(k==null)return _.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]))),o("WAResultOrError").makeError("no-public-identity");L={deviceIdentityElementValue:k}}var I={appdataDeviceListCheck:r==="checkPhash"?"true":"false"},T={appdataId:t,peerMsgTypesArgs:R,deviceIdentityMixinArgs:L,withDeviceListCheckMixinArgs:I},D=await o("WASmaxAppdataPublishPeerRPC").sendPeerRPC(T);switch(D.name){case"PeerResponseSuccess":{var x,$=(x=D.value.deviceListStaleMixin)==null?void 0:x.phash;return $!=null&&b!=null&&$!==b?(_.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"])),b,$),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"}),o("WAResultOrError").makeResult({phashMismatch:!0,serverTs:o("WATimeUtils").castToUnixTime(D.value.t)})):o("WAResultOrError").makeResult({phashMismatch:!1,serverTs:o("WATimeUtils").castToUnixTime(D.value.t)})}default:return D.name,_.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""])),D.value.error),o("WAResultOrError").makeError("ack-failure")}}l.MAX_APPDATA_RECIPIENTS=f,l.sendAppDataToDevicesProtocol=g}),98);
__d("WASendMsgUtilV2",["WADevicesState","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WAResultOrError","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p;function _(e){return Promise.resolve()}function f(e,t){return o("WADevicesState").getDevicesState().waitForUserDevices(Array.from(new Set([e,o("WAGlobals").getMyUserJid()])),"GetDevicesBeforeSend: "+t)}function g(t,n){var r=n.chatJid,a=n.reason;return o("WAJids").switchOnChatJidType(r,{group:function(t){return _(t)},interopUser:function(t){return f(t,a)},lidUser:function(t){return f(t,a)},msgrUser:function(t){return f(t,a)},phoneUser:function(t){return f(t,a)}}).catch(function(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices before sending: ",""])),t),Promise.resolve()})}async function h(e,t){var n=e.messagePayload,r=e.loadThreadParticipants,a={author:n.protocolMsgId.author,chat:n.protocolMsgId.chat,externalId:n.protocolMsgId.externalId},i=await o("WALoadReceiptApi").loadReceipt(a);if(i.success)return i;t.addPoint("get_devices_before_send_start"),await g(void 0,{chatJid:n.protocolMsgId.chat,reason:"prepareReceipt"}),t.addPoint("get_devices_before_send_end");var l=await r(n.protocolMsgId.chat);t.addPoint("get_identities_start");var u=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return t.storage.bulkLoadIdentities(l)},{flush:!1,afterInit:!0,operationType:"prepare_receipt_load_identities"}),c=[];if(u.size===0)c=[].concat(l);else for(var d of u){var m=d[0],p=d[1];p.size===0&&c.push(m)}c.length>0&&(await o("WADevicesState").getDevicesState().waitForUserDevices(c,"GetDevicesBeforeSend: prepareReceipt",!0),u=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return t.storage.bulkLoadIdentities(l)},{afterInit:!0,flush:!1,operationType:"prepare_receipt_load_identities"}));var _=new Map;for(var f of u){var h=f[0],y=f[1];for(var C of y){var b=C[0],v=C[1];b!==o("WAGlobals").getMyDeviceJid()&&_.set(b,{pubKey:v})}}t.addPoint("get_identities_end");var S=new Set,R={permittedIdentitiesPerDevice:_,recipientDevices:S,id:a};return t.addPoint("save_receipts_start"),await o("WASaveReceiptApi").saveReceipt(R).catch(function(e){return t.addPoint("save_receipts_fail"),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to save receipt for message with error ",""])),e),o("WAResultOrError").makeError("missing-receipt")}),t.addPoint("save_receipts_end"),o("WAResultOrError").makeResult(R)}async function y(e,t,n){var r=t.messagePayload,a=t.loadThreadParticipants,i=t.sendIdentity,l=i===void 0?!1:i,s=t.isInstamadillo,p=s===void 0?!1:s;n.addPoint("prepare_receipt_start");var _=await h({messagePayload:r,loadThreadParticipants:a},n);if(_.success===!1)return n.addPoint("prepare_receipt_fail"),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message that does not have a receipt in db"]))),o("WAResultOrError").makeError({type:"missing-receipt"});n.addPoint("prepare_receipt_end");var f=_.value,g=r.frankingKey,y=r.frankingVersion,v=r.messageBytes,S=r.backupDirective,R=r.messageType,L=r.protocolMsgId,E=C(f.permittedIdentitiesPerDevice),k=R.type==="text"&&R.invitedParticipantUserJid!=null?E.filter(function(e){return e.user===R.invitedParticipantUserJid||e.user===o("WAGlobals").getMyUserJid()}):E;n.addPoint("recipients-calculated",{int:{recipientsCount:k.length},string:{msgType:R.type}});var I=R.type==="text"&&R.invitedParticipantUserJid!=null?R.invitedParticipantUserJid:L.chat,T=L.chat===o("WAGlobals").getMyUserJid();if(k.length===0&&!T)return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients"]))),o("WAResultOrError").makeError({type:"no-recipients",isRetriable:!1});if(k.length===0&&T)return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients, but it is a self thread"]))),o("WAResultOrError").makeResult({baseKey:null,reportingMeta:null,serverTs:o("WATimeUtils").unixTime()});var D=l?await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return b(t)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null,x=await(R.isRevoked===!0?Promise.resolve(null):o("WAGenReportingMeta").genReportingMeta(v.bytes,g,y));return o("WASendMsgInternal").sendMessage({type:"chat",messageBytes:v,chat:I,deviceIdentity:D,messageType:R,protocolMsgId:L,externalId:L.externalId,recipients:k,reportingMeta:x,backupDirective:S},n,p).then(function(e){return e.success?o("WASentBytesCache").sentBytesCache().saveSentBytes({ts:e.value.serverTs,frankingKey:g,frankingVersion:y,messageBytes:v,backupDirective:S,messageType:R,protocolMsgId:L,waMsgId:o("WAMsg").craftWAMsgIdString({author:L.author,chat:L.chat,externalId:L.externalId})}).catch(function(e){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""])),e)}).then(function(){return e}):e})}function C(e){var t=new Map;return e.forEach(function(e,n){var r=e.pubKey,a=o("WAJids").extractUserJid(n),i={identity:r,jid:n},l=t.get(a)||[];l.push(i),t.set(a,l)}),Array.from(t,function(e){var t=e[0],n=e[1];return{devicesInfo:n,user:t}})}async function b(e){try{var t=await e.storage.loadIdentities(o("WAGlobals").getMyUserJid()),n=t.get(o("WAGlobals").getMyDeviceJid());if(n!=null)return n;throw r("err")("missing-identity")}catch(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""])),e)}}l.getDevicesBeforeSend=g,l.sendChatMessage=y}),98);
__d("WASetClockSkewApi",["WASetMetaApi"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){var e=t.clockSkew;return o("WASetMetaApi").setMeta({clockSkew:e})};l.setClockSkew=e}),98);
__d("WASendPing",["WAComms","WALogger","WASetClockSkewApi","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendPing: sending"]))),o("WAComms").sendPing()}async function u(e,t){var n=t.clockSkew;o("WATimeUtils").setClockSkew(n),await o("WASetClockSkewApi").setClockSkew({clockSkew:n})}l.sendPing=s,l.updateClockSkew=u}),98);
__d("WASyncAbProps",["WAAbPropsSync","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t,n){var r=n.sendHash;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Syncing ABProps"]))),await o("WAAbPropsSync").syncAbProps({sendHash:r,eventFlow:t!=null?t:void 0})}l.syncAbProps=s}),98);
__d("encryptedBackupsOptOutOfBackup",["LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSOptOutOfBackupStoredProcedure","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(function(n){if(n==null)return[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)];var a=n.backupId;return a!=null?t.runInTransaction(function(e){return r("LSOptOutOfBackupStoredProcedure")(r("LSFactory")(e),{backupId:a})},"readwrite",void 0,void 0,i.id+":32"):[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)]})}l.optOutOfBackupStoredProcedure=s}),98);
__d("mwEBUpdateBackupsTable",["LSFactory","LSUpdateBackupsTableStoredProcedure","LSVec"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.backupIds,n=e.deviceIds,o=e.encryptionManagementDelegatorId,a=e.hasOtcEligibleDevices,l=e.isSuccess,s=e.isUserOptedOut,u=e.storage,c=e.virtualDevices;return u.runInTransaction(function(e){return r("LSUpdateBackupsTableStoredProcedure")(r("LSFactory")(e),{backupIds:t,backupMetadata:r("LSVec").ofArray([]),deviceIds:n,encryptionManagementDelegatorId:o,hasOtcEligibleDevices:a,isSuccess:l,isUserOptedOut:s,virtualDevices:c})},"readwrite",void 0,void 0,i.id+":48")}l.default=e}),98);
/**
 * License: https://www.facebook.com/legal/license/ZMc_bSwzLKC/
 */
__d("ristretto255-0.1.1",["tweetnacl-1.0.3"],(function(t,n,r,o,a,i,l){var e=r("tweetnacl-1.0.3")();Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(t,n){return new Uint8Array(Array.prototype.slice.call(this,t,n))}});var s={},u=e.lowlevel,c=u.gf([1]);function d(){return[u.gf(),u.gf(),u.gf(),u.gf()]}var m=new Uint8Array([226,242,174,10,106,188,78,113,168,132,169,97,197,0,81,95,88,227,11,106,165,130,221,141,182,166,89,69,224,141,45,118]),p=new Float64Array([235,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function _(e,t,n){for(var r=new Float64Array(64),o=0;o<32;o++)for(var a=0;a<32;a++)r[o+a]+=t[o]*n[a];u.modL(e,r)}function f(e,t){_(e,t,t)}function g(e,t){for(var n=0;n<32;n++)e[n]=t[n];for(var r=251;r>=0;r--)f(e,e),(p[r>>3]>>(r&7)&1)!==0&&_(e,e,t)}var h=u.gf([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]),y=u.gf([11803,18811,63136,32407,21693,7032,36364,44957,53757,12789,64713,3900,18604,11139,12735,14185]),C=u.gf([16618,32861,64938,39368,29374,23105,5655,40239,55360,65025,31633,5826,64674,53167,35077,30828]),b=u.gf([49526,37983,2497,57980,13583,52574,41272,11393,57316,48752,43997,39316,57559,45747,29352,656]),v=u.gf([19744,17645,23210,12717,6553,45086,18988,53918,20203,21147,54063,19676,8769,63084,45946,22888]);function S(e){var t=new Uint8Array(32);u.pack25519(t,e);for(var n=1,r=0;r<32;r++)n&=t[r]===0;return n}function R(e,t,n){for(var r,o=-n,a=0;a<16;a++)r=e[a]^t[a],r&=o,e[a]^=r}function L(e){var t=new Uint8Array(32);return u.pack25519(t,e),t[0]&1}function E(e,t){u.Z(e,u.gf(),t)}function k(e,t,n){var r=u.gf();E(r,t),u.set25519(e,t),R(e,r,n)}function I(e,t){k(e,t,L(t))}function T(e,t,n){var r=u.gf(),o=u.gf(),a=u.gf(),i=u.gf(),l=u.gf(),s=u.gf();u.S(r,n),u.M(r,r,n),u.S(e,r),u.M(e,e,n),u.M(e,e,t),u.pow2523(e,e),u.M(e,e,r),u.M(e,e,t),u.S(o,e),u.M(o,o,n),u.Z(a,o,t),u.A(i,o,t),u.M(l,t,h),u.A(l,o,l);var c=S(a),d=S(i),m=S(l);return u.M(s,e,h),R(e,s,d|m),I(e,e),c|d}function D(e){var t=u.gf(),n=u.gf(),r=u.gf(),o=u.gf(),a=u.gf(),i=u.gf(),l=u.gf(),s=u.gf(),d=u.gf(),m=u.gf(),p=u.gf(),_=u.gf(),f=u.gf(),g=u.gf(),y=u.gf(),b=u.gf(),v=u.gf(),S=0,E=new Uint8Array(32);return u.A(m,e[2],e[1]),u.Z(v,e[2],e[1]),u.M(m,m,v),u.M(p,e[0],e[1]),u.S(_,p),u.M(_,m,_),T(a,c,_),u.M(t,a,m),u.M(n,a,p),u.M(b,t,n),u.M(b,b,e[3]),u.M(i,e[0],h),u.M(l,e[1],h),u.M(o,t,C),u.M(d,e[3],b),S=L(d),f=u.gf(e[0]),g=u.gf(e[1]),r=u.gf(n),R(f,l,S),R(g,i,S),R(r,o,S),u.M(y,f,b),k(g,g,L(y)),u.Z(s,e[2],g),u.M(s,r,s),I(s,s),u.pack25519(E,s),E}function x(e){for(var t=e[31]&127^127,n=30;n>0;n--)t|=e[n]^255;t=(t|0)-1>>8;var r=236-(e[0]|0)>>8;return 1-((t&r|e[0])&1|(e[31]&255)>>7)}function $(e,t){var n=u.gf(),r=u.gf(),o=u.gf(),a=u.gf(),i=u.gf(),l=u.gf(),s=u.gf(),d=u.gf(),m=u.gf(),p=u.gf();if(x(t)===0)return-1;u.unpack25519(o,t),u.S(a,o),u.set25519(i,c),u.Z(i,i,a),u.S(s,i),u.set25519(l,c),u.A(l,l,a),u.S(d,l),u.M(m,u.D,s),E(m,m),u.Z(m,m,d),u.M(p,m,d),u.set25519(r,c);var _=T(n,r,p);return u.M(e[0],n,l),u.M(e[1],n,e[0]),u.M(e[1],e[1],m),u.M(e[0],e[0],o),u.A(e[0],e[0],e[0]),I(e[0],e[0]),u.M(e[1],i,e[1]),u.set25519(e[2],c),u.M(e[3],e[0],e[1]),-(1-_|L(e[3])|S(e[1]))}function P(e,t){var n=u.gf(),r=u.gf(),o=u.gf(),a=u.gf(),i=u.gf(),l=u.gf(),s=u.gf(),d=u.gf(),m=u.gf(),p=u.gf(),_=u.gf(),f=u.gf(),g=u.gf(),C=u.gf();u.set25519(o,c),u.S(a,t),u.M(a,h,a),u.A(m,a,o),u.M(m,m,b),u.set25519(n,c),E(n,n),u.A(i,a,u.D),u.M(p,a,u.D),u.Z(p,n,p),u.M(p,p,i);var S=1-T(l,m,p);u.M(s,l,t),I(s,s),E(s,s),R(l,s,S),R(n,a,S),u.Z(r,a,o),u.M(r,r,n),u.M(r,r,v),u.Z(r,r,p),u.A(_,l,l),u.M(_,_,p),u.M(f,r,y),u.S(d,l),u.Z(g,o,d),u.A(C,o,d),u.M(e[0],_,C),u.M(e[1],g,f),u.M(e[2],f,C),u.M(e[3],_,g)}function N(e){var t=u.gf(),n=u.gf(),r=d(),o=d();return u.unpack25519(t,e.slice(0,32)),u.unpack25519(n,e.slice(32,64)),P(r,t),P(o,n),u.add(r,o),r}function M(e){var t=d();return u.scalarbase(t,e),D(t)}function w(e,t){var n=d(),r=d();if($(n,t)!==0)throw new Error("Invalid argument");return u.scalarmult(r,n,e),D(r)}function A(e){var t=d();return $(t,e)!==-1}function F(e,t){var n=d(),r=d();if($(n,e)===-1)throw new Error("Invalid argument");if($(r,t)===-1)throw new Error("Invalid argument");return[n,r]}function O(e,t){var n=F(e,t),r=n[0],o=n[1];return u.add(r,o),D(r)}function B(e,t){var n=u.gf();E(n,t[3]);var r=u.gf();E(r,t[0]);var o=[r,t[1],t[2],n];u.add(e,o)}function W(e,t){var n=F(e,t),r=n[0],o=n[1];return B(r,o),D(r)}function q(){var t=e.randomBytes(64);return N(t)}function U(e){return D(N(e))}function V(){return D(q())}function H(){var t=new Uint8Array(32),n=0;do{t=e.randomBytes(32),t[31]&=31;var r=32,o=1;do r--,n|=t[r]-u.L[r]>>8&o,o&=(t[r]^u.L[r])-1>>8;while(r!==0)}while(n===0);return t}function G(e){var t=new Uint8Array(32);return g(t,e),t}function z(e){for(var t=new Float64Array(64),n=0;n<32;n++)t[n]=-e[n];var r=new Uint8Array(32);return u.modL(r,t),r}function j(e,t){for(var n=new Float64Array(64),r=0;r<32;r++)n[r]=e[r]+t[r];var o=new Uint8Array(32);return u.modL(o,n),o}function K(e,t){return j(e,z(t))}function Q(e,t){var n=new Uint8Array(32);return _(n,e,t),n}s.scalarMultBase=M,s.scalarMult=w,s.isValid=A,s.add=O,s.sub=W,s.fromHash=U,s.getRandom=V,s.basePoint=m,s.scalar={},s.scalar.getRandom=H,s.scalar.invert=G,s.scalar.negate=z,s.scalar.add=j,s.scalar.sub=K,s.scalar.mul=Q,s.unsafe={},s.unsafe.point={},s.unsafe.point.toBytes=D,s.unsafe.point.fromBytes=$,s.unsafe.point.fromHash=N,s.unsafe.point.sub=B,s.unsafe.point.add=u.add,s.unsafe.point.scalarMultBase=u.scalarbase,s.unsafe.point.scalarMult=u.scalarmult,s.unsafe.point.getRandom=q,s.unsafe.point.alloc=d,s.unsafe.constants={},s.unsafe.constants.LSub2=p,s.unsafe.constants.sqrtm1=h,s.unsafe.constants.sqrtadm1=y,s.unsafe.constants.invsqrtamd=C,s.unsafe.constants.onemsqd=b,s.unsafe.constants.sqdmone=v,i.exports=s}),34);
__d("ristretto255",["ristretto255-0.1.1"],(function(t,n,r,o,a,i){a.exports=n("ristretto255-0.1.1")}),null);/*FB_PKG_DELIM*/
__d("TCompactProtocol",["StringToUtf8","ThriftTypes","Utf8ToString"],(function(t,n,r,o,a,i,l){var e,s=Object.freeze({CT_STOP:0,CT_BOOLEAN_TRUE:1,CT_BOOLEAN_FALSE:2,CT_BYTE:3,CT_I16:4,CT_I32:5,CT_I64:6,CT_DOUBLE:7,CT_BINARY:8,CT_LIST:9,CT_SET:10,CT_MAP:11,CT_STRUCT:12,CT_FLOAT:13}),u=Object.freeze({NONE:-1,CT_BOOLEAN_TRUE:s.CT_BOOLEAN_TRUE,CT_BOOLEAN_FALSE:s.CT_BOOLEAN_FALSE}),c=[s.CT_STOP,0,s.CT_BOOLEAN_TRUE,s.CT_BYTE,s.CT_DOUBLE,0,s.CT_I16,0,s.CT_I32,0,s.CT_I64,s.CT_BINARY,s.CT_STRUCT,s.CT_MAP,s.CT_SET,s.CT_LIST,0,0,0,s.CT_FLOAT],d=Math.pow(2,7)-1,m=-1*Math.pow(2,7),p=Math.pow(2,15)-1,_=-1*Math.pow(2,15),f=Math.pow(2,31)-1,g=-1*Math.pow(2,31),h=Math.pow(2,32)-1,y=BigInt("9223372036854775807"),C=BigInt("-9223372036854775808"),b=BigInt("18446744073709551615"),v=BigInt(63),S=BigInt(1),R=BigInt(7),L=BigInt("0x7f"),E=BigInt("0x80"),k=Math.pow(2,4),I=(function(){function t(e){this.$4=null,this.$5=null,this.$1=e,this.$2=[],this.$3=0,this.$6=new DataView(new ArrayBuffer(1))}var n=t.prototype;return n.readStructBegin=function(){this.$2.push(this.$3),this.$3=0},n.readStructEnd=function(){return this.$3=this.$2.pop(),0},n.writeStructBegin=function(t){return this.$2.push(this.$3),this.$3=0,0},n.writeStructEnd=function(){return this.$3=this.$2.pop(),0},n.writeFieldBegin=function(n){return n.ftype===(e||(e=r("ThriftTypes"))).BOOL?(this.$4={fid:n.fid,fname:n.fname,ftype:n.ftype},0):this.$7(n,u.NONE)},n.writeListBegin=function(t){return this.$8(t)},n.writeListEnd=function(){return 0},n.writeSetBegin=function(t){return this.$8(t)},n.writeSetEnd=function(){return 0},n.writeMapBegin=function(t){var e=0;if(t.size===0)e+=this.$1.writeByte(0);else if(e+=this.writeVarint32(t.size),t.ktype!=null&&t.vtype!=null)e+=this.$1.writeByte(this.$9(t.ktype)<<4|this.$9(t.vtype));else throw new Error("received invalid map info: "+JSON.stringify(t));return e},n.writeMapEnd=function(){return 0},n.$7=function(t,n){var e=0,r=n===u.NONE?this.$9(t.ftype):n;return t.fid>this.$3&&t.fid-this.$3<=k-1?e+=this.$1.writeByte(t.fid-this.$3<<4|r):(e+=this.$1.writeByte(r),e+=this.writeI16(t.fid)),this.$3=t.fid,e},n.$8=function(t){var e=0,n=this.$9(t.etype);return t.size<=k-2?e+=this.$1.writeByte(t.size<<4|n):(e+=this.$1.writeByte(240|n),e+=this.writeVarint32(t.size)),e},n.readFieldBegin=function(){var t=this.$1.readByte(),n=t&15;if(n===(e||(e=r("ThriftTypes"))).STOP)return{ftype:(e||(e=r("ThriftTypes"))).STOP,fid:0};var o=(t&240)>>>4,a;o===0?a=this.readI16():a=this.$3+o;var i=this.$10(n);return(n===s.CT_BOOLEAN_TRUE||n===s.CT_BOOLEAN_FALSE)&&(this.$5=n===s.CT_BOOLEAN_TRUE),this.$3=a,{ftype:i,fid:a}},n.readListBegin=function(){return this.$11()},n.readListEnd=function(){return 0},n.readSetBegin=function(){return this.$11()},n.readSetEnd=function(){return 0},n.readMapBegin=function(){var e=this.readVarint32();if(e>0){var t=this.$1.readByte(),n=this.$12(t>>4,"readMapBegin:key"),r=this.$12(t&15,"readMapBegin:value");return{ktype:this.$10(n),vtype:this.$10(r),size:e}}return{size:e}},n.readMapEnd=function(){return 0},n.$12=function(t,n){if(t<0||t>13)throw new Error(n+" read invalid compact type: "+t);return t},n.$11=function(){var e=this.$1.readByte(),t=this.$12(e&15,"_readListOrSetBegin"),n=this.$10(t),r=e>>4&15;return r===15&&(r=this.readVarint32()),{etype:n,size:r}},n.readFieldEnd=function(){return 0},n.readByte=function(){return this.$6.setUint8(0,this.$1.readByte()),this.$6.getInt8(0)},n.writeByte=function(t){if(t<m||t>d)throw new Error("byte to write is out of range: "+t);return this.$6.setInt8(0,t),this.$1.writeByte(this.$6.getUint8(0))},n.readFloat=function(){return this.$1.readFloatBE()},n.writeFloat=function(t){return this.$1.writeFloatBE(t)},n.readDouble=function(){return this.$1.readDoubleBE()},n.writeDouble=function(t){return this.$1.writeDoubleBE(t)},n.writeString=function(t){return this.writeBinary(o("StringToUtf8").StringToUtf8(t))},n.skip=function(n){switch(n){case(e||(e=r("ThriftTypes"))).STOP:return;case(e||(e=r("ThriftTypes"))).BOOL:this.readBool();break;case(e||(e=r("ThriftTypes"))).BYTE:this.readByte();break;case(e||(e=r("ThriftTypes"))).DOUBLE:this.readDouble();break;case(e||(e=r("ThriftTypes"))).I16:this.readI16();break;case(e||(e=r("ThriftTypes"))).I32:this.readI32();break;case(e||(e=r("ThriftTypes"))).I64:this.readI64();break;case(e||(e=r("ThriftTypes"))).STRING:this.readString();break;case(e||(e=r("ThriftTypes"))).STRUCT:{this.readStructBegin();for(var t;t=this.readFieldBegin(),t.ftype!==(e||(e=r("ThriftTypes"))).STOP;)this.skip(t.ftype);this.readStructEnd();break}case(e||(e=r("ThriftTypes"))).MAP:{var o=this.readMapBegin();if(o.size>0&&o.ktype!=null&&o.vtype!=null)for(var a=o.ktype,i=o.vtype,l=0;l<o.size;l++)this.skip(a),this.skip(i);break}case(e||(e=r("ThriftTypes"))).SET:case(e||(e=r("ThriftTypes"))).LIST:{for(var s=this.$11(),u=0;u<s.size;u++)this.skip(s.etype);break}case(e||(e=r("ThriftTypes"))).FLOAT:this.readFloat();break;default:throw new Error("encoutered unknow thrift type: "+n+" in skip")}},n.toByteArray=function(){return this.$1.toByteArray()},n.writeFieldEnd=function(){return 0},n.writeFieldStop=function(){return this.$1.writeByte((e||(e=r("ThriftTypes"))).STOP)},n.writeI16=function(t){if(t<_||t>p)throw new Error("trying to write i16 out of range: "+t);return this.writeVarint32(this.i32ToZigzag(t))},n.readI16=function(){var e=this.zigzagToI32(this.readVarint32());if(e<_||e>p)throw new Error("read invalid i16: "+e);return e},n.writeI32=function(t){if(t<g||t>f)throw new Error("i32 out of range: "+t);return this.writeVarint32(this.i32ToZigzag(t))},n.readI32=function(){return this.zigzagToI32(this.readVarint32())},n.writeI64=function(t){return this.writeVarint64(this.i64ToZigzag(t))},n.readI64=function(){return this.zigzagToI64(this.readVarint64())},n.readBool=function(){var e;return this.$5!=null?(e=this.$5,this.$5=null):e=this.$1.readByte()===s.CT_BOOLEAN_TRUE,e},n.writeBool=function(t){var e=0;return this.$4!=null?(e+=this.$7(this.$4,t?u.CT_BOOLEAN_TRUE:u.CT_BOOLEAN_FALSE),this.$4=null):e+=this.$1.writeByte(t?s.CT_BOOLEAN_TRUE:s.CT_BOOLEAN_FALSE),e},n.readBinary=function(){var e=this.readVarint32();return e===0?new Uint8Array(0):this.$1.readBytes(e)},n.writeBinary=function(t){var e=0;return e+=this.writeVarint32(t.length),e+=this.$1.write(t),e},n.i32ToZigzag=function(t){if(t<g||t>f)throw new Error("number: "+t+" is out of range of i32");return(t<<1^(t<0?4294967295:0))>>>0},n.zigzagToI32=function(t){if(t<0||t>h)throw new Error("number: "+t+" is out of range of uint32");return t>>>1^-1*(t&1)},n.i64ToZigzag=function(t){if(t>y||t<C)throw new Error("i64 out of range: "+t.toString());return t>>v^t<<S},n.zigzagToI64=function(t){if(t<0||t>b)throw new Error("invalid uint64: "+t.toString());return(t&S)===S?~(t>>S):t>>S},n.writeVarint32=function(t){if(t<0||t>h)throw new Error("writeVarint32 received out of range uint32: "+t);for(var e=t,n=0;;)if(e>>>7)this.$1.writeByte(e&127|128),n++,e>>>=7;else{this.$1.writeByte(e),n++;break}return n},n.readVarint32=function(){for(var e=0,t=0,n;;){if(n=this.$1.readByte(),e=(e|(n&127)<<t)>>>0,t+=7,(n&128)==0){if(t===35&&(n&240)!=0)throw new Error("result exceeded 32 bit limit");break}if(t>28)throw new Error("result exceeded 32 bit limit")}return e},n.writeVarint64=function(t){if(t<0||t>b)throw new Error("invalid uint64: "+t.toString());for(var e=t,n=0;;)if(e>>R==0){this.$1.writeByte(Number(e)),n++;break}else this.$1.writeByte(Number(e&L|E)),n++,e>>=R;return n},n.readVarint64=function(){for(var e=BigInt(0),t=BigInt(0),n;;){if(n=BigInt(this.$1.readByte()),e|=(n&L)<<t,t+=R,(n&E)==0){if(t==70&&n!==S)throw new Error("result exceeded 64 bit limit");break}if(t>63)throw new Error("result exceeded 64 bit limit")}return e},n.readString=function(){return o("Utf8ToString").Utf8ToString(this.readBinary())},n.getLastFieldId=function(){return this.$3},n.getLastField=function(){return this.$2},n.getBooleanFieldInfo=function(){return this.$4},n.getBooleanValue=function(){return this.$5},n.$9=function(t){return c[t]},n.$10=function(n){switch(n){case s.CT_STOP:return(e||(e=r("ThriftTypes"))).STOP;case s.CT_BOOLEAN_FALSE:case s.CT_BOOLEAN_TRUE:return(e||(e=r("ThriftTypes"))).BOOL;case s.CT_BYTE:return(e||(e=r("ThriftTypes"))).BYTE;case s.CT_I16:return(e||(e=r("ThriftTypes"))).I16;case s.CT_I32:return(e||(e=r("ThriftTypes"))).I32;case s.CT_I64:return(e||(e=r("ThriftTypes"))).I64;case s.CT_DOUBLE:return(e||(e=r("ThriftTypes"))).DOUBLE;case s.CT_FLOAT:return(e||(e=r("ThriftTypes"))).FLOAT;case s.CT_BINARY:return(e||(e=r("ThriftTypes"))).STRING;case s.CT_LIST:return(e||(e=r("ThriftTypes"))).LIST;case s.CT_SET:return(e||(e=r("ThriftTypes"))).SET;case s.CT_MAP:return(e||(e=r("ThriftTypes"))).MAP;case s.CT_STRUCT:return(e||(e=r("ThriftTypes"))).STRUCT;default:throw new Error("don't know what type")}},t})();l.default=I}),98);
__d("CompactSerializer",["TCompactProtocol","TNoOpWriteBuffer","TReadBuffer","TWriteBuffer"],(function(t,n,r,o,a,i,l){function e(e,t,n){try{return s(e,t)}catch(e){n!=null&&n(e)}return null}function s(e,t){var n=new(r("TReadBuffer"))(e),o=new(r("TCompactProtocol"))(n);return t(o)}function u(e,t,n,r){n===void 0&&(n=!1);try{return c(e,t,n)}catch(e){r!=null&&r(e)}return null}function c(e,t,n){n===void 0&&(n=!1);var o;if(n){var a=new(r("TNoOpWriteBuffer")),i=new(r("TCompactProtocol"))(a);t(e,i),o=new(r("TWriteBuffer"))(a.currentSize())}else o=new(r("TWriteBuffer"));var l=new(r("TCompactProtocol"))(o);return t(e,l),l.toByteArray()}l.deserializeNoThrow=e,l.deserialize=s,l.serializeNoThrow=u,l.serialize=c}),98);
__d("MultiwaySharedTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({UNKNOWN:0,SFU:1,P2P:2}),s=e({UNKNOWN:0,IGVIDEOCALL:9,ROOM:15,CRUCIBLE:20,MBS_WA:21,BOT:22,HORIZON:23,ULLC:24}),u=e({OFFER:0,PRANSWER:1,ANSWER:2,PROFFER:3}),c=e({LOW:0,MEDIUM:1,HIGH:2,HD:3,NUM_QUALITIES:4}),d=e({E2EE_NOT_MANDATED:0,DEPRECATED_NO_REQUIREMENT:1,E2EE_MANDATED:2,E2EE_BYPASSED_USER_CONSENTED:3}),m=e({NOT_SET:0,CONTROL:1,TEST:2}),p=e({NOT_SET:0,CONTROL:1,TEST:2}),_=e({NotPaused:0,Paused:1}),f=e({AUDIO:0,VIDEO:1,DATA:2}),g=e({UNKNOWN:0,COMPOSITING_SERVICE:1,MEDIA_SERVER:2,CATHODE_AMBISONIC:3,CATHODE_CAPTIONS:4,CATHODE_MEETING_SUMMARIZER:5,CATHODE_REALTIME_SHARED_STATE:6,RP_GENAI_SERVICE:7,SMART_GLASSES_ASSISTANT:8}),h=e({CNAME:0,TRACK:1,DOMINANT_SPEAKER:2}),y=e({UNKNOWN:0,DEFAULT:1,SCREEN_SHARE:2}),C=e({UNSPECIFIED:0,FNA:1,FNA_PREFERRED:2}),b=e({NONE:0,EXTENSION_SELF_PARTICIPANT:1}),v=e({IntValue:"intValue",StringValue:"stringValue"});a.exports={ConferenceType:s,CustomMediaRoutingType:b,E2eeInfraMandatedExpStatus:m,E2eeMode:d,EdgerayType:C,EndpointServiceType:g,MediaPath:l,MediaPauseStatus:_,MediaType:f,P2PSFrameExpStatus:p,QuickExperimentValue$Types:v,RenderedStreamType:y,SdpType:u,SubscriptionType:h,VideoQuality:c}}),null);
__d("WebrtcSignalingCommonTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({DEFAULT_AUDIO:0,DEFAULT_VIDEO:1,SCREEN_AUDIO:2,SCREEN_VIDEO:3,CUSTOM_VIDEO:4,CUSTOM_AUDIO:5}),s=e({OLD_CLIENT_PLATFORM_STACK:0,RSYS_X:1,IG_OLD_STACK:2,MLITE_OLD_STACK:3,SCOTCH:4,ZENON:5}),u=e({NONE:0,AVATAR:1,AUGMENTED_CALLING:2,SCENE_COMPOSITION:3,STEREO_VIDEO:4,SHARED_STATE:5,CODEC_AVATAR_2D:6,CODEC_AVATAR_2D_IMU:7}),c=e({NONE:0,AMBISONIC:1,CONVERSATION_BOT:2,MONOMIX:3,MONOSTREAM:4});a.exports={ClientStack:s,CustomAudioContentType:c,CustomVideoContentType:u,TrackLabel:l}}),null);
__d("MultiwaySharedSerializers",["MultiwaySharedTypes","ThriftTypes","WebrtcSignalingCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{cluster:"",nonce:""}}function u(){return{cluster:"",conferenceName:"",nonce:"",userId:"",clientSessionId:""}}function c(){return{userId:"",deviceId:"",appId:"",appVersion:"",appBuildNumber:""}}function d(){return{mode:o("MultiwaySharedTypes").E2eeMode.cast(0),preventSfuMode:!1,infraMandatedExpStatus:o("MultiwaySharedTypes").E2eeInfraMandatedExpStatus.cast(0),p2pSFrameExpStatus:o("MultiwaySharedTypes").P2PSFrameExpStatus.cast(0)}}function m(){return{semantics:"",ssrcs:[]}}function p(){return{type:o("MultiwaySharedTypes").MediaType.cast(0),id:"",ssrcs:[],enabled:!1,customVideoContentType:o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0),customAudioContentType:o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0)}}function _(){return{parameters:{},conditionFbid:"0",exposureHasBeenLogged:!1,canExposureLog:!1,universeShortName:"",userFbid:"0",unitId:""}}function f(){return{experiments:{},userFbid:"0"}}function g(){return{conditionFbid:"0",userFbid:"0",universeName:"",unitId:""}}function h(){return{enabled:!1,customVideoContentType:o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0),customAudioContentType:o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0)}}function y(){return{tracks:{}}}function C(){return{videoQuality:o("MultiwaySharedTypes").VideoQuality.cast(0)}}function b(){return{cname:"",type:o("MultiwaySharedTypes").SubscriptionType.cast(0)}}function v(){return{restrictiveLogging:!0,verboseLogging:!1}}function S(){return{userId:"",streamId:"",streamType:0,renderWidth:0,renderHeight:0}}function R(){return{}}function L(){return{}}function E(){return{}}function k(){return{host:Uint8Array.of(),port:0}}function I(){return{}}function T(t,n){if(n.writeStructBegin("ServerInfo"),n.writeFieldBegin({fname:"cluster",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.cluster!=null)n.writeString(t.cluster);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),t.conferenceName_deprecated!=null&&(n.writeFieldBegin({fname:"conferenceName_deprecated",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.conferenceName_deprecated),n.writeFieldEnd()),n.writeFieldBegin({fname:"nonce",ftype:e.STRING,fid:3}),t.nonce!=null)n.writeString(t.nonce);else{var a="";n.writeString(a)}n.writeFieldEnd(),t.conferenceId!=null&&(n.writeFieldBegin({fname:"conferenceId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:4}),n.writeI64(BigInt(t.conferenceId)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function D(t,n){if(n.writeStructBegin("ClientSessionInfo"),n.writeFieldBegin({fname:"cluster",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.cluster!=null)n.writeString(t.cluster);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"conferenceName",ftype:e.STRING,fid:2}),t.conferenceName!=null)n.writeString(t.conferenceName);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"nonce",ftype:e.STRING,fid:3}),t.nonce!=null)n.writeString(t.nonce);else{var i="";n.writeString(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"userId",ftype:e.STRING,fid:4}),t.userId!=null)n.writeString(t.userId);else{var l="";n.writeString(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"clientSessionId",ftype:e.STRING,fid:5}),t.clientSessionId!=null)n.writeString(t.clientSessionId);else{var s="";n.writeString(s)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function x(t,n){if(n.writeStructBegin("Endpoint"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"deviceId",ftype:e.STRING,fid:2}),t.deviceId!=null)n.writeString(t.deviceId);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"appId",ftype:e.STRING,fid:3}),t.appId!=null)n.writeString(t.appId);else{var i="";n.writeString(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"appVersion",ftype:e.STRING,fid:4}),t.appVersion!=null)n.writeString(t.appVersion);else{var l="";n.writeString(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"appBuildNumber",ftype:e.STRING,fid:5}),t.appBuildNumber!=null)n.writeString(t.appBuildNumber);else{var s="";n.writeString(s)}n.writeFieldEnd(),t.clientStackInfo!=null&&(n.writeFieldBegin({fname:"clientStackInfo",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:6}),n.writeString(t.clientStackInfo),n.writeFieldEnd()),t.familyDeviceId!=null&&(n.writeFieldBegin({fname:"familyDeviceId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeString(t.familyDeviceId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function $(t,n){if(n.writeStructBegin("E2eeEnforcement"),n.writeFieldBegin({fname:"mode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.mode!=null){var a;n.writeI32((a=t.mode)!=null?a:0)}else{var i=o("MultiwaySharedTypes").E2eeMode.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"preventSfuMode",ftype:e.BOOL,fid:2}),t.preventSfuMode!=null)n.writeBool(t.preventSfuMode);else{var l=!1;n.writeBool(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"infraMandatedExpStatus",ftype:e.I32,fid:3}),t.infraMandatedExpStatus!=null){var s;n.writeI32((s=t.infraMandatedExpStatus)!=null?s:0)}else{var u=o("MultiwaySharedTypes").E2eeInfraMandatedExpStatus.cast(0);n.writeI32(u!=null?u:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"p2pSFrameExpStatus",ftype:e.I32,fid:4}),t.p2pSFrameExpStatus!=null){var c;n.writeI32((c=t.p2pSFrameExpStatus)!=null?c:0)}else{var d=o("MultiwaySharedTypes").P2PSFrameExpStatus.cast(0);n.writeI32(d!=null?d:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function P(t,n){if(n.writeStructBegin("SsrcGroup"),n.writeFieldBegin({fname:"semantics",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.semantics!=null)n.writeString(t.semantics);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"ssrcs",ftype:e.LIST,fid:2}),t.ssrcs!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I64,size:t.ssrcs.length});for(var a of t.ssrcs)n.writeI64(BigInt(a));n.writeListEnd()}else{var i=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I64,size:i.length});for(var l of i)n.writeI64(BigInt(l));n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function N(t,n){if(n.writeStructBegin("Media"),n.writeFieldBegin({fname:"type",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.type!=null){var a;n.writeI32((a=t.type)!=null?a:0)}else{var i=o("MultiwaySharedTypes").MediaType.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"id",ftype:e.STRING,fid:2}),t.id!=null)n.writeString(t.id);else{var l="";n.writeString(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"ssrcs",ftype:e.LIST,fid:3}),t.ssrcs!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I64,size:t.ssrcs.length});for(var s of t.ssrcs)n.writeI64(BigInt(s));n.writeListEnd()}else{var u=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I64,size:u.length});for(var c of u)n.writeI64(BigInt(c));n.writeListEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"enabled",ftype:e.BOOL,fid:4}),t.enabled!=null)n.writeBool(t.enabled);else{var d=!1;n.writeBool(d)}if(n.writeFieldEnd(),t.pausedDownlink!=null){var m;n.writeFieldBegin({fname:"pausedDownlink",ftype:(e||(e=r("ThriftTypes"))).I32,fid:5}),n.writeI32((m=t.pausedDownlink)!=null?m:0),n.writeFieldEnd()}if(t.pausedUplink!=null){var p;n.writeFieldBegin({fname:"pausedUplink",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32((p=t.pausedUplink)!=null?p:0),n.writeFieldEnd()}if(t.owner!=null&&(n.writeFieldBegin({fname:"owner",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeString(t.owner),n.writeFieldEnd()),t.label!=null){var _;n.writeFieldBegin({fname:"label",ftype:(e||(e=r("ThriftTypes"))).I32,fid:8}),n.writeI32((_=t.label)!=null?_:0),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"customVideoContentType",ftype:e.I32,fid:9}),t.customVideoContentType!=null){var f;n.writeI32((f=t.customVideoContentType)!=null?f:0)}else{var g=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0);n.writeI32(g!=null?g:0)}if(n.writeFieldEnd(),t.name!=null&&(n.writeFieldBegin({fname:"name",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.name),n.writeFieldEnd()),n.writeFieldBegin({fname:"customAudioContentType",ftype:e.I32,fid:11}),t.customAudioContentType!=null){var h;n.writeI32((h=t.customAudioContentType)!=null?h:0)}else{var y=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0);n.writeI32(y!=null?y:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function M(t,n){if(n.writeStructBegin("QuickExperiment"),n.writeFieldBegin({fname:"parameters",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.parameters!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.parameters).length});for(var o of Object.entries(t.parameters)){var a=o[0],i=o[1];n.writeString(a),j(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeString(u),j(c,n)}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"conditionFbid",ftype:e.I64,fid:2}),t.conditionFbid!=null)n.writeI64(BigInt(t.conditionFbid));else{var d="0";n.writeI64(BigInt(d))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"exposureHasBeenLogged",ftype:e.BOOL,fid:3}),t.exposureHasBeenLogged!=null)n.writeBool(t.exposureHasBeenLogged);else{var m=!1;n.writeBool(m)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"canExposureLog",ftype:e.BOOL,fid:4}),t.canExposureLog!=null)n.writeBool(t.canExposureLog);else{var p=!1;n.writeBool(p)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"universeShortName",ftype:e.STRING,fid:5}),t.universeShortName!=null)n.writeString(t.universeShortName);else{var _="";n.writeString(_)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"userFbid",ftype:e.I64,fid:6}),t.userFbid!=null)n.writeI64(BigInt(t.userFbid));else{var f="0";n.writeI64(BigInt(f))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"unitId",ftype:e.STRING,fid:7}),t.unitId!=null)n.writeString(t.unitId);else{var g="";n.writeString(g)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function w(t,n){if(n.writeStructBegin("QuickExperimentResult"),n.writeFieldBegin({fname:"experiments",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.experiments!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.experiments).length});for(var o of Object.entries(t.experiments)){var a=o[0],i=o[1];n.writeString(a),M(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeString(u),M(c,n)}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"userFbid",ftype:e.I64,fid:2}),t.userFbid!=null)n.writeI64(BigInt(t.userFbid));else{var d="0";n.writeI64(BigInt(d))}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function A(t,n){if(n.writeStructBegin("QuickExperimentExposureLoggingEvent"),n.writeFieldBegin({fname:"conditionFbid",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.conditionFbid!=null)n.writeI64(BigInt(t.conditionFbid));else{var o="0";n.writeI64(BigInt(o))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"userFbid",ftype:e.I64,fid:2}),t.userFbid!=null)n.writeI64(BigInt(t.userFbid));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"universeName",ftype:e.STRING,fid:3}),t.universeName!=null)n.writeString(t.universeName);else{var i="";n.writeString(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"unitId",ftype:e.STRING,fid:4}),t.unitId!=null)n.writeString(t.unitId);else{var l="";n.writeString(l)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function F(t,n){if(n.writeStructBegin("ClientTrackInfo"),n.writeFieldBegin({fname:"enabled",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:1}),t.enabled!=null)n.writeBool(t.enabled);else{var a=!1;n.writeBool(a)}if(n.writeFieldEnd(),t.pausedUplink!=null){var i;n.writeFieldBegin({fname:"pausedUplink",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32((i=t.pausedUplink)!=null?i:0),n.writeFieldEnd()}if(t.pausedDownlink!=null){var l;n.writeFieldBegin({fname:"pausedDownlink",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32((l=t.pausedDownlink)!=null?l:0),n.writeFieldEnd()}if(t.owner!=null&&(n.writeFieldBegin({fname:"owner",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.owner),n.writeFieldEnd()),t.label!=null){var s;n.writeFieldBegin({fname:"label",ftype:(e||(e=r("ThriftTypes"))).I32,fid:5}),n.writeI32((s=t.label)!=null?s:0),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"customVideoContentType",ftype:e.I32,fid:6}),t.customVideoContentType!=null){var u;n.writeI32((u=t.customVideoContentType)!=null?u:0)}else{var c=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0);n.writeI32(c!=null?c:0)}if(n.writeFieldEnd(),t.name!=null&&(n.writeFieldBegin({fname:"name",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeString(t.name),n.writeFieldEnd()),n.writeFieldBegin({fname:"customAudioContentType",ftype:e.I32,fid:8}),t.customAudioContentType!=null){var d;n.writeI32((d=t.customAudioContentType)!=null?d:0)}else{var m=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0);n.writeI32(m!=null?m:0)}n.writeFieldEnd(),t.nodeId!=null&&(n.writeFieldBegin({fname:"nodeId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:9}),n.writeI64(BigInt(t.nodeId)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function O(t,n){if(n.writeStructBegin("ClientMediaStatus"),n.writeFieldBegin({fname:"tracks",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.tracks!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.tracks).length});for(var o of Object.entries(t.tracks)){var a=o[0],i=o[1];n.writeString(a),F(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeString(u),F(c,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function B(t,n){if(n.writeStructBegin("SubscriptionOptions"),n.writeFieldBegin({fname:"videoQuality",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.videoQuality!=null){var a;n.writeI32((a=t.videoQuality)!=null?a:0)}else{var i=o("MultiwaySharedTypes").VideoQuality.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),t.qualityIndex!=null&&(n.writeFieldBegin({fname:"qualityIndex",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32(t.qualityIndex),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function W(t,n){if(n.writeStructBegin("Subscription"),n.writeFieldBegin({fname:"cname",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.cname!=null)n.writeString(t.cname);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),t.options!=null&&(n.writeFieldBegin({fname:"options",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),B(t.options,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"type",ftype:e.I32,fid:3}),t.type!=null){var i;n.writeI32((i=t.type)!=null?i:0)}else{var l=o("MultiwaySharedTypes").SubscriptionType.cast(0);n.writeI32(l!=null?l:0)}n.writeFieldEnd(),t.trackId!=null&&(n.writeFieldBegin({fname:"trackId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.trackId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function q(t,n){if(n.writeStructBegin("LoggingOptions"),n.writeFieldBegin({fname:"restrictiveLogging",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:1}),t.restrictiveLogging!=null)n.writeBool(t.restrictiveLogging);else{var o=!0;n.writeBool(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"verboseLogging",ftype:e.BOOL,fid:2}),t.verboseLogging!=null)n.writeBool(t.verboseLogging);else{var a=!1;n.writeBool(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function U(t,n){if(n.writeStructBegin("ResolutionData"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"streamId",ftype:e.STRING,fid:2}),t.streamId!=null)n.writeString(t.streamId);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"streamType",ftype:e.I32,fid:3}),t.streamType!=null)n.writeI32(t.streamType);else{var i=0;n.writeI32(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"renderWidth",ftype:e.I32,fid:4}),t.renderWidth!=null)n.writeI32(t.renderWidth);else{var l=0;n.writeI32(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"renderHeight",ftype:e.I32,fid:5}),t.renderHeight!=null)n.writeI32(t.renderHeight);else{var s=0;n.writeI32(s)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function V(t,n){n.writeStructBegin("TurnInfo"),t.ipv4!=null&&(n.writeFieldBegin({fname:"ipv4",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeBinary(t.ipv4),n.writeFieldEnd()),t.ipv6!=null&&(n.writeFieldBegin({fname:"ipv6",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.ipv6),n.writeFieldEnd()),t.udpPort!=null&&(n.writeFieldBegin({fname:"udpPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32(t.udpPort),n.writeFieldEnd()),t.tcpPort!=null&&(n.writeFieldBegin({fname:"tcpPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:4}),n.writeI32(t.tcpPort),n.writeFieldEnd()),t.sslTcpPort!=null&&(n.writeFieldBegin({fname:"sslTcpPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:5}),n.writeI32(t.sslTcpPort),n.writeFieldEnd()),t.portInfoIdx!=null&&(n.writeFieldBegin({fname:"portInfoIdx",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32(t.portInfoIdx),n.writeFieldEnd()),t.tlsPort!=null&&(n.writeFieldBegin({fname:"tlsPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:7}),n.writeI32(t.tlsPort),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function H(t,n){if(n.writeStructBegin("EdgerayInfo"),t.edgerayType!=null){var o;n.writeFieldBegin({fname:"edgerayType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32((o=t.edgerayType)!=null?o:0),n.writeFieldEnd()}t.ipv4!=null&&(n.writeFieldBegin({fname:"ipv4",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.ipv4),n.writeFieldEnd()),t.ipv6!=null&&(n.writeFieldBegin({fname:"ipv6",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeBinary(t.ipv6),n.writeFieldEnd()),t.token!=null&&(n.writeFieldBegin({fname:"token",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeBinary(t.token),n.writeFieldEnd()),t.tokenIdx!=null&&(n.writeFieldBegin({fname:"tokenIdx",ftype:(e||(e=r("ThriftTypes"))).I32,fid:5}),n.writeI32(t.tokenIdx),n.writeFieldEnd()),t.secret!=null&&(n.writeFieldBegin({fname:"secret",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:6}),n.writeBinary(t.secret),n.writeFieldEnd()),t.secretIdx!=null&&(n.writeFieldBegin({fname:"secretIdx",ftype:(e||(e=r("ThriftTypes"))).I32,fid:7}),n.writeI32(t.secretIdx),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function G(t,n){if(n.writeStructBegin("RelayInfo"),t.turns!=null){n.writeFieldBegin({fname:"turns",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),n.writeListBegin({etype:e.STRUCT,size:t.turns.length});for(var o of t.turns)V(o,n);n.writeListEnd(),n.writeFieldEnd()}if(t.edgerays!=null){n.writeFieldBegin({fname:"edgerays",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.STRUCT,size:t.edgerays.length});for(var a of t.edgerays)H(a,n);n.writeListEnd(),n.writeFieldEnd()}t.turnUsername!=null&&(n.writeFieldBegin({fname:"turnUsername",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeString(t.turnUsername),n.writeFieldEnd()),t.turnPassword!=null&&(n.writeFieldBegin({fname:"turnPassword",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.turnPassword),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function z(t,n){if(n.writeStructBegin("TSocketAddress"),n.writeFieldBegin({fname:"host",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.host!=null)n.writeBinary(t.host);else{var o=Uint8Array.of();n.writeBinary(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"port",ftype:e.I16,fid:2}),t.port!=null)n.writeI16(t.port);else{var a=0;n.writeI16(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function j(t,n){if(n.writeStructBegin("QuickExperimentValue"),t.intValue!=null){n.writeFieldBegin({fname:"intValue",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),n.writeI64(BigInt(t.intValue)),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.stringValue!=null){n.writeFieldBegin({fname:"stringValue",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.stringValue),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}n.writeFieldStop(),n.writeStructEnd()}function K(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.cluster=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.conferenceName_deprecated=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.nonce=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).I64?n.conferenceId=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.cluster===void 0&&(n.cluster=""),n.nonce===void 0&&(n.nonce=""),n}function Q(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.cluster=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.conferenceName=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.nonce=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRING?n.clientSessionId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.cluster===void 0&&(n.cluster=""),n.conferenceName===void 0&&(n.conferenceName=""),n.nonce===void 0&&(n.nonce=""),n.userId===void 0&&(n.userId=""),n.clientSessionId===void 0&&(n.clientSessionId=""),n}function X(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.deviceId=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.appId=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.appVersion=t.readString():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRING?n.appBuildNumber=t.readString():t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).STRING?n.clientStackInfo=t.readString():t.skip(a);break;case 7:a===(e||(e=r("ThriftTypes"))).STRING?n.familyDeviceId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n.deviceId===void 0&&(n.deviceId=""),n.appId===void 0&&(n.appId=""),n.appVersion===void 0&&(n.appVersion=""),n.appBuildNumber===void 0&&(n.appBuildNumber=""),n}function Y(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.mode=o("MultiwaySharedTypes").E2eeMode.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).BOOL?n.preventSfuMode=t.readBool():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.infraMandatedExpStatus=o("MultiwaySharedTypes").E2eeInfraMandatedExpStatus.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.p2pSFrameExpStatus=o("MultiwaySharedTypes").P2PSFrameExpStatus.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.mode===void 0&&(n.mode=o("MultiwaySharedTypes").E2eeMode.cast(0)),n.preventSfuMode===void 0&&(n.preventSfuMode=!1),n.infraMandatedExpStatus===void 0&&(n.infraMandatedExpStatus=o("MultiwaySharedTypes").E2eeInfraMandatedExpStatus.cast(0)),n.p2pSFrameExpStatus===void 0&&(n.p2pSFrameExpStatus=o("MultiwaySharedTypes").P2PSFrameExpStatus.cast(0)),n}function J(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.semantics=t.readString():t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.ssrcs=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=t.readI64().toString();n.ssrcs.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.semantics===void 0&&(n.semantics=""),n.ssrcs===void 0&&(n.ssrcs=[]),n}function Z(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.type=o("MultiwaySharedTypes").MediaType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.id=t.readString():t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).LIST){n.ssrcs=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=t.readI64().toString();n.ssrcs.push(c)}}else t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).BOOL?n.enabled=t.readBool():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.pausedDownlink=o("MultiwaySharedTypes").MediaPauseStatus.cast(t.readI32()):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.pausedUplink=o("MultiwaySharedTypes").MediaPauseStatus.cast(t.readI32()):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRING?n.owner=t.readString():t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).I32?n.label=o("WebrtcSignalingCommonTypes").TrackLabel.cast(t.readI32()):t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).I32?n.customVideoContentType=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32()):t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRING?n.name=t.readString():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).I32?n.customAudioContentType=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.type===void 0&&(n.type=o("MultiwaySharedTypes").MediaType.cast(0)),n.id===void 0&&(n.id=""),n.ssrcs===void 0&&(n.ssrcs=[]),n.enabled===void 0&&(n.enabled=!1),n.customVideoContentType===void 0&&(n.customVideoContentType=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0)),n.customAudioContentType===void 0&&(n.customAudioContentType=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0)),n}function ee(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.parameters={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readString(),c=pe(t);n.parameters[u]=c}}else t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.conditionFbid=t.readI64().toString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).BOOL?n.exposureHasBeenLogged=t.readBool():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).BOOL?n.canExposureLog=t.readBool():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRING?n.universeShortName=t.readString():t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).I64?n.userFbid=t.readI64().toString():t.skip(a);break;case 7:a===(e||(e=r("ThriftTypes"))).STRING?n.unitId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.parameters===void 0&&(n.parameters={}),n.conditionFbid===void 0&&(n.conditionFbid="0"),n.exposureHasBeenLogged===void 0&&(n.exposureHasBeenLogged=!1),n.canExposureLog===void 0&&(n.canExposureLog=!1),n.universeShortName===void 0&&(n.universeShortName=""),n.userFbid===void 0&&(n.userFbid="0"),n.unitId===void 0&&(n.unitId=""),n}function te(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.experiments={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readString(),c=ee(t);n.experiments[u]=c}}else t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.userFbid=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.experiments===void 0&&(n.experiments={}),n.userFbid===void 0&&(n.userFbid="0"),n}function ne(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I64?n.conditionFbid=t.readI64().toString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.userFbid=t.readI64().toString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.universeName=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.unitId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.conditionFbid===void 0&&(n.conditionFbid="0"),n.userFbid===void 0&&(n.userFbid="0"),n.universeName===void 0&&(n.universeName=""),n.unitId===void 0&&(n.unitId=""),n}function re(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).BOOL?n.enabled=t.readBool():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.pausedUplink=o("MultiwaySharedTypes").MediaPauseStatus.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.pausedDownlink=o("MultiwaySharedTypes").MediaPauseStatus.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.owner=t.readString():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.label=o("WebrtcSignalingCommonTypes").TrackLabel.cast(t.readI32()):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.customVideoContentType=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32()):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRING?n.name=t.readString():t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).I32?n.customAudioContentType=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(t.readI32()):t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).I64?n.nodeId=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.enabled===void 0&&(n.enabled=!1),n.customVideoContentType===void 0&&(n.customVideoContentType=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0)),n.customAudioContentType===void 0&&(n.customAudioContentType=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0)),n}function oe(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.tracks={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readString(),c=re(t);n.tracks[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.tracks===void 0&&(n.tracks={}),n}function ae(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.videoQuality=o("MultiwaySharedTypes").VideoQuality.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.qualityIndex=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.videoQuality===void 0&&(n.videoQuality=o("MultiwaySharedTypes").VideoQuality.cast(0)),n}function ie(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.cname=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.options=ae(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.type=o("MultiwaySharedTypes").SubscriptionType.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.trackId=t.readString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.cname===void 0&&(n.cname=""),n.type===void 0&&(n.type=o("MultiwaySharedTypes").SubscriptionType.cast(0)),n}function le(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).BOOL?n.restrictiveLogging=t.readBool():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).BOOL?n.verboseLogging=t.readBool():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.restrictiveLogging===void 0&&(n.restrictiveLogging=!0),n.verboseLogging===void 0&&(n.verboseLogging=!1),n}function se(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.streamId=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.streamType=t.readI32():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).I32?n.renderWidth=t.readI32():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).I32?n.renderHeight=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n.streamId===void 0&&(n.streamId=""),n.streamType===void 0&&(n.streamType=0),n.renderWidth===void 0&&(n.renderWidth=0),n.renderHeight===void 0&&(n.renderHeight=0),n}function ue(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.ipv4=t.readBinary():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.ipv6=t.readBinary():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.udpPort=t.readI32():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).I32?n.tcpPort=t.readI32():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).I32?n.sslTcpPort=t.readI32():t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).I32?n.portInfoIdx=t.readI32():t.skip(a);break;case 7:a===(e||(e=r("ThriftTypes"))).I32?n.tlsPort=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function ce(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.edgerayType=o("MultiwaySharedTypes").EdgerayType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.ipv4=t.readBinary():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.ipv6=t.readBinary():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.token=t.readBinary():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.tokenIdx=t.readI32():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRING?n.secret=t.readBinary():t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).I32?n.secretIdx=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function de(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).LIST){n.turns=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=ue(t);n.turns.push(u)}}else t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.edgerays=[];for(var c=t.readListBegin(),d=0;d<c.size;d++){var m=ce(t);n.edgerays.push(m)}}else t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.turnUsername=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.turnPassword=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function me(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.host=t.readBinary():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I16?n.port=t.readI16():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.host===void 0&&(n.host=Uint8Array.of()),n.port===void 0&&(n.port=0),n}function pe(t){var n,o={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).I64)if(n==null)o.intValue=t.readI64().toString(),n="intValue";else throw new Error("more than one field have been deserialized in union type: QuickExperimentValue; current field: intValue, previous deserialized field: "+n);else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).STRING)if(n==null)o.stringValue=t.readString(),n="stringValue";else throw new Error("more than one field have been deserialized in union type: QuickExperimentValue; current field: stringValue, previous deserialized field: "+n);else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),o}l.ServerInfo$DefaultConstructor=s,l.ClientSessionInfo$DefaultConstructor=u,l.Endpoint$DefaultConstructor=c,l.E2eeEnforcement$DefaultConstructor=d,l.SsrcGroup$DefaultConstructor=m,l.Media$DefaultConstructor=p,l.QuickExperiment$DefaultConstructor=_,l.QuickExperimentResult$DefaultConstructor=f,l.QuickExperimentExposureLoggingEvent$DefaultConstructor=g,l.ClientTrackInfo$DefaultConstructor=h,l.ClientMediaStatus$DefaultConstructor=y,l.SubscriptionOptions$DefaultConstructor=C,l.Subscription$DefaultConstructor=b,l.LoggingOptions$DefaultConstructor=v,l.ResolutionData$DefaultConstructor=S,l.TurnInfo$DefaultConstructor=R,l.EdgerayInfo$DefaultConstructor=L,l.RelayInfo$DefaultConstructor=E,l.TSocketAddress$DefaultConstructor=k,l.QuickExperimentValue$DefaultConstructor=I,l.serializeServerInfo=T,l.serializeClientSessionInfo=D,l.serializeEndpoint=x,l.serializeE2eeEnforcement=$,l.serializeSsrcGroup=P,l.serializeMedia=N,l.serializeQuickExperiment=M,l.serializeQuickExperimentResult=w,l.serializeQuickExperimentExposureLoggingEvent=A,l.serializeClientTrackInfo=F,l.serializeClientMediaStatus=O,l.serializeSubscriptionOptions=B,l.serializeSubscription=W,l.serializeLoggingOptions=q,l.serializeResolutionData=U,l.serializeTurnInfo=V,l.serializeEdgerayInfo=H,l.serializeRelayInfo=G,l.serializeTSocketAddress=z,l.serializeQuickExperimentValue=j,l.deserializeServerInfo=K,l.deserializeClientSessionInfo=Q,l.deserializeEndpoint=X,l.deserializeE2eeEnforcement=Y,l.deserializeSsrcGroup=J,l.deserializeMedia=Z,l.deserializeQuickExperiment=ee,l.deserializeQuickExperimentResult=te,l.deserializeQuickExperimentExposureLoggingEvent=ne,l.deserializeClientTrackInfo=re,l.deserializeClientMediaStatus=oe,l.deserializeSubscriptionOptions=ae,l.deserializeSubscription=ie,l.deserializeLoggingOptions=le,l.deserializeResolutionData=se,l.deserializeTurnInfo=ue,l.deserializeEdgerayInfo=ce,l.deserializeRelayInfo=de,l.deserializeTSocketAddress=me,l.deserializeQuickExperimentValue=pe}),98);
__d("WebrtcSignalingCommonSerializers",["ThriftTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{topic:"",data:Uint8Array.of()}}function u(t,n){if(n.writeStructBegin("GenericDataMessage"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"data",ftype:e.STRING,fid:2}),t.data!=null)n.writeBinary(t.data);else{var a=Uint8Array.of();n.writeBinary(a)}n.writeFieldEnd(),t.e2eEncryptedData!=null&&(n.writeFieldBegin({fname:"e2eEncryptedData",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeBinary(t.e2eEncryptedData),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function c(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.data=t.readBinary():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.e2eEncryptedData=t.readBinary():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.data===void 0&&(n.data=Uint8Array.of()),n}l.GenericDataMessage$DefaultConstructor=s,l.serializeGenericDataMessage=u,l.deserializeGenericDataMessage=c}),98);
__d("DataMessageSerializers",["MultiwaySharedSerializers","MultiwaySharedTypes","ThriftTypes","WebrtcSignalingCommonSerializers"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{topic_DEPRECATED:""}}function u(){return{userId:""}}function c(){return{userId:"",cname:"",trackIds:[],transactionId:"0"}}function d(){return{cname:"",quality_DEPRECATED:o("MultiwaySharedTypes").VideoQuality.cast(0)}}function m(){return{userId:"",bottleneckBps:0}}function p(){return{bottleneckUplinksByLayer:{}}}function _(){return{duplicationAmount:0,delayMs:0}}function f(){return{}}function g(){return{}}function h(){return{primarySpeakerUserId:"",transactionId:"0"}}function y(){return{}}function C(){return{signalingMessagePayload:Uint8Array.of()}}function b(){return{signalingMessagePayload:Uint8Array.of()}}function v(){return{subscriptionMessagePayload:[]}}function S(){return{}}function R(){return{}}function L(){return{nodeIdToUserIdMap:{},nodeIdToServiceTypeMap:{}}}function E(){return{}}function k(){return{header:s()}}function I(t,n){if(n.writeStructBegin("DataHeader"),t.sender!=null&&(n.writeFieldBegin({fname:"sender",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.sender),n.writeFieldEnd()),n.writeFieldBegin({fname:"topic_DEPRECATED",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),t.topic_DEPRECATED!=null)n.writeString(t.topic_DEPRECATED);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),t.recipients!=null){n.writeFieldBegin({fname:"recipients",ftype:(e||(e=r("ThriftTypes"))).SET,fid:3}),n.writeSetBegin({etype:e.STRING,size:t.recipients.size});for(var a of t.recipients)n.writeString(a);n.writeSetEnd(),n.writeFieldEnd()}if(t.serviceSender!=null){var i;n.writeFieldBegin({fname:"serviceSender",ftype:(e||(e=r("ThriftTypes"))).I32,fid:4}),n.writeI32((i=t.serviceSender)!=null?i:0),n.writeFieldEnd()}if(t.serviceRecipients!=null){n.writeFieldBegin({fname:"serviceRecipients",ftype:(e||(e=r("ThriftTypes"))).SET,fid:5}),n.writeSetBegin({etype:e.I32,size:t.serviceRecipients.size});for(var l of t.serviceRecipients)n.writeI32(l!=null?l:0);n.writeSetEnd(),n.writeFieldEnd()}t.shouldSendToAllUsers!=null&&(n.writeFieldBegin({fname:"shouldSendToAllUsers",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:6}),n.writeBool(t.shouldSendToAllUsers),n.writeFieldEnd()),t.senderE2eeId!=null&&(n.writeFieldBegin({fname:"senderE2eeId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeBinary(t.senderE2eeId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function T(t,n){if(n.writeStructBegin("SpeakerDetail"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function D(t,n){if(n.writeStructBegin("DominantSpeakerNotification"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"cname",ftype:e.STRING,fid:2}),t.cname!=null)n.writeString(t.cname);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"trackIds",ftype:e.LIST,fid:4}),t.trackIds!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.trackIds.length});for(var i of t.trackIds)n.writeString(i);n.writeListEnd()}else{var l=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:l.length});for(var s of l)n.writeString(s);n.writeListEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"transactionId",ftype:e.I64,fid:5}),t.transactionId!=null)n.writeI64(BigInt(t.transactionId));else{var u="0";n.writeI64(BigInt(u))}if(n.writeFieldEnd(),t.dominantSpeakers!=null){n.writeFieldBegin({fname:"dominantSpeakers",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:6}),n.writeListBegin({etype:e.STRUCT,size:t.dominantSpeakers.length});for(var c of t.dominantSpeakers)T(c,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function x(t,n){if(n.writeStructBegin("VideoUploadRequest"),n.writeFieldBegin({fname:"cname",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.cname!=null)n.writeString(t.cname);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"quality_DEPRECATED",ftype:e.I32,fid:2}),t.quality_DEPRECATED!=null){var i;n.writeI32((i=t.quality_DEPRECATED)!=null?i:0)}else{var l=o("MultiwaySharedTypes").VideoQuality.cast(0);n.writeI32(l!=null?l:0)}if(n.writeFieldEnd(),t.qualityMask!=null&&(n.writeFieldBegin({fname:"qualityMask",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32(t.qualityMask),n.writeFieldEnd()),t.perSsrcTargetBitrateBpsMap!=null){n.writeFieldBegin({fname:"perSsrcTargetBitrateBpsMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:4}),n.writeMapBegin({ktype:e.I64,vtype:e.I64,size:Object.keys(t.perSsrcTargetBitrateBpsMap).length});for(var s of Object.entries(t.perSsrcTargetBitrateBpsMap)){var u=s[0],c=s[1];n.writeI64(BigInt(u)),n.writeI64(BigInt(c))}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function $(t,n){if(n.writeStructBegin("ReceiverBottleneck"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"bottleneckBps",ftype:e.I32,fid:2}),t.bottleneckBps!=null)n.writeI32(t.bottleneckBps);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function P(t,n){if(n.writeStructBegin("BweDebugInfo"),n.writeFieldBegin({fname:"bottleneckUplinksByLayer",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.bottleneckUplinksByLayer!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(t.bottleneckUplinksByLayer).length});for(var o of Object.entries(t.bottleneckUplinksByLayer)){var a=o[0],i=o[1];n.writeI32(Number(a)),$(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeI32(Number(u)),$(c,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function N(t,n){if(n.writeStructBegin("AudioDuplicationDebugInfo"),n.writeFieldBegin({fname:"duplicationAmount",ftype:(e||(e=r("ThriftTypes"))).I16,fid:1}),t.duplicationAmount!=null)n.writeI16(t.duplicationAmount);else{var o=0;n.writeI16(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"delayMs",ftype:e.I16,fid:2}),t.delayMs!=null)n.writeI16(t.delayMs);else{var a=0;n.writeI16(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function M(t,n){n.writeStructBegin("ReceiveTrackDebugInfo"),t.trackId!=null&&(n.writeFieldBegin({fname:"trackId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.trackId),n.writeFieldEnd()),t.numSimulcastLayersSupported!=null&&(n.writeFieldBegin({fname:"numSimulcastLayersSupported",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32(t.numSimulcastLayersSupported),n.writeFieldEnd()),t.numSimulcastLayersAllocated!=null&&(n.writeFieldBegin({fname:"numSimulcastLayersAllocated",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32(t.numSimulcastLayersAllocated),n.writeFieldEnd()),t.spatialLayerIndex!=null&&(n.writeFieldBegin({fname:"spatialLayerIndex",ftype:(e||(e=r("ThriftTypes"))).I32,fid:4}),n.writeI32(t.spatialLayerIndex),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function w(t,n){if(n.writeStructBegin("DebugInfo"),t.audioDuplicationDebugInfo!=null&&(n.writeFieldBegin({fname:"audioDuplicationDebugInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),N(t.audioDuplicationDebugInfo,n),n.writeFieldEnd()),t.receiveTrackDebugInfo!=null){n.writeFieldBegin({fname:"receiveTrackDebugInfo",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.STRUCT,size:t.receiveTrackDebugInfo.length});for(var o of t.receiveTrackDebugInfo)M(o,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function A(t,n){if(n.writeStructBegin("DominantSpeakerInfo"),n.writeFieldBegin({fname:"primarySpeakerUserId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.primarySpeakerUserId!=null)n.writeString(t.primarySpeakerUserId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"transactionId",ftype:e.I64,fid:2}),t.transactionId!=null)n.writeI64(BigInt(t.transactionId));else{var a="0";n.writeI64(BigInt(a))}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function F(t,n){if(n.writeStructBegin("VideoUploadInfo"),t.qualityMask!=null&&(n.writeFieldBegin({fname:"qualityMask",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32(t.qualityMask),n.writeFieldEnd()),t.perSsrcTargetBitrateBpsMap!=null){n.writeFieldBegin({fname:"perSsrcTargetBitrateBpsMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:2}),n.writeMapBegin({ktype:e.I64,vtype:e.I64,size:Object.keys(t.perSsrcTargetBitrateBpsMap).length});for(var o of Object.entries(t.perSsrcTargetBitrateBpsMap)){var a=o[0],i=o[1];n.writeI64(BigInt(a)),n.writeI64(BigInt(i))}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function O(t,n){if(n.writeStructBegin("SignalingMessageToClient"),n.writeFieldBegin({fname:"signalingMessagePayload",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.signalingMessagePayload!=null)n.writeBinary(t.signalingMessagePayload);else{var o=Uint8Array.of();n.writeBinary(o)}n.writeFieldEnd(),t.version!=null&&(n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I64,fid:2}),n.writeI64(BigInt(t.version)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function B(t,n){if(n.writeStructBegin("SignalingMessageFromClient"),n.writeFieldBegin({fname:"signalingMessagePayload",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.signalingMessagePayload!=null)n.writeBinary(t.signalingMessagePayload);else{var o=Uint8Array.of();n.writeBinary(o)}n.writeFieldEnd(),t.version!=null&&(n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I64,fid:2}),n.writeI64(BigInt(t.version)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function W(t,n){if(n.writeStructBegin("SubscriptionMessageFromClient"),n.writeFieldBegin({fname:"subscriptionMessagePayload",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),t.subscriptionMessagePayload!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.subscriptionMessagePayload.length});for(var a of t.subscriptionMessagePayload)o("MultiwaySharedSerializers").serializeSubscription(a,n);n.writeListEnd()}else{var i=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:i.length});for(var l of i)o("MultiwaySharedSerializers").serializeSubscription(l,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function q(t,n){if(n.writeStructBegin("RenderResolutionMessageFromClient"),t.renderResolutionMap!=null){n.writeFieldBegin({fname:"renderResolutionMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),n.writeMapBegin({ktype:e.STRING,vtype:e.MAP,size:Object.keys(t.renderResolutionMap).length});for(var a of Object.entries(t.renderResolutionMap)){var i=a[0],l=a[1];n.writeString(i),n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u,c=s[0],d=s[1];n.writeI32((u=Number(c))!=null?u:0),o("MultiwaySharedSerializers").serializeResolutionData(d,n)}n.writeMapEnd()}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function U(t,n){if(n.writeStructBegin("RenderResolutionMessageToClient"),t.renderResolutionMap!=null){n.writeFieldBegin({fname:"renderResolutionMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),n.writeMapBegin({ktype:e.STRING,vtype:e.MAP,size:Object.keys(t.renderResolutionMap).length});for(var a of Object.entries(t.renderResolutionMap)){var i=a[0],l=a[1];n.writeString(i),n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u,c=s[0],d=s[1];n.writeI32((u=Number(c))!=null?u:0),o("MultiwaySharedSerializers").serializeResolutionData(d,n)}n.writeMapEnd()}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function V(t,n){if(n.writeStructBegin("NodeIdNotification"),n.writeFieldBegin({fname:"nodeIdToUserIdMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.nodeIdToUserIdMap!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I64,vtype:e.I64,size:Object.keys(t.nodeIdToUserIdMap).length});for(var o of Object.entries(t.nodeIdToUserIdMap)){var a=o[0],i=o[1];n.writeI64(BigInt(a)),n.writeI64(BigInt(i))}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I64,vtype:e.I64,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeI64(BigInt(u)),n.writeI64(BigInt(c))}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"nodeIdToServiceTypeMap",ftype:e.MAP,fid:2}),t.nodeIdToServiceTypeMap!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I64,vtype:e.I32,size:Object.keys(t.nodeIdToServiceTypeMap).length});for(var d of Object.entries(t.nodeIdToServiceTypeMap)){var m=d[0],p=d[1];n.writeI64(BigInt(m)),n.writeI32(p!=null?p:0)}n.writeMapEnd()}else{var _={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I64,vtype:e.I32,size:Object.keys(_).length});for(var f of Object.entries(_)){var g=f[0],h=f[1];n.writeI64(BigInt(g)),n.writeI32(h!=null?h:0)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function H(t,n){n.writeStructBegin("DataMessageBody"),t.genericMessage!=null&&(n.writeFieldBegin({fname:"genericMessage",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),o("WebrtcSignalingCommonSerializers").serializeGenericDataMessage(t.genericMessage,n),n.writeFieldEnd()),t.dominantSpeakerNotification!=null&&(n.writeFieldBegin({fname:"dominantSpeakerNotification",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),D(t.dominantSpeakerNotification,n),n.writeFieldEnd()),t.videoUploadRequest!=null&&(n.writeFieldBegin({fname:"videoUploadRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),x(t.videoUploadRequest,n),n.writeFieldEnd()),t.dominantSpeakerSignalingInfo!=null&&(n.writeFieldBegin({fname:"dominantSpeakerSignalingInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),A(t.dominantSpeakerSignalingInfo,n),n.writeFieldEnd()),t.bweDebugInfo!=null&&(n.writeFieldBegin({fname:"bweDebugInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),P(t.bweDebugInfo,n),n.writeFieldEnd()),t.debugInfo!=null&&(n.writeFieldBegin({fname:"debugInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),w(t.debugInfo,n),n.writeFieldEnd()),t.videoUploadSignalingInfo!=null&&(n.writeFieldBegin({fname:"videoUploadSignalingInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:7}),F(t.videoUploadSignalingInfo,n),n.writeFieldEnd()),t.signalingMessageToClient!=null&&(n.writeFieldBegin({fname:"signalingMessageToClient",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:8}),O(t.signalingMessageToClient,n),n.writeFieldEnd()),t.signalingMessageFromClient!=null&&(n.writeFieldBegin({fname:"signalingMessageFromClient",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:9}),B(t.signalingMessageFromClient,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function G(t,n){if(n.writeStructBegin("DataMessage"),n.writeFieldBegin({fname:"header",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.header!=null)I(t.header,n);else{var o=s();I(o,n)}n.writeFieldEnd(),t.data_DEPRECATED!=null&&(n.writeFieldBegin({fname:"data_DEPRECATED",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.data_DEPRECATED),n.writeFieldEnd()),t.body!=null&&(n.writeFieldBegin({fname:"body",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),H(t.body,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function z(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.sender=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.topic_DEPRECATED=t.readString():t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).SET){n.recipients=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=t.readString();n.recipients.add(c)}}else t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.serviceSender=o("MultiwaySharedTypes").EndpointServiceType.cast(t.readI32()):t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).SET){n.serviceRecipients=new Set;for(var d=t.readSetBegin(),m=0;m<d.size;m++){var p=o("MultiwaySharedTypes").EndpointServiceType.cast(t.readI32());n.serviceRecipients.add(p)}}else t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).BOOL?n.shouldSendToAllUsers=t.readBool():t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRING?n.senderE2eeId=t.readBinary():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.topic_DEPRECATED===void 0&&(n.topic_DEPRECATED=""),n}function j(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n}function K(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.cname=t.readString():t.skip(a);break;case 4:if(a===(e||(e=r("ThriftTypes"))).LIST){n.trackIds=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=t.readString();n.trackIds.push(u)}}else t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).I64?n.transactionId=t.readI64().toString():t.skip(a);break;case 6:if(a===(e||(e=r("ThriftTypes"))).LIST){n.dominantSpeakers=[];for(var c=t.readListBegin(),d=0;d<c.size;d++){var m=j(t);n.dominantSpeakers.push(m)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n.cname===void 0&&(n.cname=""),n.trackIds===void 0&&(n.trackIds=[]),n.transactionId===void 0&&(n.transactionId="0"),n}function Q(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.cname=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.quality_DEPRECATED=o("MultiwaySharedTypes").VideoQuality.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.qualityMask=t.readI32():t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).MAP){n.perSsrcTargetBitrateBpsMap={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readI64().toString(),d=t.readI64().toString();n.perSsrcTargetBitrateBpsMap[c]=d}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.cname===void 0&&(n.cname=""),n.quality_DEPRECATED===void 0&&(n.quality_DEPRECATED=o("MultiwaySharedTypes").VideoQuality.cast(0)),n}function X(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I32?n.bottleneckBps=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n.bottleneckBps===void 0&&(n.bottleneckBps=0),n}function Y(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.bottleneckUplinksByLayer={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readI32(),c=X(t);n.bottleneckUplinksByLayer[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.bottleneckUplinksByLayer===void 0&&(n.bottleneckUplinksByLayer={}),n}function J(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I16?n.duplicationAmount=t.readI16():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I16?n.delayMs=t.readI16():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.duplicationAmount===void 0&&(n.duplicationAmount=0),n.delayMs===void 0&&(n.delayMs=0),n}function Z(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.trackId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I32?n.numSimulcastLayersSupported=t.readI32():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.numSimulcastLayersAllocated=t.readI32():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).I32?n.spatialLayerIndex=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function ee(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.audioDuplicationDebugInfo=J(t):t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.receiveTrackDebugInfo=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=Z(t);n.receiveTrackDebugInfo.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function te(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.primarySpeakerUserId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.transactionId=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.primarySpeakerUserId===void 0&&(n.primarySpeakerUserId=""),n.transactionId===void 0&&(n.transactionId="0"),n}function ne(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I32?n.qualityMask=t.readI32():t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).MAP){n.perSsrcTargetBitrateBpsMap={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readI64().toString(),c=t.readI64().toString();n.perSsrcTargetBitrateBpsMap[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function re(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.signalingMessagePayload=t.readBinary():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.version=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.signalingMessagePayload===void 0&&(n.signalingMessagePayload=Uint8Array.of()),n}function oe(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.signalingMessagePayload=t.readBinary():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.version=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.signalingMessagePayload===void 0&&(n.signalingMessagePayload=Uint8Array.of()),n}function ae(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).LIST){n.subscriptionMessagePayload=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=o("MultiwaySharedSerializers").deserializeSubscription(t);n.subscriptionMessagePayload.push(c)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.subscriptionMessagePayload===void 0&&(n.subscriptionMessagePayload=[]),n}function ie(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.renderResolutionMap={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){for(var c=t.readString(),d={},m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("MultiwaySharedTypes").RenderedStreamType.cast(t.readI32()),f=o("MultiwaySharedSerializers").deserializeResolutionData(t);_!=null&&(d[_]=f)}n.renderResolutionMap[c]=d}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function le(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.renderResolutionMap={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){for(var c=t.readString(),d={},m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("MultiwaySharedTypes").RenderedStreamType.cast(t.readI32()),f=o("MultiwaySharedSerializers").deserializeResolutionData(t);_!=null&&(d[_]=f)}n.renderResolutionMap[c]=d}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function se(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.nodeIdToUserIdMap={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readI64().toString(),d=t.readI64().toString();n.nodeIdToUserIdMap[c]=d}}else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).MAP){n.nodeIdToServiceTypeMap={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=t.readI64().toString(),f=o("MultiwaySharedTypes").EndpointServiceType.cast(t.readI32());n.nodeIdToServiceTypeMap[_]=f}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.nodeIdToUserIdMap===void 0&&(n.nodeIdToUserIdMap={}),n.nodeIdToServiceTypeMap===void 0&&(n.nodeIdToServiceTypeMap={}),n}function ue(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.genericMessage=o("WebrtcSignalingCommonSerializers").deserializeGenericDataMessage(t):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.dominantSpeakerNotification=K(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRUCT?n.videoUploadRequest=Q(t):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRUCT?n.dominantSpeakerSignalingInfo=te(t):t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRUCT?n.bweDebugInfo=Y(t):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRUCT?n.debugInfo=ee(t):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRUCT?n.videoUploadSignalingInfo=ne(t):t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).STRUCT?n.signalingMessageToClient=re(t):t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).STRUCT?n.signalingMessageFromClient=oe(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function ce(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.header=z(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.data_DEPRECATED=t.readBinary():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRUCT?n.body=ue(t):t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.header===void 0&&(n.header=s()),n}l.DataHeader$DefaultConstructor=s,l.SpeakerDetail$DefaultConstructor=u,l.DominantSpeakerNotification$DefaultConstructor=c,l.VideoUploadRequest$DefaultConstructor=d,l.ReceiverBottleneck$DefaultConstructor=m,l.BweDebugInfo$DefaultConstructor=p,l.AudioDuplicationDebugInfo$DefaultConstructor=_,l.ReceiveTrackDebugInfo$DefaultConstructor=f,l.DebugInfo$DefaultConstructor=g,l.DominantSpeakerInfo$DefaultConstructor=h,l.VideoUploadInfo$DefaultConstructor=y,l.SignalingMessageToClient$DefaultConstructor=C,l.SignalingMessageFromClient$DefaultConstructor=b,l.SubscriptionMessageFromClient$DefaultConstructor=v,l.RenderResolutionMessageFromClient$DefaultConstructor=S,l.RenderResolutionMessageToClient$DefaultConstructor=R,l.NodeIdNotification$DefaultConstructor=L,l.DataMessageBody$DefaultConstructor=E,l.DataMessage$DefaultConstructor=k,l.serializeDataHeader=I,l.serializeSpeakerDetail=T,l.serializeDominantSpeakerNotification=D,l.serializeVideoUploadRequest=x,l.serializeReceiverBottleneck=$,l.serializeBweDebugInfo=P,l.serializeAudioDuplicationDebugInfo=N,l.serializeReceiveTrackDebugInfo=M,l.serializeDebugInfo=w,l.serializeDominantSpeakerInfo=A,l.serializeVideoUploadInfo=F,l.serializeSignalingMessageToClient=O,l.serializeSignalingMessageFromClient=B,l.serializeSubscriptionMessageFromClient=W,l.serializeRenderResolutionMessageFromClient=q,l.serializeRenderResolutionMessageToClient=U,l.serializeNodeIdNotification=V,l.serializeDataMessageBody=H,l.serializeDataMessage=G,l.deserializeDataHeader=z,l.deserializeSpeakerDetail=j,l.deserializeDominantSpeakerNotification=K,l.deserializeVideoUploadRequest=Q,l.deserializeReceiverBottleneck=X,l.deserializeBweDebugInfo=Y,l.deserializeAudioDuplicationDebugInfo=J,l.deserializeReceiveTrackDebugInfo=Z,l.deserializeDebugInfo=ee,l.deserializeDominantSpeakerInfo=te,l.deserializeVideoUploadInfo=ne,l.deserializeSignalingMessageToClient=re,l.deserializeSignalingMessageFromClient=oe,l.deserializeSubscriptionMessageFromClient=ae,l.deserializeRenderResolutionMessageFromClient=ie,l.deserializeRenderResolutionMessageToClient=le,l.deserializeNodeIdNotification=se,l.deserializeDataMessageBody=ue,l.deserializeDataMessage=ce}),98);
__d("DataMessageTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({OK:200,NOT_FOUND:404});a.exports={DataMessageStatusCode:e}}),null);
__d("HorizonWebMqttChannel",["CurrentUser","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig"],(function(t,n,r,o,a,i,l){"use strict";r("MqttEnvInitializer").initialize();function e(){var e;return o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn),new(r("MqttChannel"))({appId:(e=r("MqttWebConfig")).appID,capabilities:e.capabilities,chatVisibility:!0,clientCapabilities:e.clientCapabilities,endpoint:e.endpoint,initialSubscribedTopics:e.subscribedTopics,pageId:null,phpOverride:e.hostNameOverride,pollingEndpoint:e.pollingEndpoint,userFbid:e.fbid})}var s=null;function u(){return s==null&&(s=e()),s}function c(){s!=null&&(s.shutdown(),s=null)}l.getHorizonWebMqttChannelInstance=u,l.shutdownAndClear=c}),98);
__d("IGDOverLSMqttChannel",["CurrentUser","Env","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s;r("MqttEnvInitializer").initialize();function u(e){o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn);var t=r("CurrentUser").getAppID()==null?936619743392459:Number(r("CurrentUser").getAppID());return new(r("MqttChannel"))({appId:t,capabilities:r("MqttWebConfig").capabilities,chatVisibility:!0,clientCapabilities:r("MqttWebConfig").clientCapabilities,clientType:"cookie_auth",deviceId:e,endpoint:(s||(s=r("Env"))).ig_mqtt_wss_endpoint||"wss://edge-chat.instagram.com/chat",initialSubscribedTopics:r("MqttWebConfig").subscribedTopics,phpOverride:r("MqttWebConfig").hostNameOverride,pollingEndpoint:(s||(s=r("Env"))).ig_mqtt_polling_endpoint||"https://edge-chat.instagram.com/mqtt/pull",userFbid:r("CurrentUser").getPossiblyNonFacebookUserID()})}var c=null,d;function m(e){c==null&&(c=u(e));var t=c;return d==null||d(t),t}function p(){return new(e||(e=n("Promise")))(function(e){c?e(m()):d=function(n){e(n)}})}function _(){c!=null&&(c.shutdown(),c=null)}l.getInstance=m,l.waitAndGetInstance=p,l.shutdownAndClear=_}),98);
__d("LiveChatWidgetMqttChannel",["MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig"],(function(t,n,r,o,a,i,l){"use strict";r("MqttEnvInitializer").initialize();function e(){var e;return o("MqttEnv").setIsUserLoggedInNow(function(){return!0}),new(r("MqttChannel"))({appId:0x70127cc7da0a0,capabilities:(e=r("MqttWebConfig")).capabilities,chatVisibility:!1,clientCapabilities:e.clientCapabilities,endpoint:e.endpoint,initialSubscribedTopics:e.subscribedTopics,pageId:null,phpOverride:e.hostNameOverride,pollingEndpoint:e.pollingEndpoint,userFbid:e.fbid})}var s=null;function u(){return s==null&&(s=e()),s}function c(){s!=null&&(s.shutdown(),s=null)}l.getLiveChatWidgetMqttChannelInstance=u,l.shutdownAndClear=c}),98);
__d("MDCMqttChannel",["CurrentUser","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";r("MqttEnvInitializer").initialize();function e(e){o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn);var t=r("CurrentUser").getAppID()==null?0xc7269b363f3c:Number(r("CurrentUser").getAppID());return new(r("MqttChannel"))({appId:t,capabilities:r("MqttWebConfig").capabilities,chatVisibility:!0,clientCapabilities:r("MqttWebConfig").clientCapabilities,clientType:"websocket",deviceId:r("uuidv4")(),endpoint:r("MqttWebConfig").endpoint,initialSubscribedTopics:r("MqttWebConfig").subscribedTopics,phpOverride:r("MqttWebConfig").hostNameOverride,pollingEndpoint:r("MqttWebConfig").pollingEndpoint,userFbid:r("CurrentUser").getPossiblyNonFacebookUserID()})}var s=null;function u(t){return s==null&&(s=e(t)),s}function c(){return s}function d(){s!=null&&(s.shutdown(),s=null)}l.getMDCMqttChannelInstance=u,l.getMDCMqttChannelInstanceDoNotCreate=c,l.shutdownAndClear=d}),98);
__d("MqttThriftHeaderSerializers",["ThriftTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{}}function u(t,n){n.writeStructBegin("MqttThriftHeader"),t.traceInfo!=null&&(n.writeFieldBegin({fname:"traceInfo",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.traceInfo),n.writeFieldEnd()),t.coreContextRequestId!=null&&(n.writeFieldBegin({fname:"coreContextRequestId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.coreContextRequestId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function c(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.traceInfo=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.coreContextRequestId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}l.MqttThriftHeader$DefaultConstructor=s,l.serializeMqttThriftHeader=u,l.deserializeMqttThriftHeader=c}),98);
__d("MultiwayCommonTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({STRING:0,THRIFT:1,BOTH:2}),s=e({OK:200,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,METHOD_NOT_ALLOWED:406,CONFLICT:409,CONDITIONAL_REQUEST_FAILED:412,SERVER_INTERNAL_ERROR:500,SERVICE_UNAVAILABLE:503}),u=e({UNKNOWN:1e3,EXCEEDED_MAX_ALLOWED_PARTICIPANTS:1001,MEMBERSHIP_CHECK_FAIL:1002,CONFERENCE_THROTTLED:1003,ENDPOINT_THROTTLED:1004,MWS_MESSAGE_SENT_TO_INCORRECT_REGION:1005,UNSUPPORTED_REQUEST_TYPE:2e3,CLIENT_REQUEST_UNACCEPTABLE:2001,CLIENT_RESPONSE_UNACCEPTABLE:2002,RING_RESPONSE_BODY_NOT_SET:2004,SERVER_MEDIA_UPDATE_RESPONSE_BODY_NOT_SET:2005,INVALID_SDP:2006,INVALID_CONFERENCE_NAME:2007,SERVER_INFO_CONFERENCE_NAME_MISMATCH:2008,INVALID_USER_ID:2009,INCORRECT_VERSION_RANGE:2010,SENDER_ID_MISMATCH:2011,RECIPIENT_NOT_SPECIFIED:2012,FIELD_NOT_ALLOWED:2013,USERS_NOT_SPECIFIED:2015,REQUEST_UNACCEPTABLE_FOR_ENDPOINT_STATE:2016,INVALID_CALL_ID:2017,SESSION_DESCRIPTION_ID_MISMATCH:2018,EMPTY_CLIENT_MEDIA_UPDATES:2019,INVALID_SERVER_INFO_DATA:2020,INCORRECT_STATE_VERSION:2021,MISMATCHED_STATE_FOR_VERSION:2022,INVALID_STATE_VERSION:2023,NO_RESOLVER_FOUND:2024,MISSING_APPROVERLIST:2025,FULL_SDP_REQUIRED_IN_APPROVED_STATE:2026,INVALID_BROADCAST_ID:2027,INVALID_ENDPOINT_CONFIG:2028,INVALID_E2EE_STATE:2029,SFU_MODE_PREVENTED:2030,INVALID_CONFERENCE_STATE:2031,JOIN_REQUEST_DENIED:2032,EMPTY_USER_IDS:2033,MISSING_SDP_CONNECT_REQUEST:2034,CALLER_HAS_APPEALABLE_CALLING_RESTRICTION:2035,MISSING_BODY_ENDPOINT:2101,MISSING_BODY_HEADER:2102,MISSING_BODY_BODY:2103,MISSING_BODY_PARAMS:2104,MISSING_BODY_REMOVE_PARTICIPANTS_REQUEST:2105,MISSING_BODY_DATA_MESSAGE_REQUEST:2106,MISSING_BODY_CLIENT_MEDIA_UPDATE_REQUEST:2107,MISSING_BODY_ADD_PARTICIPANTS_REQUEST:2108,MISSING_BODY_SUBSCRIPTION_REQUEST:2110,MISSING_BODY_JOIN_REQUEST:2111,MISSING_BODY_HANGUP_REQUEST:2112,MISSING_BODY_ICE_CANDIDATE_REQUEST:2113,MISSING_BODY_P2P_MESSAGE_REQUEST:2114,MISSING_BODY_UPDATE_REQUEST:2115,MISSING_BODY_CLIENT_EVENT_REQUEST:2116,MISSING_BODY_CONNECT_REQUEST:2117,MISSING_BODY_UNSUBSCRIBE_REQUEST:2118,MISSING_BODY_APPROVAL_REQUEST:2119,MISSING_ENDPOINT_USER_ID:2120,EMPTY_ENDPOINT_USER_ID:2121,MISSING_BODY_TRANSFER_REQUEST:2122,MISSING_BODY_GENERIC:2199,REQUESTOR_NOT_MEMBER_CONFERENCE:3002,NOT_BROADCAST_OWNER:3003,GUEST_NOT_INVITED:3004,GUEST_DISCONNECTED:3005,GUEST_INVITATION_EXPIRED:3006,PARTICIPANT_IN_PENDING_APPROVAL_STATE:3008,INVALID_MULTIWAY_PARAMS:3009,BROADCAST_ALREADY_STOPPED:4002,FAILED_TO_GENERATE_SDP_ANSWER:4003,FAILED_GENERATE_SESSION_DESCRIPTION:4004,SDP_SESSION_ID_MISMATCH:4005,MEDIA_ENDPOINT_GONE:4007,MEDIA_ENDPOINT_ALREADY_EXISTS:4008,MEDIA_ENDPOINT_EXISTS_DIFFERENT_SESSION_ID:4009,LEGACY_MESSENGER_SENDER_UNSET:4010,FAILED_TO_SET_TRANSPORT_INFO:4011,NON_PRIMARY_MULTIWAY_SERVER:4012,FAILED_TO_GET_REMOTE_DESCRIPTION:4013,LOCAL_DESCRIPTION_NOT_SET:4014,INVALID_SDP_TYPE:4015,CLIENT_MEDIA_UPDATE_WITHOUT_REMOTE_SDP_INFO:4016,SDP_UNSET_ON_P2P_ANSWER:4017,MISSING_ICE_CANDIDATE_PAYLOAD:4018,P2P_PROTOCOL_UNSET:4019,CREATE_ACK_FOR_INVALID_MESSAGE_TYPE:4020,LEGACY_CLIENT_CANNOT_JOIN_SFU_MODE:4021,CONNECT_UNSUPPORTED_IN_SFU_MODE:4022,CONNECT_UNSUPPORTED_FOR_JOINED_ENDPOINTS:4023,RESOLVE_STATE_API_ERROR:4024,EXTERNAL_RESOLUTION_ERROR:4025,INTERNAL_RESOLUTION_ERROR:4026,RESOLUTION_DISABLED:4027,BROADCAST_ID_MISSING:4028,SDP_UNSET_ON_P2P_OFFER:4029,LEGACY_OFFER_MISSING_REQUIRED_VALUE:4031,MEDIA_SERVER_STATE_SYNC_DESERIALIZATION_ERROR:4032,CONNECT_UNSUPPORTED_FOR_PRECONNECTED_USERS:4033,OTHER_USER_ANSWERED_THE_CALL:4034,MEDIA_SERVER_DESERIALIZATION_ERROR:4035,REMOTE_SDP_TRACKID_MISMATCH:4036,SIGNALING_MESSAGE_TO_CLIENT_DROPPED:4037,DATA_CHANNEL_ENDPOINT_GONE:4038,DATA_CHANNEL_ENDPOINT_ALREADY_EXISTS:4039,CONNECT_UNSUPPORTED_DURING_P2P_TO_SFU_ESCALATION:4040,P2P_CONNECT_UNSUPPORTED_AFTER_SFU_ESCALATION:4041,CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_CONFERENCE:4042,CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_USER:4043,REQUEST_TIMEOUT:4044,TOO_MANY_MEDIA_TRACKS_IN_SDP:4045,CONFERENCE_NOT_FOUND:5001,CONFERENCE_IS_TERMINATING:5002,CONFERENCE_IS_TERMINATED:5003,CONFERENCE_NAME_EMPTY:5004,NONCE_EMPTY:5005,NONCE_MISMATCH:5006,CONFERENCE_HAS_GONE:5007,PARTICIPANT_HAS_GONE:5008,MEDIA_SERVER_NOT_FOUND:5009,CLIENT_TERMINATED:5010,JOIN_SESSION_RESULT_MISSING:5012,LOGGING_POLICY_RESULT_MISSING:5013,INVITE_USERS_RESULT_MISSING:5014,STATE_SYNC_RESULT_MISSING:5015,ENDPOINT_INFO_RESULT_MISSING:5016,CONFERENCE_NAME_MISMATCH:5017,UNEXPECTED_TRANSPORT_PARAMS_CONFERENCE_NAME:5018,SESSION_CONFIGURATION_RESULT_MISSING:5019,REMOVE_USERS_RESULT_MISSING:5020,MEDIA_CODECS_UNSUPPORTED_BY_CONFERENCE:6001,CONFERENCE_INCAPABLE_RENEGOTIATION:6002,REJECTING_CMU_WHEN_SMU_PENDING:6003,PARTICIPANT_NOT_SUBSCRIBED_TO_TOPIC:6004,PARTICIPANT_ALREADY_IN_WAITING_ROOM:6005,PARTICIPANT_NOT_IN_PENDING_APPROVAL:6006,USER_NOT_APPROVER_FOR_TARGET_USER:6007,UNSUPPORTED_CAPABILITIES:6008,PRODUCT_SERVER_DEFINED_END_REASON:6009,WWW_KILLSWITCHED_REQUEST:6010,CONFLICTING_MEDIA_PATH:6011,CONFLICTING_MEDIA_STATUS:6012,CONFLICTING_SESSION_DESCRIPTION:6013,OK:9e3}),c=e({NONE:0,INFO:1,ERROR:2}),d=e({SUCCESS:0,ERROR:1,SESSION_NOT_FOUND:10,SESSION_MISMATCH:11,SESSION_TERMINATING:12,CONNECTION_ALREADY_EXIST:20,CONNECTION_OLD_EXIST:21,CONNECTION_NOT_FOUND:23,CONNECTION_MISMATCH:24,SDP_INVALID:30,SDP_NEGOTIATION_FAILED:31,EXCEEDED_MAX_PARTICIPANT_COUNT:40,UNAUTHORIZED:50}),m=e({JOIN:0,SERVER_MEDIA_UPDATE:1,HANGUP:2,ICE_CANDIDATE:3,RING:4,DISMISS:5,CONFERENCE_STATE:6,ADD_PARTICIPANTS:7,SUBSCRIPTION:8,CLIENT_MEDIA_UPDATE:9,DATA_MESSAGE:10,REMOVE_PARTICIPANTS:11,PING:18,UPDATE:20,NOTIFY:21,CONNECT:22,CLIENT_EVENT:23,UNSUBSCRIBE:25,APPROVAL:26,TRANSFER:27,WAKEUP:28}),p=e({IGNORE_CALL:0,HANGUP_CALL:1,NO_ANSWER_TIMEOUT:2,CLIENT_ERROR:3,IN_ANOTHER_CALL:4,CLIENT_INTERRUPTED:5,SESSION_MIGRATED:6,E2EE_MANDATED_BUT_OFFER_DID_NOT_CONTAIN_E2EE:7,E2EE_MANDATED_BUT_ANSWER_DID_NOT_NEGOTIATE_E2EE:8,WEBRTC_ERROR:9,CONNECTION_DROPPED:10}),_=e({CALL_ENDED:0,ANSWERED_ON_ANOTHER_DEVICE:1,IN_ANOTHER_CALL:2,CONNECTION_DROPPED:3,REJECTED_ON_ANOTHER_DEVICE:4,REMOVED_BY_PARTICIPANT:5,REJECTED_BY_CALLEE:6,INTERNAL_ERROR:7,CALL_ENDED_BY_PRODUCT:9,JOIN_APPROVAL_DENIED:10,JOIN_APPROVAL_TIMEDOUT:11,UNSUPPORTED_VERSION:12,LIVE_NOT_ACKED:13,TX_ACK_TIMEDOUT:14,ANSWERED_BY_OTHER_USER:15,PARTICIPANT_SELF_TERMINATION:16,PARTICIPANT_REJOIN:17,LONG_LASTING_AUDIO_ISSUE:18,PRIMARY_ENDPOINT_HANGUP:19,RECONNECT_FAILED:20,E2EE_HARDENING_ERROR:21,CALL_ENDED_BY_EXTENSION:22,CALL_ENDED_BY_OVER_CAPACITY:23}),f=e({SUPPORT_AUDIO_DEPRECATED:0,SUPPORT_VIDEO_DEPRECATED:1,SUPPORT_EXPERIMENTS_IN_JOIN_RESPONSE:2,SUPPORT_NEW_PARTICIPANT_STATES:3,SUPPORT_SDP_RENEGOTIATION:4,SUPPORT_MWPP:5,REQUIRE_FULL_SDP_IN_SMU:6,SUPPORT_PRECONNECT:7,SUPPORT_MWPP_DEESCALATION:8,SUPPORT_PARTICIPANT_STATE_UNCALLABLE:9,SUPPORT_MULTIPLE_VIDEO_STREAMS:10,REQUIRE_FULL_SDP_IN_SMU_OPTIMIZED:11,SUPPORT_MULTISTREAM_FEC:12,SUPPORT_DELTA_SMU:13,REQUIRE_DEFAULT_CHANNEL_SCREENSHARE:14,SUPPORT_SCREENSHARE_FLAG_IN_JOIN_RESPONSE_AND_SMU:15,SUPPORT_TEMPORAL_LAYER_JBE:16,REQUIRES_P2P_RELAY_INFO_VIA_SIGNALING:17,SUPPORT_NUMERIC_TOPICS:18,SUPPORT_PSEUDO_QUIC_CONNECTION:19,SUPPORT_SDP_SENDRECV:20}),g=e({GROUP_AUDIO_CALL:0,PEER_VIDEO_CALL:1,PEER_AUDIO_CALL:2,GROUP_VIDEO_CALL:3,LIVE_STREAM:4,PEER_ESCALATED_VIDEO_CALL:5,PEER_ESCALATED_AUDIO_CALL:6,LIVE_AUDIO_ROOM:7,LIVE_WITH_ROOM:8}),h=e({OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10}),y=e({ACTIVE:0,TERMINATED:1}),C=e({UNKNOWN:0,ACTIVE:1,TERMINATED:2}),b=e({DENIED:0,APPROVED:1}),v=e({UNKNOWN:0,SIGNALING_DATA_MESSAGE:1,STATE_SYNC_UPDATE:2,STATE_SYNC_SNAPSHOT:3}),S=e({UNKNOWN:0,DISCONNECTED:1,NO_ANSWER:2,REJECTED:3,UNREACHABLE:4,CONNECTION_DROPPED:5,CONTACTING:6,RINGING:7,CONNECTING:8,CONNECTED:9,PARTICIPANT_LIMIT_REACHED:10,IN_ANOTHER_CALL:11,RING_TYPE_UNSUPPORTED:12,PENDING_APPROVAL:13,APPROVED:14,FAILED_APPROVAL:15,HANGUP_IN_WAITING_ROOM:16,UNCALLABLE:17,UNCALLABLE_DELAYED:18}),R=e({PRANSWER:1001,INITIAL_ANSWER_TO_P2P_CALLER:1002,DEESCALATE_OFFER_TO_P2P_CALLEE:1003,DEESCALATE_ANSWER_TO_P2P_CALLER:1004,REQUEST_DEESCALATE_TO_P2P_CALLER:1005,REQUEST_ESCALATE:1006,REQUEST_CLIENT_FULL_RENEGOTIATION_TO_ADMIT_FROM_WAITINGROOM:1007,REQUEST_CLIENT_FULL_RENEGOTIATION_AGAINST_MWS:1008,PARTICIPANT_ADDED:1009,PARTICIPANT_REMOVED:1010,FIRST_REMOTE_ALERTED_FOR_INITIATOR:2001,FIRST_REMOTE_ANSWERED_FOR_INITIATOR:2002,CONTAIN_PENDING_APPROVAL_PARTICIPANTS:2003,KEEP_ALIVE_PING:3001,IS_INITIATOR:4001,PREGEN_SDP:4002}),L=e({PRIMARY:0,SECONDARY:1}),E=e({UNKNOWN:0,MEDIA_CONNECTED:1}),k=e({JoinRequest:"joinRequest",JoinResponse:"joinResponse",ServerMediaUpdateRequest:"serverMediaUpdateRequest",ServerMediaUpdateResponse:"serverMediaUpdateResponse",HangupRequest:"hangupRequest",IceCandidateRequest:"iceCandidateRequest",RingRequest:"ringRequest",RingResponse:"ringResponse",DismissRequest:"dismissRequest",ConferenceStateRequest:"conferenceStateRequest",ConferenceStateResponse:"conferenceStateResponse",AddParticipantsRequest:"addParticipantsRequest",SubscriptionRequest:"subscriptionRequest",ClientMediaUpdateRequest:"clientMediaUpdateRequest",ClientMediaUpdateResponse:"clientMediaUpdateResponse",DataMessageRequest:"dataMessageRequest",RemoveParticipantsRequest:"removeParticipantsRequest",DataMessageResponse:"dataMessageResponse",UpdateRequest:"updateRequest",UpdateResponse:"updateResponse",NotifyRequest:"notifyRequest",NotifyResponse:"notifyResponse",ConnectRequest:"connectRequest",ConnectResponse:"connectResponse",ClientEventRequest:"clientEventRequest",ClientEventResponse:"clientEventResponse",UnsubscribeRequest:"unsubscribeRequest",UnsubscribeResponse:"unsubscribeResponse",ApprovalRequest:"approvalRequest",TransferRequest:"transferRequest"});a.exports={ApprovalStatus:b,Capability:f,ClientEventType:E,DeviceStatus:h,DismissReason:_,E2eeDataMessageType:v,ExtensionSessionStatus:C,HangupReason:p,JoinMode:L,MediaConnectionStatus:y,MessageTag:R,MessageType:m,ParticipantCallState:S,RingType:g,RtcApiStatusCode:d,RtcLogSeverity:c,RtcMessageBodyVariant$Types:k,RtcResponseStatusCode:s,RtcResponseSubCode:u,SdpPayloadType:l}}),null);
__d("StateSyncSerializers",["ThriftTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{version:0}}function u(){return{stateStore:{}}}function c(t,n){if(n.writeStructBegin("State"),n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.version!=null)n.writeI32(t.version);else{var o=0;n.writeI32(o)}n.writeFieldEnd(),t.data!=null&&(n.writeFieldBegin({fname:"data",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.data),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function d(t,n){if(n.writeStructBegin("Snapshot"),n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.stateStore!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var o of Object.entries(t.stateStore)){var a=o[0],i=o[1];n.writeString(a),c(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],d=s[1];n.writeString(u),c(d,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function m(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.data=t.readBinary():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.version===void 0&&(n.version=0),n}function p(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readString(),c=m(t);n.stateStore[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.stateStore===void 0&&(n.stateStore={}),n}l.State$DefaultConstructor=s,l.Snapshot$DefaultConstructor=u,l.serializeState=c,l.serializeSnapshot=d,l.deserializeState=m,l.deserializeSnapshot=p}),98);
__d("StateSyncTopicsConfigTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({UNKNOWN:0,INTERNAL:1,EXTERNAL:2}),s=e({UNKNOWN:0,PARTICIPANT_JOIN:100,PARTICIPANT_UPDATE:101,PARTICIPANT_LEAVE:102,PARTICIPANT_NEGOTIATED:103,PARTICIPANT_SDP_CHANGED:104,EXTENSION_CREATION:201,EXTENSION_JOIN:202,EXTENSION_UPDATE:203,EXTENSION_LEAVE:204,EXTENSION_REQUEST:205,CONFERENCE_UPDATE:501,DOMINANT_SPEAKER_UPDATE:1001,MEDIA_ASPECT_RATIO_UPDATE:1002,TIMER_FIRED:1003,MEDIA_PATH_CHANGED:1004,PARTICIPANTS_ACKED_MEDIA:1005}),u=e({UNKNOWN:0,ANY_PARTICIPANT_SUBSCRIBED:1,ALWAYS_RESOLVE:2}),c=e({CACHIUS:1,IRIS:2}),d=e({Config_engine:1,E2eeState:2,Media_information:3,Breakout:4,Countdown_timer:5,Effect_match:6,Emoji_reactions:7,Entered_avatars_mode:8,Moderator_controls:9,Polls:10,Raised_hands_queue:11,Xac_calling:12,Action_items:13,Can_you_see_my_screen:14,Collage:15,Companion:16,Coplay:17,Coview:18,Custom_video_capabilities:19,Dropin:20,Dtmf:21,E2ee_v2_msg:22,Effect_sync:23,Et_pluto_activity:24,Et_pluto_session:25,Et_test_activity:26,Et_test_session:27,Et_tubi_activity:28,Et_tubi_session:29,External_resolution_enabled:30,Hyperspace_copresence_state:31,Hyperspace_mic_state:32,Intenticons:33,Live_stream:34,Live_stream_app_message:35,Max_video_subscriptions:36,Media_sync:37,Media_sync_autoplay:38,Meeting_assistant:39,Meeting_transcription:40,Morpheo_grid:41,Multipeer_ar:42,Number_of_people:43,Opaque_blob:44,Photo_booth:45,Qna:46,Quizzes:47,Reactions:48,Role_assignments:49,Room_features_availability:50,Rooms_notes:51,Screenshare_floor_control:52,Screenshare_single_floor_control:53,Sctp_negotiation:54,Sideband:55,Simple:56,Simple_external:57,Simple_pass_through:58,Simple_passthrough:59,Snippets:60,Sound_effects:61,Whiteboard:62,Whiteboard_messenger:63,Workroom:64,Workrooms_ask_everyone_to_open:65,Workrooms_vr:66,Avatar_transport_state:67,Ambisonic:68,Cathode_extension:69,Biz_calling:70,Work_costreaming:71,Conversation_bot:72,Voip_zone:73,Admin_initiated_casting:74,Smart_glasses_assistant:75,Codec_avatar_2d:76,Custom_media_routing:77,Generic_floor_control:78});a.exports={CryptoAuthVerifierIdentity:c,DataSource:s,DataSourceCondition:u,ResolutionPath:l,TopicId:d}}),null);
__d("WebrtcEnumsTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({OFFER:0,ANSWER:1,ICE_CANDIDATE:2,OK:3,HANG_UP:4,OTHER_DISMISS:5,PRANSWER:7,PING:8,PING_ACK:9,ICE_RESTART_OFFER:10,ICE_RESTART_ANSWER:11,OFFER_ACK:12,ANSWER_ACK:13,NOTIFY_MEDIA_STATE:14,ACK:15,INVALID:16,OFFER_NACK:17,NACK:18,VIDEO_REQUEST:19,SDP_UPDATE:20,SWITCH_TO_MULTIWAY:28,NEGOTIATE:30,PR_OFFER_ACK:32,CLIENT_REPORTED_EVENT:33}),s=e({OFFER:0,ANSWER:1}),u=e({LL_NIL:0,LL_BASIC:1,LL_DEBUG:2,LL_WARNING:3,LL_INFO:4,LL_VERBOSE:5}),c=e({IGNORE_CALL:0,HANGUP_CALL:1,IN_ANOTHER_CALL:2,ACCEPT_AFTER_HANGUP:3,NO_ANSWER_TIMEOUT:4,INCOMING_TIMEOUT:5,OTHER_INSTANCE_HANDLED:6,SIGNALING_MESSAGE_FAILED:7,CONNECTION_DROPPED:8,CLIENT_INTERRUPTED:9,WEBRTC_ERROR:10,CLIENT_ERROR:11,NO_PERMISSION:12,OTHER_NOT_CAPABLE:13,NO_UI_ERROR:14,UNSUPPORTED_VERSION:15,CALLER_NOT_VISIBLE:16,CARRIER_BLOCKED:17,OTHER_CARRIER_BLOCKED:18,CLIENT_ENCRYPTION_ERROR:19,MICROPHONE_PERMISSION_DENIED:20,CAMERA_PERMISSION_DENIED:21,SESSION_MIGRATED:22,RING_MUTED:23,MAX_ALLOWED_PARTICIPANTS_REACHED:24,CALLEE_REQUIRES_MULTIWAY:25,LIVE_NOT_ACKED:26,TX_ACK_TIMEDOUT:27,E2EE_MANDATED_BUT_OFFER_DID_NOT_CONTAIN_E2EE:28,E2EE_MANDATED_BUT_ANSWER_DID_NOT_NEGOTIATE_E2EE:29,ANSWERED_BY_OTHER_USER:30,LONG_LASTING_AUDIO_ISSUE:31,ADMIN_CALLING_OWN_PAGE:32,PAGE_CALLS_BLOCKED:33}),d=e({UDP:0,TCP:1,SSLTCP:2}),m=e({HOST:0,SERVER_REFLEXIVE:1,PEER_REFLEXIVE:2,RELAY:3}),p=e({TCPTYPE_NONE:0,TCPTYPE_PASSIVE:1,TCPTYPE_ACTIVE:2,TCPTYPE_SIMOPEN:3}),_=e({SENDONLY:0,SENDRECV:1,RECVONLY:2,INACTIVE:3}),f=e({AUDIO:0,VIDEO:1,DATA:2}),g=e({AUDIO:0,VIDEO:1,SCREEN:2}),h=e({AES_CM_128_HMAC_SHA1_80:0,AES_CM_128_HMAC_SHA1_32:1,F8_128_HMAC_SHA1_80:2,AEAD_AES_256_GCM:8}),y=e({RTP_SAVPF:0,DTLS_SCTP:1,SCTP:2}),C=e({URN_IETF_PARAMS_RTP_HDREXT_SSRC_AUDIO_LEVEL:0,URN_IETF_PARAMS_RTP_HDREXT_TOFFSET:1,IETF_DRAFT_HOLMER_RMCAT_TRANSPORT_WIDE_CC_01:2,URN_3GPP_VIDEO_ORIENTATION:3,ABS_SEND_TIME:4,PLAYOUT_DELAY:5,VIDEO_CONTENT_TYPE:6,VIDEO_TIMING:7,RTP_MID:8,RTP_STREAM_ID:9,RTP_REPAIRED_STREAM_ID:10,ENCRYPT_EXTENSIONS:11,FRAME_MARKING:12,GENERIC_FRAME_DESCRIPTOR:13,RTP_LOSS_INFO:14,RTP_CONGESTION_INFO:15,RTP_AUDIO_DROP_INFO:16,FRAME_ENCRYPTION_INFO:17,GENERIC_FRAME_DESCRIPTOR_01:18,DEPENDENCY_DESCRIPTOR:19,COLOR_SPACE:20,ABS_CAPTURE_TIME:21,VIDEO_FRAME_TRACKING_ID:22,VIDEO_FRAME_INFO:23}),b=e({ISAC:0,SPEEX_ISAC_OBSOLETE:1,SPEEX:2,OPUS:3,PCMU_OBSOLETE:4,PCMA_OBSOLETE:5,CN:6,TELEPHONE_EVENT:7,VP8:8,RED:9,ULPFEC:10,H264:17,ISPX_WB_2:32,GOOGLE_DATA:33,AAC:36,AAC_LD:37,VP9:96,GOOGLE_SCTP_DATA:97,H265:98,RTX:99,FLEXFEC:100,MULTIPLEX:101,VIDEO_DATA:102,AV1:103,MLOW:104,MLOW_RED:105,RSFEC:106}),v=e({SILENCEBIT_OBSOLETE:0,SPEEXUSEJITTERBIT_OBSOLETE:1,USEINBANDFEC:2,USEADAPTIVEFEC_OBSOLETE:3,EXTERNALBWE_OBSOLETE:4,FEC_BEI_OBSOLETE:5,ISPX_ADAPTIVE_FEC:6,CBR:7,USEDTX:8}),S=e({MINPTIME:0,MAXAVERAGEBITRATE:1,SPROP_STEREO:2,STEREO:3,MAXPTIME:4,PTIME:5,FEC_BEI_OBSOLETE:6,PORT:7,H264PROFILELEVELID:8,PACKETIZATION_MODE:9,LEVEL_ASYMMETRY_ALLOWED:10,APT:11,MAXPLAYBACKRATE:12,REPAIR_WINDOW:13,EMPTY_KEY:14}),R=e({CR_NONE:0,CR_ACTIVE:1,CR_PASSIVE:2,CR_ACTPASS:3,CR_HOLDCONN:4}),L=e({EVENT_NONE:0,EVENT_MEDIA_CONNECTED:1});a.exports={CallEndReason:c,ClientReportedEventType:L,CodecName:b,CodecOption:S,CodecOptionBoolean:v,ConnectionRole:R,CryptoSuite:h,ExtmapUris:C,IceCandidateProtocolType:m,IceCandidateTcpType:p,IceCandidateTransport:d,MediaProtocol:y,MediaType:f,PayloadType:l,SdpNegotiateType:s,SendRecvMode:_,StreamType:g,UploadLogLevel:u}}),null);
__d("WebrtcSdpSerializers",["ThriftTypes","WebrtcEnumsTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{}}function u(){return{msid:"stream_label"}}function c(){return{id:""}}function d(){return{bwtype:"",bw:0}}function m(){return{numAudioChannels:1}}function p(){return{id:1,extensionAttributes:[]}}function _(){return{}}function f(){return{componentId:1,transport:o("WebrtcEnumsTypes").IceCandidateTransport.cast(0),generation:0}}function g(){return{port:1,protocol:o("WebrtcEnumsTypes").MediaProtocol.cast(0),sendRecvMode:o("WebrtcEnumsTypes").SendRecvMode.cast(1),hasRtcpMux:!0}}function h(){return{supportsMsid:!0}}function y(){return{}}function C(t,n){if(n.writeStructBegin("SsrcGroup"),t.semantics!=null&&(n.writeFieldBegin({fname:"semantics",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.semantics),n.writeFieldEnd()),t.ssrcIds!=null){n.writeFieldBegin({fname:"ssrcIds",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.I32,size:t.ssrcIds.length});for(var o of t.ssrcIds)n.writeI32(o);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function b(t,n){if(n.writeStructBegin("SsrcObject"),t.ssrcId!=null&&(n.writeFieldBegin({fname:"ssrcId",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32(t.ssrcId),n.writeFieldEnd()),t.cname!=null&&(n.writeFieldBegin({fname:"cname",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.cname),n.writeFieldEnd()),n.writeFieldBegin({fname:"msid",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),t.msid!=null)n.writeString(t.msid);else{var o="stream_label";n.writeString(o)}n.writeFieldEnd(),t.msidAppData!=null&&(n.writeFieldBegin({fname:"msidAppData",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.msidAppData),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function v(t,n){if(n.writeStructBegin("RtcpFbVal"),n.writeFieldBegin({fname:"id",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.id!=null)n.writeString(t.id);else{var o="";n.writeString(o)}n.writeFieldEnd(),t.param!=null&&(n.writeFieldBegin({fname:"param",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.param),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function S(t,n){if(n.writeStructBegin("Bandwidth"),n.writeFieldBegin({fname:"bwtype",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.bwtype!=null)n.writeString(t.bwtype);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"bw",ftype:e.I32,fid:2}),t.bw!=null)n.writeI32(t.bw);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function R(t,n){if(n.writeStructBegin("CodecDescription"),t.payloadType!=null&&(n.writeFieldBegin({fname:"payloadType",ftype:(e||(e=r("ThriftTypes"))).BYTE,fid:1}),n.writeByte(t.payloadType),n.writeFieldEnd()),t.encodingName!=null){var o;n.writeFieldBegin({fname:"encodingName",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32((o=t.encodingName)!=null?o:0),n.writeFieldEnd()}if(t.clockRateKhz!=null&&(n.writeFieldBegin({fname:"clockRateKhz",ftype:(e||(e=r("ThriftTypes"))).BYTE,fid:3}),n.writeByte(t.clockRateKhz),n.writeFieldEnd()),n.writeFieldBegin({fname:"numAudioChannels",ftype:(e||(e=r("ThriftTypes"))).BYTE,fid:4}),t.numAudioChannels!=null)n.writeByte(t.numAudioChannels);else{var a=1;n.writeByte(a)}if(n.writeFieldEnd(),t.fmtParameters!=null){n.writeFieldBegin({fname:"fmtParameters",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:5}),n.writeMapBegin({ktype:e.I32,vtype:e.STRING,size:Object.keys(t.fmtParameters).length});for(var i of Object.entries(t.fmtParameters)){var l,s=i[0],u=i[1];n.writeI32((l=Number(s))!=null?l:0),n.writeString(u)}n.writeMapEnd(),n.writeFieldEnd()}if(t.enabledOptions!=null){n.writeFieldBegin({fname:"enabledOptions",ftype:(e||(e=r("ThriftTypes"))).SET,fid:6}),n.writeSetBegin({etype:e.I32,size:t.enabledOptions.size});for(var c of t.enabledOptions)n.writeI32(c!=null?c:0);n.writeSetEnd(),n.writeFieldEnd()}if(t.rtcpFbParameters!=null){n.writeFieldBegin({fname:"rtcpFbParameters",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:7}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRING,size:Object.keys(t.rtcpFbParameters).length});for(var d of Object.entries(t.rtcpFbParameters)){var m=d[0],p=d[1];n.writeString(m),n.writeString(p)}n.writeMapEnd(),n.writeFieldEnd()}if(t.rtcpFbParamList!=null){n.writeFieldBegin({fname:"rtcpFbParamList",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:10}),n.writeListBegin({etype:e.STRUCT,size:t.rtcpFbParamList.length});for(var _ of t.rtcpFbParamList)v(_,n);n.writeListEnd(),n.writeFieldEnd()}t.videoWidth!=null&&(n.writeFieldBegin({fname:"videoWidth",ftype:(e||(e=r("ThriftTypes"))).I32,fid:8}),n.writeI32(t.videoWidth),n.writeFieldEnd()),t.videoHeight!=null&&(n.writeFieldBegin({fname:"videoHeight",ftype:(e||(e=r("ThriftTypes"))).I32,fid:9}),n.writeI32(t.videoHeight),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function L(t,n){if(n.writeStructBegin("Extmap"),n.writeFieldBegin({fname:"id",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.id!=null)n.writeI32(t.id);else{var o=1;n.writeI32(o)}if(n.writeFieldEnd(),t.uri!=null){var a;n.writeFieldBegin({fname:"uri",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32((a=t.uri)!=null?a:0),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"extensionAttributes",ftype:e.LIST,fid:3}),t.extensionAttributes!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:t.extensionAttributes.length});for(var i of t.extensionAttributes)n.writeI32(i!=null?i:0);n.writeListEnd()}else{var l=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:l.length});for(var s of l)n.writeI32(s!=null?s:0);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function E(t,n){if(n.writeStructBegin("CryptoParam"),t.tag!=null&&(n.writeFieldBegin({fname:"tag",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32(t.tag),n.writeFieldEnd()),t.suite!=null){var o;n.writeFieldBegin({fname:"suite",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32((o=t.suite)!=null?o:0),n.writeFieldEnd()}t.keyParams!=null&&(n.writeFieldBegin({fname:"keyParams",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeString(t.keyParams),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function k(t,n){if(n.writeStructBegin("IceCandidateSdp"),t.foundation!=null&&(n.writeFieldBegin({fname:"foundation",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.foundation),n.writeFieldEnd()),n.writeFieldBegin({fname:"componentId",ftype:(e||(e=r("ThriftTypes"))).BYTE,fid:2}),t.componentId!=null)n.writeByte(t.componentId);else{var a=1;n.writeByte(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"transport",ftype:e.I32,fid:3}),t.transport!=null){var i;n.writeI32((i=t.transport)!=null?i:0)}else{var l=o("WebrtcEnumsTypes").IceCandidateTransport.cast(0);n.writeI32(l!=null?l:0)}if(n.writeFieldEnd(),t.priority!=null&&(n.writeFieldBegin({fname:"priority",ftype:(e||(e=r("ThriftTypes"))).I32,fid:4}),n.writeI32(t.priority),n.writeFieldEnd()),t.address!=null&&(n.writeFieldBegin({fname:"address",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.address),n.writeFieldEnd()),t.port!=null&&(n.writeFieldBegin({fname:"port",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32(t.port),n.writeFieldEnd()),t.protocolType!=null){var s;n.writeFieldBegin({fname:"protocolType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:7}),n.writeI32((s=t.protocolType)!=null?s:0),n.writeFieldEnd()}if(t.relatedAddress!=null&&(n.writeFieldBegin({fname:"relatedAddress",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:8}),n.writeString(t.relatedAddress),n.writeFieldEnd()),t.relatedPort!=null&&(n.writeFieldBegin({fname:"relatedPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:9}),n.writeI32(t.relatedPort),n.writeFieldEnd()),t.username!=null&&(n.writeFieldBegin({fname:"username",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.username),n.writeFieldEnd()),t.password!=null&&(n.writeFieldBegin({fname:"password",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:11}),n.writeString(t.password),n.writeFieldEnd()),n.writeFieldBegin({fname:"generation",ftype:e.I32,fid:12}),t.generation!=null)n.writeI32(t.generation);else{var u=0;n.writeI32(u)}if(n.writeFieldEnd(),t.tcptype!=null){var c;n.writeFieldBegin({fname:"tcptype",ftype:(e||(e=r("ThriftTypes"))).I32,fid:13}),n.writeI32((c=t.tcptype)!=null?c:0),n.writeFieldEnd()}t.networkId!=null&&(n.writeFieldBegin({fname:"networkId",ftype:(e||(e=r("ThriftTypes"))).I16,fid:14}),n.writeI16(t.networkId),n.writeFieldEnd()),t.networkCost!=null&&(n.writeFieldBegin({fname:"networkCost",ftype:(e||(e=r("ThriftTypes"))).I16,fid:15}),n.writeI16(t.networkCost),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function I(t,n){if(n.writeStructBegin("MediaDescription"),t.mediaType!=null){var a;n.writeFieldBegin({fname:"mediaType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32((a=t.mediaType)!=null?a:0),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"port",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),t.port!=null)n.writeI32(t.port);else{var i=1;n.writeI32(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"protocol",ftype:e.I32,fid:3}),t.protocol!=null){var l;n.writeI32((l=t.protocol)!=null?l:0)}else{var s=o("WebrtcEnumsTypes").MediaProtocol.cast(0);n.writeI32(s!=null?s:0)}if(n.writeFieldEnd(),t.fmt!=null&&(n.writeFieldBegin({fname:"fmt",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:22}),n.writeString(t.fmt),n.writeFieldEnd()),t.mediaIceUserFrag!=null&&(n.writeFieldBegin({fname:"mediaIceUserFrag",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.mediaIceUserFrag),n.writeFieldEnd()),t.mediaIcePassword!=null&&(n.writeFieldBegin({fname:"mediaIcePassword",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.mediaIcePassword),n.writeFieldEnd()),t.mediaIceOptions!=null){n.writeFieldBegin({fname:"mediaIceOptions",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:6}),n.writeListBegin({etype:e.STRING,size:t.mediaIceOptions.length});for(var u of t.mediaIceOptions)n.writeString(u);n.writeListEnd(),n.writeFieldEnd()}if(t.mediaSslFingerprintHash!=null&&(n.writeFieldBegin({fname:"mediaSslFingerprintHash",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeString(t.mediaSslFingerprintHash),n.writeFieldEnd()),t.mediaSslFingerprintDigest!=null&&(n.writeFieldBegin({fname:"mediaSslFingerprintDigest",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:8}),n.writeString(t.mediaSslFingerprintDigest),n.writeFieldEnd()),t.extmaps!=null){n.writeFieldBegin({fname:"extmaps",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:9}),n.writeListBegin({etype:e.STRUCT,size:t.extmaps.length});for(var c of t.extmaps)L(c,n);n.writeListEnd(),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"sendRecvMode",ftype:e.I32,fid:10}),t.sendRecvMode!=null){var d;n.writeI32((d=t.sendRecvMode)!=null?d:0)}else{var m=o("WebrtcEnumsTypes").SendRecvMode.cast(1);n.writeI32(m!=null?m:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"hasRtcpMux",ftype:e.BOOL,fid:11}),t.hasRtcpMux!=null)n.writeBool(t.hasRtcpMux);else{var p=!0;n.writeBool(p)}if(n.writeFieldEnd(),t.rtcpReducedSize!=null&&(n.writeFieldBegin({fname:"rtcpReducedSize",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:25}),n.writeBool(t.rtcpReducedSize),n.writeFieldEnd()),t.cryptoParams!=null){n.writeFieldBegin({fname:"cryptoParams",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:12}),n.writeListBegin({etype:e.STRUCT,size:t.cryptoParams.length});for(var _ of t.cryptoParams)E(_,n);n.writeListEnd(),n.writeFieldEnd()}if(t.codecs!=null){n.writeFieldBegin({fname:"codecs",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:13}),n.writeListBegin({etype:e.STRUCT,size:t.codecs.length});for(var f of t.codecs)R(f,n);n.writeListEnd(),n.writeFieldEnd()}if(t.maxPTime!=null&&(n.writeFieldBegin({fname:"maxPTime",ftype:(e||(e=r("ThriftTypes"))).I32,fid:14}),n.writeI32(t.maxPTime),n.writeFieldEnd()),t.pTime!=null&&(n.writeFieldBegin({fname:"pTime",ftype:(e||(e=r("ThriftTypes"))).I32,fid:15}),n.writeI32(t.pTime),n.writeFieldEnd()),t.ssrcObjects!=null){n.writeFieldBegin({fname:"ssrcObjects",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:16}),n.writeListBegin({etype:e.STRUCT,size:t.ssrcObjects.length});for(var g of t.ssrcObjects)b(g,n);n.writeListEnd(),n.writeFieldEnd()}if(t.candidates!=null){n.writeFieldBegin({fname:"candidates",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:17}),n.writeListBegin({etype:e.STRUCT,size:t.candidates.length});for(var h of t.candidates)k(h,n);n.writeListEnd(),n.writeFieldEnd()}if(t.conferenceMode!=null&&(n.writeFieldBegin({fname:"conferenceMode",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:18}),n.writeBool(t.conferenceMode),n.writeFieldEnd()),t.ssrcGroups!=null){n.writeFieldBegin({fname:"ssrcGroups",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:19}),n.writeListBegin({etype:e.STRUCT,size:t.ssrcGroups.length});for(var y of t.ssrcGroups)C(y,n);n.writeListEnd(),n.writeFieldEnd()}if(t.connectionRole!=null){var v;n.writeFieldBegin({fname:"connectionRole",ftype:(e||(e=r("ThriftTypes"))).I32,fid:20}),n.writeI32((v=t.connectionRole)!=null?v:0),n.writeFieldEnd()}t.mid!=null&&(n.writeFieldBegin({fname:"mid",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:21}),n.writeString(t.mid),n.writeFieldEnd()),t.bandwidth!=null&&(n.writeFieldBegin({fname:"bandwidth",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:23}),S(t.bandwidth,n),n.writeFieldEnd()),t.sctpPort!=null&&(n.writeFieldBegin({fname:"sctpPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:24}),n.writeI32(t.sctpPort),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function T(t,n){if(n.writeStructBegin("SessionDescription"),t.sessionId!=null&&(n.writeFieldBegin({fname:"sessionId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.sessionId),n.writeFieldEnd()),t.sessionVersion!=null&&(n.writeFieldBegin({fname:"sessionVersion",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.sessionVersion),n.writeFieldEnd()),n.writeFieldBegin({fname:"supportsMsid",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:3}),t.supportsMsid!=null)n.writeBool(t.supportsMsid);else{var o=!0;n.writeBool(o)}if(n.writeFieldEnd(),t.useIceLite!=null&&(n.writeFieldBegin({fname:"useIceLite",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:4}),n.writeBool(t.useIceLite),n.writeFieldEnd()),t.features!=null){n.writeFieldBegin({fname:"features",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:5}),n.writeListBegin({etype:e.STRING,size:t.features.length});for(var a of t.features)n.writeString(a);n.writeListEnd(),n.writeFieldEnd()}if(t.connectionRole!=null){var i;n.writeFieldBegin({fname:"connectionRole",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32((i=t.connectionRole)!=null?i:0),n.writeFieldEnd()}if(t.bandwidth!=null&&(n.writeFieldBegin({fname:"bandwidth",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:7}),S(t.bandwidth,n),n.writeFieldEnd()),t.transportBundle!=null){n.writeFieldBegin({fname:"transportBundle",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:8}),n.writeListBegin({etype:e.STRING,size:t.transportBundle.length});for(var l of t.transportBundle)n.writeString(l);n.writeListEnd(),n.writeFieldEnd()}if(t.commonCryptos!=null){n.writeFieldBegin({fname:"commonCryptos",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:9}),n.writeListBegin({etype:e.STRUCT,size:t.commonCryptos.length});for(var s of t.commonCryptos)E(s,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function D(t,n){if(n.writeStructBegin("Sdp"),t.sessionDescription!=null&&(n.writeFieldBegin({fname:"sessionDescription",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),T(t.sessionDescription,n),n.writeFieldEnd()),t.mediaDescriptions!=null){n.writeFieldBegin({fname:"mediaDescriptions",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.STRUCT,size:t.mediaDescriptions.length});for(var o of t.mediaDescriptions)I(o,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function x(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.semantics=t.readString():t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.ssrcIds=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=t.readI32();n.ssrcIds.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function $(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I32?n.ssrcId=t.readI32():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.cname=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.msid=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.msidAppData=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.msid===void 0&&(n.msid="stream_label"),n}function P(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.id=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.param=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.id===void 0&&(n.id=""),n}function N(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.bwtype=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I32?n.bw=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.bwtype===void 0&&(n.bwtype=""),n.bw===void 0&&(n.bw=0),n}function M(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).BYTE?n.payloadType=t.readByte():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.encodingName=o("WebrtcEnumsTypes").CodecName.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).BYTE?n.clockRateKhz=t.readByte():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).BYTE?n.numAudioChannels=t.readByte():t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).MAP){n.fmtParameters={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=o("WebrtcEnumsTypes").CodecOption.cast(t.readI32()),d=t.readString();c!=null&&(n.fmtParameters[c]=d)}}else t.skip(i);break;case 6:if(i===(e||(e=r("ThriftTypes"))).SET){n.enabledOptions=new Set;for(var m=t.readSetBegin(),p=0;p<m.size;p++){var _=o("WebrtcEnumsTypes").CodecOptionBoolean.cast(t.readI32());n.enabledOptions.add(_)}}else t.skip(i);break;case 7:if(i===(e||(e=r("ThriftTypes"))).MAP){n.rtcpFbParameters={};for(var f=t.readMapBegin(),g=0;g<f.size;g++){var h=t.readString(),y=t.readString();n.rtcpFbParameters[h]=y}}else t.skip(i);break;case 10:if(i===(e||(e=r("ThriftTypes"))).LIST){n.rtcpFbParamList=[];for(var C=t.readListBegin(),b=0;b<C.size;b++){var v=P(t);n.rtcpFbParamList.push(v)}}else t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).I32?n.videoWidth=t.readI32():t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).I32?n.videoHeight=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.numAudioChannels===void 0&&(n.numAudioChannels=1),n}function w(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.id=t.readI32():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.uri=o("WebrtcEnumsTypes").ExtmapUris.cast(t.readI32()):t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).LIST){n.extensionAttributes=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=o("WebrtcEnumsTypes").ExtmapUris.cast(t.readI32());n.extensionAttributes.push(c)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.id===void 0&&(n.id=1),n.extensionAttributes===void 0&&(n.extensionAttributes=[]),n}function A(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.tag=t.readI32():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.suite=o("WebrtcEnumsTypes").CryptoSuite.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.keyParams=t.readString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function F(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.foundation=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).BYTE?n.componentId=t.readByte():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.transport=o("WebrtcEnumsTypes").IceCandidateTransport.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.priority=t.readI32():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.address=t.readString():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.port=t.readI32():t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).I32?n.protocolType=o("WebrtcEnumsTypes").IceCandidateProtocolType.cast(t.readI32()):t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).STRING?n.relatedAddress=t.readString():t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).I32?n.relatedPort=t.readI32():t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRING?n.username=t.readString():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).STRING?n.password=t.readString():t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).I32?n.generation=t.readI32():t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).I32?n.tcptype=o("WebrtcEnumsTypes").IceCandidateTcpType.cast(t.readI32()):t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).I16?n.networkId=t.readI16():t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).I16?n.networkCost=t.readI16():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.componentId===void 0&&(n.componentId=1),n.transport===void 0&&(n.transport=o("WebrtcEnumsTypes").IceCandidateTransport.cast(0)),n.generation===void 0&&(n.generation=0),n}function O(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.mediaType=o("WebrtcEnumsTypes").MediaType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.port=t.readI32():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.protocol=o("WebrtcEnumsTypes").MediaProtocol.cast(t.readI32()):t.skip(i);break;case 22:i===(e||(e=r("ThriftTypes"))).STRING?n.fmt=t.readString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.mediaIceUserFrag=t.readString():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.mediaIcePassword=t.readString():t.skip(i);break;case 6:if(i===(e||(e=r("ThriftTypes"))).LIST){n.mediaIceOptions=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=t.readString();n.mediaIceOptions.push(c)}}else t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRING?n.mediaSslFingerprintHash=t.readString():t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).STRING?n.mediaSslFingerprintDigest=t.readString():t.skip(i);break;case 9:if(i===(e||(e=r("ThriftTypes"))).LIST){n.extmaps=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=w(t);n.extmaps.push(p)}}else t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).I32?n.sendRecvMode=o("WebrtcEnumsTypes").SendRecvMode.cast(t.readI32()):t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).BOOL?n.hasRtcpMux=t.readBool():t.skip(i);break;case 25:i===(e||(e=r("ThriftTypes"))).BOOL?n.rtcpReducedSize=t.readBool():t.skip(i);break;case 12:if(i===(e||(e=r("ThriftTypes"))).LIST){n.cryptoParams=[];for(var _=t.readListBegin(),f=0;f<_.size;f++){var g=A(t);n.cryptoParams.push(g)}}else t.skip(i);break;case 13:if(i===(e||(e=r("ThriftTypes"))).LIST){n.codecs=[];for(var h=t.readListBegin(),y=0;y<h.size;y++){var C=M(t);n.codecs.push(C)}}else t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).I32?n.maxPTime=t.readI32():t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).I32?n.pTime=t.readI32():t.skip(i);break;case 16:if(i===(e||(e=r("ThriftTypes"))).LIST){n.ssrcObjects=[];for(var b=t.readListBegin(),v=0;v<b.size;v++){var S=$(t);n.ssrcObjects.push(S)}}else t.skip(i);break;case 17:if(i===(e||(e=r("ThriftTypes"))).LIST){n.candidates=[];for(var R=t.readListBegin(),L=0;L<R.size;L++){var E=F(t);n.candidates.push(E)}}else t.skip(i);break;case 18:i===(e||(e=r("ThriftTypes"))).BOOL?n.conferenceMode=t.readBool():t.skip(i);break;case 19:if(i===(e||(e=r("ThriftTypes"))).LIST){n.ssrcGroups=[];for(var k=t.readListBegin(),I=0;I<k.size;I++){var T=x(t);n.ssrcGroups.push(T)}}else t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).I32?n.connectionRole=o("WebrtcEnumsTypes").ConnectionRole.cast(t.readI32()):t.skip(i);break;case 21:i===(e||(e=r("ThriftTypes"))).STRING?n.mid=t.readString():t.skip(i);break;case 23:i===(e||(e=r("ThriftTypes"))).STRUCT?n.bandwidth=N(t):t.skip(i);break;case 24:i===(e||(e=r("ThriftTypes"))).I32?n.sctpPort=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.port===void 0&&(n.port=1),n.protocol===void 0&&(n.protocol=o("WebrtcEnumsTypes").MediaProtocol.cast(0)),n.sendRecvMode===void 0&&(n.sendRecvMode=o("WebrtcEnumsTypes").SendRecvMode.cast(1)),n.hasRtcpMux===void 0&&(n.hasRtcpMux=!0),n}function B(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.sessionId=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.sessionVersion=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).BOOL?n.supportsMsid=t.readBool():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).BOOL?n.useIceLite=t.readBool():t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).LIST){n.features=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=t.readString();n.features.push(c)}}else t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.connectionRole=o("WebrtcEnumsTypes").ConnectionRole.cast(t.readI32()):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRUCT?n.bandwidth=N(t):t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).LIST){n.transportBundle=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=t.readString();n.transportBundle.push(p)}}else t.skip(i);break;case 9:if(i===(e||(e=r("ThriftTypes"))).LIST){n.commonCryptos=[];for(var _=t.readListBegin(),f=0;f<_.size;f++){var g=A(t);n.commonCryptos.push(g)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.supportsMsid===void 0&&(n.supportsMsid=!0),n}function W(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.sessionDescription=B(t):t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.mediaDescriptions=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=O(t);n.mediaDescriptions.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}l.SsrcGroup$DefaultConstructor=s,l.SsrcObject$DefaultConstructor=u,l.RtcpFbVal$DefaultConstructor=c,l.Bandwidth$DefaultConstructor=d,l.CodecDescription$DefaultConstructor=m,l.Extmap$DefaultConstructor=p,l.CryptoParam$DefaultConstructor=_,l.IceCandidateSdp$DefaultConstructor=f,l.MediaDescription$DefaultConstructor=g,l.SessionDescription$DefaultConstructor=h,l.Sdp$DefaultConstructor=y,l.serializeSsrcGroup=C,l.serializeSsrcObject=b,l.serializeRtcpFbVal=v,l.serializeBandwidth=S,l.serializeCodecDescription=R,l.serializeExtmap=L,l.serializeCryptoParam=E,l.serializeIceCandidateSdp=k,l.serializeMediaDescription=I,l.serializeSessionDescription=T,l.serializeSdp=D,l.deserializeSsrcGroup=x,l.deserializeSsrcObject=$,l.deserializeRtcpFbVal=P,l.deserializeBandwidth=N,l.deserializeCodecDescription=M,l.deserializeExtmap=w,l.deserializeCryptoParam=A,l.deserializeIceCandidateSdp=F,l.deserializeMediaDescription=O,l.deserializeSessionDescription=B,l.deserializeSdp=W}),98);
__d("MultiwayCommonSerializers",["DataMessageSerializers","DataMessageTypes","MultiwayCommonTypes","MultiwaySharedSerializers","MultiwaySharedTypes","StateSyncSerializers","StateSyncTopicsConfigTypes","ThriftTypes","Utf8ToString","WebrtcSdpSerializers","WebrtcSignalingCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var e;return{message:"",responseStatusCode:(e=o("MultiwayCommonTypes")).RtcResponseStatusCode.cast(0),responseSubCode:e.RtcResponseSubCode.cast(0),apiStatusCode:e.RtcApiStatusCode.cast(0),rtcLogSeverity:e.RtcLogSeverity.cast(0)}}function u(){return{}}function c(){return{media:{}}}function d(){return{body:"",msid:"",mid:""}}function m(){return{sourceKey:"",media:[],ssrcGroups:[]}}function p(){return{mediaStatus:{}}}function _(){return{sdpMLineIndex:"0",sdpMid:""}}function f(){return{stateStore:{},stateStoreV2:{}}}function g(){return{version:0}}function h(){return{encryptedTopic:"",encryptedData:Uint8Array.of(),senderId:Uint8Array.of(),messageType:o("MultiwayCommonTypes").E2eeDataMessageType.cast(0)}}function y(){return{fromVersion:"0",toVersion:"0",mediaUpdates:[]}}function C(){return{currentVersion:"0",mediaPath:o("MultiwaySharedTypes").MediaPath.cast(0)}}function b(){return{callerUserId:"",calleeUserId:"",sessionId:""}}function v(){return{fromVersion:"0",toVersion:"0",mediaUpdates:[],renegotiationRequested:!1,multipleVideoStreamsAllowed:!1,mediaPath:o("MultiwaySharedTypes").MediaPath.cast(0),screenShareStreamAllowed:!1}}function S(){return{currentVersion:"0"}}function R(){return{}}function L(){return{reason:o("MultiwayCommonTypes").HangupReason.cast(0),detailedReasonString:""}}function E(){return{iceCandidateSdps:[]}}function k(){return{reason:o("MultiwayCommonTypes").DismissReason.cast(0),detailedReasonString:""}}function I(){return{joinMode:o("MultiwayCommonTypes").JoinMode.cast(0)}}function T(){return{state:o("MultiwayCommonTypes").ParticipantCallState.cast(0)}}function D(){return{}}function x(){return{}}function $(){return{}}function P(){return{version:"0",participantStates:{},groupsOfUsers:[]}}function N(){return{currentVersion:"0"}}function M(){return{subscriptions:[]}}function w(){return{message:o("DataMessageSerializers").DataMessage$DefaultConstructor()}}function A(){return{deliveryResult:{}}}function F(){return{usersToInvite:new Set}}function O(){return{smcTier:"",region:"",isUsfu:!1,isEdge:!1}}function B(){return{offer:u(),deviceCapabilities:new Set}}function W(){return{answer:u(),mediaStatus:{},initiator:"",isPendingApproval:!1,multipleVideoStreamsAllowed:!1,mediaPath:o("MultiwaySharedTypes").MediaPath.cast(0),groupsOfUsers:[],screenShareStreamAllowed:!1}}function q(){return{deviceCapabilities:new Set}}function U(){return{}}function V(){return{type:o("MultiwayCommonTypes").ClientEventType.cast(0)}}function H(){return{clientEvents:[]}}function G(){return{}}function z(){return{}}function j(){return{caller:"",otherParticipants:new Set,ringType:o("MultiwayCommonTypes").RingType.cast(0),mediaPath:o("MultiwaySharedTypes").MediaPath.cast(0),isTransferCall:!1}}function K(){return{deviceStatus:o("MultiwayCommonTypes").DeviceStatus.cast(0)}}function Q(){return{usersToRemove:new Set}}function X(){return{topic:"",version:0,topicId:o("StateSyncTopicsConfigTypes").TopicId.cast(0)}}function Y(){return{topic:"",version:0}}function J(){return{syncPayload:f(),topic:"",version:0,topicId:o("StateSyncTopicsConfigTypes").TopicId.cast(0)}}function Z(){return{topic:"",version:0}}function ee(){return{topic:"",version:0,data:Uint8Array.of()}}function te(){return{topic:"",version:0}}function ne(){return{approvalStatus:o("MultiwayCommonTypes").ApprovalStatus.cast(0),targetUsers:new Set}}function re(){return{id:""}}function oe(){return{actorId:"",baseId:""}}function ae(){return{type:o("MultiwayCommonTypes").MessageType.cast(0),conferenceName:"",transactionId:"",retryCount:0}}function ie(){return{}}function le(){return{messageHeader:ae(),messageBody:ie()}}function se(){return{users:new Set,allowMultipleJoins:!1,dismissOthersOnFirstJoin:!1,aliasId:""}}function ue(){return{}}function ce(t,n){if(n.writeStructBegin("RtcException"),n.writeFieldBegin({fname:"message",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.message!=null)n.writeString(t.message);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"responseStatusCode",ftype:e.I32,fid:2}),t.responseStatusCode!=null){var i;n.writeI32((i=t.responseStatusCode)!=null?i:0)}else{var l=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(0);n.writeI32(l!=null?l:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"responseSubCode",ftype:e.I32,fid:3}),t.responseSubCode!=null){var s;n.writeI32((s=t.responseSubCode)!=null?s:0)}else{var u=o("MultiwayCommonTypes").RtcResponseSubCode.cast(0);n.writeI32(u!=null?u:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"apiStatusCode",ftype:e.I32,fid:4}),t.apiStatusCode!=null){var c;n.writeI32((c=t.apiStatusCode)!=null?c:0)}else{var d=o("MultiwayCommonTypes").RtcApiStatusCode.cast(0);n.writeI32(d!=null?d:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"rtcLogSeverity",ftype:e.I32,fid:5}),t.rtcLogSeverity!=null){var m;n.writeI32((m=t.rtcLogSeverity)!=null?m:0)}else{var p=o("MultiwayCommonTypes").RtcLogSeverity.cast(0);n.writeI32(p!=null?p:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function de(t,n){n.writeStructBegin("SessionDescription"),t.sdpString!=null&&(n.writeFieldBegin({fname:"sdpString",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.sdpString),n.writeFieldEnd()),t.sdpThrift!=null&&(n.writeFieldBegin({fname:"sdpThrift",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),o("WebrtcSdpSerializers").serializeSdp(t.sdpThrift,n),n.writeFieldEnd()),t.sdpCompressionVersion!=null&&(n.writeFieldBegin({fname:"sdpCompressionVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:3}),n.writeI64(BigInt(t.sdpCompressionVersion)),n.writeFieldEnd()),t.sdpCompressedData!=null&&(n.writeFieldBegin({fname:"sdpCompressedData",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeBinary(t.sdpCompressedData),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function me(t,n){if(n.writeStructBegin("SessionDescriptionUpdate"),n.writeFieldBegin({fname:"media",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.media!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(t.media).length});for(var o of Object.entries(t.media)){var a=o[0],i=o[1];n.writeI32(Number(a)),pe(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeI32(Number(u)),pe(c,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function pe(t,n){if(n.writeStructBegin("MediaDescriptionUpdate"),n.writeFieldBegin({fname:"body",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.body!=null)n.writeString(t.body);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"msid",ftype:e.STRING,fid:2}),t.msid!=null)n.writeString(t.msid);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mid",ftype:e.STRING,fid:3}),t.mid!=null)n.writeString(t.mid);else{var i="";n.writeString(i)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function _e(t,n){if(n.writeStructBegin("ServerMediaUpdate"),n.writeFieldBegin({fname:"sourceKey",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.sourceKey!=null)n.writeString(t.sourceKey);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"media",ftype:e.LIST,fid:2}),t.media!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.media.length});for(var i of t.media)o("MultiwaySharedSerializers").serializeMedia(i,n);n.writeListEnd()}else{var l=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:l.length});for(var s of l)o("MultiwaySharedSerializers").serializeMedia(s,n);n.writeListEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"ssrcGroups",ftype:e.LIST,fid:3}),t.ssrcGroups!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.ssrcGroups.length});for(var u of t.ssrcGroups)o("MultiwaySharedSerializers").serializeSsrcGroup(u,n);n.writeListEnd()}else{var c=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:c.length});for(var d of c)o("MultiwaySharedSerializers").serializeSsrcGroup(d,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function fe(t,n){if(n.writeStructBegin("ClientMediaUpdate"),n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.mediaStatus!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.BOOL,size:Object.keys(t.mediaStatus).length});for(var a of Object.entries(t.mediaStatus)){var i=a[0],l=a[1];n.writeString(i),n.writeBool(l)}n.writeMapEnd()}else{var s={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.BOOL,size:Object.keys(s).length});for(var u of Object.entries(s)){var c=u[0],d=u[1];n.writeString(c),n.writeBool(d)}n.writeMapEnd()}n.writeFieldEnd(),t.mediaStatusEx!=null&&(n.writeFieldBegin({fname:"mediaStatusEx",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatusEx,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function ge(t,n){if(n.writeStructBegin("IceCandidate"),t.candidateSdpString!=null&&(n.writeFieldBegin({fname:"candidateSdpString",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.candidateSdpString),n.writeFieldEnd()),n.writeFieldBegin({fname:"sdpMLineIndex",ftype:(e||(e=r("ThriftTypes"))).I64,fid:2}),t.sdpMLineIndex!=null)n.writeI64(BigInt(t.sdpMLineIndex));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"sdpMid",ftype:e.STRING,fid:3}),t.sdpMid!=null)n.writeString(t.sdpMid);else{var i="";n.writeString(i)}n.writeFieldEnd(),t.candidateSdpThrift!=null&&(n.writeFieldBegin({fname:"candidateSdpThrift",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),o("WebrtcSdpSerializers").serializeIceCandidateSdp(t.candidateSdpThrift,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function he(t,n){if(n.writeStructBegin("SyncPayload"),n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.stateStore!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var a of Object.entries(t.stateStore)){var i=a[0],l=a[1];n.writeString(i),o("StateSyncSerializers").serializeState(l,n)}n.writeMapEnd()}else{var s={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(s).length});for(var u of Object.entries(s)){var c=u[0],d=u[1];n.writeString(c),o("StateSyncSerializers").serializeState(d,n)}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"stateStoreV2",ftype:e.MAP,fid:4}),t.stateStoreV2!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(t.stateStoreV2).length});for(var m of Object.entries(t.stateStoreV2)){var p,_=m[0],f=m[1];n.writeI32((p=Number(_))!=null?p:0),o("StateSyncSerializers").serializeState(f,n)}n.writeMapEnd()}else{var g={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(g).length});for(var h of Object.entries(g)){var y,C=h[0],b=h[1];n.writeI32((y=Number(C))!=null?y:0),o("StateSyncSerializers").serializeState(b,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function ye(t,n){if(n.writeStructBegin("SyncAck"),n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.version!=null)n.writeI32(t.version);else{var o=0;n.writeI32(o)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ce(t,n){if(n.writeStructBegin("E2eeData"),n.writeFieldBegin({fname:"encryptedTopic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.encryptedTopic!=null)n.writeString(t.encryptedTopic);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"encryptedData",ftype:e.STRING,fid:2}),t.encryptedData!=null)n.writeBinary(t.encryptedData);else{var i=Uint8Array.of();n.writeBinary(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"senderId",ftype:e.STRING,fid:3}),t.senderId!=null)n.writeBinary(t.senderId);else{var l=Uint8Array.of();n.writeBinary(l)}if(n.writeFieldEnd(),t.targetIds!=null){n.writeFieldBegin({fname:"targetIds",ftype:(e||(e=r("ThriftTypes"))).SET,fid:4}),n.writeSetBegin({etype:e.STRING,size:t.targetIds.size});for(var s of t.targetIds)n.writeBinary(s);n.writeSetEnd(),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"messageType",ftype:e.I32,fid:5}),t.messageType!=null){var u;n.writeI32((u=t.messageType)!=null?u:0)}else{var c=o("MultiwayCommonTypes").E2eeDataMessageType.cast(0);n.writeI32(c!=null?c:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function be(t,n){if(n.writeStructBegin("ClientMediaUpdateRequest"),n.writeFieldBegin({fname:"fromVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.fromVersion!=null)n.writeI64(BigInt(t.fromVersion));else{var o="0";n.writeI64(BigInt(o))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"toVersion",ftype:e.I64,fid:2}),t.toVersion!=null)n.writeI64(BigInt(t.toVersion));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mediaUpdates",ftype:e.LIST,fid:3}),t.mediaUpdates!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.mediaUpdates.length});for(var i of t.mediaUpdates)fe(i,n);n.writeListEnd()}else{var l=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:l.length});for(var s of l)fe(s,n);n.writeListEnd()}n.writeFieldEnd(),t.offer!=null&&(n.writeFieldBegin({fname:"offer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),de(t.offer,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function ve(t,n){if(n.writeStructBegin("ClientMediaUpdateResponse"),n.writeFieldBegin({fname:"currentVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.currentVersion!=null)n.writeI64(BigInt(t.currentVersion));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),t.answer!=null&&(n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),de(t.answer,n),n.writeFieldEnd()),t.mediaStatus!=null&&(n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatus,n),n.writeFieldEnd()),t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),t.renegotiationOffer!=null&&(n.writeFieldBegin({fname:"renegotiationOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),de(t.renegotiationOffer,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"mediaPath",ftype:e.I32,fid:6}),t.mediaPath!=null){var i;n.writeI32((i=t.mediaPath)!=null?i:0)}else{var l=o("MultiwaySharedTypes").MediaPath.cast(0);n.writeI32(l!=null?l:0)}if(n.writeFieldEnd(),t.stateStore!=null){n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:7}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var s of Object.entries(t.stateStore)){var u=s[0],c=s[1];n.writeString(u),o("StateSyncSerializers").serializeState(c,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.stateStoreV2!=null){n.writeFieldBegin({fname:"stateStoreV2",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:8}),n.writeMapBegin({ktype:e.I32,vtype:e.STRUCT,size:Object.keys(t.stateStoreV2).length});for(var d of Object.entries(t.stateStoreV2)){var m,p=d[0],_=d[1];n.writeI32((m=Number(p))!=null?m:0),o("StateSyncSerializers").serializeState(_,n)}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function Se(t,n){if(n.writeStructBegin("MultipleRelaysAllocationParameters"),n.writeFieldBegin({fname:"callerUserId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.callerUserId!=null)n.writeString(t.callerUserId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"calleeUserId",ftype:e.STRING,fid:2}),t.calleeUserId!=null)n.writeString(t.calleeUserId);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"sessionId",ftype:e.STRING,fid:3}),t.sessionId!=null)n.writeString(t.sessionId);else{var i="";n.writeString(i)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Re(t,n){if(n.writeStructBegin("ServerMediaUpdateRequest"),n.writeFieldBegin({fname:"fromVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.fromVersion!=null)n.writeI64(BigInt(t.fromVersion));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"toVersion",ftype:e.I64,fid:2}),t.toVersion!=null)n.writeI64(BigInt(t.toVersion));else{var i="0";n.writeI64(BigInt(i))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mediaUpdates",ftype:e.LIST,fid:3}),t.mediaUpdates!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.mediaUpdates.length});for(var l of t.mediaUpdates)_e(l,n);n.writeListEnd()}else{var s=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:s.length});for(var u of s)_e(u,n);n.writeListEnd()}if(n.writeFieldEnd(),t.offer!=null&&(n.writeFieldBegin({fname:"offer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),de(t.offer,n),n.writeFieldEnd()),t.answer!=null&&(n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),de(t.answer,n),n.writeFieldEnd()),t.mediaStatus!=null&&(n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:7}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatus,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"renegotiationRequested",ftype:e.BOOL,fid:8}),t.renegotiationRequested!=null)n.writeBool(t.renegotiationRequested);else{var c=!1;n.writeBool(c)}if(n.writeFieldEnd(),t.prAnswer!=null&&(n.writeFieldBegin({fname:"prAnswer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:9}),de(t.prAnswer,n),n.writeFieldEnd()),t.stateStore!=null){n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:10}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var d of Object.entries(t.stateStore)){var m=d[0],p=d[1];n.writeString(m),o("StateSyncSerializers").serializeState(p,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:11}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),t.multipleRelaysParameters!=null&&(n.writeFieldBegin({fname:"multipleRelaysParameters",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:12}),Se(t.multipleRelaysParameters,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"multipleVideoStreamsAllowed",ftype:e.BOOL,fid:13}),t.multipleVideoStreamsAllowed!=null)n.writeBool(t.multipleVideoStreamsAllowed);else{var _=!1;n.writeBool(_)}if(n.writeFieldEnd(),t.renegotiationOffer!=null&&(n.writeFieldBegin({fname:"renegotiationOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),de(t.renegotiationOffer,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"mediaPath",ftype:e.I32,fid:15}),t.mediaPath!=null){var f;n.writeI32((f=t.mediaPath)!=null?f:0)}else{var g=o("MultiwaySharedTypes").MediaPath.cast(0);n.writeI32(g!=null?g:0)}if(n.writeFieldEnd(),t.update!=null&&(n.writeFieldBegin({fname:"update",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),me(t.update,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"screenShareStreamAllowed",ftype:e.BOOL,fid:17}),t.screenShareStreamAllowed!=null)n.writeBool(t.screenShareStreamAllowed);else{var h=!1;n.writeBool(h)}if(n.writeFieldEnd(),t.stateStoreV2!=null){n.writeFieldBegin({fname:"stateStoreV2",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:18}),n.writeMapBegin({ktype:e.I32,vtype:e.STRUCT,size:Object.keys(t.stateStoreV2).length});for(var y of Object.entries(t.stateStoreV2)){var C,b=y[0],v=y[1];n.writeI32((C=Number(b))!=null?C:0),o("StateSyncSerializers").serializeState(v,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.allowedCustomVideoContentTypes!=null){n.writeFieldBegin({fname:"allowedCustomVideoContentTypes",ftype:(e||(e=r("ThriftTypes"))).SET,fid:19}),n.writeSetBegin({etype:e.I32,size:t.allowedCustomVideoContentTypes.size});for(var S of t.allowedCustomVideoContentTypes)n.writeI32(S!=null?S:0);n.writeSetEnd(),n.writeFieldEnd()}t.relayInfo!=null&&(n.writeFieldBegin({fname:"relayInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:20}),o("MultiwaySharedSerializers").serializeRelayInfo(t.relayInfo,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Le(t,n){if(n.writeStructBegin("ServerMediaUpdateResponse"),n.writeFieldBegin({fname:"currentVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.currentVersion!=null)n.writeI64(BigInt(t.currentVersion));else{var a="0";n.writeI64(BigInt(a))}n.writeFieldEnd(),t.answer!=null&&(n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),de(t.answer,n),n.writeFieldEnd()),t.mediaStatus!=null&&(n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatus,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ee(e,t){t.writeStructBegin("TransferRequest"),t.writeFieldStop(),t.writeStructEnd()}function ke(t,n){if(n.writeStructBegin("HangupRequest"),n.writeFieldBegin({fname:"reason",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.reason!=null){var a;n.writeI32((a=t.reason)!=null?a:0)}else{var i=o("MultiwayCommonTypes").HangupReason.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"detailedReasonString",ftype:e.STRING,fid:2}),t.detailedReasonString!=null)n.writeString(t.detailedReasonString);else{var l="";n.writeString(l)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ie(t,n){if(n.writeStructBegin("IceCandidateRequest"),n.writeFieldBegin({fname:"iceCandidateSdps",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),t.iceCandidateSdps!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.iceCandidateSdps.length});for(var o of t.iceCandidateSdps)ge(o,n);n.writeListEnd()}else{var a=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:a.length});for(var i of a)ge(i,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Te(t,n){if(n.writeStructBegin("DismissRequest"),n.writeFieldBegin({fname:"reason",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.reason!=null){var a;n.writeI32((a=t.reason)!=null?a:0)}else{var i=o("MultiwayCommonTypes").DismissReason.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"detailedReasonString",ftype:e.STRING,fid:2}),t.detailedReasonString!=null)n.writeString(t.detailedReasonString);else{var l="";n.writeString(l)}n.writeFieldEnd(),t.callabilityResultErrorCode!=null&&(n.writeFieldBegin({fname:"callabilityResultErrorCode",ftype:(e||(e=r("ThriftTypes"))).I64,fid:3}),n.writeI64(BigInt(t.callabilityResultErrorCode)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function De(t,n){if(n.writeStructBegin("EndpointSettings"),n.writeFieldBegin({fname:"joinMode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.joinMode!=null){var a;n.writeI32((a=t.joinMode)!=null?a:0)}else{var i=o("MultiwayCommonTypes").JoinMode.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function xe(t,n){if(n.writeStructBegin("ParticipantState"),n.writeFieldBegin({fname:"state",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.state!=null){var a;n.writeI32((a=t.state)!=null?a:0)}else{var i=o("MultiwayCommonTypes").ParticipantCallState.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),t.userCapabilities!=null&&(n.writeFieldBegin({fname:"userCapabilities",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.userCapabilities),n.writeFieldEnd()),t.sctpNodeId!=null&&(n.writeFieldBegin({fname:"sctpNodeId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:3}),n.writeI64(BigInt(t.sctpNodeId)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function $e(t,n){n.writeStructBegin("ServerOnlyParticipantState"),t.userCountry!=null&&(n.writeFieldBegin({fname:"userCountry",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.userCountry),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Pe(t,n){n.writeStructBegin("UserProfile"),t.name!=null&&(n.writeFieldBegin({fname:"name",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.name),n.writeFieldEnd()),t.profilePictureUri!=null&&(n.writeFieldBegin({fname:"profilePictureUri",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.profilePictureUri),n.writeFieldEnd()),t.aliasId!=null&&(n.writeFieldBegin({fname:"aliasId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeString(t.aliasId),n.writeFieldEnd()),t.thirdPartyId!=null&&(n.writeFieldBegin({fname:"thirdPartyId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.thirdPartyId),n.writeFieldEnd()),t.groupId!=null&&(n.writeFieldBegin({fname:"groupId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.groupId),n.writeFieldEnd()),t.avatarImageUri!=null&&(n.writeFieldBegin({fname:"avatarImageUri",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:6}),n.writeString(t.avatarImageUri),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ne(t,n){n.writeStructBegin("ProductMetadata"),t.callerInfo!=null&&(n.writeFieldBegin({fname:"callerInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),Pe(t.callerInfo,n),n.writeFieldEnd()),t.liveBroadcastId!=null&&(n.writeFieldBegin({fname:"liveBroadcastId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.liveBroadcastId),n.writeFieldEnd()),t.callingTags!=null&&(n.writeFieldBegin({fname:"callingTags",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32(t.callingTags),n.writeFieldEnd()),t.backingIdentifier!=null&&(n.writeFieldBegin({fname:"backingIdentifier",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.backingIdentifier),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Me(t,n){if(n.writeStructBegin("ConferenceStateRequest"),n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.version!=null)n.writeI64(BigInt(t.version));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"participantStates",ftype:e.MAP,fid:2}),t.participantStates!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.participantStates).length});for(var i of Object.entries(t.participantStates)){var l=i[0],s=i[1];n.writeString(l),xe(s,n)}n.writeMapEnd()}else{var u={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(u).length});for(var c of Object.entries(u)){var d=c[0],m=c[1];n.writeString(d),xe(m,n)}n.writeMapEnd()}if(n.writeFieldEnd(),t.userProfiles!=null){n.writeFieldBegin({fname:"userProfiles",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:3}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRUCT,size:Object.keys(t.userProfiles).length});for(var p of Object.entries(t.userProfiles)){var _=p[0],f=p[1];n.writeString(_),Pe(f,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:4}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var g of t.appMessages)o("DataMessageSerializers").serializeDataMessage(g,n);n.writeListEnd(),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"groupsOfUsers",ftype:e.LIST,fid:5}),t.groupsOfUsers!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.groupsOfUsers.length});for(var h of t.groupsOfUsers)ct(h,n);n.writeListEnd()}else{var y=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:y.length});for(var C of y)ct(C,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function we(t,n){if(n.writeStructBegin("ConferenceStateResponse"),n.writeFieldBegin({fname:"currentVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.currentVersion!=null)n.writeI64(BigInt(t.currentVersion));else{var o="0";n.writeI64(BigInt(o))}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ae(t,n){if(n.writeStructBegin("SubscriptionRequest"),n.writeFieldBegin({fname:"subscriptions",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),t.subscriptions!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.subscriptions.length});for(var a of t.subscriptions)o("MultiwaySharedSerializers").serializeSubscription(a,n);n.writeListEnd()}else{var i=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:i.length});for(var l of i)o("MultiwaySharedSerializers").serializeSubscription(l,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Fe(t,n){if(n.writeStructBegin("DataMessageRequest"),n.writeFieldBegin({fname:"message",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.message!=null)o("DataMessageSerializers").serializeDataMessage(t.message,n);else{var a=o("DataMessageSerializers").DataMessage$DefaultConstructor();o("DataMessageSerializers").serializeDataMessage(a,n)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Oe(t,n){if(n.writeStructBegin("DataMessageResponse"),n.writeFieldBegin({fname:"deliveryResult",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.deliveryResult!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.I32,size:Object.keys(t.deliveryResult).length});for(var o of Object.entries(t.deliveryResult)){var a=o[0],i=o[1];n.writeString(a),n.writeI32(i!=null?i:0)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.I32,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeString(u),n.writeI32(c!=null?c:0)}n.writeMapEnd()}if(n.writeFieldEnd(),t.serviceTypeDeliveryResult!=null){n.writeFieldBegin({fname:"serviceTypeDeliveryResult",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:2}),n.writeMapBegin({ktype:e.I32,vtype:e.I32,size:Object.keys(t.serviceTypeDeliveryResult).length});for(var d of Object.entries(t.serviceTypeDeliveryResult)){var m,p=d[0],_=d[1];n.writeI32((m=Number(p))!=null?m:0),n.writeI32(_!=null?_:0)}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function Be(t,n){if(n.writeStructBegin("AddParticipantsRequest"),n.writeFieldBegin({fname:"usersToInvite",ftype:(e||(e=r("ThriftTypes"))).SET,fid:1}),t.usersToInvite!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.usersToInvite.size});for(var a of t.usersToInvite)n.writeString(a);n.writeSetEnd()}else{var i=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:i.size});for(var l of i)n.writeString(l);n.writeSetEnd()}if(n.writeFieldEnd(),t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var s of t.appMessages)o("DataMessageSerializers").serializeDataMessage(s,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function We(t,n){if(n.writeStructBegin("SfuAllocation"),n.writeFieldBegin({fname:"smcTier",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.smcTier!=null)n.writeString(t.smcTier);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"region",ftype:e.STRING,fid:2}),t.region!=null)n.writeString(t.region);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"isUsfu",ftype:e.BOOL,fid:3}),t.isUsfu!=null)n.writeBool(t.isUsfu);else{var i=!1;n.writeBool(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"isEdge",ftype:e.BOOL,fid:4}),t.isEdge!=null)n.writeBool(t.isEdge);else{var l=!1;n.writeBool(l)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function qe(t,n){if(n.writeStructBegin("JoinRequest"),n.writeFieldBegin({fname:"offer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.offer!=null)de(t.offer,n);else{var a=u();de(a,n)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"deviceCapabilities",ftype:e.SET,fid:2}),t.deviceCapabilities!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:t.deviceCapabilities.size});for(var i of t.deviceCapabilities)n.writeI32(i!=null?i:0);n.writeSetEnd()}else{var l=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:l.size});for(var s of l)n.writeI32(s!=null?s:0);n.writeSetEnd()}if(n.writeFieldEnd(),t.usersToCall!=null){n.writeFieldBegin({fname:"usersToCall",ftype:(e||(e=r("ThriftTypes"))).SET,fid:3}),n.writeSetBegin({etype:e.STRING,size:t.usersToCall.size});for(var c of t.usersToCall)n.writeString(c);n.writeSetEnd(),n.writeFieldEnd()}if(t.mediaStatus!=null){n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:4}),n.writeMapBegin({ktype:e.STRING,vtype:e.BOOL,size:Object.keys(t.mediaStatus).length});for(var d of Object.entries(t.mediaStatus)){var m=d[0],p=d[1];n.writeString(m),n.writeBool(p)}n.writeMapEnd(),n.writeFieldEnd()}if(t.userCapabilities!=null&&(n.writeFieldBegin({fname:"userCapabilities",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeBinary(t.userCapabilities),n.writeFieldEnd()),t.supportedExperiments!=null&&(n.writeFieldBegin({fname:"supportedExperiments",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:6}),n.writeString(t.supportedExperiments),n.writeFieldEnd()),t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:9}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var _ of t.appMessages)o("DataMessageSerializers").serializeDataMessage(_,n);n.writeListEnd(),n.writeFieldEnd()}if(t.userToEscalate!=null&&(n.writeFieldBegin({fname:"userToEscalate",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.userToEscalate),n.writeFieldEnd()),t.escalatingCallId!=null&&(n.writeFieldBegin({fname:"escalatingCallId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:11}),n.writeI64(BigInt(t.escalatingCallId)),n.writeFieldEnd()),t.conferenceType!=null){var f;n.writeFieldBegin({fname:"conferenceType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:12}),n.writeI32((f=t.conferenceType)!=null?f:0),n.writeFieldEnd()}if(t.mediaStatusEx!=null&&(n.writeFieldBegin({fname:"mediaStatusEx",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:13}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatusEx,n),n.writeFieldEnd()),t.answer!=null&&(n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),de(t.answer,n),n.writeFieldEnd()),t.syncPayload!=null&&(n.writeFieldBegin({fname:"syncPayload",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:15}),he(t.syncPayload,n),n.writeFieldEnd()),t.usersToApproveFromWaitingRoom!=null){n.writeFieldBegin({fname:"usersToApproveFromWaitingRoom",ftype:(e||(e=r("ThriftTypes"))).SET,fid:16}),n.writeSetBegin({etype:e.STRING,size:t.usersToApproveFromWaitingRoom.size});for(var g of t.usersToApproveFromWaitingRoom)n.writeString(g);n.writeSetEnd(),n.writeFieldEnd()}if(t.e2eeEnforcement!=null&&(n.writeFieldBegin({fname:"e2eeEnforcement",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:17}),o("MultiwaySharedSerializers").serializeE2eeEnforcement(t.e2eeEnforcement,n),n.writeFieldEnd()),t.sfuAllocation!=null&&(n.writeFieldBegin({fname:"sfuAllocation",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:18}),We(t.sfuAllocation,n),n.writeFieldEnd()),t.clientMediaMode!=null){var h;n.writeFieldBegin({fname:"clientMediaMode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:19}),n.writeI32((h=t.clientMediaMode)!=null?h:0),n.writeFieldEnd()}if(t.endpointSettings!=null&&(n.writeFieldBegin({fname:"endpointSettings",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:20}),De(t.endpointSettings,n),n.writeFieldEnd()),t.backupSfuAllocation!=null&&(n.writeFieldBegin({fname:"backupSfuAllocation",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:21}),We(t.backupSfuAllocation,n),n.writeFieldEnd()),t.supportedCustomVideoContentTypes!=null){n.writeFieldBegin({fname:"supportedCustomVideoContentTypes",ftype:(e||(e=r("ThriftTypes"))).SET,fid:22}),n.writeSetBegin({etype:e.I32,size:t.supportedCustomVideoContentTypes.size});for(var y of t.supportedCustomVideoContentTypes)n.writeI32(y!=null?y:0);n.writeSetEnd(),n.writeFieldEnd()}t.configIntegrityOpaqueToken!=null&&(n.writeFieldBegin({fname:"configIntegrityOpaqueToken",ftype:(e||(e=r("ThriftTypes"))).I32,fid:23}),n.writeI32(t.configIntegrityOpaqueToken),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ue(t,n){if(n.writeStructBegin("JoinResponse"),n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.answer!=null)de(t.answer,n);else{var a=u();de(a,n)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mediaStatus",ftype:e.MAP,fid:2}),t.mediaStatus!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.BOOL,size:Object.keys(t.mediaStatus).length});for(var i of Object.entries(t.mediaStatus)){var l=i[0],s=i[1];n.writeString(l),n.writeBool(s)}n.writeMapEnd()}else{var c={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.BOOL,size:Object.keys(c).length});for(var d of Object.entries(c)){var m=d[0],p=d[1];n.writeString(m),n.writeBool(p)}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"initiator",ftype:e.STRING,fid:3}),t.initiator!=null)n.writeString(t.initiator);else{var _="";n.writeString(_)}if(n.writeFieldEnd(),t.negotiatedExperiments!=null&&(n.writeFieldBegin({fname:"negotiatedExperiments",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.negotiatedExperiments),n.writeFieldEnd()),t.mediaStatusEx!=null&&(n.writeFieldBegin({fname:"mediaStatusEx",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatusEx,n),n.writeFieldEnd()),t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:7}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var f of t.appMessages)o("DataMessageSerializers").serializeDataMessage(f,n);n.writeListEnd(),n.writeFieldEnd()}if(t.stateStore!=null){n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:8}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var g of Object.entries(t.stateStore)){var h=g[0],y=g[1];n.writeString(h),o("StateSyncSerializers").serializeState(y,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:9}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),n.writeFieldBegin({fname:"isPendingApproval",ftype:e.BOOL,fid:10}),t.isPendingApproval!=null)n.writeBool(t.isPendingApproval);else{var C=!1;n.writeBool(C)}if(n.writeFieldEnd(),t.renegotiationOffer!=null&&(n.writeFieldBegin({fname:"renegotiationOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:11}),de(t.renegotiationOffer,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"multipleVideoStreamsAllowed",ftype:e.BOOL,fid:12}),t.multipleVideoStreamsAllowed!=null)n.writeBool(t.multipleVideoStreamsAllowed);else{var b=!1;n.writeBool(b)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mediaPath",ftype:e.I32,fid:13}),t.mediaPath!=null){var v;n.writeI32((v=t.mediaPath)!=null?v:0)}else{var S=o("MultiwaySharedTypes").MediaPath.cast(0);n.writeI32(S!=null?S:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"groupsOfUsers",ftype:e.LIST,fid:14}),t.groupsOfUsers!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.groupsOfUsers.length});for(var R of t.groupsOfUsers)ct(R,n);n.writeListEnd()}else{var L=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:L.length});for(var E of L)ct(E,n);n.writeListEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"screenShareStreamAllowed",ftype:e.BOOL,fid:15}),t.screenShareStreamAllowed!=null)n.writeBool(t.screenShareStreamAllowed);else{var k=!1;n.writeBool(k)}if(n.writeFieldEnd(),t.relayInfo!=null&&(n.writeFieldBegin({fname:"relayInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),o("MultiwaySharedSerializers").serializeRelayInfo(t.relayInfo,n),n.writeFieldEnd()),t.selfSctpNodeId!=null&&(n.writeFieldBegin({fname:"selfSctpNodeId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:17}),n.writeI64(BigInt(t.selfSctpNodeId)),n.writeFieldEnd()),t.stateStoreV2!=null){n.writeFieldBegin({fname:"stateStoreV2",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:18}),n.writeMapBegin({ktype:e.I32,vtype:e.STRUCT,size:Object.keys(t.stateStoreV2).length});for(var I of Object.entries(t.stateStoreV2)){var T,D=I[0],x=I[1];n.writeI32((T=Number(D))!=null?T:0),o("StateSyncSerializers").serializeState(x,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.allowedCustomVideoContentTypes!=null){n.writeFieldBegin({fname:"allowedCustomVideoContentTypes",ftype:(e||(e=r("ThriftTypes"))).SET,fid:19}),n.writeSetBegin({etype:e.I32,size:t.allowedCustomVideoContentTypes.size});for(var $ of t.allowedCustomVideoContentTypes)n.writeI32($!=null?$:0);n.writeSetEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function Ve(t,n){if(n.writeStructBegin("ConnectRequest"),t.sdp!=null&&(n.writeFieldBegin({fname:"sdp",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),de(t.sdp,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"deviceCapabilities",ftype:(e||(e=r("ThriftTypes"))).SET,fid:3}),t.deviceCapabilities!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:t.deviceCapabilities.size});for(var a of t.deviceCapabilities)n.writeI32(a!=null?a:0);n.writeSetEnd()}else{var i=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:i.size});for(var l of i)n.writeI32(l!=null?l:0);n.writeSetEnd()}if(n.writeFieldEnd(),t.supportedCustomVideoContentTypes!=null){n.writeFieldBegin({fname:"supportedCustomVideoContentTypes",ftype:(e||(e=r("ThriftTypes"))).SET,fid:5}),n.writeSetBegin({etype:e.I32,size:t.supportedCustomVideoContentTypes.size});for(var s of t.supportedCustomVideoContentTypes)n.writeI32(s!=null?s:0);n.writeSetEnd(),n.writeFieldEnd()}t.prOffer!=null&&(n.writeFieldBegin({fname:"prOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),de(t.prOffer,n),n.writeFieldEnd()),t.e2eeEnforcement!=null&&(n.writeFieldBegin({fname:"e2eeEnforcement",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:7}),o("MultiwaySharedSerializers").serializeE2eeEnforcement(t.e2eeEnforcement,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function He(t,n){n.writeStructBegin("ConnectResponse"),t.sdp!=null&&(n.writeFieldBegin({fname:"sdp",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),de(t.sdp,n),n.writeFieldEnd()),t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ge(t,n){if(n.writeStructBegin("ClientEvent"),n.writeFieldBegin({fname:"type",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.type!=null){var a;n.writeI32((a=t.type)!=null?a:0)}else{var i=o("MultiwayCommonTypes").ClientEventType.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),t.time!=null&&(n.writeFieldBegin({fname:"time",ftype:(e||(e=r("ThriftTypes"))).I64,fid:2}),n.writeI64(BigInt(t.time)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function ze(t,n){if(n.writeStructBegin("ClientEventRequest"),n.writeFieldBegin({fname:"clientEvents",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),t.clientEvents!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.clientEvents.length});for(var o of t.clientEvents)Ge(o,n);n.writeListEnd()}else{var a=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:a.length});for(var i of a)Ge(i,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function je(t,n){n.writeStructBegin("ThreadIdInfo"),t.groupThreadId!=null&&(n.writeFieldBegin({fname:"groupThreadId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.groupThreadId),n.writeFieldEnd()),t.peerId!=null&&(n.writeFieldBegin({fname:"peerId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.peerId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ke(e,t){t.writeStructBegin("ClientEventResponse"),t.writeFieldStop(),t.writeStructEnd()}function Qe(t,n){if(n.writeStructBegin("RingRequest"),n.writeFieldBegin({fname:"caller",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.caller!=null)n.writeString(t.caller);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"otherParticipants",ftype:e.SET,fid:2}),t.otherParticipants!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.otherParticipants.size});for(var i of t.otherParticipants)n.writeString(i);n.writeSetEnd()}else{var l=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:l.size});for(var s of l)n.writeString(s);n.writeSetEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"ringType",ftype:e.I32,fid:4}),t.ringType!=null){var u;n.writeI32((u=t.ringType)!=null?u:0)}else{var c=o("MultiwayCommonTypes").RingType.cast(0);n.writeI32(c!=null?c:0)}if(n.writeFieldEnd(),t.offeredExperiments!=null&&(n.writeFieldBegin({fname:"offeredExperiments",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.offeredExperiments),n.writeFieldEnd()),t.isScheduledCall!=null&&(n.writeFieldBegin({fname:"isScheduledCall",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:6}),n.writeBool(t.isScheduledCall),n.writeFieldEnd()),t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:8}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var d of t.appMessages)o("DataMessageSerializers").serializeDataMessage(d,n);n.writeListEnd(),n.writeFieldEnd()}if(t.offer!=null&&(n.writeFieldBegin({fname:"offer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:10}),de(t.offer,n),n.writeFieldEnd()),t.mediaStatusEx!=null&&(n.writeFieldBegin({fname:"mediaStatusEx",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:11}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatusEx,n),n.writeFieldEnd()),t.isPreconnectSupported!=null&&(n.writeFieldBegin({fname:"isPreconnectSupported",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:12}),n.writeBool(t.isPreconnectSupported),n.writeFieldEnd()),t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:13}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),t.unifiedOffer!=null&&(n.writeFieldBegin({fname:"unifiedOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),de(t.unifiedOffer,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"mediaPath",ftype:e.I32,fid:15}),t.mediaPath!=null){var m;n.writeI32((m=t.mediaPath)!=null?m:0)}else{var p=o("MultiwaySharedTypes").MediaPath.cast(0);n.writeI32(p!=null?p:0)}if(n.writeFieldEnd(),t.e2eeEnforcement!=null&&(n.writeFieldBegin({fname:"e2eeEnforcement",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),o("MultiwaySharedSerializers").serializeE2eeEnforcement(t.e2eeEnforcement,n),n.writeFieldEnd()),t.isLegacyCall!=null&&(n.writeFieldBegin({fname:"isLegacyCall",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:17}),n.writeBool(t.isLegacyCall),n.writeFieldEnd()),n.writeFieldBegin({fname:"isTransferCall",ftype:e.BOOL,fid:18}),t.isTransferCall!=null)n.writeBool(t.isTransferCall);else{var _=!1;n.writeBool(_)}if(n.writeFieldEnd(),t.relayInfo!=null&&(n.writeFieldBegin({fname:"relayInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:20}),o("MultiwaySharedSerializers").serializeRelayInfo(t.relayInfo,n),n.writeFieldEnd()),t.overlayConfigs!=null){n.writeFieldBegin({fname:"overlayConfigs",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:21}),n.writeMapBegin({ktype:e.I32,vtype:e.I32,size:Object.keys(t.overlayConfigs).length});for(var f of Object.entries(t.overlayConfigs)){var g=f[0],h=f[1];n.writeI32(Number(g)),n.writeI32(h)}n.writeMapEnd(),n.writeFieldEnd()}t.productMetadata!=null&&(n.writeFieldBegin({fname:"productMetadata",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:22}),Ne(t.productMetadata,n),n.writeFieldEnd()),t.callerClientSessionId!=null&&(n.writeFieldBegin({fname:"callerClientSessionId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:23}),n.writeString(t.callerClientSessionId),n.writeFieldEnd()),t.threadIdInfo!=null&&(n.writeFieldBegin({fname:"threadIdInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:24}),je(t.threadIdInfo,n),n.writeFieldEnd()),t.linkUrl!=null&&(n.writeFieldBegin({fname:"linkUrl",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:25}),n.writeString(t.linkUrl),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Xe(t,n){if(n.writeStructBegin("RingResponse"),n.writeFieldBegin({fname:"deviceStatus",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),t.deviceStatus!=null){var a;n.writeI32((a=t.deviceStatus)!=null?a:0)}else{var i=o("MultiwayCommonTypes").DeviceStatus.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ye(t,n){if(n.writeStructBegin("RemoveParticipantsRequest"),n.writeFieldBegin({fname:"usersToRemove",ftype:(e||(e=r("ThriftTypes"))).SET,fid:1}),t.usersToRemove!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.usersToRemove.size});for(var o of t.usersToRemove)n.writeString(o);n.writeSetEnd()}else{var a=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:a.size});for(var i of a)n.writeString(i);n.writeSetEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Je(t,n){if(n.writeStructBegin("UnsubscribeRequest"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.topic!=null)n.writeString(t.topic);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:2}),t.version!=null)n.writeI32(t.version);else{var i=0;n.writeI32(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"topicId",ftype:e.I32,fid:3}),t.topicId!=null){var l;n.writeI32((l=t.topicId)!=null?l:0)}else{var s=o("StateSyncTopicsConfigTypes").TopicId.cast(0);n.writeI32(s!=null?s:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ze(t,n){if(n.writeStructBegin("UnsubscribeResponse"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:2}),t.version!=null)n.writeI32(t.version);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function et(t,n){if(n.writeStructBegin("UpdateRequest"),n.writeFieldBegin({fname:"syncPayload",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.syncPayload!=null)he(t.syncPayload,n);else{var a=f();he(a,n)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"topic",ftype:e.STRING,fid:2}),t.topic!=null)n.writeString(t.topic);else{var i="";n.writeString(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:3}),t.version!=null)n.writeI32(t.version);else{var l=0;n.writeI32(l)}if(n.writeFieldEnd(),t.data!=null&&(n.writeFieldBegin({fname:"data",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeBinary(t.data),n.writeFieldEnd()),n.writeFieldBegin({fname:"topicId",ftype:e.I32,fid:5}),t.topicId!=null){var s;n.writeI32((s=t.topicId)!=null?s:0)}else{var u=o("StateSyncTopicsConfigTypes").TopicId.cast(0);n.writeI32(u!=null?u:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function tt(t,n){if(n.writeStructBegin("UpdateResponse"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:3}),t.version!=null)n.writeI32(t.version);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function nt(t,n){if(n.writeStructBegin("NotifyRequest"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:3}),t.version!=null)n.writeI32(t.version);else{var a=0;n.writeI32(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"data",ftype:e.STRING,fid:4}),t.data!=null)n.writeBinary(t.data);else{var i=Uint8Array.of();n.writeBinary(i)}if(n.writeFieldEnd(),t.syncPayload!=null&&(n.writeFieldBegin({fname:"syncPayload",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),he(t.syncPayload,n),n.writeFieldEnd()),t.topicId!=null){var l;n.writeFieldBegin({fname:"topicId",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32((l=t.topicId)!=null?l:0),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function rt(t,n){if(n.writeStructBegin("NotifyResponse"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:3}),t.version!=null)n.writeI32(t.version);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function ot(t,n){if(n.writeStructBegin("ApprovalRequest"),n.writeFieldBegin({fname:"approvalStatus",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),t.approvalStatus!=null){var a;n.writeI32((a=t.approvalStatus)!=null?a:0)}else{var i=o("MultiwayCommonTypes").ApprovalStatus.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"targetUsers",ftype:e.SET,fid:3}),t.targetUsers!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.targetUsers.size});for(var l of t.targetUsers)n.writeString(l);n.writeSetEnd()}else{var s=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:s.size});for(var u of s)n.writeString(u);n.writeSetEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function at(t,n){if(n.writeStructBegin("RtcSender"),n.writeFieldBegin({fname:"id",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.id!=null)n.writeString(t.id);else{var o="";n.writeString(o)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function it(t,n){if(n.writeStructBegin("RtcReceiver"),n.writeFieldBegin({fname:"actorId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.actorId!=null)n.writeString(t.actorId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"baseId",ftype:e.STRING,fid:2}),t.baseId!=null)n.writeString(t.baseId);else{var a="";n.writeString(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function lt(t,n){if(n.writeStructBegin("RtcMessageHeader"),n.writeFieldBegin({fname:"type",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.type!=null){var a;n.writeI32((a=t.type)!=null?a:0)}else{var i=o("MultiwayCommonTypes").MessageType.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"conferenceName",ftype:e.STRING,fid:2}),t.conferenceName!=null)n.writeString(t.conferenceName);else{var l="";n.writeString(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"transactionId",ftype:e.STRING,fid:3}),t.transactionId!=null)n.writeString(t.transactionId);else{var s="";n.writeString(s)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"retryCount",ftype:e.I16,fid:4}),t.retryCount!=null)n.writeI16(t.retryCount);else{var u=0;n.writeI16(u)}if(n.writeFieldEnd(),t.serverInfoData!=null&&(n.writeFieldBegin({fname:"serverInfoData",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.serverInfoData),n.writeFieldEnd()),t.responseStatusCode!=null){var c;n.writeFieldBegin({fname:"responseStatusCode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32((c=t.responseStatusCode)!=null?c:0),n.writeFieldEnd()}if(t.extensions!=null){n.writeFieldBegin({fname:"extensions",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:7}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRING,size:Object.keys(t.extensions).length});for(var d of Object.entries(t.extensions)){var m=d[0],p=d[1];n.writeString(m),n.writeString(p)}n.writeMapEnd(),n.writeFieldEnd()}if(t.sequenceNumber!=null&&(n.writeFieldBegin({fname:"sequenceNumber",ftype:(e||(e=r("ThriftTypes"))).I64,fid:8}),n.writeI64(BigInt(t.sequenceNumber)),n.writeFieldEnd()),t.clientSessionId!=null&&(n.writeFieldBegin({fname:"clientSessionId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:9}),n.writeString(t.clientSessionId),n.writeFieldEnd()),t.responseStatusMessage!=null&&(n.writeFieldBegin({fname:"responseStatusMessage",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.responseStatusMessage),n.writeFieldEnd()),t.responseSubCode!=null){var _;n.writeFieldBegin({fname:"responseSubCode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:11}),n.writeI32((_=t.responseSubCode)!=null?_:0),n.writeFieldEnd()}if(t.collisionKey!=null&&(n.writeFieldBegin({fname:"collisionKey",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:12}),n.writeString(t.collisionKey),n.writeFieldEnd()),t.conferenceType!=null){var f;n.writeFieldBegin({fname:"conferenceType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:13}),n.writeI32((f=t.conferenceType)!=null?f:0),n.writeFieldEnd()}if(t.serverSessionId!=null&&(n.writeFieldBegin({fname:"serverSessionId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:14}),n.writeString(t.serverSessionId),n.writeFieldEnd()),t.rtcHandle!=null&&(n.writeFieldBegin({fname:"rtcHandle",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:15}),n.writeString(t.rtcHandle),n.writeFieldEnd()),t.retryAfterMsec!=null&&(n.writeFieldBegin({fname:"retryAfterMsec",ftype:(e||(e=r("ThriftTypes"))).I32,fid:16}),n.writeI32(t.retryAfterMsec),n.writeFieldEnd()),t.receiverUserId!=null&&(n.writeFieldBegin({fname:"receiverUserId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:17}),n.writeString(t.receiverUserId),n.writeFieldEnd()),t.clientStack!=null){var g;n.writeFieldBegin({fname:"clientStack",ftype:(e||(e=r("ThriftTypes"))).I32,fid:18}),n.writeI32((g=t.clientStack)!=null?g:0),n.writeFieldEnd()}if(t.serverMsgTime!=null&&(n.writeFieldBegin({fname:"serverMsgTime",ftype:(e||(e=r("ThriftTypes"))).I64,fid:19}),n.writeI64(BigInt(t.serverMsgTime)),n.writeFieldEnd()),t.sender!=null&&(n.writeFieldBegin({fname:"sender",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:20}),at(t.sender,n),n.writeFieldEnd()),t.receiver!=null&&(n.writeFieldBegin({fname:"receiver",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:21}),it(t.receiver,n),n.writeFieldEnd()),t.messageTags!=null){n.writeFieldBegin({fname:"messageTags",ftype:(e||(e=r("ThriftTypes"))).SET,fid:22}),n.writeSetBegin({etype:e.I32,size:t.messageTags.size});for(var h of t.messageTags)n.writeI32(h!=null?h:0);n.writeSetEnd(),n.writeFieldEnd()}t.conferenceId!=null&&(n.writeFieldBegin({fname:"conferenceId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:23}),n.writeI64(BigInt(t.conferenceId)),n.writeFieldEnd()),t.protocolVersion!=null&&(n.writeFieldBegin({fname:"protocolVersion",ftype:(e||(e=r("ThriftTypes"))).I32,fid:24}),n.writeI32(t.protocolVersion),n.writeFieldEnd()),t.bodyCompressionVersion!=null&&(n.writeFieldBegin({fname:"bodyCompressionVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:25}),n.writeI64(BigInt(t.bodyCompressionVersion)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function st(t,n){n.writeStructBegin("RtcMessageBody"),t.joinRequest!=null&&(n.writeFieldBegin({fname:"joinRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),qe(t.joinRequest,n),n.writeFieldEnd()),t.joinResponse!=null&&(n.writeFieldBegin({fname:"joinResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),Ue(t.joinResponse,n),n.writeFieldEnd()),t.serverMediaUpdateRequest!=null&&(n.writeFieldBegin({fname:"serverMediaUpdateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),Re(t.serverMediaUpdateRequest,n),n.writeFieldEnd()),t.serverMediaUpdateResponse!=null&&(n.writeFieldBegin({fname:"serverMediaUpdateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),Le(t.serverMediaUpdateResponse,n),n.writeFieldEnd()),t.hangupRequest!=null&&(n.writeFieldBegin({fname:"hangupRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),ke(t.hangupRequest,n),n.writeFieldEnd()),t.iceCandidateRequest!=null&&(n.writeFieldBegin({fname:"iceCandidateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),Ie(t.iceCandidateRequest,n),n.writeFieldEnd()),t.ringRequest!=null&&(n.writeFieldBegin({fname:"ringRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:8}),Qe(t.ringRequest,n),n.writeFieldEnd()),t.ringResponse!=null&&(n.writeFieldBegin({fname:"ringResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:9}),Xe(t.ringResponse,n),n.writeFieldEnd()),t.dismissRequest!=null&&(n.writeFieldBegin({fname:"dismissRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:10}),Te(t.dismissRequest,n),n.writeFieldEnd()),t.conferenceStateRequest!=null&&(n.writeFieldBegin({fname:"conferenceStateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:11}),Me(t.conferenceStateRequest,n),n.writeFieldEnd()),t.conferenceStateResponse!=null&&(n.writeFieldBegin({fname:"conferenceStateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:12}),we(t.conferenceStateResponse,n),n.writeFieldEnd()),t.addParticipantsRequest!=null&&(n.writeFieldBegin({fname:"addParticipantsRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:13}),Be(t.addParticipantsRequest,n),n.writeFieldEnd()),t.subscriptionRequest!=null&&(n.writeFieldBegin({fname:"subscriptionRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),Ae(t.subscriptionRequest,n),n.writeFieldEnd()),t.clientMediaUpdateRequest!=null&&(n.writeFieldBegin({fname:"clientMediaUpdateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:15}),be(t.clientMediaUpdateRequest,n),n.writeFieldEnd()),t.clientMediaUpdateResponse!=null&&(n.writeFieldBegin({fname:"clientMediaUpdateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),ve(t.clientMediaUpdateResponse,n),n.writeFieldEnd()),t.dataMessageRequest!=null&&(n.writeFieldBegin({fname:"dataMessageRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:17}),Fe(t.dataMessageRequest,n),n.writeFieldEnd()),t.removeParticipantsRequest!=null&&(n.writeFieldBegin({fname:"removeParticipantsRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:18}),Ye(t.removeParticipantsRequest,n),n.writeFieldEnd()),t.dataMessageResponse!=null&&(n.writeFieldBegin({fname:"dataMessageResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:19}),Oe(t.dataMessageResponse,n),n.writeFieldEnd()),t.updateRequest!=null&&(n.writeFieldBegin({fname:"updateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:30}),et(t.updateRequest,n),n.writeFieldEnd()),t.updateResponse!=null&&(n.writeFieldBegin({fname:"updateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:31}),tt(t.updateResponse,n),n.writeFieldEnd()),t.notifyRequest!=null&&(n.writeFieldBegin({fname:"notifyRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:32}),nt(t.notifyRequest,n),n.writeFieldEnd()),t.notifyResponse!=null&&(n.writeFieldBegin({fname:"notifyResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:33}),rt(t.notifyResponse,n),n.writeFieldEnd()),t.connectRequest!=null&&(n.writeFieldBegin({fname:"connectRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:34}),Ve(t.connectRequest,n),n.writeFieldEnd()),t.connectResponse!=null&&(n.writeFieldBegin({fname:"connectResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:35}),He(t.connectResponse,n),n.writeFieldEnd()),t.clientEventRequest!=null&&(n.writeFieldBegin({fname:"clientEventRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:36}),ze(t.clientEventRequest,n),n.writeFieldEnd()),t.clientEventResponse!=null&&(n.writeFieldBegin({fname:"clientEventResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:37}),Ke(t.clientEventResponse,n),n.writeFieldEnd()),t.unsubscribeRequest!=null&&(n.writeFieldBegin({fname:"unsubscribeRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:40}),Je(t.unsubscribeRequest,n),n.writeFieldEnd()),t.unsubscribeResponse!=null&&(n.writeFieldBegin({fname:"unsubscribeResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:41}),Ze(t.unsubscribeResponse,n),n.writeFieldEnd()),t.approvalRequest!=null&&(n.writeFieldBegin({fname:"approvalRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:42}),ot(t.approvalRequest,n),n.writeFieldEnd()),t.transferRequest!=null&&(n.writeFieldBegin({fname:"transferRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:43}),Ee(t.transferRequest,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function ut(t,n){if(n.writeStructBegin("RtcMultiwayMessage"),n.writeFieldBegin({fname:"messageHeader",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.messageHeader!=null)lt(t.messageHeader,n);else{var o=ae();lt(o,n)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"messageBody",ftype:e.STRUCT,fid:2}),t.messageBody!=null)st(t.messageBody,n);else{var a=ie();st(a,n)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function ct(t,n){if(n.writeStructBegin("GroupOfUsers"),n.writeFieldBegin({fname:"users",ftype:(e||(e=r("ThriftTypes"))).SET,fid:1}),t.users!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.users.size});for(var o of t.users)n.writeString(o);n.writeSetEnd()}else{var a=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:a.size});for(var i of a)n.writeString(i);n.writeSetEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"allowMultipleJoins",ftype:e.BOOL,fid:2}),t.allowMultipleJoins!=null)n.writeBool(t.allowMultipleJoins);else{var l=!1;n.writeBool(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"dismissOthersOnFirstJoin",ftype:e.BOOL,fid:3}),t.dismissOthersOnFirstJoin!=null)n.writeBool(t.dismissOthersOnFirstJoin);else{var s=!1;n.writeBool(s)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"aliasId",ftype:e.STRING,fid:4}),t.aliasId!=null)n.writeString(t.aliasId);else{var u="";n.writeString(u)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function dt(t,n){if(n.writeStructBegin("RtcMessageBodyVariant"),t.joinRequest!=null){n.writeFieldBegin({fname:"joinRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),qe(t.joinRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.joinResponse!=null){n.writeFieldBegin({fname:"joinResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),Ue(t.joinResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.serverMediaUpdateRequest!=null){n.writeFieldBegin({fname:"serverMediaUpdateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),Re(t.serverMediaUpdateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.serverMediaUpdateResponse!=null){n.writeFieldBegin({fname:"serverMediaUpdateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),Le(t.serverMediaUpdateResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.hangupRequest!=null){n.writeFieldBegin({fname:"hangupRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),ke(t.hangupRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.iceCandidateRequest!=null){n.writeFieldBegin({fname:"iceCandidateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),Ie(t.iceCandidateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.ringRequest!=null){n.writeFieldBegin({fname:"ringRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:8}),Qe(t.ringRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.ringResponse!=null){n.writeFieldBegin({fname:"ringResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:9}),Xe(t.ringResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.dismissRequest!=null){n.writeFieldBegin({fname:"dismissRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:10}),Te(t.dismissRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.conferenceStateRequest!=null){n.writeFieldBegin({fname:"conferenceStateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:11}),Me(t.conferenceStateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.conferenceStateResponse!=null){n.writeFieldBegin({fname:"conferenceStateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:12}),we(t.conferenceStateResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.addParticipantsRequest!=null){n.writeFieldBegin({fname:"addParticipantsRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:13}),Be(t.addParticipantsRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.subscriptionRequest!=null){n.writeFieldBegin({fname:"subscriptionRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),Ae(t.subscriptionRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.clientMediaUpdateRequest!=null){n.writeFieldBegin({fname:"clientMediaUpdateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:15}),be(t.clientMediaUpdateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.clientMediaUpdateResponse!=null){n.writeFieldBegin({fname:"clientMediaUpdateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),ve(t.clientMediaUpdateResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.dataMessageRequest!=null){n.writeFieldBegin({fname:"dataMessageRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:17}),Fe(t.dataMessageRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.removeParticipantsRequest!=null){n.writeFieldBegin({fname:"removeParticipantsRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:18}),Ye(t.removeParticipantsRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.dataMessageResponse!=null){n.writeFieldBegin({fname:"dataMessageResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:19}),Oe(t.dataMessageResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.updateRequest!=null){n.writeFieldBegin({fname:"updateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:30}),et(t.updateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.updateResponse!=null){n.writeFieldBegin({fname:"updateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:31}),tt(t.updateResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.notifyRequest!=null){n.writeFieldBegin({fname:"notifyRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:32}),nt(t.notifyRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.notifyResponse!=null){n.writeFieldBegin({fname:"notifyResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:33}),rt(t.notifyResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.connectRequest!=null){n.writeFieldBegin({fname:"connectRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:34}),Ve(t.connectRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.connectResponse!=null){n.writeFieldBegin({fname:"connectResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:35}),He(t.connectResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.clientEventRequest!=null){n.writeFieldBegin({fname:"clientEventRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:36}),ze(t.clientEventRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.clientEventResponse!=null){n.writeFieldBegin({fname:"clientEventResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:37}),Ke(t.clientEventResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.unsubscribeRequest!=null){n.writeFieldBegin({fname:"unsubscribeRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:40}),Je(t.unsubscribeRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.unsubscribeResponse!=null){n.writeFieldBegin({fname:"unsubscribeResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:41}),Ze(t.unsubscribeResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.approvalRequest!=null){n.writeFieldBegin({fname:"approvalRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:42}),ot(t.approvalRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.transferRequest!=null){n.writeFieldBegin({fname:"transferRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:43}),Ee(t.transferRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}n.writeFieldStop(),n.writeStructEnd()}function mt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.message=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.responseStatusCode=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.responseSubCode=o("MultiwayCommonTypes").RtcResponseSubCode.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.apiStatusCode=o("MultiwayCommonTypes").RtcApiStatusCode.cast(t.readI32()):t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.rtcLogSeverity=o("MultiwayCommonTypes").RtcLogSeverity.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.message===void 0&&(n.message=""),n.responseStatusCode===void 0&&(n.responseStatusCode=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(0)),n.responseSubCode===void 0&&(n.responseSubCode=o("MultiwayCommonTypes").RtcResponseSubCode.cast(0)),n.apiStatusCode===void 0&&(n.apiStatusCode=o("MultiwayCommonTypes").RtcApiStatusCode.cast(0)),n.rtcLogSeverity===void 0&&(n.rtcLogSeverity=o("MultiwayCommonTypes").RtcLogSeverity.cast(0)),n}function pt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpString=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.sdpThrift=o("WebrtcSdpSerializers").deserializeSdp(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I64?n.sdpCompressionVersion=t.readI64().toString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpCompressedData=t.readBinary():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function _t(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.media={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readI32(),c=ft(t);n.media[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.media===void 0&&(n.media={}),n}function ft(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.body=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.msid=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.mid=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.body===void 0&&(n.body=""),n.msid===void 0&&(n.msid=""),n.mid===void 0&&(n.mid=""),n}function gt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.sourceKey=t.readString():t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).LIST){n.media=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=o("MultiwaySharedSerializers").deserializeMedia(t);n.media.push(c)}}else t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).LIST){n.ssrcGroups=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=o("MultiwaySharedSerializers").deserializeSsrcGroup(t);n.ssrcGroups.push(p)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.sourceKey===void 0&&(n.sourceKey=""),n.media===void 0&&(n.media=[]),n.ssrcGroups===void 0&&(n.ssrcGroups=[]),n}function ht(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.mediaStatus={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=t.readBool();n.mediaStatus[c]=d}}else t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatusEx=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.mediaStatus===void 0&&(n.mediaStatus={}),n}function yt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.candidateSdpString=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I64?n.sdpMLineIndex=t.readI64().toString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpMid=t.readString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRUCT?n.candidateSdpThrift=o("WebrtcSdpSerializers").deserializeIceCandidateSdp(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.sdpMLineIndex===void 0&&(n.sdpMLineIndex="0"),n.sdpMid===void 0&&(n.sdpMid=""),n}function Ct(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=o("StateSyncSerializers").deserializeState(t);n.stateStore[c]=d}}else t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStoreV2={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()),f=o("StateSyncSerializers").deserializeState(t);_!=null&&(n.stateStoreV2[_]=f)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.stateStore===void 0&&(n.stateStore={}),n.stateStoreV2===void 0&&(n.stateStoreV2={}),n}function bt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.version===void 0&&(n.version=0),n}function vt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.encryptedTopic=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.encryptedData=t.readBinary():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.senderId=t.readBinary():t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).SET){n.targetIds=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=o("Utf8ToString").Utf8ToString(t.readBinary());n.targetIds.add(c)}}else t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.messageType=o("MultiwayCommonTypes").E2eeDataMessageType.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.encryptedTopic===void 0&&(n.encryptedTopic=""),n.encryptedData===void 0&&(n.encryptedData=Uint8Array.of()),n.senderId===void 0&&(n.senderId=Uint8Array.of()),n.messageType===void 0&&(n.messageType=o("MultiwayCommonTypes").E2eeDataMessageType.cast(0)),n}function St(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I64?n.fromVersion=t.readI64().toString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.toVersion=t.readI64().toString():t.skip(a);break;case 3:if(a===(e||(e=r("ThriftTypes"))).LIST){n.mediaUpdates=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=ht(t);n.mediaUpdates.push(u)}}else t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRUCT?n.offer=pt(t):t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.fromVersion===void 0&&(n.fromVersion="0"),n.toVersion===void 0&&(n.toVersion="0"),n.mediaUpdates===void 0&&(n.mediaUpdates=[]),n}function Rt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I64?n.currentVersion=t.readI64().toString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatus=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRUCT?n.renegotiationOffer=pt(t):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 7:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=o("StateSyncSerializers").deserializeState(t);n.stateStore[c]=d}}else t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStoreV2={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()),f=o("StateSyncSerializers").deserializeState(t);_!=null&&(n.stateStoreV2[_]=f)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.currentVersion===void 0&&(n.currentVersion="0"),n.mediaPath===void 0&&(n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(0)),n}function Lt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.callerUserId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.calleeUserId=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.sessionId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.callerUserId===void 0&&(n.callerUserId=""),n.calleeUserId===void 0&&(n.calleeUserId=""),n.sessionId===void 0&&(n.sessionId=""),n}function Et(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I64?n.fromVersion=t.readI64().toString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I64?n.toVersion=t.readI64().toString():t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).LIST){n.mediaUpdates=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=gt(t);n.mediaUpdates.push(c)}}else t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRUCT?n.offer=pt(t):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatus=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).BOOL?n.renegotiationRequested=t.readBool():t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).STRUCT?n.prAnswer=pt(t):t.skip(i);break;case 10:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var d=t.readMapBegin(),m=0;m<d.size;m++){var p=t.readString(),_=o("StateSyncSerializers").deserializeState(t);n.stateStore[p]=_}}else t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).STRUCT?n.multipleRelaysParameters=Lt(t):t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).BOOL?n.multipleVideoStreamsAllowed=t.readBool():t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).STRUCT?n.renegotiationOffer=pt(t):t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).I32?n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 16:i===(e||(e=r("ThriftTypes"))).STRUCT?n.update=_t(t):t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).BOOL?n.screenShareStreamAllowed=t.readBool():t.skip(i);break;case 18:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStoreV2={};for(var f=t.readMapBegin(),g=0;g<f.size;g++){var h=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()),y=o("StateSyncSerializers").deserializeState(t);h!=null&&(n.stateStoreV2[h]=y)}}else t.skip(i);break;case 19:if(i===(e||(e=r("ThriftTypes"))).SET){n.allowedCustomVideoContentTypes=new Set;for(var C=t.readSetBegin(),b=0;b<C.size;b++){var v=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32());n.allowedCustomVideoContentTypes.add(v)}}else t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).STRUCT?n.relayInfo=o("MultiwaySharedSerializers").deserializeRelayInfo(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.fromVersion===void 0&&(n.fromVersion="0"),n.toVersion===void 0&&(n.toVersion="0"),n.mediaUpdates===void 0&&(n.mediaUpdates=[]),n.renegotiationRequested===void 0&&(n.renegotiationRequested=!1),n.multipleVideoStreamsAllowed===void 0&&(n.multipleVideoStreamsAllowed=!1),n.mediaPath===void 0&&(n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(0)),n.screenShareStreamAllowed===void 0&&(n.screenShareStreamAllowed=!1),n}function kt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I64?n.currentVersion=t.readI64().toString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatus=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.currentVersion===void 0&&(n.currentVersion="0"),n}function It(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;t.skip(a),t.readFieldEnd()}return t.readStructEnd(),n}function Tt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.reason=o("MultiwayCommonTypes").HangupReason.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.detailedReasonString=t.readString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.reason===void 0&&(n.reason=o("MultiwayCommonTypes").HangupReason.cast(0)),n.detailedReasonString===void 0&&(n.detailedReasonString=""),n}function Dt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).LIST){n.iceCandidateSdps=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=yt(t);n.iceCandidateSdps.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.iceCandidateSdps===void 0&&(n.iceCandidateSdps=[]),n}function xt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.reason=o("MultiwayCommonTypes").DismissReason.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.detailedReasonString=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I64?n.callabilityResultErrorCode=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.reason===void 0&&(n.reason=o("MultiwayCommonTypes").DismissReason.cast(0)),n.detailedReasonString===void 0&&(n.detailedReasonString=""),n}function $t(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.joinMode=o("MultiwayCommonTypes").JoinMode.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.joinMode===void 0&&(n.joinMode=o("MultiwayCommonTypes").JoinMode.cast(0)),n}function Pt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.state=o("MultiwayCommonTypes").ParticipantCallState.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.userCapabilities=t.readBinary():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I64?n.sctpNodeId=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.state===void 0&&(n.state=o("MultiwayCommonTypes").ParticipantCallState.cast(0)),n}function Nt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userCountry=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function Mt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.name=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.profilePictureUri=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.aliasId=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.thirdPartyId=t.readString():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRING?n.groupId=t.readString():t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).STRING?n.avatarImageUri=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function wt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.callerInfo=Mt(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.liveBroadcastId=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.callingTags=t.readI32():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.backingIdentifier=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function At(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I64?n.version=t.readI64().toString():t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).MAP){n.participantStates={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=Pt(t);n.participantStates[c]=d}}else t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).MAP){n.userProfiles={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=t.readString(),f=Mt(t);n.userProfiles[_]=f}}else t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var g=t.readListBegin(),h=0;h<g.size;h++){var y=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(y)}}else t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).LIST){n.groupsOfUsers=[];for(var C=t.readListBegin(),b=0;b<C.size;b++){var v=pn(t);n.groupsOfUsers.push(v)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.version===void 0&&(n.version="0"),n.participantStates===void 0&&(n.participantStates={}),n.groupsOfUsers===void 0&&(n.groupsOfUsers=[]),n}function Ft(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I64?n.currentVersion=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.currentVersion===void 0&&(n.currentVersion="0"),n}function Ot(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).LIST){n.subscriptions=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=o("MultiwaySharedSerializers").deserializeSubscription(t);n.subscriptions.push(c)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.subscriptions===void 0&&(n.subscriptions=[]),n}function Bt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.message=o("DataMessageSerializers").deserializeDataMessage(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.message===void 0&&(n.message=o("DataMessageSerializers").DataMessage$DefaultConstructor()),n}function Wt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.deliveryResult={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=o("DataMessageTypes").DataMessageStatusCode.cast(t.readI32());n.deliveryResult[c]=d}}else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).MAP){n.serviceTypeDeliveryResult={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("MultiwaySharedTypes").EndpointServiceType.cast(t.readI32()),f=o("DataMessageTypes").DataMessageStatusCode.cast(t.readI32());_!=null&&(n.serviceTypeDeliveryResult[_]=f)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.deliveryResult===void 0&&(n.deliveryResult={}),n}function qt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).SET){n.usersToInvite=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=t.readString();n.usersToInvite.add(c)}}else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(p)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.usersToInvite===void 0&&(n.usersToInvite=new Set),n}function Ut(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.smcTier=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.region=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).BOOL?n.isUsfu=t.readBool():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).BOOL?n.isEdge=t.readBool():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.smcTier===void 0&&(n.smcTier=""),n.region===void 0&&(n.region=""),n.isUsfu===void 0&&(n.isUsfu=!1),n.isEdge===void 0&&(n.isEdge=!1),n}function Vt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.offer=pt(t):t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).SET){n.deviceCapabilities=new Set;for(var s=t.readSetBegin(),c=0;c<s.size;c++){var d=o("MultiwayCommonTypes").Capability.cast(t.readI32());n.deviceCapabilities.add(d)}}else t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).SET){n.usersToCall=new Set;for(var m=t.readSetBegin(),p=0;p<m.size;p++){var _=t.readString();n.usersToCall.add(_)}}else t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).MAP){n.mediaStatus={};for(var f=t.readMapBegin(),g=0;g<f.size;g++){var h=t.readString(),y=t.readBool();n.mediaStatus[h]=y}}else t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.userCapabilities=t.readBinary():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRING?n.supportedExperiments=t.readString():t.skip(i);break;case 9:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var C=t.readListBegin(),b=0;b<C.size;b++){var v=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(v)}}else t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRING?n.userToEscalate=t.readString():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).I64?n.escalatingCallId=t.readI64().toString():t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).I32?n.conferenceType=o("MultiwaySharedTypes").ConferenceType.cast(t.readI32()):t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatusEx=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).STRUCT?n.syncPayload=Ct(t):t.skip(i);break;case 16:if(i===(e||(e=r("ThriftTypes"))).SET){n.usersToApproveFromWaitingRoom=new Set;for(var S=t.readSetBegin(),R=0;R<S.size;R++){var L=t.readString();n.usersToApproveFromWaitingRoom.add(L)}}else t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).STRUCT?n.e2eeEnforcement=o("MultiwaySharedSerializers").deserializeE2eeEnforcement(t):t.skip(i);break;case 18:i===(e||(e=r("ThriftTypes"))).STRUCT?n.sfuAllocation=Ut(t):t.skip(i);break;case 19:i===(e||(e=r("ThriftTypes"))).I32?n.clientMediaMode=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).STRUCT?n.endpointSettings=$t(t):t.skip(i);break;case 21:i===(e||(e=r("ThriftTypes"))).STRUCT?n.backupSfuAllocation=Ut(t):t.skip(i);break;case 22:if(i===(e||(e=r("ThriftTypes"))).SET){n.supportedCustomVideoContentTypes=new Set;for(var E=t.readSetBegin(),k=0;k<E.size;k++){var I=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32());n.supportedCustomVideoContentTypes.add(I)}}else t.skip(i);break;case 23:i===(e||(e=r("ThriftTypes"))).I32?n.configIntegrityOpaqueToken=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.offer===void 0&&(n.offer=u()),n.deviceCapabilities===void 0&&(n.deviceCapabilities=new Set),n}function Ht(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).MAP){n.mediaStatus={};for(var s=t.readMapBegin(),c=0;c<s.size;c++){var d=t.readString(),m=t.readBool();n.mediaStatus[d]=m}}else t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.initiator=t.readString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.negotiatedExperiments=t.readString():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatusEx=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 7:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var p=t.readListBegin(),_=0;_<p.size;_++){var f=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(f)}}else t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var g=t.readMapBegin(),h=0;h<g.size;h++){var y=t.readString(),C=o("StateSyncSerializers").deserializeState(t);n.stateStore[y]=C}}else t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).BOOL?n.isPendingApproval=t.readBool():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).STRUCT?n.renegotiationOffer=pt(t):t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).BOOL?n.multipleVideoStreamsAllowed=t.readBool():t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).I32?n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 14:if(i===(e||(e=r("ThriftTypes"))).LIST){n.groupsOfUsers=[];for(var b=t.readListBegin(),v=0;v<b.size;v++){var S=pn(t);n.groupsOfUsers.push(S)}}else t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).BOOL?n.screenShareStreamAllowed=t.readBool():t.skip(i);break;case 16:i===(e||(e=r("ThriftTypes"))).STRUCT?n.relayInfo=o("MultiwaySharedSerializers").deserializeRelayInfo(t):t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).I64?n.selfSctpNodeId=t.readI64().toString():t.skip(i);break;case 18:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStoreV2={};for(var R=t.readMapBegin(),L=0;L<R.size;L++){var E=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()),k=o("StateSyncSerializers").deserializeState(t);E!=null&&(n.stateStoreV2[E]=k)}}else t.skip(i);break;case 19:if(i===(e||(e=r("ThriftTypes"))).SET){n.allowedCustomVideoContentTypes=new Set;for(var I=t.readSetBegin(),T=0;T<I.size;T++){var D=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32());n.allowedCustomVideoContentTypes.add(D)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.answer===void 0&&(n.answer=u()),n.mediaStatus===void 0&&(n.mediaStatus={}),n.initiator===void 0&&(n.initiator=""),n.isPendingApproval===void 0&&(n.isPendingApproval=!1),n.multipleVideoStreamsAllowed===void 0&&(n.multipleVideoStreamsAllowed=!1),n.mediaPath===void 0&&(n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(0)),n.groupsOfUsers===void 0&&(n.groupsOfUsers=[]),n.screenShareStreamAllowed===void 0&&(n.screenShareStreamAllowed=!1),n}function Gt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.sdp=pt(t):t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).SET){n.deviceCapabilities=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=o("MultiwayCommonTypes").Capability.cast(t.readI32());n.deviceCapabilities.add(c)}}else t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).SET){n.supportedCustomVideoContentTypes=new Set;for(var d=t.readSetBegin(),m=0;m<d.size;m++){var p=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32());n.supportedCustomVideoContentTypes.add(p)}}else t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRUCT?n.prOffer=pt(t):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRUCT?n.e2eeEnforcement=o("MultiwaySharedSerializers").deserializeE2eeEnforcement(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.deviceCapabilities===void 0&&(n.deviceCapabilities=new Set),n}function zt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.sdp=pt(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function jt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.type=o("MultiwayCommonTypes").ClientEventType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I64?n.time=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.type===void 0&&(n.type=o("MultiwayCommonTypes").ClientEventType.cast(0)),n}function Kt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).LIST){n.clientEvents=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=jt(t);n.clientEvents.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.clientEvents===void 0&&(n.clientEvents=[]),n}function Qt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.groupThreadId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.peerId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function Xt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;t.skip(a),t.readFieldEnd()}return t.readStructEnd(),n}function Yt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.caller=t.readString():t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).SET){n.otherParticipants=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=t.readString();n.otherParticipants.add(c)}}else t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.ringType=o("MultiwayCommonTypes").RingType.cast(t.readI32()):t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.offeredExperiments=t.readString():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).BOOL?n.isScheduledCall=t.readBool():t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(p)}}else t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRUCT?n.offer=pt(t):t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatusEx=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).BOOL?n.isPreconnectSupported=t.readBool():t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).STRUCT?n.unifiedOffer=pt(t):t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).I32?n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 16:i===(e||(e=r("ThriftTypes"))).STRUCT?n.e2eeEnforcement=o("MultiwaySharedSerializers").deserializeE2eeEnforcement(t):t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).BOOL?n.isLegacyCall=t.readBool():t.skip(i);break;case 18:i===(e||(e=r("ThriftTypes"))).BOOL?n.isTransferCall=t.readBool():t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).STRUCT?n.relayInfo=o("MultiwaySharedSerializers").deserializeRelayInfo(t):t.skip(i);break;case 21:if(i===(e||(e=r("ThriftTypes"))).MAP){n.overlayConfigs={};for(var _=t.readMapBegin(),f=0;f<_.size;f++){var g=t.readI32(),h=t.readI32();n.overlayConfigs[g]=h}}else t.skip(i);break;case 22:i===(e||(e=r("ThriftTypes"))).STRUCT?n.productMetadata=wt(t):t.skip(i);break;case 23:i===(e||(e=r("ThriftTypes"))).STRING?n.callerClientSessionId=t.readString():t.skip(i);break;case 24:i===(e||(e=r("ThriftTypes"))).STRUCT?n.threadIdInfo=Qt(t):t.skip(i);break;case 25:i===(e||(e=r("ThriftTypes"))).STRING?n.linkUrl=t.readString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.caller===void 0&&(n.caller=""),n.otherParticipants===void 0&&(n.otherParticipants=new Set),n.ringType===void 0&&(n.ringType=o("MultiwayCommonTypes").RingType.cast(0)),n.mediaPath===void 0&&(n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(0)),n.isTransferCall===void 0&&(n.isTransferCall=!1),n}function Jt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 2:i===(e||(e=r("ThriftTypes"))).I32?n.deviceStatus=o("MultiwayCommonTypes").DeviceStatus.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.deviceStatus===void 0&&(n.deviceStatus=o("MultiwayCommonTypes").DeviceStatus.cast(0)),n}function Zt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).SET){n.usersToRemove=new Set;for(var l=t.readSetBegin(),s=0;s<l.size;s++){var u=t.readString();n.usersToRemove.add(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.usersToRemove===void 0&&(n.usersToRemove=new Set),n}function en(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n.topicId===void 0&&(n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(0)),n}function tn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n}function nn(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.syncPayload=Ct(t):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.data=t.readBinary():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.syncPayload===void 0&&(n.syncPayload=f()),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n.topicId===void 0&&(n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(0)),n}function rn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n}function on(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.data=t.readBinary():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRUCT?n.syncPayload=Ct(t):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n.data===void 0&&(n.data=Uint8Array.of()),n}function an(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n}function ln(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 2:i===(e||(e=r("ThriftTypes"))).I32?n.approvalStatus=o("MultiwayCommonTypes").ApprovalStatus.cast(t.readI32()):t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).SET){n.targetUsers=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=t.readString();n.targetUsers.add(c)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.approvalStatus===void 0&&(n.approvalStatus=o("MultiwayCommonTypes").ApprovalStatus.cast(0)),n.targetUsers===void 0&&(n.targetUsers=new Set),n}function sn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.id=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.id===void 0&&(n.id=""),n}function un(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.actorId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.baseId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.actorId===void 0&&(n.actorId=""),n.baseId===void 0&&(n.baseId=""),n}function cn(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.type=o("MultiwayCommonTypes").MessageType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.conferenceName=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.transactionId=t.readString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I16?n.retryCount=t.readI16():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.serverInfoData=t.readString():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.responseStatusCode=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(t.readI32()):t.skip(i);break;case 7:if(i===(e||(e=r("ThriftTypes"))).MAP){n.extensions={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=t.readString();n.extensions[c]=d}}else t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).I64?n.sequenceNumber=t.readI64().toString():t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).STRING?n.clientSessionId=t.readString():t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRING?n.responseStatusMessage=t.readString():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).I32?n.responseSubCode=o("MultiwayCommonTypes").RtcResponseSubCode.cast(t.readI32()):t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).STRING?n.collisionKey=t.readString():t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).I32?n.conferenceType=o("MultiwaySharedTypes").ConferenceType.cast(t.readI32()):t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).STRING?n.serverSessionId=t.readString():t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).STRING?n.rtcHandle=t.readString():t.skip(i);break;case 16:i===(e||(e=r("ThriftTypes"))).I32?n.retryAfterMsec=t.readI32():t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).STRING?n.receiverUserId=t.readString():t.skip(i);break;case 18:i===(e||(e=r("ThriftTypes"))).I32?n.clientStack=o("WebrtcSignalingCommonTypes").ClientStack.cast(t.readI32()):t.skip(i);break;case 19:i===(e||(e=r("ThriftTypes"))).I64?n.serverMsgTime=t.readI64().toString():t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).STRUCT?n.sender=sn(t):t.skip(i);break;case 21:i===(e||(e=r("ThriftTypes"))).STRUCT?n.receiver=un(t):t.skip(i);break;case 22:if(i===(e||(e=r("ThriftTypes"))).SET){n.messageTags=new Set;for(var m=t.readSetBegin(),p=0;p<m.size;p++){var _=o("MultiwayCommonTypes").MessageTag.cast(t.readI32());n.messageTags.add(_)}}else t.skip(i);break;case 23:i===(e||(e=r("ThriftTypes"))).I64?n.conferenceId=t.readI64().toString():t.skip(i);break;case 24:i===(e||(e=r("ThriftTypes"))).I32?n.protocolVersion=t.readI32():t.skip(i);break;case 25:i===(e||(e=r("ThriftTypes"))).I64?n.bodyCompressionVersion=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.type===void 0&&(n.type=o("MultiwayCommonTypes").MessageType.cast(0)),n.conferenceName===void 0&&(n.conferenceName=""),n.transactionId===void 0&&(n.transactionId=""),n.retryCount===void 0&&(n.retryCount=0),n}function dn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.joinRequest=Vt(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRUCT?n.joinResponse=Ht(t):t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRUCT?n.serverMediaUpdateRequest=Et(t):t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRUCT?n.serverMediaUpdateResponse=kt(t):t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRUCT?n.hangupRequest=Tt(t):t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).STRUCT?n.iceCandidateRequest=Dt(t):t.skip(a);break;case 8:a===(e||(e=r("ThriftTypes"))).STRUCT?n.ringRequest=Yt(t):t.skip(a);break;case 9:a===(e||(e=r("ThriftTypes"))).STRUCT?n.ringResponse=Jt(t):t.skip(a);break;case 10:a===(e||(e=r("ThriftTypes"))).STRUCT?n.dismissRequest=xt(t):t.skip(a);break;case 11:a===(e||(e=r("ThriftTypes"))).STRUCT?n.conferenceStateRequest=At(t):t.skip(a);break;case 12:a===(e||(e=r("ThriftTypes"))).STRUCT?n.conferenceStateResponse=Ft(t):t.skip(a);break;case 13:a===(e||(e=r("ThriftTypes"))).STRUCT?n.addParticipantsRequest=qt(t):t.skip(a);break;case 14:a===(e||(e=r("ThriftTypes"))).STRUCT?n.subscriptionRequest=Ot(t):t.skip(a);break;case 15:a===(e||(e=r("ThriftTypes"))).STRUCT?n.clientMediaUpdateRequest=St(t):t.skip(a);break;case 16:a===(e||(e=r("ThriftTypes"))).STRUCT?n.clientMediaUpdateResponse=Rt(t):t.skip(a);break;case 17:a===(e||(e=r("ThriftTypes"))).STRUCT?n.dataMessageRequest=Bt(t):t.skip(a);break;case 18:a===(e||(e=r("ThriftTypes"))).STRUCT?n.removeParticipantsRequest=Zt(t):t.skip(a);break;case 19:a===(e||(e=r("ThriftTypes"))).STRUCT?n.dataMessageResponse=Wt(t):t.skip(a);break;case 30:a===(e||(e=r("ThriftTypes"))).STRUCT?n.updateRequest=nn(t):t.skip(a);break;case 31:a===(e||(e=r("ThriftTypes"))).STRUCT?n.updateResponse=rn(t):t.skip(a);break;case 32:a===(e||(e=r("ThriftTypes"))).STRUCT?n.notifyRequest=on(t):t.skip(a);break;case 33:a===(e||(e=r("ThriftTypes"))).STRUCT?n.notifyResponse=an(t):t.skip(a);break;case 34:a===(e||(e=r("ThriftTypes"))).STRUCT?n.connectRequest=Gt(t):t.skip(a);break;case 35:a===(e||(e=r("ThriftTypes"))).STRUCT?n.connectResponse=zt(t):t.skip(a);break;case 36:a===(e||(e=r("ThriftTypes"))).STRUCT?n.clientEventRequest=Kt(t):t.skip(a);break;case 37:a===(e||(e=r("ThriftTypes"))).STRUCT?n.clientEventResponse=Xt(t):t.skip(a);break;case 40:a===(e||(e=r("ThriftTypes"))).STRUCT?n.unsubscribeRequest=en(t):t.skip(a);break;case 41:a===(e||(e=r("ThriftTypes"))).STRUCT?n.unsubscribeResponse=tn(t):t.skip(a);break;case 42:a===(e||(e=r("ThriftTypes"))).STRUCT?n.approvalRequest=ln(t):t.skip(a);break;case 43:a===(e||(e=r("ThriftTypes"))).STRUCT?n.transferRequest=It(t):t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function mn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.messageHeader=cn(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRUCT?n.messageBody=dn(t):t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.messageHeader===void 0&&(n.messageHeader=ae()),n.messageBody===void 0&&(n.messageBody=ie()),n}function pn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).SET){n.users=new Set;for(var l=t.readSetBegin(),s=0;s<l.size;s++){var u=t.readString();n.users.add(u)}}else t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).BOOL?n.allowMultipleJoins=t.readBool():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).BOOL?n.dismissOthersOnFirstJoin=t.readBool():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.aliasId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.users===void 0&&(n.users=new Set),n.allowMultipleJoins===void 0&&(n.allowMultipleJoins=!1),n.dismissOthersOnFirstJoin===void 0&&(n.dismissOthersOnFirstJoin=!1),n.aliasId===void 0&&(n.aliasId=""),n}function _n(t){var n,o={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.joinRequest=Vt(t),n="joinRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: joinRequest, previous deserialized field: "+n);else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.joinResponse=Ht(t),n="joinResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: joinResponse, previous deserialized field: "+n);else t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.serverMediaUpdateRequest=Et(t),n="serverMediaUpdateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: serverMediaUpdateRequest, previous deserialized field: "+n);else t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.serverMediaUpdateResponse=kt(t),n="serverMediaUpdateResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: serverMediaUpdateResponse, previous deserialized field: "+n);else t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.hangupRequest=Tt(t),n="hangupRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: hangupRequest, previous deserialized field: "+n);else t.skip(i);break;case 6:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.iceCandidateRequest=Dt(t),n="iceCandidateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: iceCandidateRequest, previous deserialized field: "+n);else t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.ringRequest=Yt(t),n="ringRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: ringRequest, previous deserialized field: "+n);else t.skip(i);break;case 9:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.ringResponse=Jt(t),n="ringResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: ringResponse, previous deserialized field: "+n);else t.skip(i);break;case 10:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.dismissRequest=xt(t),n="dismissRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: dismissRequest, previous deserialized field: "+n);else t.skip(i);break;case 11:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.conferenceStateRequest=At(t),n="conferenceStateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: conferenceStateRequest, previous deserialized field: "+n);else t.skip(i);break;case 12:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.conferenceStateResponse=Ft(t),n="conferenceStateResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: conferenceStateResponse, previous deserialized field: "+n);else t.skip(i);break;case 13:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.addParticipantsRequest=qt(t),n="addParticipantsRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: addParticipantsRequest, previous deserialized field: "+n);else t.skip(i);break;case 14:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.subscriptionRequest=Ot(t),n="subscriptionRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: subscriptionRequest, previous deserialized field: "+n);else t.skip(i);break;case 15:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.clientMediaUpdateRequest=St(t),n="clientMediaUpdateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: clientMediaUpdateRequest, previous deserialized field: "+n);else t.skip(i);break;case 16:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.clientMediaUpdateResponse=Rt(t),n="clientMediaUpdateResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: clientMediaUpdateResponse, previous deserialized field: "+n);else t.skip(i);break;case 17:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.dataMessageRequest=Bt(t),n="dataMessageRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: dataMessageRequest, previous deserialized field: "+n);else t.skip(i);break;case 18:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.removeParticipantsRequest=Zt(t),n="removeParticipantsRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: removeParticipantsRequest, previous deserialized field: "+n);else t.skip(i);break;case 19:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.dataMessageResponse=Wt(t),n="dataMessageResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: dataMessageResponse, previous deserialized field: "+n);else t.skip(i);break;case 30:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.updateRequest=nn(t),n="updateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: updateRequest, previous deserialized field: "+n);else t.skip(i);break;case 31:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.updateResponse=rn(t),n="updateResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: updateResponse, previous deserialized field: "+n);else t.skip(i);break;case 32:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.notifyRequest=on(t),n="notifyRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: notifyRequest, previous deserialized field: "+n);else t.skip(i);break;case 33:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.notifyResponse=an(t),n="notifyResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: notifyResponse, previous deserialized field: "+n);else t.skip(i);break;case 34:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.connectRequest=Gt(t),n="connectRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: connectRequest, previous deserialized field: "+n);else t.skip(i);break;case 35:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.connectResponse=zt(t),n="connectResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: connectResponse, previous deserialized field: "+n);else t.skip(i);break;case 36:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.clientEventRequest=Kt(t),n="clientEventRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: clientEventRequest, previous deserialized field: "+n);else t.skip(i);break;case 37:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.clientEventResponse=Xt(t),n="clientEventResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: clientEventResponse, previous deserialized field: "+n);else t.skip(i);break;case 40:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.unsubscribeRequest=en(t),n="unsubscribeRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: unsubscribeRequest, previous deserialized field: "+n);else t.skip(i);break;case 41:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.unsubscribeResponse=tn(t),n="unsubscribeResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: unsubscribeResponse, previous deserialized field: "+n);else t.skip(i);break;case 42:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.approvalRequest=ln(t),n="approvalRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: approvalRequest, previous deserialized field: "+n);else t.skip(i);break;case 43:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.transferRequest=It(t),n="transferRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: transferRequest, previous deserialized field: "+n);else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),o}l.RtcException$DefaultConstructor=s,l.SessionDescription$DefaultConstructor=u,l.SessionDescriptionUpdate$DefaultConstructor=c,l.MediaDescriptionUpdate$DefaultConstructor=d,l.ServerMediaUpdate$DefaultConstructor=m,l.ClientMediaUpdate$DefaultConstructor=p,l.IceCandidate$DefaultConstructor=_,l.SyncPayload$DefaultConstructor=f,l.SyncAck$DefaultConstructor=g,l.E2eeData$DefaultConstructor=h,l.ClientMediaUpdateRequest$DefaultConstructor=y,l.ClientMediaUpdateResponse$DefaultConstructor=C,l.MultipleRelaysAllocationParameters$DefaultConstructor=b,l.ServerMediaUpdateRequest$DefaultConstructor=v,l.ServerMediaUpdateResponse$DefaultConstructor=S,l.TransferRequest$DefaultConstructor=R,l.HangupRequest$DefaultConstructor=L,l.IceCandidateRequest$DefaultConstructor=E,l.DismissRequest$DefaultConstructor=k,l.EndpointSettings$DefaultConstructor=I,l.ParticipantState$DefaultConstructor=T,l.ServerOnlyParticipantState$DefaultConstructor=D,l.UserProfile$DefaultConstructor=x,l.ProductMetadata$DefaultConstructor=$,l.ConferenceStateRequest$DefaultConstructor=P,l.ConferenceStateResponse$DefaultConstructor=N,l.SubscriptionRequest$DefaultConstructor=M,l.DataMessageRequest$DefaultConstructor=w,l.DataMessageResponse$DefaultConstructor=A,l.AddParticipantsRequest$DefaultConstructor=F,l.SfuAllocation$DefaultConstructor=O,l.JoinRequest$DefaultConstructor=B,l.JoinResponse$DefaultConstructor=W,l.ConnectRequest$DefaultConstructor=q,l.ConnectResponse$DefaultConstructor=U,l.ClientEvent$DefaultConstructor=V,l.ClientEventRequest$DefaultConstructor=H,l.ThreadIdInfo$DefaultConstructor=G,l.ClientEventResponse$DefaultConstructor=z,l.RingRequest$DefaultConstructor=j,l.RingResponse$DefaultConstructor=K,l.RemoveParticipantsRequest$DefaultConstructor=Q,l.UnsubscribeRequest$DefaultConstructor=X,l.UnsubscribeResponse$DefaultConstructor=Y,l.UpdateRequest$DefaultConstructor=J,l.UpdateResponse$DefaultConstructor=Z,l.NotifyRequest$DefaultConstructor=ee,l.NotifyResponse$DefaultConstructor=te,l.ApprovalRequest$DefaultConstructor=ne,l.RtcSender$DefaultConstructor=re,l.RtcReceiver$DefaultConstructor=oe,l.RtcMessageHeader$DefaultConstructor=ae,l.RtcMessageBody$DefaultConstructor=ie,l.RtcMultiwayMessage$DefaultConstructor=le,l.GroupOfUsers$DefaultConstructor=se,l.RtcMessageBodyVariant$DefaultConstructor=ue,l.serializeRtcException=ce,l.serializeSessionDescription=de,l.serializeSessionDescriptionUpdate=me,l.serializeMediaDescriptionUpdate=pe,l.serializeServerMediaUpdate=_e,l.serializeClientMediaUpdate=fe,l.serializeIceCandidate=ge,l.serializeSyncPayload=he,l.serializeSyncAck=ye,l.serializeE2eeData=Ce,l.serializeClientMediaUpdateRequest=be,l.serializeClientMediaUpdateResponse=ve,l.serializeMultipleRelaysAllocationParameters=Se,l.serializeServerMediaUpdateRequest=Re,l.serializeServerMediaUpdateResponse=Le,l.serializeTransferRequest=Ee,l.serializeHangupRequest=ke,l.serializeIceCandidateRequest=Ie,l.serializeDismissRequest=Te,l.serializeEndpointSettings=De,l.serializeParticipantState=xe,l.serializeServerOnlyParticipantState=$e,l.serializeUserProfile=Pe,l.serializeProductMetadata=Ne,l.serializeConferenceStateRequest=Me,l.serializeConferenceStateResponse=we,l.serializeSubscriptionRequest=Ae,l.serializeDataMessageRequest=Fe,l.serializeDataMessageResponse=Oe,l.serializeAddParticipantsRequest=Be,l.serializeSfuAllocation=We,l.serializeJoinRequest=qe,l.serializeJoinResponse=Ue,l.serializeConnectRequest=Ve,l.serializeConnectResponse=He,l.serializeClientEvent=Ge,l.serializeClientEventRequest=ze,l.serializeThreadIdInfo=je,l.serializeClientEventResponse=Ke,l.serializeRingRequest=Qe,l.serializeRingResponse=Xe,l.serializeRemoveParticipantsRequest=Ye,l.serializeUnsubscribeRequest=Je,l.serializeUnsubscribeResponse=Ze,l.serializeUpdateRequest=et,l.serializeUpdateResponse=tt,l.serializeNotifyRequest=nt,l.serializeNotifyResponse=rt,l.serializeApprovalRequest=ot,l.serializeRtcSender=at,l.serializeRtcReceiver=it,l.serializeRtcMessageHeader=lt,l.serializeRtcMessageBody=st,l.serializeRtcMultiwayMessage=ut,l.serializeGroupOfUsers=ct,l.serializeRtcMessageBodyVariant=dt,l.deserializeRtcException=mt,l.deserializeSessionDescription=pt,l.deserializeSessionDescriptionUpdate=_t,l.deserializeMediaDescriptionUpdate=ft,l.deserializeServerMediaUpdate=gt,l.deserializeClientMediaUpdate=ht,l.deserializeIceCandidate=yt,l.deserializeSyncPayload=Ct,l.deserializeSyncAck=bt,l.deserializeE2eeData=vt,l.deserializeClientMediaUpdateRequest=St,l.deserializeClientMediaUpdateResponse=Rt,l.deserializeMultipleRelaysAllocationParameters=Lt,l.deserializeServerMediaUpdateRequest=Et,l.deserializeServerMediaUpdateResponse=kt,l.deserializeTransferRequest=It,l.deserializeHangupRequest=Tt,l.deserializeIceCandidateRequest=Dt,l.deserializeDismissRequest=xt,l.deserializeEndpointSettings=$t,l.deserializeParticipantState=Pt,l.deserializeServerOnlyParticipantState=Nt,l.deserializeUserProfile=Mt,l.deserializeProductMetadata=wt,l.deserializeConferenceStateRequest=At,l.deserializeConferenceStateResponse=Ft,l.deserializeSubscriptionRequest=Ot,l.deserializeDataMessageRequest=Bt,l.deserializeDataMessageResponse=Wt,l.deserializeAddParticipantsRequest=qt,l.deserializeSfuAllocation=Ut,l.deserializeJoinRequest=Vt,l.deserializeJoinResponse=Ht,l.deserializeConnectRequest=Gt,l.deserializeConnectResponse=zt,l.deserializeClientEvent=jt,l.deserializeClientEventRequest=Kt,l.deserializeThreadIdInfo=Qt,l.deserializeClientEventResponse=Xt,l.deserializeRingRequest=Yt,l.deserializeRingResponse=Jt,l.deserializeRemoveParticipantsRequest=Zt,l.deserializeUnsubscribeRequest=en,l.deserializeUnsubscribeResponse=tn,l.deserializeUpdateRequest=nn,l.deserializeUpdateResponse=rn,l.deserializeNotifyRequest=on,l.deserializeNotifyResponse=an,l.deserializeApprovalRequest=ln,l.deserializeRtcSender=sn,l.deserializeRtcReceiver=un,l.deserializeRtcMessageHeader=cn,l.deserializeRtcMessageBody=dn,l.deserializeRtcMultiwayMessage=mn,l.deserializeGroupOfUsers=pn,l.deserializeRtcMessageBodyVariant=_n}),98);
__d("OculusMqttChannel",["CurrentUser","HorizonMetaIsCastingRoute","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";r("HorizonMetaIsCastingRoute").getIsCastingRoute()?r("MqttEnvInitializer").initialize(function(e){return new WebSocket(e,"horizon_webcasting")}):r("MqttEnvInitializer").initialize();function e(e){o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn);var t=r("CurrentUser").getAppID()==null?0x9d143786e51a6:Number(r("CurrentUser").getAppID());return new(r("MqttChannel"))({appId:t,capabilities:r("MqttWebConfig").capabilities,chatVisibility:!0,clientCapabilities:r("MqttWebConfig").clientCapabilities,clientType:"websocket",deviceId:r("uuidv4")(),endpoint:r("MqttWebConfig").endpoint,initialSubscribedTopics:r("MqttWebConfig").subscribedTopics,phpOverride:r("MqttWebConfig").hostNameOverride,pollingEndpoint:r("MqttWebConfig").pollingEndpoint,userFbid:r("CurrentUser").getPossiblyNonFacebookUserID()})}var s=null;function u(t){return s==null&&(s=e(t)),s}function c(){return s}function d(){s!=null&&(s.shutdown(),s=null)}l.getOculusMqttChannelInstance=u,l.getOculusMqttChannelInstanceDoNotCreate=c,l.shutdownAndClear=d}),98);
__d("OverlayConfigConstants",[],(function(t,n,r,o,a,i){"use strict";var e={OverlayConfigNumParameters:5544,OverlayConfigNotPresentFlagValue:-1},l=e;i.default=l}),66);
__d("OverlayConfigLayerSource",[],(function(t,n,r,o,a,i){"use strict";var e=Object.freeze({UNKNOWN:0,DEFAULT:1,MOBILECONFIG:2,APP_CRUCIBLE:3,APP_JNI:4,UNITTEST_CONFIG:5,SERVER:6,PLACEHOLDER:7,LS_MOBILECONFIG:8,APP_LS:9,APP_JS:10,BROWSER:11,APP_OVRRTC:12,APP_IG:13,MLITE4A_LEGACY_QE:14,APP_MLITE4A:15,APP_PORTAL:16,IG_LAUNCHER:17,APP_ARCHON:18,APP_WS:19,APP_NOX:20,APP_WEARABLE_MSNGR:21,APP_WEARABLE_IG:22,APP_ORCA_RSYS:23,APP_WILDE:24,APP_MKIOS:25,APP_MK4A:26,DYNAMIC:27,SDK_DEFAULT:28,APP_FB4A:29,APP_RSYS_SDK_SAMPLE:30,APP_BIZAPP:31,APP_WORKCHAT:32,APP_ARCHON_LOCAL_OVERRIDES:33,APP_CATHODE:34,APP_WR4I:35,APP_WR4A:36,APP_METACAM:37,HORIZON_EMERGENCY:38,APP_SOCIALPLATFORM:39,APP_TWILIGHT:40,APP_AR_CALLING_LOCAL_OVERRIDES:41,APP_TWILIGHT_CASTING:42,TWILIGHT_EMERGENCY:43,METACAM_EMERGENCY:44,CALL_SCOPED:45,APP_CASE50:46,APP_GENERIC:47,HORIZON_EXPERIMENTAL:48}),l=e;i.default=l}),66);
__d("OverlayConfigServerLayer",["OverlayConfigConstants","OverlayConfigLayerSource"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e}e.createFromHeader=function(n){try{var t,r=n==null||(t=n.extensions)==null?void 0:t.oc1_json;if(r==null)return null;var o=JSON.parse(r),a=o==null?void 0:o.values;return a==null?null:new e(a)}catch(e){return null}};var t=e.prototype;return t.getLayerSource=function(){return r("OverlayConfigLayerSource").SERVER},t.getValue=function(t){var e=this.$1[String(t)];return e!=null?e:r("OverlayConfigConstants").OverlayConfigNotPresentFlagValue},t.logExposure=function(t){},e})();l.default=e}),98);
__d("RequestStreamBodyUtils",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){return u(atob(t))},l=function(t){return btoa(c(t))},s=function(t){var e=btoa(t),n=e.indexOf("=");return n===-1?e:e.substring(0,n)},u=function(t){for(var e=t,n=e.length,r=new Uint8Array(n),o=0;o<n;o++)r[o]=e.charCodeAt(o);return r},c=function(t){for(var e="",n=t.byteLength,r=0;r<n;r++)e+=String.fromCharCode(t[r]);return e};i.base64ToUint8Array=e,i.uint8ArrayToBase64=l,i.stringToBase64WithoutPadding=s,i.stringToUint8Array=u,i.uint8ArrayToString=c}),66);
__d("ZenonIceStatsParser",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=[],n=e.split("\r\n");return n.forEach(function(e){l(e)&&t.push({gen:s(e),type:u(e)})}),t}function l(e){return e.indexOf("candidate:")>-1}function s(e){var t=0,n=e.match(/generation (\d+)/);return n&&(t=parseInt(n[1],10)),t}function u(e){var t=e.match(/typ (host|relay|srflx|prflx)/);return t?t[1]:"unknown"}i.extractIceInfo=e}),66);
__d("ZenonMWThriftMessageMap",["MultiwayCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e==null)return"UNKNOWN";switch(e){case o("MultiwayCommonTypes").MessageType.JOIN:return"JOIN";case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:return"SERVER_MEDIA_UPDATE";case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:return"ICE_CANDIDATE";case o("MultiwayCommonTypes").MessageType.HANGUP:return"HANGUP";case o("MultiwayCommonTypes").MessageType.RING:return"RING";case o("MultiwayCommonTypes").MessageType.DISMISS:return"DISMISS";case o("MultiwayCommonTypes").MessageType.CONFERENCE_STATE:return"CONFERENCE_STATE";case o("MultiwayCommonTypes").MessageType.ADD_PARTICIPANTS:return"ADD_PARTICIPANTS";case o("MultiwayCommonTypes").MessageType.SUBSCRIPTION:return"SUBSCRIPTION";case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:return"CLIENT_MEDIA_UPDATE";case o("MultiwayCommonTypes").MessageType.DATA_MESSAGE:return"DATA_MESSAGE";case o("MultiwayCommonTypes").MessageType.REMOVE_PARTICIPANTS:return"REMOVE_PARTICIPANTS";case o("MultiwayCommonTypes").MessageType.PING:return"PING";case o("MultiwayCommonTypes").MessageType.NOTIFY:return"NOTIFY";case o("MultiwayCommonTypes").MessageType.CONNECT:return"CONNECT";case o("MultiwayCommonTypes").MessageType.CLIENT_EVENT:return"CLIENT_EVENT";case o("MultiwayCommonTypes").MessageType.UNSUBSCRIBE:return"UNSUBSCRIBE";case o("MultiwayCommonTypes").MessageType.UPDATE:return"UPDATE";case o("MultiwayCommonTypes").MessageType.APPROVAL:return"APPROVAL";case o("MultiwayCommonTypes").MessageType.WAKEUP:return"WAKEUP";default:return"UNKNOWN"}}function s(e){switch(e.toLowerCase()){case"join":return o("MultiwayCommonTypes").MessageType.JOIN;case"server_media_update":return o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE;case"ice_candidate":return o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE;case"hangup":return o("MultiwayCommonTypes").MessageType.HANGUP;case"ring":return o("MultiwayCommonTypes").MessageType.RING;case"dismiss":return o("MultiwayCommonTypes").MessageType.DISMISS;case"conference_state":return o("MultiwayCommonTypes").MessageType.CONFERENCE_STATE;case"add_participants":return o("MultiwayCommonTypes").MessageType.ADD_PARTICIPANTS;case"subscription":return o("MultiwayCommonTypes").MessageType.SUBSCRIPTION;case"client_media_update":return o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE;case"data_message":return o("MultiwayCommonTypes").MessageType.DATA_MESSAGE;case"remove_participants":return o("MultiwayCommonTypes").MessageType.REMOVE_PARTICIPANTS;case"ping":return o("MultiwayCommonTypes").MessageType.PING;case"notify":return o("MultiwayCommonTypes").MessageType.NOTIFY;case"connect":return o("MultiwayCommonTypes").MessageType.CONNECT;case"client_event":return o("MultiwayCommonTypes").MessageType.CLIENT_EVENT;case"unsubscribe":return o("MultiwayCommonTypes").MessageType.UNSUBSCRIBE;case"update":return o("MultiwayCommonTypes").MessageType.UPDATE;case"approval":return o("MultiwayCommonTypes").MessageType.APPROVAL;case"wakeup":return o("MultiwayCommonTypes").MessageType.WAKEUP;default:return null}}l.messageTypeToString=e,l.messageTypeFromString=s}),98);
__d("ZenonEndCallReason",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({BREAKOUT_SESSION_SWITCH_ROOM:"BreakoutSessionSwitchRoom",CALL_END_ACCEPT_AFTER_HANG_UP:"CallEndAcceptAfterHangUp",CALLER_HAS_APPEALABLE_CALLING_RESTRICTION:"CallerHasAppealableCallingRestriction",CALLER_NOT_VISIBLE:"CallerNotVisible",CAMERA_PERMISSION_DENIED:"CameraPermissionDenied",CARRIER_BLOCKED:"CarrierBlocked",CLIENT_ENCRYPTION_ERROR:"ClientEncryptionError",CLIENT_ERROR:"ClientError",CLIENT_INTERRUPTED:"ClientInterrupted",CONNECTION_DROPPED:"ConnectionDropped",END_TO_END_ENCRYPTION_INVARIANT_VIOLATED:"EndToEndEncryptionInvariantViolated",HANGUP_CALL:"HangupCall",IGNORE_CALL:"IgnoreCall",IN_ANOTHER_CALL:"InAnotherCall",INACTIVE_TIMEOUT:"InactiveTimeout",INCOMING_TIMEOUT:"IncomingTimeout",MAX_ALLOWED_PARTICIPANTS_REACHED:"MaxAllowedParticipantsReached",MICROPHONE_PERMISSION_DENIED:"MicrophonePermissionDenied",NO_ANSWER_TIMEOUT:"NoAnswerTimeout",NO_PERMISSION:"NoPermission",NO_UI_SHOWN:"NoUIShown",OTHER_CARRIER_BLOCKED:"OtherCarrierBlocked",OTHER_INSTANCE_HANDLED:"OtherInstanceHandled",OTHER_NOT_CAPABLE:"OtherNotCapable",PRODUCT_SERVER_DEFINED_END_REASON:"ProductServerDefinedEndReason",REMOVED_BY_PARTICIPANT:"RemovedByParticipant",RING_MUTED:"RingMuted",SESSION_MIGRATED:"SessionMigrated",SIGNALING_MESSAGE_FAILED:"SignalingMessageFailed",TX_ACK_TIMEOUT:"TxAckTimeout",UNEXPECTED_END_OF_CALL:"UnexpectedEndOfCall",UNKNOWN:"Unknown",VERSION_UNSUPPORTED:"VersionUnsupported",WEBRTC_ERROR:"WebRTCError"}),l=e;i.default=l}),66);
__d("ZenonIncomingRingSDKTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["Hangup","OtherDismiss"]);i.ZenonCancelReason=e}),66);
__d("fbwebrtc_ClientStack",[],(function(t,n,r,o,a,i){var e=Object.freeze({OLD_CLIENT_PLATFORM_STACK:0,RSYS_X:1,IG_OLD_STACK:2,MLITE_OLD_STACK:3,SCOTCH:4,ZENON:5});i.default=e}),66);
__d("multiway_ApprovalStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({DENIED:0,APPROVED:1});i.default=e}),66);
__d("multiway_Capability",[],(function(t,n,r,o,a,i){var e=Object.freeze({SUPPORT_AUDIO_DEPRECATED:0,SUPPORT_VIDEO_DEPRECATED:1,SUPPORT_EXPERIMENTS_IN_JOIN_RESPONSE:2,SUPPORT_NEW_PARTICIPANT_STATES:3,SUPPORT_SDP_RENEGOTIATION:4,SUPPORT_MWPP:5,REQUIRE_FULL_SDP_IN_SMU:6,SUPPORT_PRECONNECT:7,SUPPORT_MWPP_DEESCALATION:8,SUPPORT_PARTICIPANT_STATE_UNCALLABLE:9,SUPPORT_MULTIPLE_VIDEO_STREAMS:10,REQUIRE_FULL_SDP_IN_SMU_OPTIMIZED:11,SUPPORT_MULTISTREAM_FEC:12,SUPPORT_DELTA_SMU:13,REQUIRE_DEFAULT_CHANNEL_SCREENSHARE:14,SUPPORT_SCREENSHARE_FLAG_IN_JOIN_RESPONSE_AND_SMU:15,SUPPORT_TEMPORAL_LAYER_JBE:16,REQUIRES_P2P_RELAY_INFO_VIA_SIGNALING:17,SUPPORT_NUMERIC_TOPICS:18,SUPPORT_PSEUDO_QUIC_CONNECTION:19,SUPPORT_SDP_SENDRECV:20});i.default=e}),66);
__d("multiway_ClientEventType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,MEDIA_CONNECTED:1});i.default=e}),66);
__d("multiway_ConferenceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,IGVIDEOCALL:9,ROOM:15,CRUCIBLE:20,MBS_WA:21,BOT:22,HORIZON:23,ULLC:24});i.default=e}),66);
__d("multiway_DeviceStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10});i.default=e}),66);
__d("multiway_DismissReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({CALL_ENDED:0,ANSWERED_ON_ANOTHER_DEVICE:1,IN_ANOTHER_CALL:2,CONNECTION_DROPPED:3,REJECTED_ON_ANOTHER_DEVICE:4,REMOVED_BY_PARTICIPANT:5,REJECTED_BY_CALLEE:6,INTERNAL_ERROR:7,CALL_ENDED_BY_PRODUCT:9,JOIN_APPROVAL_DENIED:10,JOIN_APPROVAL_TIMEDOUT:11,UNSUPPORTED_VERSION:12,LIVE_NOT_ACKED:13,TX_ACK_TIMEDOUT:14,ANSWERED_BY_OTHER_USER:15,PARTICIPANT_SELF_TERMINATION:16,PARTICIPANT_REJOIN:17,LONG_LASTING_AUDIO_ISSUE:18,PRIMARY_ENDPOINT_HANGUP:19,RECONNECT_FAILED:20,E2EE_HARDENING_ERROR:21,CALL_ENDED_BY_EXTENSION:22,CALL_ENDED_BY_OVER_CAPACITY:23});i.default=e}),66);
__d("multiway_E2eeMode",[],(function(t,n,r,o,a,i){var e=Object.freeze({E2EE_NOT_MANDATED:0,DEPRECATED_NO_REQUIREMENT:1,E2EE_MANDATED:2,E2EE_BYPASSED_USER_CONSENTED:3});i.default=e}),66);
__d("multiway_EndpointServiceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,COMPOSITING_SERVICE:1,MEDIA_SERVER:2,CATHODE_AMBISONIC:3,CATHODE_CAPTIONS:4,CATHODE_MEETING_SUMMARIZER:5,CATHODE_REALTIME_SHARED_STATE:6,RP_GENAI_SERVICE:7,SMART_GLASSES_ASSISTANT:8});i.default=e}),66);
__d("multiway_HangupReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({IGNORE_CALL:0,HANGUP_CALL:1,NO_ANSWER_TIMEOUT:2,CLIENT_ERROR:3,IN_ANOTHER_CALL:4,CLIENT_INTERRUPTED:5,SESSION_MIGRATED:6,E2EE_MANDATED_BUT_OFFER_DID_NOT_CONTAIN_E2EE:7,E2EE_MANDATED_BUT_ANSWER_DID_NOT_NEGOTIATE_E2EE:8,WEBRTC_ERROR:9,CONNECTION_DROPPED:10});i.default=e}),66);
__d("multiway_JoinMode",[],(function(t,n,r,o,a,i){var e=Object.freeze({PRIMARY:0,SECONDARY:1});i.default=e}),66);
__d("multiway_MediaPath",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,SFU:1,P2P:2});i.default=e}),66);
__d("multiway_MediaPauseStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({NotPaused:0,Paused:1});i.default=e}),66);
__d("multiway_MessageTag",[],(function(t,n,r,o,a,i){var e=Object.freeze({PRANSWER:1001,INITIAL_ANSWER_TO_P2P_CALLER:1002,DEESCALATE_OFFER_TO_P2P_CALLEE:1003,DEESCALATE_ANSWER_TO_P2P_CALLER:1004,REQUEST_DEESCALATE_TO_P2P_CALLER:1005,REQUEST_ESCALATE:1006,REQUEST_CLIENT_FULL_RENEGOTIATION_TO_ADMIT_FROM_WAITINGROOM:1007,REQUEST_CLIENT_FULL_RENEGOTIATION_AGAINST_MWS:1008,PARTICIPANT_ADDED:1009,PARTICIPANT_REMOVED:1010,FIRST_REMOTE_ALERTED_FOR_INITIATOR:2001,FIRST_REMOTE_ANSWERED_FOR_INITIATOR:2002,CONTAIN_PENDING_APPROVAL_PARTICIPANTS:2003,KEEP_ALIVE_PING:3001,IS_INITIATOR:4001,PREGEN_SDP:4002});i.default=e}),66);
__d("multiway_MessageType",[],(function(t,n,r,o,a,i){var e=Object.freeze({JOIN:0,SERVER_MEDIA_UPDATE:1,HANGUP:2,ICE_CANDIDATE:3,RING:4,DISMISS:5,CONFERENCE_STATE:6,ADD_PARTICIPANTS:7,SUBSCRIPTION:8,CLIENT_MEDIA_UPDATE:9,DATA_MESSAGE:10,REMOVE_PARTICIPANTS:11,PING:18,UPDATE:20,NOTIFY:21,CONNECT:22,CLIENT_EVENT:23,UNSUBSCRIBE:25,APPROVAL:26,TRANSFER:27,WAKEUP:28});i.default=e}),66);
__d("multiway_ParticipantCallState",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,DISCONNECTED:1,NO_ANSWER:2,REJECTED:3,UNREACHABLE:4,CONNECTION_DROPPED:5,CONTACTING:6,RINGING:7,CONNECTING:8,CONNECTED:9,PARTICIPANT_LIMIT_REACHED:10,IN_ANOTHER_CALL:11,RING_TYPE_UNSUPPORTED:12,PENDING_APPROVAL:13,APPROVED:14,FAILED_APPROVAL:15,HANGUP_IN_WAITING_ROOM:16,UNCALLABLE:17,UNCALLABLE_DELAYED:18});i.default=e}),66);
__d("multiway_RingType",[],(function(t,n,r,o,a,i){var e=Object.freeze({GROUP_AUDIO_CALL:0,PEER_VIDEO_CALL:1,PEER_AUDIO_CALL:2,GROUP_VIDEO_CALL:3,LIVE_STREAM:4,PEER_ESCALATED_VIDEO_CALL:5,PEER_ESCALATED_AUDIO_CALL:6,LIVE_AUDIO_ROOM:7,LIVE_WITH_ROOM:8});i.default=e}),66);
__d("multiway_RtcResponseStatusCode",[],(function(t,n,r,o,a,i){var e=Object.freeze({OK:200,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,METHOD_NOT_ALLOWED:406,CONFLICT:409,CONDITIONAL_REQUEST_FAILED:412,SERVER_INTERNAL_ERROR:500,SERVICE_UNAVAILABLE:503});i.default=e}),66);
__d("multiway_RtcResponseSubCode",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:1e3,EXCEEDED_MAX_ALLOWED_PARTICIPANTS:1001,MEMBERSHIP_CHECK_FAIL:1002,CONFERENCE_THROTTLED:1003,ENDPOINT_THROTTLED:1004,MWS_MESSAGE_SENT_TO_INCORRECT_REGION:1005,UNSUPPORTED_REQUEST_TYPE:2e3,CLIENT_REQUEST_UNACCEPTABLE:2001,CLIENT_RESPONSE_UNACCEPTABLE:2002,RING_RESPONSE_BODY_NOT_SET:2004,SERVER_MEDIA_UPDATE_RESPONSE_BODY_NOT_SET:2005,INVALID_SDP:2006,INVALID_CONFERENCE_NAME:2007,SERVER_INFO_CONFERENCE_NAME_MISMATCH:2008,INVALID_USER_ID:2009,INCORRECT_VERSION_RANGE:2010,SENDER_ID_MISMATCH:2011,RECIPIENT_NOT_SPECIFIED:2012,FIELD_NOT_ALLOWED:2013,USERS_NOT_SPECIFIED:2015,REQUEST_UNACCEPTABLE_FOR_ENDPOINT_STATE:2016,INVALID_CALL_ID:2017,SESSION_DESCRIPTION_ID_MISMATCH:2018,EMPTY_CLIENT_MEDIA_UPDATES:2019,INVALID_SERVER_INFO_DATA:2020,INCORRECT_STATE_VERSION:2021,MISMATCHED_STATE_FOR_VERSION:2022,INVALID_STATE_VERSION:2023,NO_RESOLVER_FOUND:2024,MISSING_APPROVERLIST:2025,FULL_SDP_REQUIRED_IN_APPROVED_STATE:2026,INVALID_BROADCAST_ID:2027,INVALID_ENDPOINT_CONFIG:2028,INVALID_E2EE_STATE:2029,SFU_MODE_PREVENTED:2030,INVALID_CONFERENCE_STATE:2031,JOIN_REQUEST_DENIED:2032,EMPTY_USER_IDS:2033,MISSING_SDP_CONNECT_REQUEST:2034,CALLER_HAS_APPEALABLE_CALLING_RESTRICTION:2035,MISSING_BODY_ENDPOINT:2101,MISSING_BODY_HEADER:2102,MISSING_BODY_BODY:2103,MISSING_BODY_PARAMS:2104,MISSING_BODY_REMOVE_PARTICIPANTS_REQUEST:2105,MISSING_BODY_DATA_MESSAGE_REQUEST:2106,MISSING_BODY_CLIENT_MEDIA_UPDATE_REQUEST:2107,MISSING_BODY_ADD_PARTICIPANTS_REQUEST:2108,MISSING_BODY_SUBSCRIPTION_REQUEST:2110,MISSING_BODY_JOIN_REQUEST:2111,MISSING_BODY_HANGUP_REQUEST:2112,MISSING_BODY_ICE_CANDIDATE_REQUEST:2113,MISSING_BODY_P2P_MESSAGE_REQUEST:2114,MISSING_BODY_UPDATE_REQUEST:2115,MISSING_BODY_CLIENT_EVENT_REQUEST:2116,MISSING_BODY_CONNECT_REQUEST:2117,MISSING_BODY_UNSUBSCRIBE_REQUEST:2118,MISSING_BODY_APPROVAL_REQUEST:2119,MISSING_ENDPOINT_USER_ID:2120,EMPTY_ENDPOINT_USER_ID:2121,MISSING_BODY_TRANSFER_REQUEST:2122,MISSING_BODY_GENERIC:2199,REQUESTOR_NOT_MEMBER_CONFERENCE:3002,NOT_BROADCAST_OWNER:3003,GUEST_NOT_INVITED:3004,GUEST_DISCONNECTED:3005,GUEST_INVITATION_EXPIRED:3006,PARTICIPANT_IN_PENDING_APPROVAL_STATE:3008,INVALID_MULTIWAY_PARAMS:3009,BROADCAST_ALREADY_STOPPED:4002,FAILED_TO_GENERATE_SDP_ANSWER:4003,FAILED_GENERATE_SESSION_DESCRIPTION:4004,SDP_SESSION_ID_MISMATCH:4005,MEDIA_ENDPOINT_GONE:4007,MEDIA_ENDPOINT_ALREADY_EXISTS:4008,MEDIA_ENDPOINT_EXISTS_DIFFERENT_SESSION_ID:4009,LEGACY_MESSENGER_SENDER_UNSET:4010,FAILED_TO_SET_TRANSPORT_INFO:4011,NON_PRIMARY_MULTIWAY_SERVER:4012,FAILED_TO_GET_REMOTE_DESCRIPTION:4013,LOCAL_DESCRIPTION_NOT_SET:4014,INVALID_SDP_TYPE:4015,CLIENT_MEDIA_UPDATE_WITHOUT_REMOTE_SDP_INFO:4016,SDP_UNSET_ON_P2P_ANSWER:4017,MISSING_ICE_CANDIDATE_PAYLOAD:4018,P2P_PROTOCOL_UNSET:4019,CREATE_ACK_FOR_INVALID_MESSAGE_TYPE:4020,LEGACY_CLIENT_CANNOT_JOIN_SFU_MODE:4021,CONNECT_UNSUPPORTED_IN_SFU_MODE:4022,CONNECT_UNSUPPORTED_FOR_JOINED_ENDPOINTS:4023,RESOLVE_STATE_API_ERROR:4024,EXTERNAL_RESOLUTION_ERROR:4025,INTERNAL_RESOLUTION_ERROR:4026,RESOLUTION_DISABLED:4027,BROADCAST_ID_MISSING:4028,SDP_UNSET_ON_P2P_OFFER:4029,LEGACY_OFFER_MISSING_REQUIRED_VALUE:4031,MEDIA_SERVER_STATE_SYNC_DESERIALIZATION_ERROR:4032,CONNECT_UNSUPPORTED_FOR_PRECONNECTED_USERS:4033,OTHER_USER_ANSWERED_THE_CALL:4034,MEDIA_SERVER_DESERIALIZATION_ERROR:4035,REMOTE_SDP_TRACKID_MISMATCH:4036,SIGNALING_MESSAGE_TO_CLIENT_DROPPED:4037,DATA_CHANNEL_ENDPOINT_GONE:4038,DATA_CHANNEL_ENDPOINT_ALREADY_EXISTS:4039,CONNECT_UNSUPPORTED_DURING_P2P_TO_SFU_ESCALATION:4040,P2P_CONNECT_UNSUPPORTED_AFTER_SFU_ESCALATION:4041,CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_CONFERENCE:4042,CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_USER:4043,REQUEST_TIMEOUT:4044,TOO_MANY_MEDIA_TRACKS_IN_SDP:4045,CONFERENCE_NOT_FOUND:5001,CONFERENCE_IS_TERMINATING:5002,CONFERENCE_IS_TERMINATED:5003,CONFERENCE_NAME_EMPTY:5004,NONCE_EMPTY:5005,NONCE_MISMATCH:5006,CONFERENCE_HAS_GONE:5007,PARTICIPANT_HAS_GONE:5008,MEDIA_SERVER_NOT_FOUND:5009,CLIENT_TERMINATED:5010,JOIN_SESSION_RESULT_MISSING:5012,LOGGING_POLICY_RESULT_MISSING:5013,INVITE_USERS_RESULT_MISSING:5014,STATE_SYNC_RESULT_MISSING:5015,ENDPOINT_INFO_RESULT_MISSING:5016,CONFERENCE_NAME_MISMATCH:5017,UNEXPECTED_TRANSPORT_PARAMS_CONFERENCE_NAME:5018,SESSION_CONFIGURATION_RESULT_MISSING:5019,REMOVE_USERS_RESULT_MISSING:5020,MEDIA_CODECS_UNSUPPORTED_BY_CONFERENCE:6001,CONFERENCE_INCAPABLE_RENEGOTIATION:6002,REJECTING_CMU_WHEN_SMU_PENDING:6003,PARTICIPANT_NOT_SUBSCRIBED_TO_TOPIC:6004,PARTICIPANT_ALREADY_IN_WAITING_ROOM:6005,PARTICIPANT_NOT_IN_PENDING_APPROVAL:6006,USER_NOT_APPROVER_FOR_TARGET_USER:6007,UNSUPPORTED_CAPABILITIES:6008,PRODUCT_SERVER_DEFINED_END_REASON:6009,WWW_KILLSWITCHED_REQUEST:6010,CONFLICTING_MEDIA_PATH:6011,CONFLICTING_MEDIA_STATUS:6012,CONFLICTING_SESSION_DESCRIPTION:6013,OK:9e3});i.default=e}),66);
__d("multiway_SubscriptionType",[],(function(t,n,r,o,a,i){var e=Object.freeze({CNAME:0,TRACK:1,DOMINANT_SPEAKER:2});i.default=e}),66);
__d("multiway_VideoQuality",[],(function(t,n,r,o,a,i){var e=Object.freeze({LOW:0,MEDIUM:1,HIGH:2,HD:3,NUM_QUALITIES:4});i.default=e}),66);
__d("ZenonMWMessageTypes",["$InternalEnum","fbwebrtc_ClientStack","multiway_ApprovalStatus","multiway_Capability","multiway_ClientEventType","multiway_ConferenceType","multiway_DeviceStatus","multiway_DismissReason","multiway_E2eeMode","multiway_EndpointServiceType","multiway_HangupReason","multiway_JoinMode","multiway_MediaPath","multiway_MediaPauseStatus","multiway_MessageTag","multiway_MessageType","multiway_ParticipantCallState","multiway_RingType","multiway_RtcResponseStatusCode","multiway_RtcResponseSubCode","multiway_SubscriptionType","multiway_VideoQuality"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({DEFAULT_AUDIO:0,DEFAULT_VIDEO:1,SCREEN_AUDIO:2,SCREEN_VIDEO:3});l.ZenonMWClientStack=r("fbwebrtc_ClientStack"),l.ZenonMWApprovalStatus=r("multiway_ApprovalStatus"),l.ZenonMWCapability=r("multiway_Capability"),l.ZenonMWClientEventType=r("multiway_ClientEventType"),l.ZenonMWConferenceType=r("multiway_ConferenceType"),l.ZenonMWDeviceStatus=r("multiway_DeviceStatus"),l.ZenonMWDismissReason=r("multiway_DismissReason"),l.ZenonMWE2eeMode=r("multiway_E2eeMode"),l.ZenonMWEndpointServiceType=r("multiway_EndpointServiceType"),l.ZenonMWHangupReason=r("multiway_HangupReason"),l.ZenonMWMediaPath=r("multiway_MediaPath"),l.ZenonMWJoinMode=r("multiway_JoinMode"),l.ZenonMWMediaPauseStatus=r("multiway_MediaPauseStatus"),l.ZenonMWMessageTag=r("multiway_MessageTag"),l.ZenonMWSignalingPayloadType=r("multiway_MessageType"),l.ZenonMWParticipantCallState=r("multiway_ParticipantCallState"),l.ZenonMWRingType=r("multiway_RingType"),l.ZenonMWResponseStatusCode=r("multiway_RtcResponseStatusCode"),l.ZenonMWResponseSubCode=r("multiway_RtcResponseSubCode"),l.ZenonMWSubscriptionType=r("multiway_SubscriptionType"),l.ZenonMWVideoQuality=r("multiway_VideoQuality"),l.ZenonMWTrackLabel=e}),98);
__d("ZenonMediaError",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["ConnectionClosed","IceDisconnected","IceFailure","SetLocalSdpFailed","SetRemoteSdpFailed","RollbackSdpFailed","UnknownError"]);i.ZenonMediaError=e}),66);
__d("ZenonDismissReason",["$InternalEnum","FBLogger","ZenonIncomingRingSDKTypes","ZenonMWMessageTypes","ZenonMediaError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=n("$InternalEnum")({IgnoreCall:0,HangupCall:1,InAnotherCall:2,AcceptAfterHangUp:3,NoAnswerTimeout:4,IncomingTimeout:5,OtherInstanceHandled:6,SignalingMessageFailed:7,ConnectionDropped:8,ClientInterrupted:9,WebRTCError:10,ClientError:11,NoPermission:12,OtherNotCapable:13,NoUIShown:14,VersionUnsupported:15,CallerNotVisible:16,CarrierBlocked:17,OtherCarrierBlocked:18,ClientEncryptionError:19,MicrophonePermissionDenied:20,CameraPermissionDenied:21,SessionMigrated:22,RingMuted:23,JoinApprovalDenied:24,RejectedByCallee:25,CallEndedByProduct:26,CallEnded:27,AnsweredOnAnotherDevice:28,RejectedOnAnotherDevice:29,CallCollision:30,MaxAllowedParticipantsReached:31,UnexpectedEndOfCall:32,TxAckTimeout:33,EndToEndEncryptionInvariantViolated:34,ProductServerDefinedEndReason:35,RemovedByParticipant:39,AnsweredByOtherUser:40,CallerHasAppealableCallingRestriction:41});function c(e){switch(e){case"BreakoutSessionSwitchRoom":return u.HangupCall;case"CallEndAcceptAfterHangUp":return u.AcceptAfterHangUp;case"CallerNotVisible":return u.CallerNotVisible;case"CarrierBlocked":return u.CarrierBlocked;case"ClientEncryptionError":return u.ClientEncryptionError;case"ClientError":return u.ClientError;case"ClientInterrupted":return u.ClientInterrupted;case"ConnectionDropped":return u.ConnectionDropped;case"HangupCall":return u.HangupCall;case"IgnoreCall":return u.IgnoreCall;case"InAnotherCall":return u.InAnotherCall;case"EndToEndEncryptionInvariantViolated":return u.EndToEndEncryptionInvariantViolated;case"InactiveTimeout":return u.CallEnded;case"IncomingTimeout":return u.IncomingTimeout;case"MaxAllowedParticipantsReached":return u.MaxAllowedParticipantsReached;case"NoAnswerTimeout":return u.NoAnswerTimeout;case"NoPermission":return u.NoPermission;case"NoUIShown":return u.NoUIShown;case"OtherCarrierBlocked":return u.OtherCarrierBlocked;case"OtherInstanceHandled":return u.OtherInstanceHandled;case"OtherNotCapable":return u.OtherNotCapable;case"SignalingMessageFailed":return u.SignalingMessageFailed;case"UnexpectedEndOfCall":return u.UnexpectedEndOfCall;case"Unknown":return u.CallEnded;case"VersionUnsupported":return u.VersionUnsupported;case"WebRTCError":return u.WebRTCError;case"MicrophonePermissionDenied":return u.MicrophonePermissionDenied;case"CameraPermissionDenied":return u.CameraPermissionDenied;case"SessionMigrated":return u.SessionMigrated;case"RingMuted":return u.RingMuted;case"TxAckTimeout":return u.TxAckTimeout;case"ProductServerDefinedEndReason":return u.ProductServerDefinedEndReason;case"RemovedByParticipant":return u.RemovedByParticipant;case"CallerHasAppealableCallingRestriction":return u.CallerHasAppealableCallingRestriction}}function d(e){switch(e){case u.CallEnded:case u.CallEndedByProduct:case u.HangupCall:return"HangupCall";case u.IgnoreCall:case u.JoinApprovalDenied:case u.RejectedByCallee:return"IgnoreCall";case u.InAnotherCall:return"InAnotherCall";case u.AcceptAfterHangUp:return"CallEndAcceptAfterHangUp";case u.NoAnswerTimeout:return"NoAnswerTimeout";case u.IncomingTimeout:return"IncomingTimeout";case u.AnsweredOnAnotherDevice:case u.CallCollision:case u.RejectedOnAnotherDevice:case u.OtherInstanceHandled:case u.AnsweredByOtherUser:return"OtherInstanceHandled";case u.SignalingMessageFailed:return"SignalingMessageFailed";case u.ConnectionDropped:return"ConnectionDropped";case u.ClientInterrupted:return"ClientInterrupted";case u.WebRTCError:return"WebRTCError";case u.ClientError:return"ClientError";case u.NoPermission:return"NoPermission";case u.OtherNotCapable:return"OtherNotCapable";case u.NoUIShown:return"NoUIShown";case u.VersionUnsupported:return"VersionUnsupported";case u.CallerNotVisible:return"CallerNotVisible";case u.CarrierBlocked:return"CarrierBlocked";case u.OtherCarrierBlocked:return"OtherCarrierBlocked";case u.ClientEncryptionError:return"ClientEncryptionError";case u.UnexpectedEndOfCall:return"UnexpectedEndOfCall";case u.MaxAllowedParticipantsReached:return"MaxAllowedParticipantsReached";case u.MicrophonePermissionDenied:return"MicrophonePermissionDenied";case u.CameraPermissionDenied:return"CameraPermissionDenied";case u.SessionMigrated:return"SessionMigrated";case u.RingMuted:return"RingMuted";case u.TxAckTimeout:return"TxAckTimeout";case u.EndToEndEncryptionInvariantViolated:return"EndToEndEncryptionInvariantViolated";case u.ProductServerDefinedEndReason:return"ProductServerDefinedEndReason";case u.RemovedByParticipant:return"RemovedByParticipant";case u.CallerHasAppealableCallingRestriction:return"CallerHasAppealableCallingRestriction"}return r("FBLogger")("rtc_www").mustfix("Unknown dismiss reason: %s",e),"Unknown"}function m(e){switch(e){case u.OtherInstanceHandled:case u.AnsweredOnAnotherDevice:case u.AnsweredByOtherUser:case u.RejectedOnAnotherDevice:return o("ZenonIncomingRingSDKTypes").ZenonCancelReason.OtherDismiss;default:return o("ZenonIncomingRingSDKTypes").ZenonCancelReason.Hangup}}function p(e){switch(e){case o("ZenonMediaError").ZenonMediaError.IceDisconnected:return u.ConnectionDropped;case o("ZenonMediaError").ZenonMediaError.ConnectionClosed:return u.HangupCall;case o("ZenonMediaError").ZenonMediaError.IceFailure:case o("ZenonMediaError").ZenonMediaError.SetLocalSdpFailed:case o("ZenonMediaError").ZenonMediaError.SetRemoteSdpFailed:case o("ZenonMediaError").ZenonMediaError.RollbackSdpFailed:return u.WebRTCError;case o("ZenonMediaError").ZenonMediaError.UnknownError:return u.UnexpectedEndOfCall}}function _(e){return f[e]}var f=Object.freeze((e={},e[(s=o("ZenonMWMessageTypes")).ZenonMWDismissReason.CALL_ENDED]=u.CallEnded,e[s.ZenonMWDismissReason.ANSWERED_ON_ANOTHER_DEVICE]=u.AnsweredOnAnotherDevice,e[s.ZenonMWDismissReason.ANSWERED_BY_OTHER_USER]=u.AnsweredByOtherUser,e[s.ZenonMWDismissReason.IN_ANOTHER_CALL]=u.InAnotherCall,e[s.ZenonMWDismissReason.CONNECTION_DROPPED]=u.ConnectionDropped,e[s.ZenonMWDismissReason.REJECTED_ON_ANOTHER_DEVICE]=u.RejectedOnAnotherDevice,e[s.ZenonMWDismissReason.REJECTED_BY_CALLEE]=u.RejectedByCallee,e[s.ZenonMWDismissReason.CALL_ENDED_BY_PRODUCT]=u.CallEndedByProduct,e[s.ZenonMWDismissReason.INTERNAL_ERROR]=u.SignalingMessageFailed,e[s.ZenonMWDismissReason.REMOVED_BY_PARTICIPANT]=u.RemovedByParticipant,e[s.ZenonMWDismissReason.TX_ACK_TIMEDOUT]=u.TxAckTimeout,e));l.ZenonDismissReason=u,l.endCallToDismissReason=c,l.dismissToEndCallReason=d,l.dismissReasonToCancelReason=m,l.mediaErrorToDismissReason=p,l.mwDismissToDmissReason=_}),98);
__d("ZenonMWThriftMessageTagUtils",["MultiwayCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case o("MultiwayCommonTypes").MessageTag.PRANSWER:return 1001;case o("MultiwayCommonTypes").MessageTag.INITIAL_ANSWER_TO_P2P_CALLER:return 1002;case o("MultiwayCommonTypes").MessageTag.DEESCALATE_OFFER_TO_P2P_CALLEE:return 1003;case o("MultiwayCommonTypes").MessageTag.DEESCALATE_ANSWER_TO_P2P_CALLER:return 1004;case o("MultiwayCommonTypes").MessageTag.REQUEST_DEESCALATE_TO_P2P_CALLER:return 1005;case o("MultiwayCommonTypes").MessageTag.REQUEST_ESCALATE:return 1006;case o("MultiwayCommonTypes").MessageTag.REQUEST_CLIENT_FULL_RENEGOTIATION_TO_ADMIT_FROM_WAITINGROOM:return 1007;case o("MultiwayCommonTypes").MessageTag.REQUEST_CLIENT_FULL_RENEGOTIATION_AGAINST_MWS:return 1008;case o("MultiwayCommonTypes").MessageTag.PARTICIPANT_ADDED:return 1009;case o("MultiwayCommonTypes").MessageTag.PARTICIPANT_REMOVED:return 1010;case o("MultiwayCommonTypes").MessageTag.FIRST_REMOTE_ALERTED_FOR_INITIATOR:return 2001;case o("MultiwayCommonTypes").MessageTag.FIRST_REMOTE_ANSWERED_FOR_INITIATOR:return 2002;case o("MultiwayCommonTypes").MessageTag.CONTAIN_PENDING_APPROVAL_PARTICIPANTS:return 2003;case o("MultiwayCommonTypes").MessageTag.KEEP_ALIVE_PING:return 3001;case o("MultiwayCommonTypes").MessageTag.IS_INITIATOR:return 4001;case o("MultiwayCommonTypes").MessageTag.PREGEN_SDP:return 4002}}function s(e){switch(e){case 1001:return o("MultiwayCommonTypes").MessageTag.PRANSWER;case 1002:return o("MultiwayCommonTypes").MessageTag.INITIAL_ANSWER_TO_P2P_CALLER;case 1003:return o("MultiwayCommonTypes").MessageTag.DEESCALATE_OFFER_TO_P2P_CALLEE;case 1004:return o("MultiwayCommonTypes").MessageTag.DEESCALATE_ANSWER_TO_P2P_CALLER;case 1005:return o("MultiwayCommonTypes").MessageTag.REQUEST_DEESCALATE_TO_P2P_CALLER;case 1006:return o("MultiwayCommonTypes").MessageTag.REQUEST_ESCALATE;case 1007:return o("MultiwayCommonTypes").MessageTag.REQUEST_CLIENT_FULL_RENEGOTIATION_TO_ADMIT_FROM_WAITINGROOM;case 1008:return o("MultiwayCommonTypes").MessageTag.REQUEST_CLIENT_FULL_RENEGOTIATION_AGAINST_MWS;case 1009:return o("MultiwayCommonTypes").MessageTag.PARTICIPANT_ADDED;case 1010:return o("MultiwayCommonTypes").MessageTag.PARTICIPANT_REMOVED;case 2001:return o("MultiwayCommonTypes").MessageTag.FIRST_REMOTE_ALERTED_FOR_INITIATOR;case 2002:return o("MultiwayCommonTypes").MessageTag.FIRST_REMOTE_ANSWERED_FOR_INITIATOR;case 2003:return o("MultiwayCommonTypes").MessageTag.CONTAIN_PENDING_APPROVAL_PARTICIPANTS;case 3001:return o("MultiwayCommonTypes").MessageTag.KEEP_ALIVE_PING;case 4001:return o("MultiwayCommonTypes").MessageTag.IS_INITIATOR;case 4002:return o("MultiwayCommonTypes").MessageTag.PREGEN_SDP}}function u(t){var n=[];return t==null||t.forEach(function(t){t&&n.push(e(t))}),n}l.toThriftMessageTag=s,l.fromThriftMessageTags=u}),98);
__d("ZenonCallsModelTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum")).Mirrored(["Disconnected","Precontacting","Contacting","Ringing","PendingApproval","Approved","FailedApproval","Connecting","Connected","Reconnecting","ProvisionalRinging"]),s=e.Mirrored(["Facebook","Instagram","Messenger","Guest","WhatsApp","Workplace"]),u=e.Mirrored(["New","Connecting","PendingApproval","Connected","Terminating","Terminated"]),c=e.Mirrored(["Unknown","CallsBlocked","PageAdminPressedDecline"]),d=e.Mirrored(["None","PendingPeerFeedback","Declined","RemoteDeclined","LocalDeclined","Cancelled","TimedOut","Accepted","InitiatedFromPeer"]);i.ZenonCallParticipantState=l,i.ZenonCallParticipantType=s,i.ZenonCallState=u,i.ZenonEndCallSubreason=c,i.ZenonVideoEscalationStatus=d}),66);
__d("ZenonParticipantState",["$InternalEnum","ZenonCallsModelTypes"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({UNKNOWN:0,ADDING:1,CONTACTING:2,RINGING:3,ACCEPTING:4,PRECONNECTING:5,CONNECTING:6,CONNECTED:7,REMOVING:8,DISCONNECTED:9,NO_ANSWER:10,REJECTED:11,UNREACHABLE:12,CONNECTION_DROPPED:13,PARTICIPANT_LIMIT_REACHED:14,IN_ANOTHER_CALL:15,RING_TYPE_UNSUPPORTED:16,PENDING_APPROVAL:17,APPROVING:18,DENYING:19,APPROVED:20,FAILED_APPROVAL:21,HANGUP_IN_WAITING_ROOM:22,RECONNECTING:23});function s(t){if(t==null)return o("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected;switch(t){case e.CONTACTING:case e.PRECONNECTING:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Contacting;case e.RINGING:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Ringing;case e.CONNECTING:case e.RECONNECTING:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Connecting;case e.CONNECTED:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Connected;case e.PENDING_APPROVAL:case e.APPROVING:case e.DENYING:case e.ACCEPTING:case e.ADDING:case e.REMOVING:return o("ZenonCallsModelTypes").ZenonCallParticipantState.PendingApproval;case e.APPROVED:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Approved;case e.FAILED_APPROVAL:return o("ZenonCallsModelTypes").ZenonCallParticipantState.FailedApproval;case e.HANGUP_IN_WAITING_ROOM:case e.UNKNOWN:case e.DISCONNECTED:case e.NO_ANSWER:case e.REJECTED:case e.UNREACHABLE:case e.CONNECTION_DROPPED:case e.PARTICIPANT_LIMIT_REACHED:case e.IN_ANOTHER_CALL:case e.RING_TYPE_UNSUPPORTED:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected}return o("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected}l.ZenonParticipantState=e,l.toCallParticipantState=s}),98);
__d("ZenonScreenShare",["UserAgent","ZenonAppProvider"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t;return e.length===1&&((t=e[0])==null?void 0:t.contentType)==="screen"}function s(){return!r("UserAgent").isBrowser("Safari")}function u(){return!o("ZenonAppProvider").isOculusCastingSite()}function c(){return!s()||!u()}l.isScreenSharingTrack=e,l.screenShareWithReplaceTrack=c}),98);
__d("ZenonSignalingTypes",[],(function(t,n,r,o,a,i){"use strict";var e={OK:0,REJECTED_FROM_VERSION_DOES_NOT_MATCH:1,METHOD_NOT_ALLOWED:2},l={CLIENT_TERMINATED:0};i.ZenonSignalingStatusCode=e,i.ZenonSignalingStatusSubCode=l}),66);
__d("addDevTierOverridesToHeaderExtensions",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t={multiwayCoreTier:"",multiwayWwwTier:""};return r("gkx")("25224")&&(t.multiwayWwwTier=s(e,"multiway_www_tier"),t.multiwayCoreTier=s(e,"multiway_core_tier")),t}function s(e,t){var n=t+"=",r=e.split(n);return r[1]?r.pop().split("&").shift():""}l.default=e}),98);
__d("ZenonMWThriftTranslatorUtils",["FBLogger","MultiwayCommonTypes","MultiwaySharedTypes","OverlayConfigServerLayer","RequestStreamBodyUtils","WebrtcSignalingCommonTypes","ZenonDismissReason","ZenonMWMessageTypes","ZenonMWThriftMessageTagUtils","ZenonParticipantState","ZenonScreenShare","ZenonSignalingProtocol","ZenonSignalingTypes","addDevTierOverridesToHeaderExtensions","err","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d="signalingDominantSpeakerUpdate",m="signalingVideoUploadUpdate",p="E2eeState",_=new Map(Array.from(o("MultiwaySharedTypes").ConferenceType.members(),function(e){return[o("MultiwaySharedTypes").ConferenceType.getName(e),e]}));function f(e,t,n,r){n===void 0&&(n=!1),e&&Object.keys(e).forEach(function(o){if(!(o===p&&r)){var a=e[o],i=a.data,l=a.version;if(i!=null){var s={data:i,eventName:"stateSyncNotifyRequest",responseRequired:n,topic:o,version:l};t.push(s)}}})}function g(e){if(e){var t=e[p];return t==null?void 0:t.data}}function h(e){if(e==null)return o("ZenonMWMessageTypes").ZenonMWMediaPath.UNKNOWN;switch(e){case o("MultiwaySharedTypes").MediaPath.SFU:return o("ZenonMWMessageTypes").ZenonMWMediaPath.SFU;case o("MultiwaySharedTypes").MediaPath.P2P:return o("ZenonMWMessageTypes").ZenonMWMediaPath.P2P;default:return o("ZenonMWMessageTypes").ZenonMWMediaPath.UNKNOWN}}function y(e){if(e==null)return o("ZenonParticipantState").ZenonParticipantState.UNKNOWN;switch(e){case o("MultiwayCommonTypes").ParticipantCallState.DISCONNECTED:return o("ZenonParticipantState").ZenonParticipantState.DISCONNECTED;case o("MultiwayCommonTypes").ParticipantCallState.NO_ANSWER:return o("ZenonParticipantState").ZenonParticipantState.NO_ANSWER;case o("MultiwayCommonTypes").ParticipantCallState.REJECTED:return o("ZenonParticipantState").ZenonParticipantState.REJECTED;case o("MultiwayCommonTypes").ParticipantCallState.UNREACHABLE:case o("MultiwayCommonTypes").ParticipantCallState.UNCALLABLE:return o("ZenonParticipantState").ZenonParticipantState.UNREACHABLE;case o("MultiwayCommonTypes").ParticipantCallState.CONNECTION_DROPPED:return o("ZenonParticipantState").ZenonParticipantState.CONNECTION_DROPPED;case o("MultiwayCommonTypes").ParticipantCallState.CONTACTING:return o("ZenonParticipantState").ZenonParticipantState.CONTACTING;case o("MultiwayCommonTypes").ParticipantCallState.RINGING:return o("ZenonParticipantState").ZenonParticipantState.RINGING;case o("MultiwayCommonTypes").ParticipantCallState.CONNECTING:return o("ZenonParticipantState").ZenonParticipantState.CONNECTING;case o("MultiwayCommonTypes").ParticipantCallState.CONNECTED:return o("ZenonParticipantState").ZenonParticipantState.CONNECTED;case o("MultiwayCommonTypes").ParticipantCallState.PARTICIPANT_LIMIT_REACHED:return o("ZenonParticipantState").ZenonParticipantState.PARTICIPANT_LIMIT_REACHED;case o("MultiwayCommonTypes").ParticipantCallState.IN_ANOTHER_CALL:return o("ZenonParticipantState").ZenonParticipantState.IN_ANOTHER_CALL;case o("MultiwayCommonTypes").ParticipantCallState.RING_TYPE_UNSUPPORTED:return o("ZenonParticipantState").ZenonParticipantState.RING_TYPE_UNSUPPORTED;case o("MultiwayCommonTypes").ParticipantCallState.PENDING_APPROVAL:return o("ZenonParticipantState").ZenonParticipantState.PENDING_APPROVAL;case o("MultiwayCommonTypes").ParticipantCallState.APPROVED:return o("ZenonParticipantState").ZenonParticipantState.APPROVED;case o("MultiwayCommonTypes").ParticipantCallState.FAILED_APPROVAL:return o("ZenonParticipantState").ZenonParticipantState.FAILED_APPROVAL;case o("MultiwayCommonTypes").ParticipantCallState.HANGUP_IN_WAITING_ROOM:return o("ZenonParticipantState").ZenonParticipantState.HANGUP_IN_WAITING_ROOM;default:return o("ZenonParticipantState").ZenonParticipantState.UNKNOWN}}function C(e){var t=null;return e!=null&&e.forEach(function(e){var n,r=(n=e.body)==null?void 0:n.genericMessage;if(r!=null&&r.topic==="collision_context_payload"){var a=r.data;if(a!=null){var i,l,s,u=JSON.parse(o("RequestStreamBodyUtils").uint8ArrayToString(a));t={groupThreadID:(i=u.group_thread_id)!=null?i:null,peerID:(l=u.peer_id)!=null?l:null,serverInfoData:(s=u.server_info_data)!=null?s:null}}}}),t}function b(e){var t=e&&e.length>0?e.find(function(e){var t;return((t=e.body)==null||(t=t.genericMessage)==null?void 0:t.topic)==="room_metadata"}):null;if(t){var n,r=(n=t.body)==null||(n=n.genericMessage)==null?void 0:n.data;if(r!=null){var a,i=JSON.parse(o("RequestStreamBodyUtils").uint8ArrayToString(r)),l=(a=t.header)==null?void 0:a.sender;if(i.link_hash!=null&&i.room_name!=null&&l!=null)return{linkHash:i.link_hash,profileURL:i.profile_url,ringSubtitle:i.ring_subtitle,roomName:i.room_name,sender:l}}}return null}function v(e){return e.reduce(function(e,t){var n,r,a=(n=t.body)==null||(n=n.genericMessage)==null?void 0:n.topic,i=(r=t.body)==null||(r=r.genericMessage)==null?void 0:r.data;return a!=null&&i!=null&&(e[a]=o("RequestStreamBodyUtils").uint8ArrayToString(i)),e},{})}function S(e){switch(e){case o("ZenonMWMessageTypes").ZenonMWMediaPath.SFU:return o("MultiwaySharedTypes").MediaPath.SFU;case o("ZenonMWMessageTypes").ZenonMWMediaPath.P2P:return o("MultiwaySharedTypes").MediaPath.P2P;default:return o("MultiwaySharedTypes").MediaPath.UNKNOWN}}function R(e,t,n){n===void 0&&(n=0);var r={fromVersion:t,tracks:[],version:n};return e!=null&&Object.keys(e.tracks).forEach(function(t){var n,o,a=e.tracks[t],i={enabled:a.enabled,name:(n=a.name)!=null?n:"",participantID:(o=a.owner)!=null?o:"0",trackID:t,type:L(a.label)};r.tracks.push(i)}),r}function L(e){if(e==null)return null;switch(e){case o("WebrtcSignalingCommonTypes").TrackLabel.DEFAULT_AUDIO:return"audio";case o("WebrtcSignalingCommonTypes").TrackLabel.DEFAULT_VIDEO:return"video";case o("WebrtcSignalingCommonTypes").TrackLabel.SCREEN_AUDIO:return"screen_audio";case o("WebrtcSignalingCommonTypes").TrackLabel.SCREEN_VIDEO:return"screen";default:return null}}function E(e,t){var n=r("OverlayConfigServerLayer").createFromHeader(t);if(n){var o={eventName:"overlayConfigServerUpdateRequest",serverLayer:n};e.push(o)}}function k(e){var t=e.header,n=e.rtcMessageBody,r=e.type,o=$(t,r),a={messageBody:n,messageHeader:o};return a}function I(e){var t=e.header,n=e.rtcMessageBody,r=e.statusCode,o=e.subCode,a=e.type,i=O(t,a,r,o),l={messageBody:n,messageHeader:i};return l}var T={IN_ANOTHER_CALL:(u=o("MultiwayCommonTypes")).DeviceStatus.IN_ANOTHER_CALL,NO_OP:null,NOT_SUPPORTED:u.DeviceStatus.NOT_SUPPORTED,OK:u.DeviceStatus.OK};function D(e,t){return Object.keys(e).map(function(n){var r=e[n];return{body:{genericMessage:{data:o("RequestStreamBodyUtils").stringToUint8Array(r),topic:n}},header:{recipients:new Set(t),topic_DEPRECATED:n}}})}function x(e){var t,n=e.clientSessionId,a=e.conferenceName,i=e.receiver,l=e.receiverUserId,s=e.sequenceNumber,u=e.serverInfoData,c=e.transactionId,d=e.type;if(l==null){var m=d!=null?o("MultiwayCommonTypes").MessageType.getName(d):"UNKNOWN";if(r("justknobx")._("5129"))r("FBLogger")("rpweb").info("Allowing null receiverUserId for MessageType: %s",m);else throw r("err")("Incoming Thrift MW messages should have receiverUserId populated. MessageType: "+m)}var p=n,_={userID:"2"},f={actorID:(t=i==null?void 0:i.actorId)!=null?t:null,messageID:c,messageTags:o("ZenonMWThriftMessageTagUtils").fromThriftMessageTags(e.messageTags),protocol:r("ZenonSignalingProtocol").MW,remoteInfo:_,retryCount:e.retryCount,roomInfo:{name:a},sequenceNumber:Number(s),signalingID:p,userInfo:{userID:l!=null?l:"1"}};return u!=null&&(f.remoteSignalingID=u),f}function $(e,t){var n,a,i,l=e.messageID,s=e.messageTags,u=e.remoteSignalingID,c=e.roomInfo,d=e.signalingID,m=r("addDevTierOverridesToHeaderExtensions")(window.location.href),p={clientStack:o("WebrtcSignalingCommonTypes").ClientStack.ZENON,conferenceName:(n=c.name)!=null?n:"",conferenceType:B((a=c.name)!=null?a:""),messageTags:new Set(s==null?void 0:s.map(function(e){return o("ZenonMWThriftMessageTagUtils").toThriftMessageTag(e)})),retryCount:e.retryCount,sequenceNumber:(i=e.sequenceNumber)==null?void 0:i.toString(),transactionId:l,type:t};return(m.multiwayCoreTier!==""||m.multiwayWwwTier!=="")&&(p.extensions=m),d!=null&&(p.clientSessionId=d),u!=null&&(p.serverInfoData=u),e.actorID!=null&&(p.sender={id:e.actorID}),p}function P(e){switch(e){case o("ZenonDismissReason").ZenonDismissReason.IgnoreCall:return o("MultiwayCommonTypes").HangupReason.IGNORE_CALL;case o("ZenonDismissReason").ZenonDismissReason.HangupCall:return o("MultiwayCommonTypes").HangupReason.HANGUP_CALL;case o("ZenonDismissReason").ZenonDismissReason.NoAnswerTimeout:return o("MultiwayCommonTypes").HangupReason.NO_ANSWER_TIMEOUT;case o("ZenonDismissReason").ZenonDismissReason.ClientError:return o("MultiwayCommonTypes").HangupReason.CLIENT_ERROR;case o("ZenonDismissReason").ZenonDismissReason.InAnotherCall:return o("MultiwayCommonTypes").HangupReason.IN_ANOTHER_CALL;case o("ZenonDismissReason").ZenonDismissReason.ClientInterrupted:return o("MultiwayCommonTypes").HangupReason.CLIENT_INTERRUPTED;case o("ZenonDismissReason").ZenonDismissReason.SessionMigrated:return o("MultiwayCommonTypes").HangupReason.SESSION_MIGRATED;default:return o("MultiwayCommonTypes").HangupReason.HANGUP_CALL}}function N(e){var t,n=(t=e.message.body)!=null?t:{},r=n.dominantSpeakerSignalingInfo,a=n.genericMessage,i=n.videoUploadSignalingInfo;return a?o("RequestStreamBodyUtils").uint8ArrayToString(a.data):r?JSON.stringify(r):i?JSON.stringify(i):null}function M(e){var t,n=(t=e.message.body)!=null?t:{},r=n.dominantSpeakerSignalingInfo,o=n.genericMessage,a=n.videoUploadSignalingInfo;return o?o.topic:r?d:a?m:null}function w(e){return e==null?null:e===1?o("MultiwaySharedTypes").EndpointServiceType.COMPOSITING_SERVICE:o("MultiwaySharedTypes").EndpointServiceType.UNKNOWN}function A(e){var t=F(e);return t!=null?t:o("ZenonDismissReason").ZenonDismissReason.CallEnded}function F(e){if(e==null)return null;switch(e){case o("MultiwayCommonTypes").DismissReason.CALL_ENDED:return o("ZenonDismissReason").ZenonDismissReason.CallEnded;case o("MultiwayCommonTypes").DismissReason.ANSWERED_ON_ANOTHER_DEVICE:return o("ZenonDismissReason").ZenonDismissReason.AnsweredOnAnotherDevice;case o("MultiwayCommonTypes").DismissReason.ANSWERED_BY_OTHER_USER:return o("ZenonDismissReason").ZenonDismissReason.AnsweredByOtherUser;case o("MultiwayCommonTypes").DismissReason.IN_ANOTHER_CALL:return o("ZenonDismissReason").ZenonDismissReason.InAnotherCall;case o("MultiwayCommonTypes").DismissReason.CONNECTION_DROPPED:return o("ZenonDismissReason").ZenonDismissReason.ConnectionDropped;case o("MultiwayCommonTypes").DismissReason.PRIMARY_ENDPOINT_HANGUP:return o("ZenonDismissReason").ZenonDismissReason.HangupCall;case o("MultiwayCommonTypes").DismissReason.REJECTED_ON_ANOTHER_DEVICE:return o("ZenonDismissReason").ZenonDismissReason.RejectedOnAnotherDevice;case o("MultiwayCommonTypes").DismissReason.REMOVED_BY_PARTICIPANT:return o("ZenonDismissReason").ZenonDismissReason.RemovedByParticipant;case o("MultiwayCommonTypes").DismissReason.REJECTED_BY_CALLEE:return o("ZenonDismissReason").ZenonDismissReason.RejectedByCallee;case o("MultiwayCommonTypes").DismissReason.INTERNAL_ERROR:return o("ZenonDismissReason").ZenonDismissReason.SignalingMessageFailed;case o("MultiwayCommonTypes").DismissReason.CALL_ENDED_BY_PRODUCT:return o("ZenonDismissReason").ZenonDismissReason.CallEndedByProduct;case o("MultiwayCommonTypes").DismissReason.TX_ACK_TIMEDOUT:return o("ZenonDismissReason").ZenonDismissReason.TxAckTimeout;default:return null}}function O(e,t,n,r){var a=$(e,t);return a.responseStatusCode=n!=null?n:o("MultiwayCommonTypes").RtcResponseStatusCode.OK,a.responseSubCode=r,a}function B(e){var t,n=e.indexOf(":");if(n===-1)return null;var r=e.slice(0,n);return(t=_.get(r))!=null?t:null}function W(e){var t={},n=!o("ZenonScreenShare").screenShareWithReplaceTrack();return e.tracks.forEach(function(e){var r={customAudioContentType:o("WebrtcSignalingCommonTypes").CustomAudioContentType.NONE,customVideoContentType:o("WebrtcSignalingCommonTypes").CustomVideoContentType.NONE,enabled:e.enabled},a=n?z(e.type):null;a!=null&&(r.label=a),t[e.trackID]=r}),{tracks:t}}function q(e){var t=T[e];return t!=null?t:o("MultiwayCommonTypes").DeviceStatus.OK}function U(e){var t={};return e.tracks.forEach(function(e){t[e.trackID]=e.enabled}),t}function V(e){return K[e]}function H(e){return e==null?null:Q[e]}function G(e){var t={};return e.forEach(function(e,n){t[n]={data:e.data,version:e.version}}),t}function z(e){switch(e){case"audio":return o("WebrtcSignalingCommonTypes").TrackLabel.DEFAULT_AUDIO;case"video":return o("WebrtcSignalingCommonTypes").TrackLabel.DEFAULT_VIDEO;case"screen":return o("WebrtcSignalingCommonTypes").TrackLabel.SCREEN_VIDEO;case"screen_audio":return o("WebrtcSignalingCommonTypes").TrackLabel.SCREEN_AUDIO;default:return null}}function j(e){return e===o("MultiwaySharedTypes").EndpointServiceType.COMPOSITING_SERVICE?1:0}var K=Object.freeze((e={},e[(c=o("ZenonSignalingTypes")).ZenonSignalingStatusCode.OK]=u.RtcResponseStatusCode.OK,e[c.ZenonSignalingStatusCode.REJECTED_FROM_VERSION_DOES_NOT_MATCH]=u.RtcResponseStatusCode.CONDITIONAL_REQUEST_FAILED,e[c.ZenonSignalingStatusCode.METHOD_NOT_ALLOWED]=u.RtcResponseStatusCode.METHOD_NOT_ALLOWED,e)),Q=Object.freeze((s={},s[c.ZenonSignalingStatusSubCode.CLIENT_TERMINATED]=u.RtcResponseSubCode.CLIENT_TERMINATED,s));l.addThriftStateStoreSignalingEvents=f,l.fetchE2eeServerState=g,l.fromThriftMediaPath=h,l.fromThriftParticipantState=y,l.getCollisionContextFromThriftAppMessages=C,l.getRoomMetadataFromThriftAppMessages=b,l.mwThriftAppMessagesToSignalingAppMessages=v,l.toThriftMediaPath=S,l.toZenonMediaStatesFromThrift=R,l.toMWClientTrackContentTypeFromThrift=L,l.maybeAddOverlayConfigServerUpdateRequestFromThrift=E,l.createMWThriftRequest=k,l.createMWThriftResponse=I,l.signalingMessageAppMessagesToThriftMWAppMessages=D,l.mwThriftMessageHeaderToSignalingMessageHeader=x,l.toMWThriftHangupReason=P,l.getGenericMWThriftDataMessageData=N,l.getGenericMWThriftDataMessageTopic=M,l.toThriftServiceRecipient=w,l.fromMWThriftDismissReason=A,l.getConferenceTypeFromName=B,l.toThriftMWMediaStatusEx=W,l.toMWThriftDeviceStatus=q,l.toMWThriftMediaStatus=U,l.toMWThriftResponseStatusCode=V,l.toMWThriftResponseStatusSubCode=H,l.toThriftMWSyncStateStore=G,l.toMWThriftTrackLabel=z,l.toServiceRecipientType=j}),98);
__d("ZenonMWThriftMessageDebugLogger",["Log","LogHistory","MultiwayCommonTypes","ODS","RequestStreamBodyUtils","RpWebStateMachineLoggingBlocklist.experimental","ZenonAuditedCheckpointLogId","ZenonIceStatsParser","ZenonInfraActionsLogger","ZenonMWThriftMessageMap","ZenonMWThriftTranslatorUtils","formatDate","isEmployeeTestUserZenonLogging"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(){this.$1=o("LogHistory").getInstance("webrtc"),this.$2=new Set(r("RpWebStateMachineLoggingBlocklist.experimental").MESSAGE_TYPES)}var n=t.prototype;return n.$3=function(t,n,o){n===void 0&&(n=!0);var e=r("formatDate")(new Date,"[H:i:s:X]",{skipPatternLocalization:!0});this.$1.log("Console",e+" "+t),n&&r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"[ZP] "+t,messageID:o})},n.$4=function(t){var e=t.messageHeader.responseStatusCode;return e!=null},n.logMWThriftMessage=function(t,n,a){if(this.$5(t,n,a),!!r("isEmployeeTestUserZenonLogging")()){var e=a.messageHeader,i=o("ZenonMWThriftMessageMap").messageTypeToString(a.messageHeader.type),l=this.$4(a)?"RESPONSE":"REQUEST",s=this.$6(a),u="[ms] "+t+" ["+n+"] "+i+" "+l+" [retryCount: "+e.retryCount+(s!=null?" details: "+s:"")+"]";this.$2.has(i)||this.$3(u,!0,e.transactionId)}},n.$5=function(n,r,a){var t=this.$7(n,r,a);t!==null&&(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_signaling",t)},n.$7=function(t,n,r){var e=r.messageBody,a=r.messageHeader,i="";if(a.type!=null)switch(a.type){case o("MultiwayCommonTypes").MessageType.DATA_MESSAGE:if(e.dataMessageRequest){var l;i=(l=o("ZenonMWThriftTranslatorUtils").getGenericMWThriftDataMessageTopic(e.dataMessageRequest))!=null?l:"undefined"}break;default:break}var s=this.$4(r)?"RESPONSE":"REQUEST",u=o("ZenonMWThriftMessageMap").messageTypeToString(a.type);return i===""?t+"-"+n+"-"+u+"-"+s:t+"-"+n+"-"+u+"-"+s+"-"+i},n.$6=function(t){var e=t.messageHeader;if(o("MultiwayCommonTypes").MessageType==null||e.type==null)return null;switch(e.type){case o("MultiwayCommonTypes").MessageType.JOIN:return this.$8(t);case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:return this.$9(t);case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:return this.$10(t);case o("MultiwayCommonTypes").MessageType.SUBSCRIPTION:return this.$11(t);case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:return this.$12(t);default:return null}},n.$8=function(t){var e,n,r,a,i=t.messageBody,l=t.messageHeader;if(this.$4(t)){var s,u,c,d;return JSON.stringify({hasAnswer:((s=i.joinResponse)==null?void 0:s.answer)!=null,hasRenegotiationOffer:((u=i.joinResponse)==null?void 0:u.renegotiationOffer)!=null,isPendingApproval:(c=i.joinResponse)==null?void 0:c.isPendingApproval,multipleVideoStreamsAllowed:(d=i.joinResponse)==null?void 0:d.multipleVideoStreamsAllowed,statusCode:l.responseStatusCode,subCode:l.responseSubCode})}return JSON.stringify({deviceCapabilities:(e=i.joinRequest)==null?void 0:e.deviceCapabilities,sdpType:((n=i.joinRequest)==null?void 0:n.offer)!=null?"offer":((r=i.joinRequest)==null?void 0:r.answer)!=null?"answer":"null",userCapabilities:(a=i.joinRequest)!=null&&a.userCapabilities?o("RequestStreamBodyUtils").uint8ArrayToString(i.joinRequest.userCapabilities):""})},n.$9=function(t){var e,n,r,o,a,i,l,s,u=t.messageBody,c=t.messageHeader;if(this.$4(t)){var d,m;return JSON.stringify({currentVersion:(d=u.serverMediaUpdateResponse)==null?void 0:d.currentVersion,hasAnswer:((m=u.serverMediaUpdateResponse)==null?void 0:m.answer)!=null,statusCode:c.responseStatusCode,subCode:c.responseSubCode})}return JSON.stringify({fromVersion:(e=u.serverMediaUpdateRequest)==null?void 0:e.fromVersion,messageTags:c.messageTags,renegotiationRequested:(n=(r=u.serverMediaUpdateRequest)==null?void 0:r.renegotiationRequested)!=null?n:!1,sdpType:(o=u.serverMediaUpdateRequest)!=null&&o.offer?"offer":(a=u.serverMediaUpdateRequest)!=null&&a.answer?"answer":(i=u.serverMediaUpdateRequest)!=null&&i.update?"delta":"empty",toVersion:(l=(s=u.serverMediaUpdateRequest)==null?void 0:s.toVersion)!=null?l:""})},n.$10=function(t){var e,n,r,o,a=t.messageBody,i=t.messageHeader;if(this.$4(t)){var l,s;return JSON.stringify({currentVersion:(l=(s=a.clientMediaUpdateResponse)==null?void 0:s.currentVersion)!=null?l:"",statusCode:i.responseStatusCode,subCode:i.responseSubCode})}return JSON.stringify({fromVersion:(e=(n=a.clientMediaUpdateRequest)==null?void 0:n.fromVersion)!=null?e:"",toVersion:(r=(o=a.clientMediaUpdateRequest)==null?void 0:o.toVersion)!=null?r:""})},n.$11=function(t){var e,n,r=t.messageBody;return this.$4(t)?null:JSON.stringify({subscriptions:(e=(n=r.subscriptionRequest)==null?void 0:n.subscriptions)!=null?e:""})},n.$12=function(t){var e,n=t.messageBody;if(this.$4(t))return null;var r=(e=n.iceCandidateRequest)==null?void 0:e.iceCandidateSdps.map(function(e){var t=e.candidateSdpString;if(t!=null)return o("ZenonIceStatsParser").extractIceInfo(t)});return JSON.stringify({iceCandidates:r})},n.logSendMultiwayThriftMessageFailure=function(n,a,i){(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","send_message_failure"),e.flush();var t=i?"Stack Trace: "+i.stack+".":"Error msg: "+n;r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__ERROR,checkpoint:"Failed to send MW Thrift message of type "+a+". "+t})},t})(),u=new s;l.default=u}),98);
__d("ZenonMWMessageReliabilityLogTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["RECEIVED_REQUEST","RECEIVED_RESPONSE","PROCESSING_REQUEST","START_PROCESSING_RESPONSE","PROCESSING_RESPONSE","PROCESSED_REQUEST","PROCESSED_RESPONSE","SENDING_REQUEST","SENDING_RESPONSE","SENT_REQUEST","SENT_REQUEST_FROM_HANDLER","SENT_RESPONSE","SEND_REQUEST_FAILED","SEND_REQUEST_FAILED_FROM_HANDLER","SEND_RESPONSE_FAILED","SENT_SM_EVENT","PROCESSED_SM_EVENT","REQUEST_AFTER_NULL_CHECK","REQUEST_AFTER_TRANSLATION"]);i.ZenonMWMessageReliabilityEvent=e}),66);
__d("ZenonMWThriftResponseStatusCodeUtils",["MultiwayCommonTypes","ZenonMWMessageTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case o("MultiwayCommonTypes").RtcResponseStatusCode.OK:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK;case o("MultiwayCommonTypes").RtcResponseStatusCode.BAD_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.BAD_REQUEST;case o("MultiwayCommonTypes").RtcResponseStatusCode.UNAUTHORIZED:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.UNAUTHORIZED;case o("MultiwayCommonTypes").RtcResponseStatusCode.NOT_FOUND:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.NOT_FOUND;case o("MultiwayCommonTypes").RtcResponseStatusCode.METHOD_NOT_ALLOWED:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.METHOD_NOT_ALLOWED;case o("MultiwayCommonTypes").RtcResponseStatusCode.CONFLICT:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.CONFLICT;case o("MultiwayCommonTypes").RtcResponseStatusCode.CONDITIONAL_REQUEST_FAILED:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.CONDITIONAL_REQUEST_FAILED;case o("MultiwayCommonTypes").RtcResponseStatusCode.SERVER_INTERNAL_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.SERVER_INTERNAL_ERROR;case o("MultiwayCommonTypes").RtcResponseStatusCode.SERVICE_UNAVAILABLE:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.SERVICE_UNAVAILABLE}}function s(e){switch(e){case o("MultiwayCommonTypes").RtcResponseSubCode.UNKNOWN:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.UNKNOWN;case o("MultiwayCommonTypes").RtcResponseSubCode.EXCEEDED_MAX_ALLOWED_PARTICIPANTS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EXCEEDED_MAX_ALLOWED_PARTICIPANTS;case o("MultiwayCommonTypes").RtcResponseSubCode.MEMBERSHIP_CHECK_FAIL:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEMBERSHIP_CHECK_FAIL;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_THROTTLED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_THROTTLED;case o("MultiwayCommonTypes").RtcResponseSubCode.ENDPOINT_THROTTLED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.ENDPOINT_THROTTLED;case o("MultiwayCommonTypes").RtcResponseSubCode.MWS_MESSAGE_SENT_TO_INCORRECT_REGION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MWS_MESSAGE_SENT_TO_INCORRECT_REGION;case o("MultiwayCommonTypes").RtcResponseSubCode.UNSUPPORTED_REQUEST_TYPE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.UNSUPPORTED_REQUEST_TYPE;case o("MultiwayCommonTypes").RtcResponseSubCode.CLIENT_REQUEST_UNACCEPTABLE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CLIENT_REQUEST_UNACCEPTABLE;case o("MultiwayCommonTypes").RtcResponseSubCode.CLIENT_RESPONSE_UNACCEPTABLE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CLIENT_RESPONSE_UNACCEPTABLE;case o("MultiwayCommonTypes").RtcResponseSubCode.RING_RESPONSE_BODY_NOT_SET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.RING_RESPONSE_BODY_NOT_SET;case o("MultiwayCommonTypes").RtcResponseSubCode.SERVER_MEDIA_UPDATE_RESPONSE_BODY_NOT_SET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SERVER_MEDIA_UPDATE_RESPONSE_BODY_NOT_SET;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_SDP:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_SDP;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_CONFERENCE_NAME:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_CONFERENCE_NAME;case o("MultiwayCommonTypes").RtcResponseSubCode.SERVER_INFO_CONFERENCE_NAME_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SERVER_INFO_CONFERENCE_NAME_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_USER_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_USER_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.INCORRECT_VERSION_RANGE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INCORRECT_VERSION_RANGE;case o("MultiwayCommonTypes").RtcResponseSubCode.SENDER_ID_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SENDER_ID_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.RECIPIENT_NOT_SPECIFIED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.RECIPIENT_NOT_SPECIFIED;case o("MultiwayCommonTypes").RtcResponseSubCode.FIELD_NOT_ALLOWED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FIELD_NOT_ALLOWED;case o("MultiwayCommonTypes").RtcResponseSubCode.USERS_NOT_SPECIFIED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.USERS_NOT_SPECIFIED;case o("MultiwayCommonTypes").RtcResponseSubCode.REQUEST_UNACCEPTABLE_FOR_ENDPOINT_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REQUEST_UNACCEPTABLE_FOR_ENDPOINT_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_CALL_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_CALL_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.SESSION_DESCRIPTION_ID_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SESSION_DESCRIPTION_ID_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.EMPTY_CLIENT_MEDIA_UPDATES:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EMPTY_CLIENT_MEDIA_UPDATES;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_SERVER_INFO_DATA:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_SERVER_INFO_DATA;case o("MultiwayCommonTypes").RtcResponseSubCode.INCORRECT_STATE_VERSION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INCORRECT_STATE_VERSION;case o("MultiwayCommonTypes").RtcResponseSubCode.MISMATCHED_STATE_FOR_VERSION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISMATCHED_STATE_FOR_VERSION;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_STATE_VERSION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_STATE_VERSION;case o("MultiwayCommonTypes").RtcResponseSubCode.NO_RESOLVER_FOUND:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NO_RESOLVER_FOUND;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_APPROVERLIST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_APPROVERLIST;case o("MultiwayCommonTypes").RtcResponseSubCode.FULL_SDP_REQUIRED_IN_APPROVED_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FULL_SDP_REQUIRED_IN_APPROVED_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_BROADCAST_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_BROADCAST_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_ENDPOINT_CONFIG:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_ENDPOINT_CONFIG;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_E2EE_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_E2EE_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.SFU_MODE_PREVENTED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SFU_MODE_PREVENTED;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_CONFERENCE_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_CONFERENCE_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.JOIN_REQUEST_DENIED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.JOIN_REQUEST_DENIED;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_ENDPOINT:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_ENDPOINT;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_HEADER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_HEADER;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_BODY:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_BODY;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_PARAMS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_PARAMS;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_REMOVE_PARTICIPANTS_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_REMOVE_PARTICIPANTS_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_DATA_MESSAGE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_DATA_MESSAGE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_CLIENT_MEDIA_UPDATE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_CLIENT_MEDIA_UPDATE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_ADD_PARTICIPANTS_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_ADD_PARTICIPANTS_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_SUBSCRIPTION_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_SUBSCRIPTION_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_JOIN_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_JOIN_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_HANGUP_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_HANGUP_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_ICE_CANDIDATE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_ICE_CANDIDATE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_P2P_MESSAGE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_P2P_MESSAGE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_UPDATE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_UPDATE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_CLIENT_EVENT_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_CLIENT_EVENT_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_CONNECT_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_CONNECT_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_UNSUBSCRIBE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_UNSUBSCRIBE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_APPROVAL_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_APPROVAL_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_ENDPOINT_USER_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_ENDPOINT_USER_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.EMPTY_ENDPOINT_USER_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EMPTY_ENDPOINT_USER_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_TRANSFER_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_TRANSFER_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_GENERIC:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_GENERIC;case o("MultiwayCommonTypes").RtcResponseSubCode.REQUESTOR_NOT_MEMBER_CONFERENCE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REQUESTOR_NOT_MEMBER_CONFERENCE;case o("MultiwayCommonTypes").RtcResponseSubCode.NOT_BROADCAST_OWNER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NOT_BROADCAST_OWNER;case o("MultiwayCommonTypes").RtcResponseSubCode.GUEST_NOT_INVITED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.GUEST_NOT_INVITED;case o("MultiwayCommonTypes").RtcResponseSubCode.GUEST_DISCONNECTED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.GUEST_DISCONNECTED;case o("MultiwayCommonTypes").RtcResponseSubCode.GUEST_INVITATION_EXPIRED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.GUEST_INVITATION_EXPIRED;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_IN_PENDING_APPROVAL_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_IN_PENDING_APPROVAL_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_MULTIWAY_PARAMS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_MULTIWAY_PARAMS;case o("MultiwayCommonTypes").RtcResponseSubCode.BROADCAST_ALREADY_STOPPED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.BROADCAST_ALREADY_STOPPED;case o("MultiwayCommonTypes").RtcResponseSubCode.FAILED_TO_GENERATE_SDP_ANSWER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FAILED_TO_GENERATE_SDP_ANSWER;case o("MultiwayCommonTypes").RtcResponseSubCode.FAILED_GENERATE_SESSION_DESCRIPTION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FAILED_GENERATE_SESSION_DESCRIPTION;case o("MultiwayCommonTypes").RtcResponseSubCode.SDP_SESSION_ID_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SDP_SESSION_ID_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_ENDPOINT_GONE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_ENDPOINT_GONE;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_ENDPOINT_ALREADY_EXISTS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_ENDPOINT_ALREADY_EXISTS;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_ENDPOINT_EXISTS_DIFFERENT_SESSION_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_ENDPOINT_EXISTS_DIFFERENT_SESSION_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.LEGACY_MESSENGER_SENDER_UNSET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LEGACY_MESSENGER_SENDER_UNSET;case o("MultiwayCommonTypes").RtcResponseSubCode.FAILED_TO_SET_TRANSPORT_INFO:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FAILED_TO_SET_TRANSPORT_INFO;case o("MultiwayCommonTypes").RtcResponseSubCode.NON_PRIMARY_MULTIWAY_SERVER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NON_PRIMARY_MULTIWAY_SERVER;case o("MultiwayCommonTypes").RtcResponseSubCode.FAILED_TO_GET_REMOTE_DESCRIPTION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FAILED_TO_GET_REMOTE_DESCRIPTION;case o("MultiwayCommonTypes").RtcResponseSubCode.LOCAL_DESCRIPTION_NOT_SET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LOCAL_DESCRIPTION_NOT_SET;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_SDP_TYPE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_SDP_TYPE;case o("MultiwayCommonTypes").RtcResponseSubCode.CLIENT_MEDIA_UPDATE_WITHOUT_REMOTE_SDP_INFO:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CLIENT_MEDIA_UPDATE_WITHOUT_REMOTE_SDP_INFO;case o("MultiwayCommonTypes").RtcResponseSubCode.SDP_UNSET_ON_P2P_ANSWER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SDP_UNSET_ON_P2P_ANSWER;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_ICE_CANDIDATE_PAYLOAD:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_ICE_CANDIDATE_PAYLOAD;case o("MultiwayCommonTypes").RtcResponseSubCode.P2P_PROTOCOL_UNSET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.P2P_PROTOCOL_UNSET;case o("MultiwayCommonTypes").RtcResponseSubCode.CREATE_ACK_FOR_INVALID_MESSAGE_TYPE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CREATE_ACK_FOR_INVALID_MESSAGE_TYPE;case o("MultiwayCommonTypes").RtcResponseSubCode.LEGACY_CLIENT_CANNOT_JOIN_SFU_MODE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LEGACY_CLIENT_CANNOT_JOIN_SFU_MODE;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_UNSUPPORTED_IN_SFU_MODE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_UNSUPPORTED_IN_SFU_MODE;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_UNSUPPORTED_DURING_P2P_TO_SFU_ESCALATION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_UNSUPPORTED_DURING_P2P_TO_SFU_ESCALATION;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_UNSUPPORTED_FOR_JOINED_ENDPOINTS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_UNSUPPORTED_FOR_JOINED_ENDPOINTS;case o("MultiwayCommonTypes").RtcResponseSubCode.RESOLVE_STATE_API_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.RESOLVE_STATE_API_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.EXTERNAL_RESOLUTION_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EXTERNAL_RESOLUTION_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.INTERNAL_RESOLUTION_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INTERNAL_RESOLUTION_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.RESOLUTION_DISABLED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.RESOLUTION_DISABLED;case o("MultiwayCommonTypes").RtcResponseSubCode.BROADCAST_ID_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.BROADCAST_ID_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.SDP_UNSET_ON_P2P_OFFER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SDP_UNSET_ON_P2P_OFFER;case o("MultiwayCommonTypes").RtcResponseSubCode.LEGACY_OFFER_MISSING_REQUIRED_VALUE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LEGACY_OFFER_MISSING_REQUIRED_VALUE;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_SERVER_STATE_SYNC_DESERIALIZATION_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_SERVER_STATE_SYNC_DESERIALIZATION_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_UNSUPPORTED_FOR_PRECONNECTED_USERS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_UNSUPPORTED_FOR_PRECONNECTED_USERS;case o("MultiwayCommonTypes").RtcResponseSubCode.OTHER_USER_ANSWERED_THE_CALL:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.OTHER_USER_ANSWERED_THE_CALL;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_SERVER_DESERIALIZATION_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_SERVER_DESERIALIZATION_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.REMOTE_SDP_TRACKID_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REMOTE_SDP_TRACKID_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.SIGNALING_MESSAGE_TO_CLIENT_DROPPED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SIGNALING_MESSAGE_TO_CLIENT_DROPPED;case o("MultiwayCommonTypes").RtcResponseSubCode.DATA_CHANNEL_ENDPOINT_GONE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.DATA_CHANNEL_ENDPOINT_GONE;case o("MultiwayCommonTypes").RtcResponseSubCode.DATA_CHANNEL_ENDPOINT_ALREADY_EXISTS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.DATA_CHANNEL_ENDPOINT_ALREADY_EXISTS;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_NOT_FOUND:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_NOT_FOUND;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_IS_TERMINATING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_IS_TERMINATING;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_IS_TERMINATED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_IS_TERMINATED;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_NAME_EMPTY:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_NAME_EMPTY;case o("MultiwayCommonTypes").RtcResponseSubCode.NONCE_EMPTY:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NONCE_EMPTY;case o("MultiwayCommonTypes").RtcResponseSubCode.NONCE_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NONCE_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_HAS_GONE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_HAS_GONE;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_HAS_GONE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_HAS_GONE;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_SERVER_NOT_FOUND:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_SERVER_NOT_FOUND;case o("MultiwayCommonTypes").RtcResponseSubCode.CLIENT_TERMINATED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CLIENT_TERMINATED;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_CODECS_UNSUPPORTED_BY_CONFERENCE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_CODECS_UNSUPPORTED_BY_CONFERENCE;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_INCAPABLE_RENEGOTIATION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_INCAPABLE_RENEGOTIATION;case o("MultiwayCommonTypes").RtcResponseSubCode.REJECTING_CMU_WHEN_SMU_PENDING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REJECTING_CMU_WHEN_SMU_PENDING;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_NOT_SUBSCRIBED_TO_TOPIC:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_NOT_SUBSCRIBED_TO_TOPIC;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_ALREADY_IN_WAITING_ROOM:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_ALREADY_IN_WAITING_ROOM;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_NOT_IN_PENDING_APPROVAL:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_NOT_IN_PENDING_APPROVAL;case o("MultiwayCommonTypes").RtcResponseSubCode.USER_NOT_APPROVER_FOR_TARGET_USER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.USER_NOT_APPROVER_FOR_TARGET_USER;case o("MultiwayCommonTypes").RtcResponseSubCode.UNSUPPORTED_CAPABILITIES:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.UNSUPPORTED_CAPABILITIES;case o("MultiwayCommonTypes").RtcResponseSubCode.PRODUCT_SERVER_DEFINED_END_REASON:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PRODUCT_SERVER_DEFINED_END_REASON;case o("MultiwayCommonTypes").RtcResponseSubCode.WWW_KILLSWITCHED_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.WWW_KILLSWITCHED_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFLICTING_MEDIA_PATH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFLICTING_MEDIA_PATH;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFLICTING_MEDIA_STATUS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFLICTING_MEDIA_STATUS;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFLICTING_SESSION_DESCRIPTION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFLICTING_SESSION_DESCRIPTION;case o("MultiwayCommonTypes").RtcResponseSubCode.EMPTY_USER_IDS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EMPTY_USER_IDS;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_SDP_CONNECT_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_SDP_CONNECT_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.CALLER_HAS_APPEALABLE_CALLING_RESTRICTION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CALLER_HAS_APPEALABLE_CALLING_RESTRICTION;case o("MultiwayCommonTypes").RtcResponseSubCode.P2P_CONNECT_UNSUPPORTED_AFTER_SFU_ESCALATION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.P2P_CONNECT_UNSUPPORTED_AFTER_SFU_ESCALATION;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_CONFERENCE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_CONFERENCE;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_USER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_USER;case o("MultiwayCommonTypes").RtcResponseSubCode.REQUEST_TIMEOUT:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REQUEST_TIMEOUT;case o("MultiwayCommonTypes").RtcResponseSubCode.TOO_MANY_MEDIA_TRACKS_IN_SDP:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.TOO_MANY_MEDIA_TRACKS_IN_SDP;case o("MultiwayCommonTypes").RtcResponseSubCode.OK:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.OK;case o("MultiwayCommonTypes").RtcResponseSubCode.ENDPOINT_INFO_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.ENDPOINT_INFO_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.INVITE_USERS_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVITE_USERS_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.JOIN_SESSION_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.JOIN_SESSION_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.LOGGING_POLICY_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LOGGING_POLICY_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.STATE_SYNC_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.STATE_SYNC_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_NAME_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_NAME_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.SESSION_CONFIGURATION_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SESSION_CONFIGURATION_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.REMOVE_USERS_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REMOVE_USERS_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.UNEXPECTED_TRANSPORT_PARAMS_CONFERENCE_NAME:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.UNEXPECTED_TRANSPORT_PARAMS_CONFERENCE_NAME}}l.getResponseStatusCodeFromThrift=e,l.getResponseSubCodeFromThrift=s}),98);
__d("ZenonTransportChannelStatus",["cr:17347"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:17347")}),98);
__d("ZenonMWThriftMessageQPLLogger",["DateConsts","QPLMsgTypesSitevarConfig","QPLUserFlow","ZenonLoggingUtils","ZenonMWMessageReliabilityLogTypes","ZenonMWThriftMessageMap","ZenonMWThriftMessageTagUtils","ZenonMWThriftResponseStatusCodeUtils","ZenonTransportChannelStatus","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=30*o("DateConsts").MS_PER_SEC,s=new Map,u=new(r("ZenonTransportChannelStatus"));function c(e,t,n){var a,i,l,s,u,c;if(o("ZenonLoggingUtils").shouldAllowLogging()){var d=e.messageHeader,L=o("ZenonMWThriftMessageMap").messageTypeToString(e.messageHeader.type).toLowerCase();if(r("QPLMsgTypesSitevarConfig").QPL_MSG_TYPES.includes(L)){var E=m(d.transactionId);switch(t){case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_REQUEST:p(E,L,{connectionState:(a=n==null?void 0:n.connectionState)!=null?a:"",peerConnectionState:(i=n==null?void 0:n.peerConnectionState)!=null?i:"",signalingState:(l=n==null?void 0:n.signalingState)!=null?l:""},e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_REQUEST:_(E);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_RESPONSE:f(E,e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_RESPONSE:g(E,e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SEND_RESPONSE_FAILED:h(E,e,n==null?void 0:n.errorMessage);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_REQUEST:y(E,L,{connectionState:(s=n==null?void 0:n.connectionState)!=null?s:"",peerConnectionState:(u=n==null?void 0:n.peerConnectionState)!=null?u:"",signalingState:(c=n==null?void 0:n.signalingState)!=null?c:""},e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_REQUEST:C(E);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SEND_REQUEST_FAILED:b(E,n==null?void 0:n.errorMessage);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_RESPONSE:v(E,e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_SM_EVENT:S(E,n==null?void 0:n.smEvent);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_SM_EVENT:R(E,n==null?void 0:n.smEvent);return;default:return}}}}function d(e,t){o("ZenonLoggingUtils").shouldAllowLogging()&&r("QPLUserFlow").addAnnotations(r("qpl")._(398988976,"737"),{string:babelHelpers.extends({},t)},{instanceKey:+e})}function m(e){var t=isNaN(+e)?0:+e,n=9223372036854776e3;return Math.round(t%n)}function p(t,n,a,i){var l=u.getTransportName()+"State",c=babelHelpers.extends({},a,{messageType:n});if(c[l]=u.getConnectionState(),r("QPLUserFlow").start(r("qpl")._(398988976,"737"),{annotations:{int:{retryCount:i.messageHeader.retryCount},int_array:{messageTags:o("ZenonMWThriftMessageTagUtils").fromThriftMessageTags(i.messageHeader.messageTags)},string:c},instanceKey:t,timeoutInMs:e}),i.messageBody.serverMediaUpdateRequest){var d=i.messageBody.serverMediaUpdateRequest,m=d.answer,p=d.offer,_=d.update;r("QPLUserFlow").addAnnotations(r("qpl")._(398988976,"737"),{string:{sdpType:p?"offer":m?"answer":_?"delta":"empty"}},{instanceKey:t})}var f=function(n){r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),u.getTransportName()+"_"+n,{instanceKey:t})},g=u.addListener("connectionStateEvent",f);s.set(t,g)}function _(e){r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"processed_request",{instanceKey:e})}function f(e,t){var n=t.messageHeader,a=n.responseStatusCode,i=n.responseSubCode;r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"sending_response",{instanceKey:e}),r("QPLUserFlow").addAnnotations(r("qpl")._(398988976,"737"),{int:{responseStatusCode:a?o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(a):200,responseSubCode:i?o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(i):9e3}},{instanceKey:e})}function g(e,t){var n=t.messageHeader,a=n.responseStatusCode,i=n.responseSubCode;r("QPLUserFlow").endSuccess(r("qpl")._(398988976,"737"),{annotations:{int:{responseStatusCode:a?o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(a):200,responseSubCode:i?o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(i):9e3}},instanceKey:e});var l=s.get(e);l&&(u.removeListener(l),s.delete(e))}function h(e,t,n){var a=t.messageHeader,i=a.responseStatusCode,l=a.responseSubCode;r("QPLUserFlow").endFailure(r("qpl")._(398988976,"737"),"send_response_failed",{annotations:{int:{responseStatusCode:i?o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(i):200,responseSubCode:l?o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(l):9e3},string:{errorMessage:n}},instanceKey:e});var c=s.get(e);c&&(u.removeListener(c),s.delete(e))}function y(t,n,a,i){var l=u.getTransportName()+"State",s=babelHelpers.extends({},a,{messageType:n});s[l]=u.getConnectionState(),r("QPLUserFlow").start(r("qpl")._(398988976,"737"),{annotations:{int:{retryCount:i.messageHeader.retryCount},int_array:{messageTags:o("ZenonMWThriftMessageTagUtils").fromThriftMessageTags(i.messageHeader.messageTags)},string:s},instanceKey:t,timeoutInMs:e})}function C(e){r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"sending_request",{instanceKey:e})}function b(e,t){r("QPLUserFlow").endFailure(r("qpl")._(398988976,"737"),"send_request_failed",{annotations:{string:{errorMessage:t}},instanceKey:e})}function v(e,t){var n=t.messageHeader,a=n.responseStatusCode,i=n.responseSubCode;r("QPLUserFlow").endSuccess(r("qpl")._(398988976,"737"),{annotations:{int:{responseStatusCode:a?o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(a):200,responseSubCode:i?o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(i):9e3}},instanceKey:e})}function S(e,t){t!=null&&r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"sent_sm_event:"+t,{instanceKey:e})}function R(e,t){t!=null&&r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"processed_sm_event:"+t,{instanceKey:e})}l.log=c,l.updateState=d}),98);
__d("ZenonMWThriftMessageReliabilityLogger",["ODS","ZenonMWMessageReliabilityLogTypes","ZenonMWThriftMessageMap","ZenonMWThriftMessageQPLLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Map,u=new Map,c=new Map;function d(e){c.set(e,!0)}function m(e,t,n){var r=u.get(e);r&&k(r,t,n)}function p(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_REQUEST)}function _(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSING_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSING_REQUEST)}function f(e){v(e)||k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.REQUEST_AFTER_NULL_CHECK)}function g(e){v(e)||k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.REQUEST_AFTER_TRANSLATION)}function h(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_REQUEST)}function y(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_REQUEST)}function C(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_REQUEST)}function b(e,t){var n=v(e)?o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SEND_RESPONSE_FAILED:o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SEND_REQUEST_FAILED;k(e,n,{errorMessage:t})}function v(e){var t=e.messageHeader.responseStatusCode;return t!=null}function S(e){var t=isNaN(+e)?0:+e,n=9223372036854776e3;return Math.round(t%n)}function R(t,n){var r=o("ZenonMWThriftMessageMap").messageTypeToString(t.messageHeader.type).toLowerCase(),a=v(t)?"response":"request";switch(n){case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_REQUEST:case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_RESPONSE:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","receive_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSING_REQUEST:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","processing_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_REQUEST:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","processed_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_RESPONSE:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","sending_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.REQUEST_AFTER_TRANSLATION:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","after_translation_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.REQUEST_AFTER_NULL_CHECK:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","after_null_check_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_RESPONSE:case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_REQUEST:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","sent_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;default:return}}var L={connectionState:"",peerConnectionState:"",signalingState:""};function E(e){var t=babelHelpers.extends({},L,e);if(L.connectionState!==t.connectionState||L.peerConnectionState!==t.peerConnectionState||L.signalingState!==t.signalingState){L=t;for(var n of s.keys())o("ZenonMWThriftMessageQPLLogger").updateState(n,e)}}function k(e,t,n){var r,a=e.messageHeader,i=(r=s.get(a.transactionId))!=null?r:new Set;s.set(a.transactionId,i),!(t!==o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_SM_EVENT&&t!==o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_SM_EVENT&&i.has(t))&&(i.add(t),u.set(a.transactionId,e),R(e,t),o("ZenonMWThriftMessageQPLLogger").log(e,t,babelHelpers.extends({},n,L)))}l.setE2eeIsMandatedForCall=d,l.logEventForTxid=m,l.logReceivedMessage=p,l.logProcessingMessage=_,l.logMessageAfterNullCheck=f,l.logMessageAfterTranslation=g,l.logProcessedMessage=h,l.logSendingMessage=y,l.logSentMessage=C,l.logSendMessageFailed=b,l.updateState=E}),98);
__d("ZenonMWThriftMessageSerializer",["CompactSerializer","MqttThriftHeaderSerializers","MultiwayCommonSerializers","TCompactProtocol","TReadBuffer"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){t===void 0&&(t=!1);var n=o("CompactSerializer").serialize(e.messageHeader,o("MultiwayCommonSerializers").serializeRtcMessageHeader),r=o("CompactSerializer").serialize(e.messageBody,o("MultiwayCommonSerializers").serializeRtcMessageBody);if(t){var a=new Uint8Array(n.length+r.length);return a.set(n),a.set(r,n.length),a}var i={},l=o("CompactSerializer").serialize(i,o("MqttThriftHeaderSerializers").serializeMqttThriftHeader),s=new Uint8Array(l.length+n.length+r.length);return s.set(l),s.set(n,l.length),s.set(r,l.length+n.length),s}function s(e,t){t===void 0&&(t=!1);var n=new(r("TReadBuffer"))(e),a=new(r("TCompactProtocol"))(n);t||o("MqttThriftHeaderSerializers").deserializeMqttThriftHeader(a);var i=o("MultiwayCommonSerializers").deserializeRtcMessageHeader(a),l=o("MultiwayCommonSerializers").deserializeRtcMessageBody(a);return{messageBody:l,messageHeader:i}}l.serializeMWThriftMessage=e,l.deserializeMWThriftMessage=s}),98);
__d("ZenonMWThriftAddParticipantsTranslator",["MultiwayCommonTypes","RequestStreamBodyUtils","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e="new_room_context";function s(t,n){var r={usersToInvite:new Set(n.participants)};if(n.groupThreadId!=null){var a={calling_tags:2,group_thread_id:n.groupThreadId};if(a){var i=[{body:{genericMessage:{data:o("RequestStreamBodyUtils").stringToUint8Array(JSON.stringify(a)),topic:e}},header:{topic_DEPRECATED:e}}];r.appMessages=i}}return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:t,rtcMessageBody:{addParticipantsRequest:r},type:o("MultiwayCommonTypes").MessageType.ADD_PARTICIPANTS})}l.NEW_ROOM_CONTEXT=e,l.toThriftAddParticipantsRequest=s}),98);
__d("ZenonMWThriftApprovalTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=t.approvalStatus,r=t.targetUsers,a={approvalStatus:n===0?o("MultiwayCommonTypes").ApprovalStatus.DENIED:o("MultiwayCommonTypes").ApprovalStatus.APPROVED,targetUsers:new Set(r)};return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{approvalRequest:a},type:o("MultiwayCommonTypes").MessageType.APPROVAL})}l.toThriftApprovalRequest=e}),98);
__d("ZenonMWThriftClientEventTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n={clientEvents:[{type:t.clientEventType===0?o("MultiwayCommonTypes").ClientEventType.UNKNOWN:o("MultiwayCommonTypes").ClientEventType.MEDIA_CONNECTED}]};return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{clientEventRequest:n},type:o("MultiwayCommonTypes").MessageType.CLIENT_EVENT})}l.toThriftClientEventRequest=e}),98);
__d("ZenonMWCommonUtils",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.split("\n");if(t.length<2)throw r("FBLogger")("rtc_www").mustfixThrow("Expected SDP string with two or more lines, but got %s",t.length);var n=t[1].trim(),o=n.split(" ");if(o.length<3)throw r("FBLogger")("rtc_www").mustfixThrow("Session line should have at least 3 tokens, but got %s",o.length);var a=parseInt(o[2],10);if(isNaN(a))throw r("FBLogger")("rtc_www").mustfixThrow("SDP version could not be parsed as number.");return a}function s(e){return e.includes("BUNDLE 0")}l.getSdpVersion=e,l.isUnifiedPlan=s}),98);
__d("ZenonMWThriftClientMediaUpdateTranslator",["MultiwayCommonTypes","ZenonMWCommonUtils","ZenonMWThriftResponseStatusCodeUtils","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[],n=e.messageBody,r=e.messageHeader,a=n.clientMediaUpdateResponse,i=r.responseStatusCode,l=r.responseSubCode,s=r.retryAfterMsec;if(a){var u=a.answer,c=a.mediaStatus,d=u!=null&&c!=null;o("ZenonMWThriftTranslatorUtils").addThriftStateStoreSignalingEvents(a.stateStore,t,!1,d);var m=o("ZenonMWThriftTranslatorUtils").fetchE2eeServerState(a.stateStore);if(d){var p,_=(p=u==null?void 0:u.sdpString)!=null?p:"",f=o("ZenonMWThriftTranslatorUtils").toZenonMediaStatesFromThrift(c),g={ackMessageId:r.transactionId,eventName:"localSdpResponse",hasAnswerInJoinResponse:!1,source:"clientMediaUpdate"},h=a.renegotiationOffer,y=null;h!=null&&h.sdpString!=null&&(y={sdp:h.sdpString,type:"offer",version:o("ZenonMWCommonUtils").getSdpVersion(h.sdpString)});var C={e2eeServerState:m,eventName:"remoteSdpRequest",mediaPath:o("ZenonMWThriftTranslatorUtils").fromThriftMediaPath(a.mediaPath),mediaStates:f,negotiateType:!1,renegotiationOffer:y,sdp:{sdp:_,type:"answer",version:o("ZenonMWCommonUtils").getSdpVersion(_)},sdpOriginLocalId:a.sdpOriginLocalId,source:"clientMediaUpdateResponse"};t.push(g),t.push(C)}var b={ackMessageId:r.transactionId,acknowledgedVersion:Number(a.currentVersion),eventName:"mediaUpdateResponse",retryAfter:s!=null?s:0};i!=null&&(b.responseStatusCode=o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(i)),l!=null&&(b.responseSubCode=o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(l)),t.push(b)}return t}function s(e,t,n){var r={fromVersion:String(t.version),mediaUpdates:[{mediaStatus:o("ZenonMWThriftTranslatorUtils").toMWThriftMediaStatus(t),mediaStatusEx:o("ZenonMWThriftTranslatorUtils").toThriftMWMediaStatusEx(t)}],toVersion:String(t.version)};return n!==void 0&&(r.offer={sdpString:n.sdp}),o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{clientMediaUpdateRequest:r},type:o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE})}l.fromThriftClientMediaUpdateResponse=e,l.toThriftClientMediaUpdateRequest=s}),98);
__d("ZenonMWThriftConferenceStateTranslator",["MultiwayCommonTypes","RequestStreamBodyUtils","ZenonMWMessageTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[],n=e.messageBody.conferenceStateRequest;if(n){var r=n.appMessages,a=n.participantStates,i={eventName:"participantUpdateRequest",participantStates:new Map,sctpUserIdNodeIdMap:new Map,versionId:+n.version},l={actorRepresentatives:new Map,eventName:"clientInfoRequest",mediaPath:o("ZenonMWMessageTypes").ZenonMWMediaPath.UNKNOWN,userCapabilities:new Map};Object.keys(a).forEach(function(e){var t=a[e],n=t.sctpNodeId,r=t.state,s=t.userCapabilities;i.participantStates.set(e,o("ZenonMWThriftTranslatorUtils").fromThriftParticipantState(r)),n!=null&&i.sctpUserIdNodeIdMap.set(e,+n),l.userCapabilities.set(e,s?o("RequestStreamBodyUtils").uint8ArrayToString(s):"")}),t.push(i),t.push(l);var s=o("ZenonMWThriftTranslatorUtils").getCollisionContextFromThriftAppMessages(r);if(s){s.serverInfoData=e.messageHeader.serverInfoData;var u={context:s,eventName:"roomContextUpdateRequest"};t.push(u)}}return t}function s(e,t){var n={currentVersion:String(t.requestVersionId)};return o("ZenonMWThriftTranslatorUtils").createMWThriftResponse({header:e,rtcMessageBody:{conferenceStateResponse:n},type:o("MultiwayCommonTypes").MessageType.CONFERENCE_STATE})}l.fromThriftConferenceStateRequest=e,l.toThriftConferenceStateResponse=s}),98);
__d("ZenonMWThriftDataMessageTranslator",["MultiwayCommonTypes","RequestStreamBodyUtils","ZenonActorHooks","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[],n=e.messageBody.dataMessageRequest;if(n){var r=n.message.header,a=o("ZenonMWThriftTranslatorUtils").getGenericMWThriftDataMessageData(n),i=o("ZenonMWThriftTranslatorUtils").getGenericMWThriftDataMessageTopic(n),l=c(r.serviceRecipients);if(a!=null&&i!=null){var s,u={data:a,eventName:"genericDataMessageRequest",recipientIDs:Array.from((s=r.recipients)!=null?s:[]),serviceRecipients:l,topic:i};t.push(u)}}return t}function s(e,t){var n={data:o("RequestStreamBodyUtils").stringToUint8Array(t.data),topic:t.topic},r=new Set(t.serviceRecipients.map(o("ZenonMWThriftTranslatorUtils").toThriftServiceRecipient));return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{dataMessageRequest:{message:{body:{genericMessage:n},header:{recipients:new Set(t.recipientIDs),sender:o("ZenonActorHooks").ZenonActor.getID(),serviceRecipients:r,topic_DEPRECATED:""}}}},type:o("MultiwayCommonTypes").MessageType.DATA_MESSAGE})}function u(e){return o("ZenonMWThriftTranslatorUtils").createMWThriftResponse({header:e,rtcMessageBody:{dataMessageResponse:{deliveryResult:{}}},type:o("MultiwayCommonTypes").MessageType.DATA_MESSAGE})}function c(e){var t=[];return e==null||e.forEach(function(e){return t.push(o("ZenonMWThriftTranslatorUtils").toServiceRecipientType(e))}),t}l.fromThriftDataMessageRequest=e,l.toThriftDataMessageRequest=s,l.toThriftDataMessageResponse=u}),98);
__d("ZenonMWThriftDismissTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[],n=e.messageBody.dismissRequest;if(n){var r=n.detailedReasonString,a=n.reason,i={eventName:"terminateRequest",fromJoinResponse:!1,reason:o("ZenonMWThriftTranslatorUtils").fromMWThriftDismissReason(a),shouldInformPeer:!0,subreason:r};t.push(i)}return t}function s(e){return o("ZenonMWThriftTranslatorUtils").createMWThriftResponse({header:e,rtcMessageBody:{},type:o("MultiwayCommonTypes").MessageType.DISMISS})}l.fromThriftDismissRequest=e,l.toThriftDismissResponse=s}),98);
__d("ZenonMWThriftHangupTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[],n=e.messageHeader,r={ackMessageId:n.transactionId,eventName:"hangupResponse"};return t.push(r),t}function s(e,t){var n=t.reason,r={detailedReasonString:"",reason:o("ZenonMWThriftTranslatorUtils").toMWThriftHangupReason(n)};return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{hangupRequest:r},type:o("MultiwayCommonTypes").MessageType.HANGUP})}l.fromThriftHangupResponse=e,l.toThriftHangupRequest=s}),98);
__d("ZenonMWThriftIceCandidateTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[],n=e.messageBody.iceCandidateRequest;if(n){var r={eventName:"iceCandidateRequest",iceCandidates:n.iceCandidateSdps.map(function(e){var t;return{candidateSdpString:(t=e.candidateSdpString)!=null?t:"",sdpMid:e.sdpMid,sdpMLineIndex:parseInt(e.sdpMLineIndex,10)}})};t.push(r)}return t}function s(e){var t=[],n=e.messageHeader,r={ackMessageId:n.transactionId,eventName:"iceCandidateResponse"};return t.push(r),t}function u(e){return o("ZenonMWThriftTranslatorUtils").createMWThriftResponse({header:e,rtcMessageBody:{},type:o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE})}function c(e,t){var n=t.iceCandidates,r=n.map(function(e){return{candidateSdpString:e.candidateSdpString,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex.toString()}}),a={iceCandidateSdps:r};return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{iceCandidateRequest:a},type:o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE})}l.fromThriftIceCandidateRequest=e,l.fromThriftIceCandidateResponse=s,l.toThriftIceCandidateResponse=u,l.toThriftIceCandidateRequest=c}),98);
__d("ZenonBrowsers",["UserAgent","UserAgentData"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("UserAgent").isBrowser("Chrome")}function s(){return!!navigator.webkitGetUserMedia}function u(){return r("UserAgent").isBrowser("Edge (Chromium Based)")||r("UserAgent").isBrowser("Edge PWA (Chromium Based)")}function c(){return r("UserAgent").isBrowser("Safari")}function d(){return r("UserAgent").isBrowser("Firefox")}function m(){return r("UserAgent").isBrowser("Opera")}function p(){return r("UserAgent").isBrowser("Mobile Safari")}function _(){return r("UserAgent").isBrowser("Oculus Browser")}function f(){return r("UserAgent").isBrowser("Samsung Browser")}function g(){return p()||r("UserAgent").isPlatform("Android")||f()}function h(){return r("UserAgent").isPlatform("Android")||r("UserAgent").isPlatform("iOS")}function y(){if(d()){var e;return(e=r("UserAgentData").browserVersion)!=null?e:0}if(s()){var t=navigator.userAgent.match(/Chrom(e|ium)\/(\d+)\./);return t!=null?parseInt(t[2],10):999}return 0}function C(){return r("UserAgent").isBrowser("FBLite")||r("UserAgent").isBrowser("Facebook for Android")}function b(){return d()}function v(){return!_()}function S(){return!_()}function R(){return!p()&&!c()&&!((s()||e())&&y()<80)&&!(d()&&y()<70)}function L(){return(s()||e())&&y()>=77||r("UserAgent").isBrowser("Firefox >= 70")||r("UserAgent").isBrowser("Safari >= 14.1")}function E(){return!(r("UserAgent").isBrowser("Chrome > 105")&&r("UserAgent").isBrowser("Chrome < 115"))}function k(){return r("UserAgent").isBrowser("Chrome >= 89")||r("UserAgent").isBrowser("Opera >= 75")||r("UserAgent").isBrowser("Edge (Chromium Based) >= 89")||r("UserAgent").isBrowser("Edge PWA (Chromium Based) >= 89")}function I(){var e=r("UserAgent").isBrowser("Chrome >= 113")&&r("UserAgent").isBrowser("Chrome < 114"),t=(r("UserAgent").isBrowser("Edge (Chromium Based) >= 113")||r("UserAgent").isBrowser("Edge PWA (Chromium Based) >= 113"))&&(r("UserAgent").isBrowser("Edge (Chromium Based) < 114")||r("UserAgent").isBrowser("Edge PWA (Chromium Based) < 114")),n=r("UserAgent").isBrowser("Safari >= 16")&&r("UserAgent").isBrowser("Safari < 17");return e||t||n}function T(){return!(r("UserAgent").isBrowser("Chrome <= 113")||r("UserAgent").isBrowser("Edge (Chromium Based) <= 113")||r("UserAgent").isBrowser("Edge PWA (Chromium Based) <= 113"))}l.isChrome=e,l.isChromium=s,l.isChromiumBasedEdge=u,l.isDesktopSafari=c,l.isFirefox=d,l.isOpera=m,l.isMobileSafari=p,l.isOculusBrowser=_,l.isSamsung=f,l.isSupportedMobileBrowser=g,l.isMobileDevice=h,l.webrtcVersion=y,l.isFBWebview=C,l.noTransceiverForNegotiations=b,l.supportsMWAVEscalation=v,l.supportsVideoCalls=S,l.supportsRollback=R,l.supportsIceRestart=L,l.supportsPranswer=E,l.isVideoLayersAllocationSupported=k,l.isSctpdataChannelDisabled=I,l.isMidCallSCTPSupported=T}),98);
__d("ZenonJoiningContext",[],(function(t,n,r,o,a,i){"use strict";var e="joining_context";function l(e){var t=e.callablePostID,n=e.callingTags,r=e.callTrigger,o=e.conferenceName,a=e.groupThreadID,i=e.igThreadID,l=e.immersiveModeDoorID,s=e.isMetaAiCall,u=e.linkUrl,c=e.liveBroadcastID,d=e.meetingID,m=e.peerID,p=e.rtcDoorID,_=e.serverInfoData;return{call_trigger:r,callable_post_id:t,calling_tags:n,conference_name:o,group_thread_id:a,ig_thread_id:i,immersive_mode_door_id:l,is_meta_ai_call:s,link_url:u,live_broadcast_id:c,meeting_id:d,peer_id:m,rtc_door_id:p,server_info_data:_}}i.JOINING_CONTEXT_TOPIC=e,i.convertCollisionToJoiningContext=l}),66);
__d("ZenonIGMediaUtil",["ZenonAppProvider","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e={shouldUseSFUOnly:function(){return o("ZenonAppProvider").isInstagramApp()&&!r("gkx")("2274")}},s=e;l.default=s}),98);
__d("shouldUseSFUMediaPath",["UserAgent"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return!!r("UserAgent").isBrowser("Chrome <= 88")}l.default=e}),98);
__d("ZenonMWJoinUtils",["ZenonActorHooks","ZenonBrowsers","ZenonIGMediaUtil","shouldUseSFUMediaPath"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("ZenonBrowsers").isFirefox()&&e!=="answer"?!1:!r("ZenonIGMediaUtil").shouldUseSFUOnly()}function s(){return r("shouldUseSFUMediaPath")(!1)?!1:!o("ZenonBrowsers").isMobileSafari()&&!o("ZenonBrowsers").isDesktopSafari()&&!o("ZenonBrowsers").isFirefox()&&!o("ZenonBrowsers").isFBWebview()&&!o("ZenonActorHooks").ZenonActor.isInstagramUser()}l.canUseMwpp=e,l.canDeescalate=s}),98);
__d("ZenonMWThriftJoinTranslator",["FBLogger","MultiwayCommonTypes","MultiwaySharedTypes","RequestStreamBodyUtils","RoboticsPermission","ZenonAuditedCheckpointLogId","ZenonBrowsers","ZenonDismissReason","ZenonInfraActionsLogger","ZenonJoiningContext","ZenonMWCommonUtils","ZenonMWJoinUtils","ZenonMWThriftTranslatorUtils","ZenonScreenShare"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t,n,a=[],i=e.messageHeader,l=i.responseStatusCode,s=i.responseSubCode;if(l&&l!==o("MultiwayCommonTypes").RtcResponseStatusCode.OK){var c,d="JOIN response status code: "+String(l)+" subcode "+String(s!=null?s:"[undefined]");r("ZenonInfraActionsLogger").logError({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__ERROR,callType:"mw",checkpoint:"[ZP] Got non-OK "+d,errorDomain:"ZenonMWThriftMessageTranslator.fromThriftJoinResponse"});var m={detailedReasonFromMW:(c=i.responseStatusMessage)!=null?c:"",eventName:"terminateRequest",fromJoinResponse:!0,reason:u(l,i.responseSubCode),shouldInformPeer:!1,subreason:d};return a.push(m),a}var p=e.messageBody.joinResponse;if(!p)return a;var _=(t=(n=p.answer)==null?void 0:n.sdpString)!=null?t:"",f=_!=="";o("ZenonMWThriftTranslatorUtils").addThriftStateStoreSignalingEvents(p.stateStore,a,!1,f),o("ZenonMWThriftTranslatorUtils").maybeAddOverlayConfigServerUpdateRequestFromThrift(a,i);var g=o("ZenonMWThriftTranslatorUtils").fetchE2eeServerState(p.stateStore),h={ackMessageId:i.transactionId,eventName:"localSdpResponse",hasAnswerInJoinResponse:f,source:"joinResponse"};if(a.push(h),f){var y={sdp:_,type:"answer",version:o("ZenonMWCommonUtils").getSdpVersion(_)},C=o("ZenonMWThriftTranslatorUtils").toZenonMediaStatesFromThrift(p.mediaStatusEx),b=p.renegotiationOffer,v=null;b!=null&&b.sdpString!=null&&(v={sdp:b.sdpString,type:"offer",version:o("ZenonMWCommonUtils").getSdpVersion(b.sdpString)});var S={e2eeServerState:g,eventName:"remoteSdpRequest",mediaPath:o("ZenonMWThriftTranslatorUtils").fromThriftMediaPath(p.mediaPath),mediaStates:C,negotiateType:!1,renegotiationOffer:v,sdp:y,sdpOriginLocalId:p.sdpOriginLocalId,source:"joinResponse"};a.push(S)}var R={capabilities:{addParticipantEnabled:!0,cowatchEnabled:!0,cowatchGroupEnabled:!0,multipleVideoStreamsAllowed:p.multipleVideoStreamsAllowed},eventName:"capabilitiesRequest"};if(a.push(R),p.isPendingApproval){var L={eventName:"pendingApprovalRequest"};a.push(L)}var E=p.groupsOfUsers,k=new Map;E.forEach(function(e){var t=e.aliasId,n=e.users;t!=null&&n.forEach(function(e){k.set(e,t)})});var I={actorRepresentatives:k,eventName:"clientInfoRequest",mediaPath:o("ZenonMWThriftTranslatorUtils").fromThriftMediaPath(p.mediaPath),userCapabilities:new Map};return a.push(I),a}function s(e,t,n,a){var i,l,s=t.initialSyncStates,u=t.isSecondaryJoinRole,d=t.userCapabilities,m={clientMediaMode:n.mediaMode==="p2p"?o("MultiwaySharedTypes").MediaPath.P2P:o("MultiwaySharedTypes").MediaPath.SFU,deviceCapabilities:new Set([o("MultiwayCommonTypes").Capability.SUPPORT_NEW_PARTICIPANT_STATES,o("MultiwayCommonTypes").Capability.REQUIRE_FULL_SDP_IN_SMU,o("MultiwayCommonTypes").Capability.SUPPORT_SDP_RENEGOTIATION,o("MultiwayCommonTypes").Capability.REQUIRE_FULL_SDP_IN_SMU_OPTIMIZED,o("MultiwayCommonTypes").Capability.SUPPORT_DELTA_SMU].concat(o("ZenonBrowsers").supportsPranswer()?[o("MultiwayCommonTypes").Capability.SUPPORT_PRECONNECT]:[])),mediaStatus:o("ZenonMWThriftTranslatorUtils").toMWThriftMediaStatus(n.mediaStates),mediaStatusEx:o("ZenonMWThriftTranslatorUtils").toThriftMWMediaStatusEx(n.mediaStates),offer:{},syncPayload:s?{stateStore:o("ZenonMWThriftTranslatorUtils").toThriftMWSyncStateStore(s),stateStoreV2:{}}:void 0,userCapabilities:o("RequestStreamBodyUtils").stringToUint8Array((i=d.get(e.userInfo.userID))!=null?i:"")};u!=null&&(m.endpointSettings={joinMode:u?o("MultiwayCommonTypes").JoinMode.SECONDARY:o("MultiwayCommonTypes").JoinMode.PRIMARY});var p=t.isE2eeMandated===!0;m.e2eeEnforcement={infraMandatedExpStatus:t.e2eeInfraMandatedExpStatus,mode:p?o("MultiwaySharedTypes").E2eeMode.E2EE_MANDATED:o("MultiwaySharedTypes").E2eeMode.E2EE_NOT_MANDATED,p2pSFrameExpStatus:o("MultiwaySharedTypes").P2PSFrameExpStatus.NOT_SET,preventSfuMode:!1},n.sdp.type==="offer"&&(m.offer={sdpString:n.sdp.sdp}),o("ZenonMWJoinUtils").canUseMwpp(n.sdp.type)&&(m.deviceCapabilities.add(o("MultiwayCommonTypes").Capability.SUPPORT_MWPP),n.sdp.type==="answer"&&(m.answer={sdpString:n.sdp.sdp}),o("ZenonMWJoinUtils").canDeescalate()&&m.deviceCapabilities.add(o("MultiwayCommonTypes").Capability.SUPPORT_MWPP_DEESCALATION)),(!o("ZenonScreenShare").screenShareWithReplaceTrack()||r("RoboticsPermission").is_authorized_robot)&&m.deviceCapabilities.add(o("MultiwayCommonTypes").Capability.SUPPORT_MULTIPLE_VIDEO_STREAMS);var _=a==null?void 0:a.otherParticipants;_&&(m.usersToCall=new Set(_));var f=[],g=(l=a==null?void 0:a.roomInfo.context)!=null?l:e.roomInfo.context;if(g!=null){var h=o("ZenonJoiningContext").convertCollisionToJoiningContext(g);p&&(h.calling_tags=2),f=[].concat(f,[{body:{genericMessage:{data:o("RequestStreamBodyUtils").stringToUint8Array(JSON.stringify(h)),topic:o("ZenonJoiningContext").JOINING_CONTEXT_TOPIC}},header:{topic_DEPRECATED:o("ZenonJoiningContext").JOINING_CONTEXT_TOPIC}}])}(a==null?void 0:a.appMessages)!=null&&(f=[].concat(f,o("ZenonMWThriftTranslatorUtils").signalingMessageAppMessagesToThriftMWAppMessages(a.appMessages,_))),m.appMessages=f;var y=o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{joinRequest:m},type:o("MultiwayCommonTypes").MessageType.JOIN});return g&&g.serverInfoData!=null&&(y.messageHeader.serverInfoData=g.serverInfoData),c(g,y.messageHeader)&&(y.messageHeader.conferenceType=o("MultiwaySharedTypes").ConferenceType.ROOM),y}function u(e,t){if(t===o("MultiwayCommonTypes").RtcResponseSubCode.EXCEEDED_MAX_ALLOWED_PARTICIPANTS)return o("ZenonDismissReason").ZenonDismissReason.MaxAllowedParticipantsReached;if(t===o("MultiwayCommonTypes").RtcResponseSubCode.PRODUCT_SERVER_DEFINED_END_REASON)return o("ZenonDismissReason").ZenonDismissReason.ProductServerDefinedEndReason;if(t===o("MultiwayCommonTypes").RtcResponseSubCode.CALLER_HAS_APPEALABLE_CALLING_RESTRICTION)return o("ZenonDismissReason").ZenonDismissReason.CallerHasAppealableCallingRestriction;switch(e){case o("MultiwayCommonTypes").RtcResponseStatusCode.METHOD_NOT_ALLOWED:case o("MultiwayCommonTypes").RtcResponseStatusCode.UNAUTHORIZED:return o("ZenonDismissReason").ZenonDismissReason.NoPermission;case o("MultiwayCommonTypes").RtcResponseStatusCode.SERVICE_UNAVAILABLE:return o("ZenonDismissReason").ZenonDismissReason.SignalingMessageFailed;case o("MultiwayCommonTypes").RtcResponseStatusCode.OK:throw r("FBLogger")("rtc_www").mustfixThrow("Response status code is OK; should not return a dismiss reason");default:return r("ZenonInfraActionsLogger").logError({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__ERROR,callType:"mw",error:"[ZP] Got unexpected JOIN response status: "+String(e)+" subcode "+String(t!=null?t:"[undefined]"),errorDomain:"fromMWThriftJoinResponseStatusToDismissReason"}),o("ZenonDismissReason").ZenonDismissReason.UnexpectedEndOfCall}}function c(e,t){return((e==null?void 0:e.peerID)!=null||(e==null?void 0:e.groupThreadID)!=null)&&t.conferenceName===""}l.fromThriftJoinResponse=e,l.toThriftJoinRequest=s}),98);
__d("ZenonMWThriftPingTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[],n=e.messageHeader,r={ackMessageId:n.transactionId,eventName:"pingResponse"};return t.push(r),t}function s(e){return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{},type:o("MultiwayCommonTypes").MessageType.PING})}l.fromThriftPingResponse=e,l.toThriftPingRequest=s}),98);
__d("ZenonMWThriftRemoveParticipantsTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n={usersToRemove:new Set(t.participants)};return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{removeParticipantsRequest:n},type:o("MultiwayCommonTypes").MessageType.REMOVE_PARTICIPANTS})}l.toThriftRemoveParticipantsRequest=e}),98);
__d("ZenonMWThriftRingTranslator",["MultiwayCommonTypes","MultiwaySharedTypes","ZenonMWCommonUtils","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){if(t)return{groupThreadID:t.groupThreadId,peerID:t.peerId,serverInfoData:n};var r=o("ZenonMWThriftTranslatorUtils").getCollisionContextFromThriftAppMessages(e);return r&&(r.serverInfoData=n),r!=null?r:{groupThreadID:null,peerID:null,serverInfoData:n}}function s(t,n){var r=[],a=t.messageBody,i=t.messageHeader,l=a.ringRequest;if(l){var s,u,c,d=l.appMessages,m=l.caller,p=l.e2eeEnforcement,_=l.otherParticipants,f=l.ringType,g=l.sdpOriginLocalId,h=l.threadIdInfo,y=m,C=f===o("MultiwayCommonTypes").RingType.PEER_VIDEO_CALL||f===o("MultiwayCommonTypes").RingType.GROUP_VIDEO_CALL||f===o("MultiwayCommonTypes").RingType.LIVE_STREAM||f===o("MultiwayCommonTypes").RingType.PEER_ESCALATED_AUDIO_CALL,b=i.conferenceName,v=i.serverInfoData,S=e(d,h,v),R=o("ZenonMWThriftTranslatorUtils").getRoomMetadataFromThriftAppMessages(d),L={actorID:n.actorID,e2eeInfraMandatedExpStatus:p==null?void 0:p.infraMandatedExpStatus,eventName:"inviteRequest",inviterID:y,isE2eeMandated:(p==null?void 0:p.mode)===o("MultiwaySharedTypes").E2eeMode.E2EE_MANDATED,isRemoteOfferer:!1,otherParticipants:Array.from(_),requestingVideo:C,roomInfo:babelHelpers.extends({context:S,name:b},R==null?{}:{room:R,sender:R.sender}),userID:n.userInfo.userID};v!=null&&(L.serverInfoData=v),d!=null&&(L.appMessages=o("ZenonMWThriftTranslatorUtils").mwThriftAppMessagesToSignalingAppMessages(d)),r.push(L);var E=(s=(u=l.offer)==null?void 0:u.sdpString)!=null?s:"",k=(c=l.mediaStatusEx)!=null?c:null;if(E!==""&&k!=null){var I={sdp:E,type:"offer",version:o("ZenonMWCommonUtils").getSdpVersion(E)},T=o("ZenonMWThriftTranslatorUtils").toZenonMediaStatesFromThrift(k),D={eventName:"remoteSdpRequest",mediaPath:o("ZenonMWThriftTranslatorUtils").fromThriftMediaPath(l.mediaPath),mediaStates:T,negotiateType:!1,sdp:I,sdpOriginLocalId:g,source:"ringRequest"};r.push(D)}}return r}function u(e,t){var n=t.status;n==="IN_ANOTHER_CALL"&&(e.signalingID=null);var r=o("ZenonMWThriftTranslatorUtils").toMWThriftDeviceStatus(n),a={deviceStatus:r};return o("ZenonMWThriftTranslatorUtils").createMWThriftResponse({header:e,rtcMessageBody:{ringResponse:a},type:o("MultiwayCommonTypes").MessageType.RING})}l.fromThriftRingRequest=s,l.toThriftRingResponse=u}),98);
__d("ZenonMWThriftServerMediaUpdateTranslator",["FBLogger","MultiwayCommonTypes","ZenonAuditedCheckpointLogId","ZenonBrowsers","ZenonInfraActionsLogger","ZenonMWCommonUtils","ZenonMWThriftMessageReliabilityLogger","ZenonMWThriftMessageTagUtils","ZenonMWThriftTranslatorUtils","ZenonODSLogger","ZenonScreenShare"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t,n,a,i=[],l=e.messageBody.serverMediaUpdateRequest,u=e.messageHeader,c=u.messageTags,d=u.transactionId;if(!l)return i;var m=l.answer,p=l.fromVersion,_=l.mediaPath,f=l.mediaStatus,g=l.multipleVideoStreamsAllowed,h=l.offer,y=l.prAnswer,C=l.renegotiationRequested,b=l.sdpOriginLocalId,v=l.stateStore,S=l.toVersion,R=l.update,L=[h,m,y].some(function(e){return(e==null?void 0:e.sdpCompressionVersion)!=null});if(L){r("ZenonODSLogger").logCounter("compressed_sdp_received");var E="Compressed SDP is not supported;";r("FBLogger")("rpweb").warn(E+" TXID = %s",d),r("ZenonInfraActionsLogger").logError({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__ERROR,error:E+" TXID = "+d,errorDomain:"ZenonMWThriftServerMediaUpdateTranslator"})}var k=(t=h==null?void 0:h.sdpString)!=null?t:"",I=(n=m==null?void 0:m.sdpString)!=null?n:"",T=(a=y==null?void 0:y.sdpString)!=null?a:"",D=+p,x=+S,$=o("ZenonMWThriftTranslatorUtils").fromThriftMediaPath(_),P=o("ZenonMWThriftMessageTagUtils").fromThriftMessageTags(c),N=function(){o("ZenonMWThriftMessageReliabilityLogger").logProcessedMessage(e)},M=k!=="",w=I!=="",A=o("ZenonBrowsers").supportsPranswer()&&T!=="",F=R!==null,O=M||w||A||F;o("ZenonMWThriftTranslatorUtils").addThriftStateStoreSignalingEvents(v,i,!1,O);var B=o("ZenonMWThriftTranslatorUtils").fetchE2eeServerState(v);if(C){r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"SMU type 1: renegotationRequested"});var W={ackMessageId:d,eventName:"initiateRenegotiationRequest",fromVersion:D,hasRemoteOffer:k!=="",mediaPath:$,messageTags:P!=null?P:[],onProcessed:N,version:x};if(i.push(W),M){var q=s(d,D,$,f,{sdp:k,type:"offer",version:o("ZenonMWCommonUtils").getSdpVersion(k)},b,N,P,B);i.push(q)}}else if(w){r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"SMU type 2: answer SDP"});var U=s(d,D,$,f,{sdp:I,type:"answer",version:o("ZenonMWCommonUtils").getSdpVersion(I)},b,N,P,B);if(U.sdp.sdp!=null&&o("ZenonMWCommonUtils").isUnifiedPlan(U.sdp.sdp)){var V={sdp:I,type:"offer",version:o("ZenonMWCommonUtils").getSdpVersion(I)};U.renegotiationOffer=V}i.push(U)}else if(M){r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"SMU type 3: offer SDP"});var H=s(d,D,$,f,{sdp:k,type:"offer",version:o("ZenonMWCommonUtils").getSdpVersion(k)},b,N,P,B);i.push(H)}else if(R){r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"SMU type 4: delta SDP"});var G=s(d,D,$,f,{type:"offer",update:R,version:x},b,N,P,B);i.push(G)}else if(A){r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"SMU type 5: prAnswer SDP"});var z=s(d,D,$,f,{sdp:T,type:"pranswer",version:o("ZenonMWCommonUtils").getSdpVersion(T)},b,N,P,B);i.push(z)}else if(f){r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"SMU type 6: media update"});var j={ackMessageId:d,eventName:"mediaUpdateRequest",mediaStates:o("ZenonMWThriftTranslatorUtils").toZenonMediaStatesFromThrift(f,D,x),messageTags:P!=null?P:[],onProcessed:N};i.push(j)}else{var K="Warning: unsupported SMU type. TXID: "+d;r("FBLogger")("rpweb").warn(K),r("ZenonInfraActionsLogger").logError({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__ERROR,error:K,errorDomain:"ZenonMWThriftServerMediaUpdateTranslator"})}o("ZenonMWThriftTranslatorUtils").maybeAddOverlayConfigServerUpdateRequestFromThrift(i,u);var Q={capabilities:{multipleVideoStreamsAllowed:g},eventName:"capabilitiesRequest",messageTags:P!=null?P:[]};return i.push(Q),i}function s(e,t,n,r,a,i,l,s,u){return{ackMessageId:e,e2eeServerState:u,eventName:"remoteSdpRequest",fromVersion:t,mediaPath:n,mediaStates:o("ZenonMWThriftTranslatorUtils").toZenonMediaStatesFromThrift(r),messageTags:s!=null?s:[],negotiateType:!1,onProcessed:l,sdp:a,sdpOriginLocalId:i,source:"serverMediaUpdateRequest"}}function u(e,t,n,r){var a;return m({acknowledgedVersion:t.acknowledgedVersion,answer:r,header:e,mediaStates:n,statusCode:o("ZenonMWThriftTranslatorUtils").toMWThriftResponseStatusCode(t.statusCode),subCode:(a=o("ZenonMWThriftTranslatorUtils").toMWThriftResponseStatusSubCode(t.subCode))!=null?a:void 0})}function c(e,t){var n;return m({acknowledgedVersion:t.acknowledgedVersion,header:e,statusCode:o("ZenonMWThriftTranslatorUtils").toMWThriftResponseStatusCode(t.statusCode),subCode:(n=o("ZenonMWThriftTranslatorUtils").toMWThriftResponseStatusSubCode(t.subCode))!=null?n:void 0})}function d(e,t){var n;return m({acknowledgedVersion:t.acknowledgedVersion,header:e,statusCode:(n=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(t.responseStatusCode))!=null?n:o("MultiwayCommonTypes").RtcResponseStatusCode.CONDITIONAL_REQUEST_FAILED,subCode:o("MultiwayCommonTypes").RtcResponseSubCode.cast(t.responseSubCode)})}function m(e){var t=e.acknowledgedVersion,n=e.answer,r=e.header,a=e.mediaStates,i=e.statusCode,l=e.subCode,s={currentVersion:String(t)};return a&&(s.mediaStatus=p(a)),n&&(s.answer={sdpString:n.sdp}),o("ZenonMWThriftTranslatorUtils").createMWThriftResponse({header:r,rtcMessageBody:{serverMediaUpdateResponse:s},statusCode:i,subCode:l,type:o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE})}function p(e){var t={tracks:{}},n=!o("ZenonScreenShare").screenShareWithReplaceTrack();return e.tracks.forEach(function(e){var r={customAudioContentType:void 0,customVideoContentType:void 0,enabled:e.enabled,name:e.name,owner:e.participantID},a=n?o("ZenonMWThriftTranslatorUtils").toMWThriftTrackLabel(e.type):null;a!=null&&(r.label=a),t.tracks[e.trackID]=r}),t}l.fromThriftServerMediaUpdateRequest=e,l.toThriftServerMediaUpdateResponse=u,l.toThriftServerMediaUpdateRenegotiationResponse=c,l.toThriftServerMediaUpdateNoSdpResponse=d}),98);
__d("ZenonMWThriftStateSyncTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.messageBody.updateResponse,n=e.messageHeader.transactionId;if(!t)return[];var r=t.topic,o=t.version,a={ackMessageId:n,eventName:"stateSyncUpdateResponse",topic:r,version:o};return[a]}function s(e){var t=e.messageBody.notifyRequest;if(!t)return[];var n=[];if(t.syncPayload!=null)o("ZenonMWThriftTranslatorUtils").addThriftStateStoreSignalingEvents(t.syncPayload.stateStore,n,!0,!1);else{var r=t.data,a=t.topic,i=t.version,l={data:r,eventName:"stateSyncNotifyRequest",responseRequired:!0,topic:a,version:i};n.push(l)}return n}function u(e){var t=e.messageBody.unsubscribeResponse,n=e.messageHeader.transactionId;if(!t)return[];var r=t.topic,o=t.version,a={ackMessageId:n,eventName:"stateSyncUnsubscribeResponse",topic:r,version:o};return[a]}function c(e,t){var n=t.data,r=t.topic,a=t.version,i={data:n,syncPayload:{stateStore:{},stateStoreV2:{}},topic:r,topicId:null,version:a};return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{updateRequest:i},type:o("MultiwayCommonTypes").MessageType.UPDATE})}function d(e,t){var n=t.topic,r=t.version,a={topic:n,version:r};return o("ZenonMWThriftTranslatorUtils").createMWThriftResponse({header:e,rtcMessageBody:{notifyResponse:a},type:o("MultiwayCommonTypes").MessageType.NOTIFY})}function m(e,t){var n=t.topic,r=t.version,a={topic:n,topicId:null,version:r};return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{unsubscribeRequest:a},type:o("MultiwayCommonTypes").MessageType.UNSUBSCRIBE})}l.fromThriftUpdateResponse=e,l.fromThriftNotifyRequest=s,l.fromThriftUnsubscribeResponse=u,l.toThriftUpdateRequest=c,l.toThriftNotifyResponse=d,l.toThriftUnsubscribeRequest=m}),98);
__d("ZenonMWThriftSubscriptionTranslator",["MultiwayCommonTypes","MultiwaySharedTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=t.subscriptions,r={subscriptions:n.map(function(e){var t;return{cname:"",options:{videoQuality:o("MultiwaySharedTypes").VideoQuality.cast((t=e.options)==null?void 0:t.videoQuality)},trackId:e.trackId,type:o("MultiwaySharedTypes").SubscriptionType.cast(e.type)}})};return o("ZenonMWThriftTranslatorUtils").createMWThriftRequest({header:e,rtcMessageBody:{subscriptionRequest:r},type:o("MultiwayCommonTypes").MessageType.SUBSCRIPTION})}l.toThriftSubscriptionRequest=e}),98);
__d("ZenonMWThriftWakeupTranslator",["MultiwayCommonTypes","ZenonMWThriftTranslatorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[],n=e.messageHeader,r={ackMessageId:n.transactionId,eventName:"wakeupRequest"};return t.push(r),t}function s(e){return o("ZenonMWThriftTranslatorUtils").createMWThriftResponse({header:e,rtcMessageBody:{},type:o("MultiwayCommonTypes").MessageType.WAKEUP})}l.fromThriftWakeupRequest=e,l.toThriftWakeupResponse=s}),98);
__d("ZenonSignalingMessage",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.getHeader=function(){return this.$1},t.getEvents=function(){return this.$2},t.setSignalingID=function(t){this.$1.signalingID=t},t.setRetryCount=function(t){this.$1.retryCount=t},e})();i.default=e}),66);
__d("ZenonMWThriftMessageTranslator",["DGWWebConfig","FBLogger","MultiwayCommonTypes","ZenonActorHooks","ZenonMWThriftAddParticipantsTranslator","ZenonMWThriftApprovalTranslator","ZenonMWThriftClientEventTranslator","ZenonMWThriftClientMediaUpdateTranslator","ZenonMWThriftConferenceStateTranslator","ZenonMWThriftDataMessageTranslator","ZenonMWThriftDismissTranslator","ZenonMWThriftHangupTranslator","ZenonMWThriftIceCandidateTranslator","ZenonMWThriftJoinTranslator","ZenonMWThriftPingTranslator","ZenonMWThriftRemoveParticipantsTranslator","ZenonMWThriftRingTranslator","ZenonMWThriftServerMediaUpdateTranslator","ZenonMWThriftStateSyncTranslator","ZenonMWThriftSubscriptionTranslator","ZenonMWThriftTranslatorUtils","ZenonMWThriftWakeupTranslator","ZenonSignalingMessage"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.getHeader(),n=e.getEvents();if(n.length===0)throw r("FBLogger")("rtc_www").mustfixThrow("Unexpected Translation: called toMWThriftMessage with empty signaling events");var a=n[0];switch(a.eventName){case"addParticipantsRequest":return o("ZenonMWThriftAddParticipantsTranslator").toThriftAddParticipantsRequest(t,a);case"clientEventRequest":return o("ZenonMWThriftClientEventTranslator").toThriftClientEventRequest(t,a);case"clientInfoRequest":if(n.length>=2&&n[1].eventName==="localSdpRequest"&&(n[1].sdp.type==="offer"||n[1].sdp.type==="answer"))return o("ZenonMWThriftJoinTranslator").toThriftJoinRequest(t,a,n[1]);break;case"dismissResponse":return o("ZenonMWThriftDismissTranslator").toThriftDismissResponse(t);case"genericDataMessageRequest":return o("ZenonMWThriftDataMessageTranslator").toThriftDataMessageRequest(t,a);case"genericDataMessageResponse":return o("ZenonMWThriftDataMessageTranslator").toThriftDataMessageResponse(t);case"terminateRequest":return o("ZenonMWThriftHangupTranslator").toThriftHangupRequest(t,a);case"initiateRenegotiationResponse":return n.length>=3&&n[1].eventName==="remoteSdpResponse"&&n[2].eventName==="localSdpRequest"&&n[2].sdp.type==="answer"?o("ZenonMWThriftServerMediaUpdateTranslator").toThriftServerMediaUpdateResponse(t,n[1],n[2].mediaStates,n[2].sdp):o("ZenonMWThriftServerMediaUpdateTranslator").toThriftServerMediaUpdateRenegotiationResponse(t,a);case"inviteRequest":if(n.length>=3&&n[1].eventName==="clientInfoRequest"&&n[2].eventName==="localSdpRequest"&&n[2].sdp.type==="offer")return o("ZenonMWThriftJoinTranslator").toThriftJoinRequest(t,n[1],n[2],a);break;case"inviteResponse":return o("ZenonMWThriftRingTranslator").toThriftRingResponse(t,a);case"iceCandidateRequest":return o("ZenonMWThriftIceCandidateTranslator").toThriftIceCandidateRequest(t,a);case"iceCandidateResponse":return o("ZenonMWThriftIceCandidateTranslator").toThriftIceCandidateResponse(t);case"participantUpdateResponse":return o("ZenonMWThriftConferenceStateTranslator").toThriftConferenceStateResponse(t,a);case"localSdpRequest":return o("ZenonMWThriftClientMediaUpdateTranslator").toThriftClientMediaUpdateRequest(t,a.mediaStates,a.sdp);case"mediaUpdateRequest":return o("ZenonMWThriftClientMediaUpdateTranslator").toThriftClientMediaUpdateRequest(t,a.mediaStates);case"mediaUpdateResponse":return o("ZenonMWThriftServerMediaUpdateTranslator").toThriftServerMediaUpdateNoSdpResponse(t,a);case"pingRequest":return o("ZenonMWThriftPingTranslator").toThriftPingRequest(t);case"remoteSdpResponse":return a.type==="offer"&&n.length>=2&&n[1].eventName==="localSdpRequest"&&n[1].sdp.type==="answer"?n[1].mediaMode!=="p2p"?o("ZenonMWThriftServerMediaUpdateTranslator").toThriftServerMediaUpdateResponse(t,a,n[1].mediaStates):o("ZenonMWThriftServerMediaUpdateTranslator").toThriftServerMediaUpdateResponse(t,a,n[1].mediaStates,n[1].sdp):o("ZenonMWThriftServerMediaUpdateTranslator").toThriftServerMediaUpdateResponse(t,a);case"removeParticipantsRequest":return o("ZenonMWThriftRemoveParticipantsTranslator").toThriftRemoveParticipantsRequest(t,a);case"subscriptionRequest":return o("ZenonMWThriftSubscriptionTranslator").toThriftSubscriptionRequest(t,a);case"stateSyncNotifyResponse":return o("ZenonMWThriftStateSyncTranslator").toThriftNotifyResponse(t,a);case"stateSyncUpdateRequest":return o("ZenonMWThriftStateSyncTranslator").toThriftUpdateRequest(t,a);case"stateSyncUnsubscribeRequest":return o("ZenonMWThriftStateSyncTranslator").toThriftUnsubscribeRequest(t,a);case"usersApprovalRequest":return o("ZenonMWThriftApprovalTranslator").toThriftApprovalRequest(t,a);case"wakeupResponse":return o("ZenonMWThriftWakeupTranslator").toThriftWakeupResponse(t)}return null}function s(e){var t=e.messageHeader;if(!u(t))return r("FBLogger")("rtc_www").info("Ignoring Thrift MW message; receiver does not match self ID","rtc_www"),null;var n=t.type,a=t.responseStatusCode==null,i=o("ZenonMWThriftTranslatorUtils").mwThriftMessageHeaderToSignalingMessageHeader(t),l=[];if(n==null)return new(r("ZenonSignalingMessage"))(i,l);switch(n){case o("MultiwayCommonTypes").MessageType.RING:a&&(l=o("ZenonMWThriftRingTranslator").fromThriftRingRequest(e,i));break;case o("MultiwayCommonTypes").MessageType.JOIN:a||(l=o("ZenonMWThriftJoinTranslator").fromThriftJoinResponse(e));break;case o("MultiwayCommonTypes").MessageType.CONFERENCE_STATE:a&&(l=o("ZenonMWThriftConferenceStateTranslator").fromThriftConferenceStateRequest(e));break;case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:a||(l=o("ZenonMWThriftClientMediaUpdateTranslator").fromThriftClientMediaUpdateResponse(e));break;case o("MultiwayCommonTypes").MessageType.HANGUP:a||(l=o("ZenonMWThriftHangupTranslator").fromThriftHangupResponse(e));break;case o("MultiwayCommonTypes").MessageType.PING:a||(l=o("ZenonMWThriftPingTranslator").fromThriftPingResponse(e));break;case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:a?l=o("ZenonMWThriftIceCandidateTranslator").fromThriftIceCandidateRequest(e):l=o("ZenonMWThriftIceCandidateTranslator").fromThriftIceCandidateResponse(e);break;case o("MultiwayCommonTypes").MessageType.DATA_MESSAGE:a&&(l=o("ZenonMWThriftDataMessageTranslator").fromThriftDataMessageRequest(e));break;case o("MultiwayCommonTypes").MessageType.DISMISS:a&&(l=o("ZenonMWThriftDismissTranslator").fromThriftDismissRequest(e));break;case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:a&&(l=o("ZenonMWThriftServerMediaUpdateTranslator").fromThriftServerMediaUpdateRequest(e));break;case o("MultiwayCommonTypes").MessageType.NOTIFY:a&&(l=o("ZenonMWThriftStateSyncTranslator").fromThriftNotifyRequest(e));break;case o("MultiwayCommonTypes").MessageType.UPDATE:a||(l=o("ZenonMWThriftStateSyncTranslator").fromThriftUpdateResponse(e));break;case o("MultiwayCommonTypes").MessageType.UNSUBSCRIBE:a||(l=o("ZenonMWThriftStateSyncTranslator").fromThriftUnsubscribeResponse(e));break;case o("MultiwayCommonTypes").MessageType.WAKEUP:a&&(l=o("ZenonMWThriftWakeupTranslator").fromThriftWakeupRequest(e));break;default:break}return new(r("ZenonSignalingMessage"))(i,l)}function u(e){var t;return o("ZenonActorHooks").ZenonActor.isInstagramUser()||o("ZenonActorHooks").ZenonActor.isOculusUser()||o("ZenonActorHooks").ZenonActor.isKadabraUser()||o("ZenonActorHooks").ZenonActor.isLiveChatOnlyPerson()||o("ZenonActorHooks").ZenonActor.isManagedMetaAccount()||o("ZenonActorHooks").ZenonActor.isMDCUser()||e.receiverUserId==null||e.receiverUserId===o("ZenonActorHooks").ZenonActor.getID()||((t=e.receiver)==null?void 0:t.baseId)===o("ZenonActorHooks").ZenonActor.getAccountID()||e.receiverUserId===r("DGWWebConfig").fbId}l.toMWThriftMessage=e,l.toSignalingMessage=s}),98);
__d("ZenonMqttChannel",["CurrentUser","FBLogger","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=-1;try{if(r("MqttEnvInitializer").initialize(),o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn),r("gkx")("11152")&&r("CurrentUser").getAppID()===String(0x4d31ba8e7e89d))e=949958857019662;else{var t;e=Number((t=r("CurrentUser").getAppID())!=null?t:r("MqttWebConfig").appID)}return new(r("MqttChannel"))({appId:e,capabilities:r("MqttWebConfig").capabilities,chatVisibility:!1,clientCapabilities:r("MqttWebConfig").clientCapabilities,endpoint:r("MqttWebConfig").endpoint,initialSubscribedTopics:r("MqttWebConfig").subscribedTopics,phpOverride:r("MqttWebConfig").hostNameOverride,pollingEndpoint:r("MqttWebConfig").pollingEndpoint,userFbid:r("MqttWebConfig").fbid})}catch(t){var n=r("getErrorSafe")(t);throw r("FBLogger")("rtc_www").catching(n).warn("[ZenonMqttChannel][%d] failed to create MqttChannel",e),n}}var s=e(),u=s;l.default=u}),98);
__d("getZenonMqttChannel",["CurrentUser","FBMqttChannel","HorizonWebMqttChannel","IGDOverLSMqttChannel","LiveChatWidgetMqttChannel","MDCMqttChannel","OculusMqttChannel","RpWebMqttEnabledAppIds","ZenonAppProvider","ZenonMqttChannel","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set(r("RpWebMqttEnabledAppIds").APP_IDS);function s(){return o("ZenonAppProvider").isInstagramApp()?o("IGDOverLSMqttChannel").getInstance():o("ZenonAppProvider").isOculusCastingSite()?o("OculusMqttChannel").getOculusMqttChannelInstance():o("ZenonAppProvider").isHorizonApp()?o("HorizonWebMqttChannel").getHorizonWebMqttChannelInstance():o("ZenonAppProvider").isMDCApp()?o("MDCMqttChannel").getMDCMqttChannelInstance():o("ZenonAppProvider").isWidgetLiveChatApp()&&r("justknobx")._("2782")?o("LiveChatWidgetMqttChannel").getLiveChatWidgetMqttChannelInstance():e.has(Number(r("CurrentUser").getAppID()))?r("ZenonMqttChannel"):r("FBMqttChannel")}l.default=s}),98);
__d("RTWebSignalingListener",["FBLogger","ZenonMWThriftMessageDebugLogger","ZenonMWThriftMessageReliabilityLogger","ZenonMWThriftMessageSerializer","ZenonMWThriftMessageTranslator","getErrorSafe","getZenonMqttChannel"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=r("getZenonMqttChannel")()}var t=e.prototype;return t.setLoggingEventHandler=function(t){this.$2=t},t.subscribe=function(t,n){var e=this;this.$1.subscribeBinary("/t_rtc_multi",function(a){try{var i=o("ZenonMWThriftMessageSerializer").deserializeMWThriftMessage(a);r("ZenonMWThriftMessageDebugLogger").logMWThriftMessage("RECEIVED","MQTT Thrift",i),o("ZenonMWThriftMessageReliabilityLogger").logReceivedMessage(i),e.$2&&e.$2({mwThriftMessage:i,name:"mwThriftMessageRecv"});var l=o("ZenonMWThriftMessageTranslator").toSignalingMessage(i);if(o("ZenonMWThriftMessageReliabilityLogger").logMessageAfterTranslation(i),l==null)return;o("ZenonMWThriftMessageReliabilityLogger").logMessageAfterNullCheck(i),n&&e.$3(i,l,n),t(l),o("ZenonMWThriftMessageReliabilityLogger").logProcessingMessage(i)}catch(e){var s=r("getErrorSafe")(e);r("FBLogger")("rpweb").catching(s).warn("Error receiving binary MQTT message from /t_rtc_multi topic")}})},t.unsubscribe=function(){this.$1.unsubscribeAll("/t_rtc_multi")},t.$3=function(t,n,o){try{o(t,n)}catch(t){var e=r("FBLogger")("rtweb");t instanceof Error&&e.catching(t),e.mustfix("Signaling messages should be json parsable.")}},e})();l.default=e}),98);
__d("ZenonLoggingEventTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["Send","Receive"]),l=n("$InternalEnum")({Primary:"primary",Secondary:"secondary"}),s="rtc_www";i.ZenonUpdateIceInfoDirection=e,i.ZenonJoinMode=l,i.tslogSource=s}),66);
__d("ZenonMQTTTransportChannelStatus",["EventEmitter","getZenonMqttChannel"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(){var t;t=e.call(this)||this,t.$ZenonMQTTTransportChannelStatus$p_1=r("getZenonMqttChannel")();var n={onMQTTStateChanged:function(n){t.emit("connectionStateEvent",n)}};return t.$ZenonMQTTTransportChannelStatus$p_1.subscribeChannelEvents(n),t}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getConnectionState=function(){return this.$ZenonMQTTTransportChannelStatus$p_1.getConnectionState()},n.getTransportName=function(){return"mqtt"},t})(r("EventEmitter"));l.default=e}),98);
__d("ZenonMWThriftMessageLogger",["MultiwayCommonTypes","ZenonLoggingEventTypes"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set,s=new Set;function u(t,n){var r=t.messageHeader,a=t.messageBody;if(!(e.has(r.transactionId)||r.type==null)){switch(r.type){case o("MultiwayCommonTypes").MessageType.JOIN:a.joinRequest&&d(a.joinRequest,n);break;case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:a.iceCandidateRequest&&p(a.iceCandidateRequest,n,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send);break;case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:a.clientMediaUpdateRequest&&_(a.clientMediaUpdateRequest,n);break;case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:a.serverMediaUpdateResponse&&h(a.serverMediaUpdateResponse,n);break;default:break}e.add(r.transactionId)}}function c(e,t){var n=e.messageHeader,r=e.messageBody;if(!(s.has(n.transactionId)||n.type==null)){switch(n.type){case o("MultiwayCommonTypes").MessageType.JOIN:r.joinResponse&&m(r.joinResponse,t);break;case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:r.iceCandidateRequest&&p(r.iceCandidateRequest,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive);break;case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:r.clientMediaUpdateResponse&&f(r.clientMediaUpdateResponse,t);break;case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:r.serverMediaUpdateRequest&&g(r.serverMediaUpdateRequest,t);break;default:break}s.add(n.transactionId)}}function d(e,t){var n=e.answer,r=e.offer;t({name:"inviteSent"}),y(r,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send),n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function m(e,t){var n=e.answer;n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function p(e,t,n){var r=e.iceCandidateSdps;r.forEach(function(e){e.candidateSdpString!=null&&t({direction:n,name:"updateIceInfo",sdpString:e.candidateSdpString})})}function _(e,t){var n=e.offer;n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function f(e,t){var n=e.answer;n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function g(e,t){var n=e.answer,r=e.offer;r&&y(r,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive),n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function h(e,t){var n=e.answer;n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function y(e,t,n){e.sdpString!=null&&t({direction:n,name:"updateIceInfo",sdpString:e.sdpString})}l.logSentMessage=u,l.logReceivedMessage=c}),98);
__d("ZenonValidateMWThriftMessage",["FBLogger","MultiwayCommonTypes","ZenonInfraActionsLogger","ZenonMWThriftMessageMap"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.messageHeader.type,n=o("ZenonMWThriftMessageMap").messageTypeToString(t);return e.messageHeader.serverInfoData==null&&t!=null&&t!==o("MultiwayCommonTypes").MessageType.JOIN?(r("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP][DROP] No remoteSignalingID in message: "+n}),r("FBLogger")("rtc_www").warn("[ZP][DROP] No remoteSignalingID in message: "+n),!1):!0}l.default=e}),98);/*FB_PKG_DELIM*/
__d("EncryptedBackupsResignCdnUrl",["MAWBridge","MAWConfig","MAWLoggerUtils","WAJids","WAPromiseDelays","WAResolvable","WAResultOrError","cr:10071","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Map;function u(e){return s.get(e)}function c(t){var n=t.deliveryObjectId,r=t.logger,a=t.mediaDownloadFlow,i=t.mediaKey,l=t.mediaType,s=t.msgId,u=t.protocolMsgId,c=t.sortOrderMs;return a.addPoint("resign_cdn_url_start"),d({deliveryObjectId:n,mediaDownloadFlow:{addAnnotations:function(t){a==null||a.addAnnotations(babelHelpers.extends({},t))},addPoint:function(t,n){a==null||a.addPoint(t,babelHelpers.extends({},n))}},mediaKey:i,mediaType:l,msgId:s,protocolMsgId:u,sortOrderMs:c}).then(function(e){return e.success?(a==null||a.addPoint("resign_cdn_url_end"),e):(a.addPoint("resign_cdn_url_fail",{string:{resignCdnUrlFailReason:e.error}}),e)}).catch(function(t){return r.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["resignCdnUrl runtime-error: ",""])),t),a.addPoint("resign_cdn_url_fail",{string:{resignCdnUrlFailReason:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(t)}}),o("WAResultOrError").makeError("resign-cdn-url-runtime-error")})}async function d(e){var t=e.deliveryObjectId,r=e.mediaDownloadFlow,a=e.mediaKey,i=e.mediaType,l=e.msgId,u=e.protocolMsgId,c=e.sortOrderMs;if(n("cr:10071")!==null){var d=await n("cr:10071").eblsResignCdnUrlWithGraphQL({chatJid:u.chat,deliveryObjectId:t,externalId:u.externalId,mediaDownloadFlow:r,mediaKey:a,mediaType:i,sortOrderMs:c});return d.success?o("WAResultOrError").makeResult(d.value):d}else{var m=o("MAWLoggerUtils").getInstanceKey(),p=new(o("WAResolvable")).Resolvable;return s.set(m,p),o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"ResignAttachmentCDNUrl",value:{deliveryObjectId:t,mediaType:i,messageId:u.externalId,msgId:l,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,skipLegacyMediaDownloadFlow:!0,sortOrder:c,threadId:o("WAJids").threadIdForChatJid(u.chat),threadJid:u.chat,traceId:m}}]}),o("WAPromiseDelays").withTimeout(p.promise,900*1e3,function(){return o("WAResultOrError").makeError("resign-cdn-url-timeout")}).finally(function(){s.delete(m)})}}l.getRestoredCdnUrlResolvable=u,l.resignCdnUrl=c}),98);
__d("MAWAdminWriteUserDeviceMsgTxn",["MAWAckLevel","MAWAdminMsgHelpers","MAWDbMsgTxns","MAWDexieTable","MAWExternalId","MAWGetUserDeviceChangeAdminType","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e={add:"add",remove:"remove",update:"update"};function s(e,t,n,a,i){return o("MAWDbMsgTxns").getIsThreadEmpty(e,n.jid).then(function(l){if(l)return o("MAWDexieTable").dexieResolve();var s=t===o("MAWUserJidWrapper").getMyUserJid(),u=o("MAWGetUserDeviceChangeAdminType").getUserDeviceAdminType(a,s),c=s?[]:[o("WAJids").userIdFromJid(t)],d=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:c,adminType:u,version:1},n.jid,o("MAWExternalId").generateExternalId(),i);return o("MAWWriteMsgTxns").writeMsg(e,d,n).then(r("emptyFunction"))})}function u(e,t,n,a){var i=o("MAWAdminMsgHelpers").UNKNOWN_USER,l=t===o("MAWUserJidWrapper").getMyUserJid(),s={ack:o("MAWAckLevel").ACK.received,altIndex:void 0,author:l?o("WAJids").AUTHOR_ME:t,externalId:o("MAWExternalId").generateExternalId(),msgContent:{adminType:o("MAWLocalizationType").LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE,authorName:i},threadJid:n.jid,ts:a!=null?a:o("WATimeUtils").unixTime(),type:o("MAWMsgType").MSG_TYPE.ICDC_ALERT};return o("MAWWriteMsgTxns").writeMsg(e,s,n).then(r("emptyFunction"))}l.DeviceChange=e,l.writeUserDeviceAdminMsg=s,l.writeICDCAlert=u}),98);
__d("MAWCreateMaybeAddPointForMediaRender",["MAWQplProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return function(t,n){e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25302828,"2195"),t,{annotations:n,instanceKey:e},!0)}}l.createMaybeAddPointForMediaRender=e}),98);
__d("MAWDbAddDeviceChangeAlertsTxn",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.deviceChangeAlerts.add(t)}i.addDeviceChangeAlertsTxn=e}),66);
__d("MAWDbDeviceChangeAlerts",[],(function(t,n,r,o,a,i){"use strict";var e="add",l="keyChange",s="remove";function u(e){return e}i.ADD=e,i.KEY_CHANGE=l,i.REMOVE=s,i.unsafeCoerceToDeviceChangeAlertsID=u}),66);
__d("WAFindMostRecentMediaEntry",["WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=null;for(var n of e){var r,a,i=n[0],l=n[1],s=o("WAMediaUtils").decodeMediaEntryData(l);(((r=t)==null?void 0:r[1].mediaKeyTimestamp)==null||s.mediaKeyTimestamp!=null&&s.mediaKeyTimestamp>((a=t)==null?void 0:a[1].mediaKeyTimestamp))&&(t=[i,s])}return t!=null?o("WAResultOrError").makeResult(t):o("WAResultOrError").makeError("no-media-entry")}l.findMostRecentMediaEntry=e}),98);
__d("MAWGetMostRescentDecodedMediaEntry",["MAWDbMediaTxns","MAWIndexedDb","MAWTransactionMode","MWFBLogger","WAFindMostRecentMediaEntry","WAHashUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MWFBLogger").MWMediaLogger().tags(["getMostRecentDecodedMediaEntry"]),u=o("MAWIndexedDb").makeMsgrTransactor({media:o("MAWTransactionMode").READONLY},"getMediaEntries",function(t){return function(n){return o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(t,n).then(function(t){return t?o("WAResultOrError").makeResult(t.mediaEntries):(s.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."])),o("WAHashUtils").sanitisePlaintextHash(n)),o("WAResultOrError").makeError("no-media-by-plaintext-hash"))})}});async function c(e){var t=await u(e);if(t.success===!1)return t;var n=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(t.value);return n.success===!1?n:o("WAResultOrError").makeResult(n.value[1])}l.getMediaEntries=u,l.getMostRecentDecodedMediaEntry=c}),98);
__d("MAWGetProtocolMsgIdAndSortOrderMsApi",["MAWIndexedDb","MAWTransactionMode","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY},"getProtocolMsgIdAndSortOrderMs",function(e){return function(t){return e.messages.get({msgId:t}).then(function(e){if(e==null)return null;var t=e.sortOrderMs;if(t==null||o("WAJids").isAuthorSystem(e.author))return null;var n={author:e.author,chat:e.threadJid,externalId:e.externalId};return{protocolMsgId:n,sortOrderMs:t}})}});l.getProtocolMsgIdAndSortOrderMs=e}),98);
__d("WATypedArraysConcat",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){n===void 0&&(n=0);var r=t.reduce(function(e,t){return e+t.length},n),o=new e(r),a=0;return t.forEach(function(e){o.set(e,a),a+=e.length}),o}i.concatTypedArrays=e}),66);
__d("WACryptoAesCbc",["WABinary","WACryptoDependencies","WAPromiseDelays","WATypedArraysCast","WATypedArraysConcat","err"],(function(t,n,r,o,a,i,l){"use strict";var e=16,s=1024,u=16,c=1024*1024,d=e*c,m=(function(){function t(e,t,n,r){this.$4=null,this.$6=!1,this.$1=e,this.$2=t,this.$3=n;var a={name:"AES-CBC",iv:r};this.$5=o("WACryptoDependencies").getCrypto().subtle.importKey("raw",n,"AES-CBC",!1,[t]).then(function(e){return{algo:a,key:e}})}var n=t.prototype;return n.append=function(n){var t=this;this.$7("append");var r,a=this.$4;if(a)if(a.writeByteArray(n),a.size()>s){var i=a.size()%e;r=a.readByteArrayView(a.size()-i),a.size()||(this.$4=null)}else r=null;else if(n.length>s){var l=n.length%e;l?(this.$4=new(o("WABinary")).Binary(n),r=this.$4.readByteArrayView(n.length-l)):r=n}else this.$4=new(o("WABinary")).Binary(n),r=null;var u=r;return u&&(this.$5=this.$5.then(function(n){var r=n.key,a=n.algo;if(t.$2==="encrypt")return o("WACryptoDependencies").getCrypto().subtle.encrypt(a,r,u).then(function(n){return t.$1.writeByteArray(new Uint8Array(n,0,n.byteLength-e)),new Uint8Array(n,n.byteLength-2*e,e)});var i=u.slice(-e);return o("WACryptoDependencies").getCrypto().subtle.decrypt(a,r,u).then(function(e){return t.$1.writeBuffer(e),i})}).then(function(e){var n={name:"AES-CBC",iv:e};return o("WACryptoDependencies").getCrypto().subtle.importKey("raw",t.$3,"AES-CBC",!1,[t.$2]).then(function(e){return{algo:n,key:e}})})),this.$5.then(function(){})},n.finalize=function(t){var e=this;this.$7("finalize");var n;if(this.$4){var r=this.$4;t&&r.writeByteArray(t),n=r.readByteArrayView(),this.$4=null}else t&&(n=t);if(n){var a=n;return this.$5.then(function(t){var n=t.algo,r=t.key;return e.$2==="encrypt"?o("WACryptoDependencies").getCrypto().subtle.encrypt(n,r,a):o("WACryptoDependencies").getCrypto().subtle.decrypt(n,r,a)}).then(function(t){e.$1.writeBuffer(t)})}else return this.$5.then(function(){})},n.$7=function(t){if(this.$6)throw r("err")("AesCbcStream."+t+" called after finalize")},t})();function p(e){return{name:"AES-CBC",iv:o("WATypedArraysCast").castTypedArrays(Uint8Array,e)}}function _(e){return o("WACryptoDependencies").getCrypto().subtle.importKey("raw",o("WATypedArraysCast").castTypedArrays(Uint8Array,e),"AES-CBC",!1,["encrypt"])}function f(e){if(e)return o("WATypedArraysCast").castTypedArrays(Uint8Array,e);var t=new Uint8Array(u);return o("WACryptoDependencies").getCrypto().getRandomValues(t),t}function g(t){var n=t.byteLength,r=e-n%e;return Number.isNaN(r)?n:n+r}function h(e,t,n){var r=p(t);return Promise.resolve(o("WACryptoDependencies").getCrypto().subtle.importKey("raw",o("WATypedArraysCast").castTypedArrays(Uint8Array,e),"AES-CBC",!1,["decrypt"])).then(function(e){return o("WACryptoDependencies").getCrypto().subtle.decrypt(r,e,n)})}function y(e,t){return Promise.resolve().then(function(){var n=t.slice(0,u),r=t.slice(u);return h(e,n,r)})}function C(e,t,n){return Promise.resolve().then(function(){var r=f(n),a=p(r);return Promise.resolve(_(e)).then(function(e){return o("WACryptoDependencies").getCrypto().subtle.encrypt(a,e,t)}).then(function(e){return o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[r,new Uint8Array(e)]).buffer})})}async function b(t){var n=t.encKey,a=t.plaintext,i=t.optionalIv,l=t.chunkSize,s=l===void 0?d:l,u=t.delayInBetween,c=u===void 0?!1:u;if(s%e!==0)throw r("err")("chunkSize must be a multiple of "+e+", "+s+" received");var m=await _(n),p=new Uint8Array(a),h=Math.ceil(p.byteLength/s),y=f(i),C=new Uint8Array(g(p)+y.byteLength);C.set(y);for(var b=0,S=y,R;b<h;b++){var L=b===h-1,E=b*s;R=p.subarray(E,E+s);var k=await v(L,R,S,m),I=k.encryptedChunk,T=k.nextIv;C.set(I,y.byteLength+b*s),S=T,c===!0&&await o("WAPromiseDelays").releaseToMainThread()}return C.buffer}async function v(t,n,r,a){var i=await o("WACryptoDependencies").getCrypto().subtle.encrypt(p(r),a,n).then(function(n){return t?new Uint8Array(n):new Uint8Array(n).subarray(0,-e)}),l=i.slice(-e);return{encryptedChunk:i,nextIv:l}}l.AES_CBC_BLOCK_SIZE=e,l.AesCbcStream=m,l.importRawKey=_,l.getIv=f,l.aesCbcDecrypt=h,l.aesCbcDecryptSplit=y,l.aesCbcEncrypt=C,l.aesCbcEncryptWithChunking=b,l.aesCbcEncryptChunk=v}),98);
__d("WAConcurrentIterate",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){for(var r=[],o=[],a=0,i=async function(){for(;a<e;){var n=a;a++,o[n]=await t(n)}},l=Math.min(e,n),s=0;s<l;s++)r.push(i());return Promise.all(r).then(function(){return o})}i.concurrentIterate=e}),66);
__d("WAMediaCryptoSidecar",["WAConcurrentIterate","WACryptoHmac","WAMediaUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e==="video"}var s=16,u=10,c=64*1024;function d(e,t,n){n===void 0&&(n=1);var r=t.buffer.byteLength,a=Math.ceil((r-s)/c),i=new Uint8Array(u*a);return o("WAConcurrentIterate").concurrentIterate(a,function(n){var r=n*c,a=r+s+c,l=t.subarray(r,a);return o("WACryptoHmac").sign(e,l).then(function(e){var t=new Uint8Array(e,0,u);i.set(t,n*u)})},n).then(function(){return o("WAMediaUtils").castToStreamingSidecar(i.buffer)})}l.shouldHaveStreamingSidecar=e,l.calculateStreamingSidecar=d}),98);
__d("WAMediaHkdfInfo",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case"document":return"WhatsApp Document Keys";case"image":case"sticker":case"xma-image":return"WhatsApp Image Keys";case"video":case"gif":return"WhatsApp Video Keys";case"audio":case"ptt":return"WhatsApp Audio Keys";case"md-app-state":return"WhatsApp App State Keys";case"md-msg-hist":return"WhatsApp History Keys";default:throw r("err")("getMediaHkdfInfo: unexpected media type "+e)}}function s(){return"Messenger Preview Keys"}l.getMediaHkdfInfo=e,l.getPreviewMediaHkdfInfo=s}),98);
__d("WAMediaCrypto",["WABinary","WACryptoAesCbc","WACryptoDependencies","WACryptoHkdf","WACryptoHmac","WACryptoSha256","WACryptoUtils","WACustomError","WAHashUtils","WALogger","WAMediaCryptoSidecar","WAMediaHkdfInfo","WATagsLogger","WATypedArraysConcat","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS(["WAMediaCrypto"]),d=o("WACustomError").customError("HmacValidationError",!1),m=new Uint8Array([2,2]);function p(e,t){return o("WACryptoHkdf").extractAndExpand(new Uint8Array(e),t,112).then(function(e){return{iv:new Uint8Array(e,0,16),cipherKey:new Uint8Array(e,16,32),hmacKey:new Uint8Array(e,48,32),refKey:new Uint8Array(e,80,32)}})}function _(e,t){var n=o("WAMediaHkdfInfo").getMediaHkdfInfo(t);return p(e,n)}function f(e){var t=o("WAMediaHkdfInfo").getPreviewMediaHkdfInfo();return p(e,t)}async function g(e){var t=new Map,n=await f(e);t.set("preview",n);var r=["document","image","video","audio","md-app-state","md-msg-hist"];return await Promise.all(r.map(function(n){return _(e,n).then(function(e){t.set(n,e)})})),t}function h(e){switch(e){case"image":case"video":return e;default:return null}}var y=16,C=16,b=10,v=64*1024;async function S(e,t,n,r,a){var i=new(o("WABinary")).Binary;i.ensureCapacity(C+r.byteLength+y+b),i.writeByteArray(t);for(var l=new(o("WACryptoAesCbc")).AesCbcStream(i,"encrypt",e,t),s=0,u=s+v;u<r.byteLength;){var c=r.slice(s,u);await l.append(new Uint8Array(c)),s=u,u+=v}var d=await r.slice(s);await l.finalize(new Uint8Array(d));var m=i.peek(function(e){return e.readByteArrayView()}),p=await o("WACryptoHmac").encodeKeySha256(n),_=await o("WACryptoHmac").sign(p,m);i.writeByteArray(new Uint8Array(_,0,b));var f=i.readByteArrayView(),g=f.subarray(C),h=await Promise.all([o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",g),o("WAMediaCryptoSidecar").shouldHaveStreamingSidecar(a)?o("WAMediaCryptoSidecar").calculateStreamingSidecar(p,f):void 0]),S=h[0],R=h[1];return{ciphertext:g,ciphertextHash:S,sidecar:R,ivCiphertext:m,ivCiphertextHmac:f}}async function R(e,t,n){var r=await o("WACryptoHmac").encodeKeySha256(e),a=o("WABinary").Binary.build(t,n).readByteArrayView();return o("WACryptoHmac").sign(r,a)}async function L(e,t,n,r,a){if(!(10<=a.length&&a.length<=32))throw new d("Bad hmac size "+a.length);var i=o("WABinary").Binary.build(t,n).readByteArrayView(),l=await o("WACryptoHmac").hmacSha256(r,i).then(function(e){return new Uint8Array(e)}),s=l.slice(0,a.length);if(!T(s,a))throw new d("hmacAndDecrypt hmac mismatch");var u=await o("WACryptoAesCbc").aesCbcDecrypt(e,t,n),c=await o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",u);return{plaintextHash:o("WAHashUtils").toPlaintextHash(c),plaintext:u}}function E(e,t,n,r,a){if(!(10<=a.length&&a.length<=32))throw new d("Bad hmac size "+a.length);var i=o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[t,n]);return o("WACryptoHmac").hmacSha256(r,i,a.length).then(function(e){return new Uint8Array(e)}).then(function(e){if(!o("WACryptoUtils").uint8ArraysEqual(e,a))throw new d("hmacAndDecrypt hmac mismatch")}).then(function(){var e=n.byteLength%y===b;return e===!0?n.subarray(0,-10):n}).then(function(n){return k(e,t,n)})}function k(e,t,n){var r=n.subarray(-y);return o("WACryptoAesCbc").aesCbcEncrypt(e,m,r).then(function(e){return e.slice(C)}).then(function(e){return o("WABinary").Binary.build(n,e).readByteArrayView()}).then(function(n){return o("WACryptoAesCbc").aesCbcDecrypt(e,t,n)}).then(function(e){return new Uint8Array(e,0,e.byteLength-m.byteLength)}).then(function(e){return{plaintext:e,nextIv:r}})}async function I(t,n,a,i,l,d){l>d.scanLengths.length&&c.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["decryptPartialChunks targetScan greater length of scanLength array"])));var m=Math.min(l,d.scanLengths.length);if(m<1)throw c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt partial due to invalid target scan"]))),r("err")("Unable to decrypt partial due to invalid target scan");for(var p=new(o("WABinary")).Binary,_=[],f=0;f<m;f++)_.push(new Uint8Array(d.sidecar,f*10,10));for(var g=0,h=n,y=0,C=0;C<m;C++){o("WALogger").DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Processing scan ",""])),C);var b=d.alignedScanLengths[C],v=g+b,S=a.subarray(g,v),R=await E(t,h,S,i,_[C]),L=R.plaintext,k=R.nextIv;p.write(L),g+=b,h=k,y+=d.scanLengths[C]}var I=p.readBuffer(y),T=await o("WACryptoSha256").sha256(I);return{plaintextHash:o("WAHashUtils").toPlaintextHash(T),plaintext:I}}function T(e,t){if(e.length!==t.length)return!1;for(var n=1,r=e.length,o=0;o<r;o++)n&=e[o]===t[o]?1:0;return n!==0}l.HmacValidationError=d,l.DEFAULT_PADDING=m,l.computeMediaKeys=_,l.computeMediaKeysForPreview=f,l.deprecated_getAllCommonComputedMediaKeys=g,l.convertServerMediaTypeToPreviewMediaType=h,l.CBC_BLOCK_SIZE=y,l.IV_LENGTH=C,l.HMAC_LENGTH=b,l.encryptAndHmac=S,l.hmacCiphertext=R,l.hmacAndDecrypt=L,l.hmacAndDecryptPartial=E,l.decryptPartialChunks=I}),98);
__d("WAAlignChunkLengthsToMultipleOfAesBlockSize",[],(function(t,n,r,o,a,i){"use strict";function e(e){return parseInt((e+15)/16,10)*16}function l(t,n){for(var r=[],o=0,a=0,i=0,l=0;l<t.length;++l)if(o+=t[l],l===t.length-1&&n!=null&&n>0){o>a?r.push(n-a):(r.pop(),r.push(n-i));break}else if(o>a){var s=e(o-a);i=a,r.push(s),a+=s}return r}i.alignChunkSizeToMultipleAesBlockSize=e,i.alignChunkLengthsToMultipleOfAesBlockSize=l}),66);
__d("WAProgressiveJpegAlignScanLengths",["WAAlignChunkLengthsToMultipleOfAesBlockSize"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.scanLengths,n=e.totalEncryptedBytes;return o("WAAlignChunkLengthsToMultipleOfAesBlockSize").alignChunkLengthsToMultipleOfAesBlockSize(t.map(function(e){return e}),n).map(function(e){return e})}function s(e){return e}l.progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize=e,l.toProgressiveJpegAlignedScanLength=s}),98);
__d("WAProgressiveJpegGetPJpegDetails",["WAMediaCrypto","WAProgressiveJpegAlignScanLengths","WAProgressiveJpegGetScanLengths","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WATagsLogger").TAGS(["WAProgressiveJpegDetails"]);function m(e){var t=e.progressiveJpegDetails,n=e.ciphertextLength;return babelHelpers.extends({},t,{alignedScanLengths:o("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize({scanLengths:t.scanLengths,totalEncryptedBytes:n})})}async function p(e,t,n){var r=t.byteLength-o("WAMediaCrypto").IV_LENGTH,a=o("WAProgressiveJpegGetScanLengths").getProgressiveJpegScanLengths(e),i=o("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize({scanLengths:a,totalEncryptedBytes:r}),l=await _(i,t,n);return{scanLengths:a,sidecar:l}}async function _(e,t,n){for(var r=new Uint8Array(e.length*10),a=0,i=0,l=t.slice(0,16),s=t.slice(16),u=0;u<e.length;u++){var c=e[u];i=a+c;var d=s.subarray(a,i),m=(await o("WAMediaCrypto").hmacCiphertext(n,l,d)).slice(0,10);r.set(new Uint8Array(m),u*10),l=d.slice(d.length-16,d.length),a=i}return r.buffer}function f(t){return t.sidecar.byteLength%o("WAMediaCrypto").HMAC_LENGTH!==0?(d.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar has an invalid length"]))),o("WAResultOrError").makeError("pjpeg-check-sidecar-invalid-length")):t.scanLengths.length>0&&t.sidecar.byteLength===0?(d.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar is missing"]))),o("WAResultOrError").makeError("pjpeg-check-no-sidecar")):t.scanLengths.length===0?o("WAResultOrError").makeResult(!1):t.scanLengths.length*o("WAMediaCrypto").HMAC_LENGTH!==t.sidecar.byteLength?(d.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar size mismatch"]))),o("WAResultOrError").makeError("pjpeg-check-scan-length-mismatch")):t.scanLengths.length<3?(d.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg has too few scans"]))),o("WAResultOrError").makeError("pjpeg-too-few-scans")):o("WAResultOrError").makeResult(!0)}function g(e,t){var n=0;if(t===0)return 0;for(var r=0;r<t;r++){var o=e[r];o!=null&&(n+=o)}return n}function h(e){var t=e.progressiveJpegDetails;if(t==null)return o("WAResultOrError").makeResult(null);var n=f(t);return n.success===!1?n:n.value===!0?o("WAResultOrError").makeResult({scanLengths:t.scanLengths,sidecar:t.sidecar}):o("WAResultOrError").makeResult(null)}l.getExtendedProgressiveJpegDetails=m,l.getProgressiveJpegDetails=p,l.isValidProgressiveJpegDetails=f,l.getTotalByteSizeForScan=g,l.maybeGetProgressiveJpegDetailsUsingMediaEntry=h}),98);
__d("WADownloadDownloadablePreview",["WADownloadMedia","WAMediaCrypto","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAStartMediaDownloadQplFlow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WADownloadMedia").mediaDownloadLogger.TAGS(["DownloadDownloadablePreview"]);async function f(t,n,r,a,i,l,f){var g=l.handleMediaPreviewBeforeDownload,h=l.handleMediaPreviewDownloadFailed,y=a.downloadableThumbnail,C=y==null?void 0:y.directPath,b=C!=null,v=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(a);if(_.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["thumbnail_available: ",""])),b),y==null||C==null)return _.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No downloadableThumbnail. Skipping..."]))),o("WAResultOrError").makeError("preview-not-supported");_.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["DownloadableThumbnail exists. Attempting to download."])));var S=y.fileEncSha256,R=y.fileSha256,L=y.mediaKey,E=y.objectId,k=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({protocolMsgId:t,downloadEntry:i,msgType:null,triggerUIView:f,isPreview:!0});if(k.addAnnotations({bool:{duplicateDirectPath:C===a.directPath,isProgressiveJpeg:v.success===!0,hasObjectId:E!=null},string:{mediaType:"preview",fullSizeMediaType:a.serverMediaType}}),k.addPoint("wa_protocol_media_download_start"),C==null||S==null||R==null||L==null)return _.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - mediaEntryData "," is incomplete for media preview"])),a),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"preview-incomplete-media-entry"}}),o("WAResultOrError").makeError("media-entry-invalid");var I=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(r);if(I==null)return _.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - unsupported preview media type ",""])),r),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"preview-unsupported-type"}}),o("WAResultOrError").makeError("request-error");await g(n);var T=await o("WADownloadMedia").downloadMediaImpl({downloadFlow:k,mediaTypeDetails:{messageType:I,type:"preview"},directPath:C,fileEncSha256:S,fileSha256:R,mediaKey:L});return T.success===!1?(_.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["failed to download media. Reason: ",""])),T.error),h(n,T.error),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:T.error}}),T):(_.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["finished downloading"]))),k.addPoint("wa_protocol_media_download_end"),k.endSuccess(),o("WAResultOrError").makeResult(T.value))}l.maybeDownloadDownloadablePreview=f}),98);
__d("WADecryptMedia",["WAMediaCrypto","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["WADecryptMedia"]);async function f(t,n,r,a){_.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Encountered enc-hash-mismatch - looking for a potential working hmac salt"])));var i=r.type==="preview"?"preview":r.mediaType,l=await o("WAMediaCrypto").deprecated_getAllCommonComputedMediaKeys(a),d;for(var m of l){var p=m[0],f=m[1];try{if(p===i)continue;_.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Trying "," as an alternative hmac salt."])),p);var g=o("WAResultOrError").makeResult(await o("WAMediaCrypto").hmacAndDecrypt(f.cipherKey,f.iv,t,f.hmacKey,n));return d={hmacAndDecryptResult:g,alternativeHmacSaltUsed:p},_.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Found a working hmac salt using ","."])),p),d}catch(e){_.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose([""," is not a working hmac salt."])),p);continue}}return{hmacAndDecryptResult:o("WAResultOrError").makeError("enc-hash-mismatch")}}async function g(e){var t=e.ciphertextHmac,n=e.mediaKey,r=e.mediaTypeDetails,a=e.plaintextHash;_.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Using default plaintext verifier"])));var i=t.byteLength-o("WAMediaCrypto").HMAC_LENGTH,l=new Uint8Array(t,i),s=new Uint8Array(t,0,i),u;r.type==="preview"?u=o("WAMediaCrypto").computeMediaKeysForPreview(n):u=o("WAMediaCrypto").computeMediaKeys(n,r.mediaType);var c,g=null;if(c=await u.then(function(e){var t=e.iv,n=e.cipherKey,r=e.hmacKey;return o("WAMediaCrypto").hmacAndDecrypt(n,t,s,r,l)}).then(o("WAResultOrError").makeResult).catch(function(e){return _.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""])),e),e instanceof o("WAMediaCrypto").HmacValidationError?o("WAResultOrError").makeError("enc-hash-mismatch"):o("WAResultOrError").makeError("decryption-error")}),c.success===!1&&c.error==="enc-hash-mismatch"){var h=await f(s,l,r,n);c=h.hmacAndDecryptResult,g=h.alternativeHmacSaltUsed}if(!c.success)return c;var y=c.value,C=y.plaintext,b=y.plaintextHash;return a!==b?o("WAResultOrError").makeError("hash-mismatch"):(_.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Success"]))),o("WAResultOrError").makeResult({plaintext:C,alternativeHmacSaltUsed:g}))}l.decryptMedia=g}),98);
__d("WAArrayUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e,t){var n=e.pop();t<e.length&&(e[t]=n)}function*s(e,t){for(var n=0;n<e.length;n+=t)yield e.slice(n,n+t)}function u(t,n){return c(t,n,e)}function c(e,t,n){var r=new Map;for(var o of e){var a,i=t(o),l=(a=r.get(i))!=null?a:[];l.push(n(o)),r.set(i,l)}return r}i.removeIndexWithoutPreservingOrder=l,i.peekEvery=s,i.groupBy=u,i.groupByAndMap=c}),66);
__d("WABaseGlobals",["err"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(t){e=t}function u(){if(e==null)throw r("err")("Trying to access WAGlobals before being set");return e}function c(e){var t=u();t.myJids=e}function d(){var e,t=(e=u().myJids)==null?void 0:e.deviceJid;if(t==null)throw r("err")("Trying to access myDeviceJid, but it's not set");return t}function m(){var e,t=(e=u().myJids)==null?void 0:e.userJid;if(t==null)throw r("err")("Trying to access myUserJid, but it's not set");return t}function p(){return u().jidUtils}function _(){return u().qpl}function f(){return e==null?!1:u().newClockSkewCalculation()}l.setGlobals=s,l.setMyJids=c,l.getMyDeviceJid=d,l.getMyUserJid=m,l.getJidUtilsApi=p,l.getQplConfig=_,l.newClockSkewCalculation=f}),98);
__d("WAErrors",["WACustomError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e=o("WACustomError")).customError("BufferTooLarge",!1),u=e.customError("Disconnected",!1),c=e.customError("Offline",!1,u),d=e.customError("MaxRetries",!1),m=e.customError("Aborted",!1);l.BufferTooLargeError=s,l.Disconnected=u,l.Offline=c,l.MaxRetries=d,l.Aborted=m}),98);
__d("WANotifyConnectionChangeFactory",[],(function(t,n,r,o,a,i){"use strict";var e=15e3;function l(t,n,r){r===void 0&&(r=e);var o={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},a=function(){var e=o.optimismLevel,t=o.connectionStatus;e==="optimist"?o.timeoutID=setTimeout(function(){o.optimismLevel="realist",n(t)},r):n(t)};return function(e){o.connectionStatus=e,e==="disconnected"||e==="in_handshake"?a():(o.timeoutID!=null&&(clearTimeout(o.timeoutID),o.timeoutID=null),n(e)),t(e)}}i.notifyConnectionChangeFactory=l}),66);
__d("WAPromiseRetryLoop",["Promise","WALogger","WAPromiseBackoffs","WAPromiseDelays","WAResolvable","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=(function(){function t(e){var t=this;this.$2=new(o("WAResolvable")).Resolvable,this.$3=null,this.$4=null,this.$5=0,this.$6=new(o("WAResolvable")).Resolvable,this.endWithValue=function(e){t.$5++,t.$2.resolve(e)},this.$1=e}var a=t.prototype;return a.resetTimeoutAfter=function(t){this.$4=Date.now()+t},a.cancelReset=function(){this.$4=null},a.reset=function(){this.$2.resolveWasCalled()||(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: resetting ",""])),this.$1.name),this.$5++,this.$6.resolve(),this.$7())},a.start=function(){this.$2.resolveWasCalled()||(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: starting ",""])),this.$1.name),this.$5!==0&&o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop was called several times. You may have race conditions"]))),this.$5++,this.$6.resolve(),this.$7())},a.pauseOnNextIteration=function(){o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: pause requested on next iteration"]))),this.$6.resolve(),this.$6=new(o("WAResolvable")).Resolvable},a.unpause=function(){this.$6.resolveWasCalled()||o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: loop unpaused"]))),this.$6.resolve()},a.$7=function(){var e=this,t=this.$1,r=this.$5,a=o("WAPromiseBackoffs").createTimer(this.$1.timer);a();var i=function(){return e.$1.isPauseEnabled!==!0?(f||(f=n("Promise"))).resolve():(e.$6.resolveWasCalled()||o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: loop paused - waiting for unpause"]))),e.$6.promise)},l=function(){if(!e.$2.resolveWasCalled()&&r===e.$5){var n=Date.now();return e.$3=(0,t.code)(e.endWithValue).then(function(){if(!e.$2.resolveWasCalled()){var r=t.resetDelay;(r!==void 0&&Date.now()>=n+r||e.$4!=null&&e.$4<=Date.now())&&(o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: resetting ",""])),t.name),a=o("WAPromiseBackoffs").createTimer(e.$1.timer)),e.$4=null;var s=a();return o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: retrying "," in ","ms"])),t.name,s),o("WAPromiseDelays").delayMs(s).then(i).then(l)}}),e.$3}};this.$3=(f||(f=n("Promise"))).resolve().then(l)},a.promise=function(){var e=this;return this.$2.resolveWasCalled()?this.$2.promise:this.$3?(f||(f=n("Promise"))).race([this.$2.promise,this.$3.then(function(){return e.$2.promise})]):(f||(f=n("Promise"))).reject(r("err")("PromiseRetryLoop "+this.$1.name+" had promise() called before start()"))},t})();l.PromiseRetryLoop=g}),98);
__d("WASmaxInPingsEnums",["WAJids"],(function(t,n,r,o,a,i,l){var e={validators:[o("WAJids").validateDomainJid,o("WAJids").validateUserJid],typeName:"DomainJid|UserJid"};l.DOMAINJID_USERJID=e}),98);
__d("WAWapJid",["$InternalEnum","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e={JID:0,JID_U:1,JID_AD:1,JID_FB:3,JID_INTEROP:4},s=n("$InternalEnum")({WHATSAPP:0,LID:1,HOSTED:128,HOSTED_LID:129}),u=(function(){function t(e){this.$1=e}t.createAD=function(r,o,a){return new t({type:e.JID_AD,user:r,device:a==null?0:a,agent:o==null?0:o,domainType:s.WHATSAPP})},t.createJidU=function(r,o,a){return new t({type:e.JID_U,user:r,device:a==null?0:a,domainType:o==null?s.WHATSAPP:o})},t.createFbJid=function(r,o){var n=o==null?0:o;return new t({type:e.JID_FB,user:r,device:n})},t.createInteropJid=function(r,o,a){var n=o==null?0:o;return new t({type:e.JID_INTEROP,user:r,device:n,integrator:a})},t.create=function(r,o){return new t({type:e.JID,user:r,server:o})};var n=t.prototype;return n.toString=function(){if(this.$1.type===e.JID_AD||this.$1.type===e.JID_U){var t=this.$1,n=t.user,r=t.device,a=t.domainType,i="";return a===s.WHATSAPP?i=o("WAJids").WA_USER_JID_SUFFIX:a===s.HOSTED?i=o("WAJids").HOSTED_SUFFIX:a===s.HOSTED_LID?i=o("WAJids").HOSTED_LID_SUFFIX:i=o("WAJids").LID_SUFFIX,r===0?n+"@"+i:n+":"+r+"@"+i}else if(this.$1.type===e.JID_FB){var l=this.$1,u=l.user,c=l.device,d=o("WAJids").MSGR_USER_JID_SUFFIX;return u+":"+c+"@"+d}else if(this.$1.type===e.JID_INTEROP){var m=this.$1,p=m.user,_=m.device,f=m.integrator,g=o("WAJids").INTEROP_USER_JID_SUFFIX;return f+"-"+p+":"+_+"@"+g}else{this.$1.type;var h=this.$1,y=h.user,C=h.server;return y!=null?y+"@"+C:C}},n.getInnerJid=function(){return this.$1},t})();l.WAP_JID_SUBTYPE=e,l.DomainType=s,l.WapJid=u}),98);
__d("WASmaxParseUtils",["WABase64","WABinary","WACryptoUtils","WADeepEquals","WAHasProperty","WAResultOrError","WAStanzaUtils","WAWapJid","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WAResultOrError").makeResult();function s(t,n){return t.tag!==n?O(t,"to be <"+n+">"):e}function u(e,t){return B(e,t)?W(e,e.attrs[t]):O(e,'to have attribute "'+t+'"')}function c(e,t,n,r){var a=u(e,t);if(!a.success)return a;var i=n(a.value);return i!=null?o("WAResultOrError").makeResult(i):O(e,'to have "'+t+'"={'+r+'}, but instead has "'+a.value+'"')}function d(e,t,n){var r=P(e);if(!r.success)return r;var a=t(r.value);return a!=null?o("WAResultOrError").makeResult(a):O(e,"to have "+n+' content, but instead has "'+r.value+'"')}function m(t,n,r){var o=u(t,n);if(o.success){if(o.value!==r)return O(t,'to have "'+n+'"="'+r+'", but instead has "'+o.value+'"')}else return o;return e}function p(e,t){return c(e,t,o("WAStanzaUtils").toStanzaId,"stanzaID")}function _(e,t){return c(e,t,o("WAStanzaUtils").validateCallId,"callID")}function f(e,t){return c(e,t,q,"integer")}function g(e,t,n,r){var a=f(e,t);if(!a.success)return a;var i=a.value;return n!==void 0&&i<n?O(e,'to have "'+t+'"={at least '+n+"} but has value "+i):r!==void 0&&i>r?O(e,'to have "'+t+'"={at most '+r+"} but has value "+i):o("WAResultOrError").makeResult(i)}function h(e){var t=e.content;return t instanceof Uint8Array?O(e,"to have children"):o("WAResultOrError").makeResult(t)}function y(t,n){var r=h(t);if(!r.success)return r;var a=r.value;if(a==null)return e;for(var i=null,l=0;l<a.length;l++){var s=a[l];if(s.tag===n){if(i!=null)return O(t,"to have 1 child <"+n+">, but found more than 1");i=s}}return o("WAResultOrError").makeResult(i)}function C(t,n,r){var o=y(t,n);return o.success?o.value==null?e:r(o.value):o}function b(e,t,n){var r=C(e,t,n);if(!r.success)return r;var a=r.value;return a==null?O(e,"to have 1 child <"+t+">, but found 0"):o("WAResultOrError").makeResult(a)}function v(e,t){var n=y(e,t);return n.success?n.value==null?O(e,"to have 1 child <"+t+">, but found 0"):o("WAResultOrError").makeResult(n.value):n}function S(e,t,n,r,a){var i=U(e,t,n,r);if(!i.success)return i;for(var l=[],s=0;s<i.value.length;s++){var u=a(i.value[s]);if(!u.success)return u;l.push(u.value)}return o("WAResultOrError").makeResult(l)}function R(e,t,n,r,a){var i=U(e,t,n,r);if(!i.success)return i;for(var l=i.value.length,s=0;s<l;s++){var u=a(i.value[s]);if(!u.success)return u}return o("WAResultOrError").makeResult(l)}function L(e,t,n){var r=S(e,t,0,1/0,n);if(!r.success)return r;for(var a=0;a<r.value.length;a++)if(!o("WADeepEquals").deepEqual(r.value[0],r.value[a]))return O(e,"to have homogeneous children, but found two children that are not equal");return r}function E(e,t,n){var r=L(e,t,n);return r.success?o("WAResultOrError").makeResult(r.value.length):r}function k(t,n,r,o,a){return B(n,r)?t(n,r,o,a):e}function I(t,n,r,a){if(a==null)return e;var i=k(t,n,r);return i.success?i.value===a?o("WAResultOrError").makeResult(a):i.value==null?e:O(n,'to have "'+r+'"={'+a+'}, but instead has "'+i.value+'"'):i}function T(e,t,n,r){var a=e(t,n);return a.success?a.value===r?o("WAResultOrError").makeResult(r):O(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"'):a}function D(e,t,n){var r=e(t);return r.success?r.value===n?o("WAResultOrError").makeResult(n):O(t,'to have content "'+n+'", but instead has "'+r.value+'"'):r}function x(e,t,n){var r=u(e,t);if(!r.success)return r;var a=n[r.value];if(a!=null)return o("WAResultOrError").makeResult(a);var i=Object.values(n).join("|");return O(e,'to have "'+t+'"={'+i+'}, but instead has "'+r.value+'"')}function $(e,t){var n=P(e);if(!n.success)return n;var r=t[n.value];if(r!=null)return o("WAResultOrError").makeResult(r);var a=Object.values(t).join("|");return O(e,'to have content "'+a+'", but instead has "'+n.value+'"')}function P(e){var t=N(e);if(t.success)try{var n=new(o("WABinary")).Binary(t.value),a=n.readString(n.size());return o("WAResultOrError").makeResult(a)}catch(t){return O(e,"to have string content, but run into decoding error: "+r("getErrorSafe")(t).message)}else return t}function N(e){var t=e.content;return t==null?O(e,"to have content"):Array.isArray(t)?O(e,"to have content, but has children instead"):o("WAResultOrError").makeResult(t)}function M(e,t){var n=N(e);return n.success?o("WACryptoUtils").uint8ArraysEqual(n.value,t)?o("WAResultOrError").makeResult(t):O(e,'to have content ":binary:'+o("WABase64").encodeB64(t)+'", but instead has ":binary:'+o("WABase64").encodeB64(n.value)+'"'):n}function w(e,t,n){var r=e.content;if(r==null)return t===void 0||t<1?o("WAResultOrError").makeResult(new Uint8Array([])):O(e,"to have content");if(Array.isArray(r))return O(e,"to have content, but has children instead");var a=r.length;return t!==void 0&&a<t?O(e,"to have binary content at least "+t+" bytes but has "+a+" bytes"):n!==void 0&&a>n?O(e,"to have binary content at most "+n+" bytes but has "+a+" bytes"):o("WAResultOrError").makeResult(r)}function A(e){return d(e,q,"integer")}function F(e){return e}function O(e,t){return o("WAResultOrError").makeError("expected <"+e.tag+">: "+t)}function B(e,t){return r("WAHasProperty")(e.attrs,t)}function W(e,t){return t instanceof o("WAWapJid").WapJid?o("WAResultOrError").makeResult(t.toString()):typeof t=="string"?o("WAResultOrError").makeResult(t):O(e,"decodeAsString: attribute is "+typeof t+" not a string: "+String(t))}function q(e){var t=parseInt(e,10);return Number.isNaN(t)?null:t}function U(e,t,n,r){var a=h(e);if(!a.success)return a;var i=a.value;if(i==null)return n!==0?O(e,"to have at least "+n+" <"+t+"> children, but found 0"):o("WAResultOrError").makeResult([]);for(var l=[],s=0;s<i.length;s++){var u=i[s];u.tag===t&&l.push(u)}var c=l.length;return c<n?O(e,"to have at least "+n+" <"+t+"> children, but found "+c):c>r?O(e,"to have at most "+r+" <"+t+"> children, but found "+c):o("WAResultOrError").makeResult(l)}var V={};function H(e,t,n){var r=t.map(function(e,t){return e+": "+n[t].error});return O(e,["to match any of following mixins: "+t.join(", ")+", but all mixins failed."].concat(r).join(" "))}l.voidSuccess=e,l.assertTag=s,l.attrString=u,l.attrValidate=c,l.contentValidate=d,l.assertAttr=m,l.attrStanzaId=p,l.attrCallId=_,l.attrInt=f,l.attrIntRange=g,l.maybeChildren=h,l.optionalChild=y,l.optionalChildWithTag=C,l.childWithTag=b,l.flattenedChildWithTag=v,l.mapChildrenWithTag=S,l.countChildrenWithTag=R,l.mapHomogeneousChildrenWithTag=L,l.countHomogeneousChildrenWithTag=E,l.optional=k,l.optionalLiteral=I,l.literal=T,l.literalContent=D,l.attrStringEnum=x,l.contentStringEnum=$,l.contentString=P,l.contentBytes=N,l.contentLiteralBytes=M,l.contentBytesRange=w,l.contentInt=A,l.identity=F,l.errorMessage=O,l.emptyObject=V,l.errorMixinDisjunction=H}),98);
__d("WASmaxParseJid",["WAJids","WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateUserJid,"UserJid")}function s(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateLidUserJid,"LidUserJid")}function u(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateDeviceJid,"DeviceJid")}function c(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateGroupJid,"GroupJid")}function d(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateCallJid,"CallJid")}function m(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateDomainJid,"DomainJid")}function p(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateBroadcastJid,"BroadcastJid")}function _(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateStatusJid,"StatusJid")}function f(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateNewsletterJid,"NewsletterJid")}function g(e,t,n){var r=o("WASmaxParseUtils").attrString(e,t);if(!r.success)return r;for(var a=n.validators,i=n.typeName,l=0;l<a.length;l++){var s=a[l](r.value);if(s!=null)return o("WAResultOrError").makeResult(s)}return o("WASmaxParseUtils").errorMessage(e,'to have "'+t+'"={'+i+'}, but instead has "'+r.value+'"')}function h(e,t,n,r){var a=e(t,n);return!a.success||a.value===r?a:o("WASmaxParseUtils").errorMessage(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"')}function y(e,t,n,r){var a=o("WASmaxParseUtils").optional(e,t,n);return!a.success||a.value==null||a.value===r?a:o("WASmaxParseUtils").errorMessage(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"')}l.attrUserJid=e,l.attrLidUserJid=s,l.attrDeviceJid=u,l.attrGroupJid=c,l.attrCallJid=d,l.attrDomainJid=m,l.attrBroadcastJid=p,l.attrStatusJid=_,l.attrNewsletterJid=f,l.attrJidEnum=g,l.literalJid=h,l.optionalLiteralJid=y}),98);
__d("WASmaxParseReference",["WAHasProperty","WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,o){var a=m(t,n);if(!a.success)return _(a);var i=e(a.value,n[n.length-1],r,o);return i.success?i:_(i)}function s(t,n,r,a,i){return p(n,r)?e(t,n,r,a,i):o("WASmaxParseUtils").voidSuccess}function u(t,n){return e(o("WASmaxParseUtils").attrString,t,n)}function c(e,t){return p(e,t)?u(e,t):o("WASmaxParseUtils").voidSuccess}function d(e,t){var n=m(e,t);if(!n.success)return _(n);var r=o("WASmaxParseUtils").contentString(n.value);return r.success?r:_(r)}function m(e,t){for(var n=t.length,r=e,a=0;a<n-1;a++){var i=t[a],l=o("WASmaxParseUtils").flattenedChildWithTag(r,i);if(!l.success)return l;r=l.value}return o("WAResultOrError").makeResult(r)}function p(e,t){var n=m(e,t);return n.success&&r("WAHasProperty")(n.value.attrs,t[t.length-1])}function _(e){return o("WAResultOrError").makeError("in the reference, "+e.error)}l.attrFromReference=e,l.optionalAttrFromReference=s,l.attrStringFromReference=u,l.optionalAttrStringFromReference=c,l.contentStringFromReference=d}),98);
__d("WASmaxInPingsClientResponseServerResponse",["WAResultOrError","WASmaxInPingsEnums","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseJid").attrJidEnum(e,"from",o("WASmaxInPingsEnums").DOMAINJID_USERJID);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").attrInt(e,"t");return s.success?o("WAResultOrError").makeResult({from:r.value,type:a.value,t:s.value}):s}l.parseClientResponseServerResponse=e}),98);
__d("WAWapDict",[],(function(t,n,r,o,a,i){"use strict";var e=3,l=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","notification","disappearing_mode","status","jid","broadcast","user","devices","device_hash","to","offline","message","result","class","xmlns","duration","notify","iq","t","ack","g.us","enc","urn:xmpp:whatsapp:push","presence","config_value","picture","verified_name","config_code","key-index-list","contact","mediatype","routing_info","edge_routing","get","read","urn:xmpp:ping","fallback_hostname","0","chatstate","business_hours_config","unavailable","download_buckets","skmsg","verified_level","composing","handshake","device-list","media","text","fallback_ip4","media_conn","device","creation","location","config","item","fallback_ip6","count","w:profile:picture","image","business","2","hostname","call-creator","display_name","relaylatency","platform","abprops","success","msg","offline_preview","prop","key-index","v","day_of_week","pkmsg","version","1","ping","w:p","download","video","set","specific_hours","props","primary","unknown","hash","commerce_experience","last","subscribe","max_buckets","call","profile","member_since_text","close_time","call-id","sticker","mode","participants","value","query","profile_options","open_time","code","list","host","ts","contacts","upload","lid","preview","update","usync","w:stats","delivery","auth_ttl","context","fail","cart_enabled","appdata","category","atn","direct_connection","decrypt-fail","relay_id","mmg-fallback.whatsapp.net","target","available","name","last_id","mmg.whatsapp.net","categories","401","is_new","index","tctoken","ip4","token_id","latency","recipient","edit","ip6","add","thumbnail-document","26","paused","true","identity","stream:error","key","sidelist","background","audio","3","thumbnail-image","biz-cover-photo","cat","gcm","thumbnail-video","error","auth","deny","serial","in","registration","thumbnail-link","remove","00","gif","thumbnail-gif","tag","capability","multicast","item-not-found","description","business_hours","config_expo_key","md-app-state","expiration","fallback","ttl","300","md-msg-hist","device_orientation","out","w:m","open_24h","side_list","token","inactive","01","document","te2","played","encrypt","msgr","hide","direct_path","12","state","not-authorized","url","terminate","signature","status-revoke-delay","02","te","linked_accounts","trusted_contact","timezone","ptt","kyc-id","privacy_token","readreceipts","appointment_only","address","expected_ts","privacy","7","android","interactive","device-identity","enabled","attribute_padding","1080","03","screen_height"],s=["read-self","active","fbns","protocol","reaction","screen_width","heartbeat","deviceid","2:47DEQpj8","uploadfieldstat","voip_settings","retry","priority","longitude","conflict","false","ig_professional","replaced","preaccept","cover_photo","uncompressed","encopt","ppic","04","passive","status-revoke-drop","keygen","540","offer","rate","opus","latitude","w:gp2","ver","4","business_profile","medium","sender","prev_v_id","email","website","invited","sign_credential","05","transport","skey","reason","peer_abtest_bucket","America/Sao_Paulo","appid","refresh","100","06","404","101","104","107","102","109","103","member_add_mode","105","transaction-id","110","106","outgoing","108","111","tokens","followers","ig_handle","self_pid","tue","dec","thu","joinable","peer_pid","mon","features","wed","peer_device_presence","pn","delete","07","fri","audio_duration","admin","connected","delta","rcat","disable","collection","08","480","sat","phash","all","invite","accept","critical_unblock_low","group_update","signed_credential","blinded_credential","eph_setting","net","09","background_location","refresh_id","Asia/Kolkata","privacy_mode_ts","account_sync","voip_payload_type","service_areas","acs_public_key","v_id","0a","fallback_class","relay","actual_actors","metadata","w:biz","5","connected-limit","notice","0b","host_storage","fb_page","subject","privatestats","invis","groupadd","010","note.m4r","uuid","0c","8000","sun","372","1020","stage","1200","720","canonical","fb","011","video_duration","0d","1140","superadmin","012","Opening.m4r","keystore_attestation","dleq_proof","013","timestamp","ab_key","w:sync:app:state","0e","vertical","600","p_v_id","6","likes","014","500","1260","creator","0f","rte","destination","group","group_info","syncd_anti_tampering_fatal_exception_enabled","015","dl_bw","Asia/Jakarta","vp8/h.264","online","1320","fb:multiway","10","timeout","016","nse_retry","urn:xmpp:whatsapp:dirty","017","a_v_id","web_shops_chat_header_button_enabled","nse_call","inactive-upgrade","none","web","groups","2250","mms_hot_content_timespan_in_seconds","contact_blacklist","nse_read","suspended_group_deletion_notification","binary_version","018","https://www.whatsapp.com/otp/copy/","reg_push","shops_hide_catalog_attachment_entrypoint","server_sync",".","ephemeral_messages_allowed_values","019","mms_vcache_aggregation_enabled","iphone","America/Argentina/Buenos_Aires","01a","mms_vcard_autodownload_size_kb","nse_ver","shops_header_dropdown_menu_item","dhash","catalog_status","communities_mvp_new_iqs_serverprop","blocklist","default","11","ephemeral_messages_enabled","01b","original_dimensions","8","mms4_media_retry_notification_encryption_enabled","mms4_server_error_receipt_encryption_enabled","original_image_url","sync","multiway","420","companion_enc_static","shops_profile_drawer_entrypoint","01c","vcard_as_document_size_kb","status_video_max_duration","request_image_url","01d","regular_high","s_t","abt","share_ext_min_preliminary_image_quality","01e","32","syncd_key_rotation_enabled","data_namespace","md_downgrade_read_receipts2","patch","polltype","ephemeral_messages_setting","userrate","15","partial_pjpeg_bw_threshold","played-self","catalog_exists","01f","mute_v2"],u=["reject","dirty","announcement","020","13","9","status_video_max_bitrate","fb:thrift_iq","offline_batch","022","full","ctwa_first_business_reply_logging","h.264","smax_id","group_description_length","https://www.whatsapp.com/otp/code","status_image_max_edge","smb_upsell_business_profile_enabled","021","web_upgrade_to_md_modal","14","023","s_o","smaller_video_thumbs_status_enabled","media_max_autodownload","960","blocking_status","peer_msg","joinable_group_call_client_version","group_call_video_maximization_enabled","return_snapshot","high","America/Mexico_City","entry_point_block_logging_enabled","pop","024","1050","16","1380","one_tap_calling_in_group_chat_size","regular_low","inline_joinable_education_enabled","hq_image_max_edge","locked","America/Bogota","smb_biztools_deeplink_enabled","status_image_quality","1088","025","payments_upi_intent_transaction_limit","voip","w:g2","027","md_pin_chat_enabled","026","multi_scan_pjpeg_download_enabled","shops_product_grid","transaction_id","ctwa_context_enabled","20","fna","hq_image_quality","alt_jpeg_doc_detection_quality","group_call_max_participants","pkey","America/Belem","image_max_kbytes","web_cart_v1_1_order_message_changes_enabled","ctwa_context_enterprise_enabled","urn:xmpp:whatsapp:account","840","Asia/Kuala_Lumpur","max_participants","video_remux_after_repair_enabled","stella_addressbook_restriction_type","660","900","780","context_menu_ios13_enabled","mute-state","ref","payments_request_messages","029","frskmsg","vcard_max_size_kb","sample_buffer_gif_player_enabled","match_last_seen","510","4983","video_max_bitrate","028","w:comms:chat","17","frequently_forwarded_max","groups_privacy_blacklist","Asia/Karachi","02a","web_download_document_thumb_mms_enabled","02b","hist_sync","biz_block_reasons_version","1024","18","web_is_direct_connection_for_plm_transparent","view_once_write","file_max_size","paid_convo_id","online_privacy_setting","video_max_edge","view_once_read","enhanced_storage_management","multi_scan_pjpeg_encoding_enabled","ctwa_context_forward_enabled","video_transcode_downgrade_enable","template_doc_mime_types","hq_image_bw_threshold","30","body","u_aud_limit_sil_restarts_ctrl","other","participating","w:biz:directory","1110","vp8","4018","meta","doc_detection_image_max_edge","image_quality","1170","02c","smb_upsell_chat_banner_enabled","key_expiry_time_second","pid","stella_interop_enabled","19","linked_device_max_count","md_device_sync_enabled","02d","02e","360","enhanced_block_enabled","ephemeral_icon_in_forwarding","paid_convo_status","gif_provider","project_name","server-error","canonical_url_validation_enabled","wallpapers_v2","syncd_clear_chat_delete_chat_enabled","medianotify","02f","shops_required_tos_version","vote","reset_skey_on_id_change","030","image_max_edge","multicast_limit_global","ul_bw","21","25","5000","poll","570","22","031","1280","WhatsApp","032","bloks_shops_enabled","50","upload_host_switching_enabled","web_ctwa_context_compose_enabled","ptt_forwarded_features_enabled","unblocked","partial_pjpeg_enabled","fbid:devices","height","ephemeral_group_query_ts","group_join_permissions","order","033","alt_jpeg_status_quality","migrate","popular-bank","win_uwp_deprecation_killswitch_enabled","web_download_status_thumb_mms_enabled","blocking","url_text","035","web_forwarding_limit_to_groups","1600","val","1000","syncd_msg_date_enabled","bank-ref-id","max_subject","payments_web_enabled","web_upload_document_thumb_mms_enabled","size","request","ephemeral","24","receipt_agg","ptt_remember_play_position","sampling_weight","enc_rekey","mute_always","037","034","23","036","action","click_to_chat_qr_enabled","width","disabled","038","md_blocklist_v2","played_self_enabled","web_buttons_message_enabled","flow_id","clear","450","fbid:thread","bloks_session_state","America/Lima","attachment_picker_refresh","download_host_switching_enabled","1792","u_aud_limit_sil_restarts_test2","custom_urls","device_fanout","optimistic_upload","2000","key_cipher_suite","web_smb_upsell_in_biz_profile_enabled","e","039","siri_post_status_shortcut","pair-device","lg","lc","stream_attribution_url","model","mspjpeg_phash_gen","catalog_send_all","new_multi_vcards_ui","share_biz_vcard_enabled","-","clean","200","md_blocklist_v2_server","03b","03a","web_md_migration_experience","ptt_conversation_waveform","u_aud_limit_sil_restarts_test1"],c=["64","ptt_playback_speed_enabled","web_product_list_message_enabled","paid_convo_ts","27","manufacturer","psp-routing","grp_uii_cleanup","ptt_draft_enabled","03c","business_initiated","web_catalog_products_onoff","web_upload_link_thumb_mms_enabled","03e","mediaretry","35","hfm_string_changes","28","America/Fortaleza","max_keys","md_mhfs_days","streaming_upload_chunk_size","5541","040","03d","2675","03f","...","512","mute","48","041","alt_jpeg_quality","60","042","md_smb_quick_reply","5183","c","1343","40","1230","043","044","mms_cat_v1_forward_hot_override_enabled","user_notice","ptt_waveform_send","047","Asia/Calcutta","250","md_privacy_v2","31","29","128","md_messaging_enabled","046","crypto","690","045","enc_iv","75","failure","ptt_oot_playback","AIzaSyDR5yfaG7OG8sMTUj8kfQEb8T9pN8BM6Lk","w","048","2201","web_large_files_ui","Asia/Makassar","812","status_collapse_muted","1334","257","2HP4dm","049","patches","1290","43cY6T","America/Caracas","web_sticker_maker","campaign","ptt_pausable_enabled","33","42","attestation","biz","04b","query_linked","s","125","04a","810","availability","1411","responsiveness_v2_m1","catalog_not_created","34","America/Santiago","1465","enc_p","04d","status_info","04f","key_version","..","04c","04e","md_group_notification","1598","1215","web_cart_enabled","37","630","1920","2394","-1","vcard","38","elapsed","36","828","peer","pricing_category","1245","invalid","stella_ios_enabled","2687","45","1528","39","u_is_redial_audio_1104_ctrl","1025","1455","58","2524","2603","054","bsp_system_message_enabled","web_pip_redesign","051","verify_apps","1974","1272","1322","1755","052","70","050","1063","1135","1361","80","1096","1828","1851","1251","1921","key_config_id","1254","1566","1252","2525","critical_block","1669","max_available","w:auth:backup:token","product","2530","870","1022","participant_uuid","web_cart_on_off","1255","1432","1867","41","1415","1440","240","1204","1608","1690","1846","1483","1687","1749","69","url_number","053","1325","1040","365","59","Asia/Riyadh","1177","test_recommended","057","1612","43","1061","1518","1635","055","1034","1375","750","1430","event_code","1682","503","55","865","78","1309","1365","44","America/Guayaquil","535","LIMITED","1377","1613","1420","1599","1822","05a","1681","password","1111","1214","1376","1478","47","1082","4282","Europe/Istanbul","1307","46","058","1124","256","rate-overlimit","retail","u_a_socket_err_fix_succ_test","1292","1370","1388","520","861","psa","regular","1181","1766","05b","1183","1213","1304","1537"],d=["1724","profile_picture","1071","1314","1605","407","990","1710","746","pricing_model","056","059","061","1119","6027","65","877","1607","05d","917","seen","1516","49","470","973","1037","1350","1394","1480","1796","keys","794","1536","1594","2378","1333","1524","1825","116","309","52","808","827","909","495","1660","361","957","google","1357","1565","1967","996","1775","586","736","1052","1670","bank","177","1416","2194","2222","1454","1839","1275","53","997","1629","6028","smba","1378","1410","05c","1849","727","create","1559","536","1106","1310","1944","670","1297","1316","1762","en","1148","1295","1551","1853","1890","1208","1784","7200","05f","178","1283","1332","381","643","1056","1238","2024","2387","179","981","1547","1705","05e","290","903","1069","1285","2436","062","251","560","582","719","56","1700","2321","325","448","613","777","791","51","488","902","Asia/Almaty","is_hidden","1398","1527","1893","1999","2367","2642","237","busy","065","067","233","590","993","1511","54","723","860","363","487","522","605","995","1321","1691","1865","2447","2462","NON_TRANSACTIONAL","433","871","432","1004","1207","2032","2050","2379","2446","279","636","703","904","248","370","691","700","1068","1655","2334","060","063","364","533","534","567","1191","1210","1473","1827","069","701","2531","514","prev_dhash","064","496","790","1046","1139","1505","1521","1108","207","544","637","final","1173","1293","1694","1939","1951","1993","2353","2515","504","601","857","modify","spam_request","p_121_aa_1101_test4","866","1427","1502","1638","1744","2153","068","382","725","1704","1864","1990","2003","Asia/Dubai","508","531","1387","1474","1632","2307","2386","819","2014","066","387","1468","1706","2186","2261","471","728","1147","1372","1961"],m=[s,u,c,d];i.DICT_VERSION=e,i.SINGLE_BYTE_TOKEN=l,i.DICTIONARY_0_TOKEN=s,i.DICTIONARY_1_TOKEN=u,i.DICTIONARY_2_TOKEN=c,i.DICTIONARY_3_TOKEN=d,i.DICTIONARIES=m}),66);
__d("WAXmlFormatter",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~"),n=t.length,r=!1,o=0,a="",i=0,s=["\n"];for(i=0;i<100;i++)s.push(s[i]+"    ");var u=function(t,n){var e=/^<[\w:\-.,]+/.exec(t[n-1]),r=/^<\/[\w:\-.,]+/.exec(t[n]);return e!=null&&r!=null&&e[0]===r[0]};for(i=0;i<n;i++)t[i].search(/<!/)>-1?(a+=s[o]+t[i],r=!0,(t[i].search(/-->/)>-1||t[i].search(/\]>/)>-1||t[i].search(/!DOCTYPE/)>-1)&&(r=!1)):t[i].search(/-->/)>-1||t[i].search(/\]>/)>-1?(a+=t[i],r=!1):u(t,i)?(a+=t[i],r||o--):t[i].search(/<\w/)>-1&&t[i].search(/<\//)===-1&&t[i].search(/\/>/)===-1?(t[i]=l(t[i]),a=r?a+=t[i]:a+=s[o++]+t[i]):t[i].search(/<\w/)>-1&&t[i].search(/<\//)>-1?a=r?a+=t[i]:a+=s[o]+t[i]:t[i].search(/<\//)>-1?a=r?a+=t[i]:a+=s[o===0?o:--o]+t[i]:t[i].search(/\/>/)>-1?a=r?a+=t[i]:a+=s[o]+t[i]:t[i].search(/<\?/)>-1||t[i].search(/xmlns:/)>-1||t[i].search(/xmlns=/)>-1?a+=s[o]+t[i]:a+=t[i];return a[0]==="\n"?a.slice(1):a}function l(e){var t=e.match(/(<query.*>|<result>)(\{.*\})/);if(t===null)return e;try{var n=t[1],r=JSON.stringify(JSON.parse(t[2]),null,2);return n+"\n"+r}catch(t){return e+"[Error formatting JSON]"}}i.default=e}),66);
__d("WAXmlNode",["WAHex"],(function(t,n,r,o,a,i,l){"use strict";var e={},s=(function(){function t(t,n,r){n===void 0&&(n=e),r===void 0&&(r=null),this.tag=t,this.attrs=n,this.content=r}var n=t.prototype;return n.toString=function(){var e="<"+this.tag;e+=u(this.attrs);var t=this.content;return Array.isArray(t)?e+=">"+t.map(String).join("")+"</"+this.tag+">":t instanceof Uint8Array?e+=">"+c(t)+"</"+this.tag+">":t!=null?e+=">"+String(t)+"</"+this.tag+">":e+=" />",e},t})();function u(e){for(var t=Object.keys(e),n="",r=0;r<t.length;r++){var o=t[r];n+=" "+o+'="'+e[o].toString()+'"'}return n}function c(e){var t="";return e.length===0?t="<!-- empty binary -->":e.length<50?t=o("WAHex").bytesToDebugString(e):t="<!-- "+e.length+" bytes -->",t}l.XmlNode=s,l.attrsToString=u,l.uint8ArrayToDebugString=c}),98);
__d("WAWap",["WAAssertUnreachable","WABinary","WACryptoDependencies","WAJids","WALogger","WALongInt","WATextEncoding","WAWapDict","WAWapJid","WAXmlFormatter","WAXmlNode","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=(c=o("WAJids")).MSGR_USER_DOMAIN.replace("@",""),p=c.WA_USER_DOMAIN.replace("@",""),_=c.LID_DOMAIN.replace("@",""),f=c.INTEROP_DOMAIN.replace("@",""),g=c.HOSTED_DOMAIN.replace("@",""),h=2,y=128,C=0,b=236,v=237,S=238,R=239,L=[b,v,S,R],E=245,k=246,I=247,T=248,D=249,x=250,$=251,P=252,N=253,M=254,w=255,A=["0","1","2","3","4","5","6","7","8","9","-",".","\uFFFD","\uFFFD","\uFFFD","\uFFFD"],F=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],O="",B=1,W={sentinel:"DROP_ATTR"},q=(d=o("WAWapJid")).WapJid.create(null,"g.us"),U=d.WapJid.create(null,c.WA_SERVER_JID_SUFFIX),V=d.WapJid.create("status","broadcast"),H=d.WapJid.create(null,"newsletter"),G=d.WapJid.create(null,"hosted"),z=d.WapJid.create(null,"hosted.lid"),j=d.WapJid.create(null,"call"),K={},Q=!1;function X(){Q=!0}var Y=o("WATextEncoding").newTextEncoder(),J=(function(){function e(e,t,n){t===void 0&&(t=K),n===void 0&&(n=null),this.tag=e,this.attrs=t,this.content=n}var t=e.prototype;return t.toString=function(){var e="<"+this.tag;e+=o("WAXmlNode").attrsToString(this.attrs);var t=this.content;return Array.isArray(t)?e+=">"+t.map(String).join("")+"</"+this.tag+">":t?e+=">"+o("WAXmlNode").uint8ArrayToDebugString(t)+"</"+this.tag+">":e+=" />",Q&&(e=r("WAXmlFormatter")(e)),e},e})();function Z(e,t,n){var a=null;if(t&&t.children!=null)throw r("err")('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(n))a=n.filter(Boolean);else if(typeof n=="string")a=o("WABinary").Binary.build(n).readByteArrayView();else if(n instanceof ArrayBuffer)a=new Uint8Array(n);else if(n instanceof Uint8Array)a=n;else{for(var i=[],l=2;l<arguments.length;l++){var s=arguments[l];s&&i.push(s)}a=i}Array.isArray(a)&&a.length===0&&(a=null);var u={};if(t){var c=t;Object.keys(c).forEach(function(t){if(!["__self","__source"].includes(t)){var n=c[t];if(n==null)throw r("err")("Attr "+t+" in <"+e+"> is null");n!==W&&(u[t]=n)}})}return new J(e,u,a)}var ee=Z;function te(e){return e instanceof o("WAWapJid").WapJid?e.toString():e}function ne(e){var t=e.content;return Array.isArray(t)?t=t.map(ne):typeof t=="string"&&(t=o("WABinary").Binary.build(t).readByteArrayView()),new J(e.tag,e.attrs||K,t)}function re(e){var t=e instanceof J?e:ne(e),n=new(o("WABinary")).Binary;oe(t,n);var r=0,a=n.readByteArrayView(),i=new Uint8Array(1+a.length);return i[0]=r,i.set(a,1),i}function oe(e,t){if(e==null)t.writeUint8(C);else if(e instanceof J)ie(e,t);else if(e instanceof o("WAWapJid").WapJid)ae(e,t);else if(typeof e=="string")ce(e,t);else if(e instanceof Uint8Array)me(e,t);else{var n=typeof e;throw r("err")("Invalid payload type "+n)}}function ae(e,t){var n=e.getInnerJid();if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_U){var r=n.user,a=n.device,i=n.domainType;t.writeUint8(I),t.writeUint8(i),t.writeUint8(a),oe(r,t)}else if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_FB){var l=n.user,s=n.device;t.writeUint8(k),oe(l,t),t.writeUint16(s),oe(m,t)}else if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_INTEROP){var u=n.user,c=n.device,d=n.integrator;t.writeUint8(E),oe(u,t),t.writeUint16(c),t.writeUint16(d)}else{var p=n.user,_=n.server;t.writeUint8(x),p!=null?oe(p,t):t.writeUint8(C),oe(_,t)}}function ie(e,t){if(e.tag===void 0){t.writeUint8(T),t.writeUint8(C);return}var n=1;e.attrs&&(n+=Object.keys(e.attrs).length*2),e.content&&n++,n<256?(t.writeUint8(T),t.writeUint8(n)):n<65536&&(t.writeUint8(D),t.writeUint16(n)),oe(e.tag,t),e.attrs&&Object.keys(e.attrs).forEach(function(n){ce(n,t),oe(e.attrs[n],t)});var r=e.content;if(Array.isArray(r)){r.length<256?(t.writeUint8(T),t.writeUint8(r.length)):r.length<65536&&(t.writeUint8(D),t.writeUint16(r.length));for(var o=0;o<r.length;o++)ie(r[o],t)}else r&&oe(r,t)}var le,se;function ue(e){for(var t=new Map,n=0;n<e.length;n++)t.set(e[n],n);return t}function ce(e,t){if(e===""){t.writeUint8(P),t.writeUint8(0);return}le==null&&(le=ue(o("WAWapDict").SINGLE_BYTE_TOKEN));var n=le.get(e);if(n!=null){t.writeUint8(n+1);return}if(se==null){se=[];for(var r=0;r<o("WAWapDict").DICTIONARIES.length;++r)se.push(ue(o("WAWapDict").DICTIONARIES[r]))}for(var a=0;a<se.length;++a){var i=se[a].get(e);if(i!=null){t.writeUint8(L[a]),t.writeUint8(i);return}}var l=o("WABinary").numUtf8Bytes(e);if(l<128){var s=/[^0-9.-]+?/,u=/[^0-9A-F]+?/;if(s.exec(e)){if(!u.exec(e)){de(e,$,t);return}}else{de(e,w,t);return}}pe(l,t),t.writeString(e)}function de(e,t,n){var o=e.length%2===1;n.writeUint8(t);var a=Math.ceil(e.length/2);o&&(a|=y),n.writeUint8(a);for(var i=0,l=0;l<e.length;l++){var s=e.charCodeAt(l),u=null;if(48<=s&&s<=57?u=s-48:t===w?s===45?u=10:s===46&&(u=11):t===$&&65<=s&&s<=70&&(u=s-55),u==null)throw r("err")("Cannot nibble encode "+s);l%2===0?(i=u<<4,l===e.length-1&&(i|=15,n.writeUint8(i))):(i|=u,n.writeUint8(i))}}function me(e,t){pe(e.length,t),t.writeByteArray(e)}function pe(e,t){if(e<256)t.writeUint8(P),t.writeUint8(e);else if(e<1048576)t.writeUint8(N),t.writeUint8(e>>>16&255),t.writeUint8(e>>>8&255),t.writeUint8(e&255);else if(e<4294967296)t.writeUint8(M),t.writeUint32(e);else throw r("err")("Binary with length "+e+" is too big for WAP protocol")}function _e(t,n){var r=new(o("WABinary")).Binary(t),a=r.readUint8(),i=a&h;return i?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Decoding compressed stanza"]))),n(r.readByteArrayView()).then(function(e){return ye(new(o("WABinary")).Binary(e))})):Promise.resolve(ye(r))}function fe(e){var t=new(o("WABinary")).Binary(e),n=t.readUint8(),a=n&h;if(a)throw r("err")("Cannot pass compressed stanza to decodeStanzaDebug");return ye(t)}function ge(e,t){var n=e.readUint8();if(n===C)return null;if(n===T)return he(e,e.readUint8());if(n===D)return he(e,e.readUint16());if(n===P){var a=e.readUint8();return Ee(e,a,t)}if(n===N){var i=e.readUint8(),l=e.readUint8(),s=e.readUint8(),u=((i&15)<<16)+(l<<8)+s;return Ee(e,u,t)}if(n===M){var c=e.readUint32();return Ee(e,c,t)}if(n===x)return ve(e);if(n===k)return Se(e);if(n===E)return Re(e);if(n===I)return Le(e);if(n===w){var d=e.readUint8(),m=d>>>7,p=d&127;return ke(e,A,m,p)}if(n===$){var _=e.readUint8(),f=_>>>7,g=_&127;return ke(e,F,f,g)}if(n<=0||n>=240)throw r("err")("Unable to decode WAP buffer");if(n>=b&&n<=R){var h=n-b,y=o("WAWapDict").DICTIONARIES[h];if(y===void 0)throw r("err")("Missing WAP dictionary "+h);var v=e.readUint8(),S=y[v];if(S===void 0)throw r("err")("Invalid value index "+v+" in dict "+h);return S}var L=o("WAWapDict").SINGLE_BYTE_TOKEN[n-1];if(L===void 0)throw r("err")("Undefined token with index "+n);return L}function he(e,t){for(var n=[],r=0;r<t;r++)n.push(ye(e));return n}function ye(e){var t=e.readUint8(),n;if(t===T)n=e.readUint8();else if(t===D)n=e.readUint16();else throw r("err")("Failed to decode node since type byte "+String(t)+" is invalid");var a=void 0,i=null;if(n===0)throw r("err")("Failed to decode node, list cannot be empty");var l=Ce(e);for(n-=1;n>1;){a||(a={});var s=Ce(e),u=ge(e,!0);a[s]=u,n-=2}return n===1&&(i=ge(e,!1),i instanceof o("WAWapJid").WapJid&&(i=String(i)),typeof i=="string"&&(i=Y.encode(i))),new J(l,a,i)}function Ce(e){var t=ge(e,!0);if(typeof t!="string")throw o("WALogger").DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["decodeString got invalid value: ",", string expected"])),String(t)),r("err")("WAWap:decodeString got invalid value, string expected");return t}function be(e){var t=ge(e,!0);if(t!=null&&typeof t!="string")throw o("WALogger").DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["decodeNullableString got invalid value: ",", string expected"])),String(t)),r("err")("WAWap:decodeNullableString got invalid value, string expected");return t}function ve(e){var t=be(e),n=Ce(e);return o("WAWapJid").WapJid.create(t,n)}function Se(e){var t=Ce(e),n=e.readUint16();return Ce(e),o("WAWapJid").WapJid.createFbJid(t,n)}function Re(e){var t=Ce(e),n=e.readUint16(),r=e.readUint16();return Ce(e),o("WAWapJid").WapJid.createInteropJid(t,n,r)}function Le(e){var t=null,n=e.readUint8();if(n===0)t=o("WAWapJid").DomainType.WHATSAPP;else if(n===1)t=o("WAWapJid").DomainType.LID;else if((1&n)===0&&(128&n)!==0)t=o("WAWapJid").DomainType.HOSTED;else if(n===129)t=o("WAWapJid").DomainType.HOSTED_LID;else throw r("err")("decodeJidU - Invalid domain type encoding "+n);var a=e.readUint8(),i=Ce(e);return o("WAWapJid").WapJid.createJidU(i,t,a)}function Ee(e,t,n){return n===void 0&&(n=!1),n?e.readString(t):e.readByteArrayView(t)}function ke(e,t,n,r){for(var o=new Array(r*2-n),a=0;a<o.length-1;a+=2){var i=e.readUint8();o[a]=t[i>>>4],o[a+1]=t[i&15]}if(n){var l=e.readUint8();o[o.length-1]=t[l>>>4]}return o.join("")}function Ie(){if(!O){var e=new Uint16Array(2);o("WACryptoDependencies").getCrypto().getRandomValues(e),O=String(e[0])+"."+String(e[1])+"-"}return""+O+B++}function Te(e){switch(e.type){case"group":return e.groupJid;case"status":return o("WAJids").STATUS_JID;case"device":return e.deviceJid;case"newsletter":return e.newsletterJid;case"hosted":return e.hostedDeviceJid;case"hostedLid":return e.hostedLidDeviceJid;default:return e.type,e.broadcastJid}}function De(e){switch(e.type){case"group":return e.author;case"status":return e.author;case"broadcast":return e.author;default:return e.type,null}}function xe(e){return e.type==="status"||e.type==="group"||e.type==="broadcast"?Pe(e.author):W}function $e(e){return Pe(Te(e))}function Pe(e){var t=o("WAJids").validateDomainJid(e);if(t!=null)return Ne(t);var n=e.split("@"),a=n[0],i=n[1],l=null,s=null;if((i===p||i===m||i===f||i===_||i===g||i===o("WAJids").HOSTED_LID_SUFFIX)&&a.indexOf(":")!==-1){var u=a.split(":");a=u[0],l=u[1],s=parseInt(l,10)}if(i===f){var c=a.split("-"),d=c[0],h=c[1];return o("WAWapJid").WapJid.createInteropJid(h,s,parseInt(d,10))}else if(i===m)return o("WAWapJid").WapJid.createFbJid(a,s);var y=null;if(i===_)y=o("WAWapJid").DomainType.LID;else if(i===g){if(s!==99)throw r("err")("wid unexpected deviceId");y=o("WAWapJid").DomainType.HOSTED}else if(i===o("WAJids").HOSTED_LID_SUFFIX){if(s!==99)throw r("err")("lid invalid deviceId");y=o("WAWapJid").DomainType.HOSTED_LID}else y=o("WAWapJid").DomainType.WHATSAPP;return s!=null&&s!==0?o("WAWapJid").WapJid.createJidU(a,y,s):o("WAWapJid").WapJid.create(a,i)}function Ne(e){return e==="s.whatsapp.net"?U:e==="g.us"?q:e==="newsletter"?H:e==="call"?j:r("WAAssertUnreachable")(e)}function Me(e){return Pe(e)}function we(e){return Pe(e)}function Ae(e){return Pe(e)}function Fe(e){return Pe(e)}function Oe(e){return Pe(e)}function Be(e){return Pe(e)}function We(e){return e.jidType==="phoneDevice"||e.jidType==="msgrDevice"||e.jidType==="lidDevice"?Pe(e.deviceJid):e.jidType==="phoneUser"||e.jidType==="msgrUser"||e.jidType==="lidUser"?Pe(e.userJid):e.jidType==="group"?Pe(e.groupJid):e.jidType==="status"?Pe(e.statusJid):e.jidType==="call"?Pe(e.callJid):e.jidType==="interopDevice"?Pe(e.deviceJid):e.jidType==="interopUser"?Pe(e.userJid):e.jidType==="newsletter"?Pe(e.newsletterJid):e.jidType==="hosted"?Pe(e.hostedDeviceJid):e.jidType==="hostedLid"?Pe(e.hostedLidDeviceJid):e.jidType==="bot"?Pe(e.botJid):(e.jidType,Pe(e.broadcastJid))}function qe(e){return e}function Ue(e){return e.toString()}function Ve(e){return e}function He(e){return e}function Ge(e){return e==null?W:e}function ze(e){return e.toString()}function je(e){return o("WALongInt").longIntToDecimalString(e)}function Ke(e,t){t===void 0&&(t=4);for(var n=e,r=new Uint8Array(t),o=t-1;o>=0;o--)r[o]=n&255,n>>>=8;return r}l.DROP_ATTR=W,l.G_US=q,l.S_WHATSAPP_NET=U,l.STATUS_BROADCAST=V,l.NEWSLETTER=H,l.HOSTED=G,l.HOSTED_LID=z,l.CALL=j,l.enableXMLFormat=X,l.WapNode=J,l.makeWapNode=Z,l.wap=ee,l.decodeAsString=te,l.makeStanza=ne,l.encodeStanza=re,l.decodeStanza=_e,l.decodeStanzaDebug=fe,l.generateId=Ie,l.extractToJid=Te,l.extractParticipantJid=De,l.PARTICIPANT_JID=xe,l.TO_JID=$e,l.JID=Pe,l.DOMAIN_JID=Ne,l.USER_JID=Me,l.DEVICE_JID=we,l.GROUP_JID=Ae,l.BROADCAST_JID=Fe,l.CALL_JID=Oe,l.NEWSLETTER_JID=Be,l.TO_WAP_JID=We,l.STANZA_ID=qe,l.SMAX_ID=Ue,l.CUSTOM_STRING=Ve,l.CALL_ID=He,l.MAYBE_CUSTOM_STRING=Ge,l.INT=ze,l.LONG_INT=je,l.BIG_ENDIAN_CONTENT=Ke}),98);
__d("WASmaxJsx",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";l.smax=o("WAWap").wap}),98);
__d("WASmaxMixins",["WAArrayBufferUtils","WAWapJid"],(function(t,n,r,o,a,i,l){"use strict";var e="smax$any";function s(e,t){return c(e,t),d(e,t),t.content instanceof Uint8Array?p(e,t.content):t.content!=null&&_(e,t.content),e}function u(e,t,n,r){return n!=null?e(t,n,r):t}function c(t,n){var r=t.tag,o=n.tag;if(o!==e&&r!==o)throw new Error("tag mismatch: "+r+" != "+o)}function d(e,t){var n=e.attrs,r=t.attrs;Object.keys(r).forEach(function(e){var t=r[e],o=n[e];if(t!=null&&o!=null){if(m(t,o))return;throw new Error("conflict for key: "+e)}n[e]=t})}function m(e,t){return typeof e=="string"&&typeof t=="string"?e===t:e instanceof o("WAWapJid").WapJid&&t instanceof o("WAWapJid").WapJid?e.toString()===t.toString():!1}function p(e,t){var n=e.content;if(n instanceof Uint8Array){if(!o("WAArrayBufferUtils").uint8ArraysEqualUNSAFE(n,t))throw new Error("elementValue mismatch: bytes dose not equal");return}if(n!=null)throw new Error("elementValue mismatch: destination has children");e.content=t}function _(e,t){var n=e.content;if(n instanceof Uint8Array)throw new Error("children mismatch: destination has element value");if(n==null||n.length===0){e.content=t;return}if(!f(n,t))throw new Error("children mismatch: child counts are not compatible");var r=[],o=Array.from(n);t.forEach(function(e){var t=o.findIndex(function(t){return t.tag===e.tag});if(t===-1)r.push(e);else{var n=o.splice(t,1),a=s(n[0],e);r.push(a)}}),o.forEach(function(e){return r.push(e)}),e.content=r}function f(e,t){for(var n=g(t),r=g(e),o=Object.keys(n),a=0;a<o.length;a++){var i=o[a],l=n[i],s=r[i];if(l!=null&&s!=null&&l!==s)return!1}return!0}function g(e){return e.reduce(function(e,t){var n=t.tag,r=e[n];return e[n]=r==null?1:r+1,e},{})}l.mergeStanzas=s,l.optionalMerge=u}),98);
__d("WASmaxOutPingsClientWellFormedToMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeClientWellFormedToMixin=s}),98);
__d("WASmaxOutPingsClientRequest",["WASmaxJsx","WASmaxOutPingsClientWellFormedToMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxOutPingsClientWellFormedToMixin").mergeClientWellFormedToMixin(o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get",xmlns:"w:p"}));return e}l.makeClientRequest=e}),98);
__d("WAComms",["WAArrayUtils","WABaseGlobals","WAErrors","WALogger","WANotifyConnectionChangeFactory","WAPromiseRetryLoop","WAResolvable","WAShiftTimer","WASmaxInPingsClientResponseServerResponse","WASmaxOutPingsClientRequest","WASmaxParseUtils","WATimeUtils","WAWap","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N,M,w,A,F,O,B,W=null,q=null,U=1,V=0,H=(function(){function t(t,n,r){var a=this,i,l,c;this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this.pendingSmaxStanzas=new Map,this.$2=new(o("WAResolvable")).Resolvable,this.socketAbortController=null,this.activePing=null,this.$3=new Set,this.socketId=V,this.socket=null,this.softCloseSocket=null,this.handleStanza=function(t,n,r){var i=o("WASmaxParseUtils").attrString(t,"id");if(i.success&&t.tag!=="receipt"){var l=i.value,u=a.pendingSmaxStanzas.get(l);if(u)return a.pendingSmaxStanzas.delete(l),u.resolve(t),a.maybeScheduleHealthCheck(),"NO_ACK"}var c=_e(t);if(c!=null){var d=a.pendingIqs.get(c);d?(a.pendingIqs.delete(c),d.resolve(t),a.maybeScheduleHealthCheck()):(o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq with id ",""])),c),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq"]))))}else if(t.tag==="ack")a.handleAck(t);else return t.tag==="failure"&&a.config.shouldBlockReceivingUntilSuccess?a.$1(t,n,r):a.$2.promise.then(function(){return a.$1(t,n,r)});return"NO_ACK"},this.healthCheckTimer=new(o("WAShiftTimer")).ShiftTimer(function(){a.socketId&&a.sendPing()}),this.deadSocketTimer=new(o("WAShiftTimer")).ShiftTimer(function(e){e===a.socketId&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," expired"])),e),a.softCloseSocket&&a.softCloseSocket())}),this.$1=t,this.onConnectionChange=o("WANotifyConnectionChangeFactory").notifyConnectionChangeFactory((i=n.handlers.onConnectionChange)!=null?i:function(){},(l=n.handlers.onOptimisticConnectionChange)!=null?l:function(){}),this.gzipInflate=r,this.config=n,this.socketLoop=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({name:"MainSocketLoop",code:ne,timer:(c=n.socketReconnectBackoffAlgo)!=null?c:{jitter:.1,max:n.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4,isPauseEnabled:n.isPauseEnabled===!0})}var n=t.prototype;return n.filterPending=function(t){var e=[];function n(n){t(n)&&e.push(n)}return this.pendingIqs.forEach(n),this.ackHandlers.forEach(n),this.pendingSmaxStanzas.forEach(n),e},n.sendPendingStanza=function(t){t.cleanup==null||t.cleanup(),t.cleanup=void 0,this.callStanza(t.stanza)},n.maybeSendPendingStanza=function(t){if(t.attempt>=this.config.maxRetries){var e,n;(e=(n=this.config.handlers).onDropStanza)==null||e.call(n,t),t.cleanup==null||t.cleanup(),t.cleanup=void 0,this.removeHandler(t,"max-retries")}else if(this.socket){t.attempt+=1,this.sendPendingStanza(t);return}else o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will resend stanza when socket opens"])))},n.callStanzaAsync=async function(t,n){var e=await this.callStanza(t,n);return e},n.callStanza=function(t,n){var e=this.castStanza(t,n);return this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel(),e},n.castStanzaAsync=async function(t){var e=await this.castStanza(t);return e},n.castStanza=function(t,n){var e=this;try{var r,a,i=(r=(a=this.config.handlers).onBeforeCastStanzaForE2E)==null?void 0:r.call(a,t,n);if(i!=null)return o("WALogger").DEV_XMPP(d||(d=babelHelpers.taggedTemplateLiteralLoose([`Dropping stanza since onBeforeCastStanza matched:
`,". We return mock response directly."],["Dropping stanza since onBeforeCastStanza matched:\\n",". We return mock response directly."])),t),o("WALogger").DEV_XMPP(m||(m=babelHelpers.taggedTemplateLiteralLoose([`--- Receive (via SMAX+E2E) ---
`,""],["--- Receive (via SMAX+E2E) ---\\n",""])),i),o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched. We return mock response directly."]))),Array.isArray(i)?Promise.all(i.map(function(t){return Promise.resolve(e.handleStanza(t,e.socketId,V))})):(this.handleStanza(i,this.socketId,V),Promise.resolve())}catch(e){o("WALogger").DEV_XMPP(_||(_=babelHelpers.taggedTemplateLiteralLoose([`Error in onBeforeCastStanza, we consumed and continue with normal stanza sending to the server:
`,""],["Error in onBeforeCastStanza, we consumed and continue with normal stanza sending to the server:\\n",""])),e)}var l=this.socketOrThrow("castStanza");try{return o("WALogger").DEV_XMPP(f||(f=babelHelpers.taggedTemplateLiteralLoose([`--- Sending ---
`,""],["--- Sending ---\\n",""])),t),l.sendFrame(o("WAWap").encodeStanza(t)).then(function(){e.config.handlers.onCastStanza==null||e.config.handlers.onCastStanza(t,n)}).catch(function(e){if(o("WALogger").ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["castStanza async error ",""])),e).devConsole(e),e instanceof o("WAErrors").BufferTooLargeError)return Promise.reject(e)})}catch(e){o("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["castStanza error ",""])),e).devConsole(e)}return Promise.resolve()},n.socketOrThrow=function(t){var e=this.socket;if(e)return e;throw r("err")("Comms."+t+" called while no socket")},n.startHandlingRequests=function(){return o("WALogger").LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Comms.startHandlingRequests"]))),this.$2.resolve(),this.$2.promise.then(function(){})},n.parseAndHandleStanza=function(t,n){var e=this;t===this.socketId&&(this.deadSocketTimer.cancel(),q&&(q.resolve(),q=null));var r=o("WAWap").decodeStanza(n,this.gzipInflate).catch(function(e){throw o("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Failure parsing stanza!"]))).devConsole(n),e}).then(function(r){o("WALogger").DEV_XMPP(b||(b=babelHelpers.taggedTemplateLiteralLoose([`--- Receiving ---
`,""],["--- Receiving ---\\n",""])),r),e.config.handlers.onHandleStanza==null||e.config.handlers.onHandleStanza(r,t,n.byteLength);var a=e.activePing;return a&&a.socketId===t&&a.stanzaId===_e(r)?(e.activePing=null,a.handler.resolve(r),e.maybeScheduleHealthCheck(),"NO_ACK"):e.handleStanza(r,t,n.byteLength)}).then(function(n){if(t===e.socketId){if(n==="CLOSE_SOCKET"){o("WALogger").LOG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["[comms] job response is CLOSE_SOCKET"])));var r=e.socket;r&&r.close()}else n==="NO_ACK"||e.castStanza(n);return"NO_ACK"}});this.$3.add(r),r.finally(function(){return void e.$3.delete(r)})},n.handleAck=function(t){for(var e=this.ackHandlers,n=-1,r=null;!r&&++n<e.length;)r=e[n].parseAndTest(t);if(r){var a,i,l=e[n];o("WAArrayUtils").removeIndexWithoutPreservingOrder(e,n),(a=(i=this.config.handlers).onHandleAck)==null||a.call(i,t),l.resolve(r),this.maybeScheduleHealthCheck()}else o("WALogger").WARN(S||(S=babelHelpers.taggedTemplateLiteralLoose(["handleAck: unrecognized ",""])),t)},n.removeHandler=function(t,n){if(n===void 0&&(n="disconnect"),t.type==="iq"||t.type==="smax"){var e=t.stanza.attrs.id;if(!e||typeof e!="string"||t.type==="iq"&&!this.pendingIqs.delete(e)||t.type==="smax"&&!this.pendingSmaxStanzas.delete(e))return}else{t.type;var r=this.ackHandlers.indexOf(t);if(r===-1)return;o("WAArrayUtils").removeIndexWithoutPreservingOrder(this.ackHandlers,r)}n==="disconnect"?t.resolve(Promise.reject(new(o("WAErrors")).Disconnected)):n==="abort"?t.resolve(Promise.reject(new(o("WAErrors")).Aborted)):t.resolve(Promise.reject(new(o("WAErrors")).MaxRetries))},n.maybeScheduleHealthCheck=function(){if(!this.healthCheckTimer.isScheduled()&&!(this.activePing||this.ackHandlers.length||this.pendingIqs.size||this.pendingSmaxStanzas.size)){var e=this.config.healthCheckInterval,t=Math.ceil(e*1e3*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}},n.sendPing=async function(){var e=pe("sendPing");if(!e.socketId)return o("WALogger").LOG(R||(R=babelHelpers.taggedTemplateLiteralLoose(["[comms] sendPing when socket dead"]))),!1;if(e.activePing&&e.activePing.socketId===e.socketId)return o("WALogger").LOG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["[comms] sendPing ping still pending"]))),!1;e.activePing&&e.activePing.handler.resolve();var t=o("WASmaxOutPingsClientRequest").makeClientRequest(),n=t.attrs.id;if(typeof n!="string")return o("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["[comms] No stanzaId in ping request stanza"]))),!1;var r=new(o("WAResolvable")).Resolvable;e.activePing={socketId:e.socketId,stanzaId:n,handler:r};var a=Date.now();e.callStanza(t);var i=await r.promise,l=Date.now();if(i){var s=o("WASmaxInPingsClientResponseServerResponse").parseClientResponseServerResponse(i,t);if(s.success){var u=l-a,c=Math.round(u/2),d=o("WATimeUtils").castToUnixTime(s.value.t),m=o("WABaseGlobals").newClockSkewCalculation()?Math.round((a+c)/1e3-d):Math.round(Date.now()/1e3-d);return e.config.handlers.onClockSkewUpdate==null||e.config.handlers.onClockSkewUpdate(m),!0}}return!1},t})();function G(){return W}function z(e,t,n,r){r===void 0&&(r=!0),!W&&(W=new H(e,t,n),r&&setTimeout(Y,0))}function j(){var e=pe("stopComms");e.socketLoop.endWithValue(),e.socket&&re(),W=null}function K(){var e=pe("closeSocketAndPreventRetry");e.socketLoop.endWithValue(),e.socket&&(o("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndPreventRetry called"]))),re())}function Q(){var e=pe("closeSocketAndPause");e.socketLoop.pauseOnNextIteration(),e.socket&&(o("WALogger").LOG(I||(I=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndPause called"]))),re())}function X(){var e=pe("closeSocketAndResume");e.socketLoop.unpause(),e.socket&&(o("WALogger").LOG(T||(T=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndResume called"]))),re())}function Y(){pe("openSocketLoop").socketLoop.start()}function J(){o("WALogger").LOG(D||(D=babelHelpers.taggedTemplateLiteralLoose(["[comms] maybeResetSocketLoop"]))),te()||pe("maybeResetSocketLoop").socketLoop.reset()}function Z(){pe("forceResetSocketLoop").socketLoop.reset()}function ee(){var e,t=pe("socketAbortController");(e=t.socketAbortController)==null||e.abort(),t.softCloseSocket==null||t.softCloseSocket()}function te(){var e;return!!((e=W)!=null&&e.socket)}function ne(){var e,t=pe("socketLoopIteration"),n=t.nextSocketId++;o("WALogger").LOG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," opening"])),n);var r=function(){t.onConnectionChange("in_handshake")};return t.config.handlers.onSocketLoopIteration==null||t.config.handlers.onSocketLoopIteration(t.socketAbortController),typeof AbortController=="function"&&(t.socketAbortController=new AbortController),t.config.openChatSocket(r,(e=t.socketAbortController)==null?void 0:e.signal).then(function(e){if(e.success){var r=e.value;t.config.handlers.onSocketOpen==null||t.config.handlers.onSocketOpen();var a=new(o("WAResolvable")).Resolvable;return o("WALogger").LOG($||($=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," opened"])),n),t.socketId=n,t.socket=r,t.softCloseSocket=function(){t.softCloseSocket=null,t.socket&&t.config.shouldCloseStaleSocket&&(re(),t.socket=null),a.resolve()},t.socketLoop.resetTimeoutAfter(1e4),t.deadSocketTimer.cancel(),t.maybeScheduleHealthCheck(),r.setOnFrame(function(e){return t.parseAndHandleStanza(n,e)}),r.setOnClose(function(){o("WALogger").LOG(P||(P=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," closed"])),n),t.activePing&&n===t.activePing.socketId&&(t.activePing.handler.resolve(),t.activePing=null),t.filterPending(function(e){return e.attachedToSocketId===n}).forEach(function(e){return void t.removeHandler(e)}),n===t.socketId&&(t.socketId=V,t.socket=null,t.onConnectionChange("disconnected"),t.config.handlers.onDisconnect==null||t.config.handlers.onDisconnect(),a.resolve())}),t.onConnectionChange("connected"),t.config.handlers.onConnect==null||t.config.handlers.onConnect(),t.filterPending(function(e){return!e.attachedToSocketId}).sort(function(e,t){return e.orderedId-t.orderedId}).forEach(function(e){switch(e.type){case"smax":case"iq":t.maybeSendPendingStanza(e);break;case"ack":t.callStanza(e.stanza);break;default:e.type;break}}),a.promise}else{var i=e.error;switch(i){case"max-hunters":o("WALogger").WARN(N||(N=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket closed while in noise handshake using treasureHunt strategy"])));break;case"disconnected":o("WALogger").WARN(M||(M=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket disconnected while in noise handshake"])));break;default:return}}}).catch(function(e){e instanceof o("WAErrors").Disconnected?o("WALogger").LOG(w||(w=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket closed while in noise handshake"]))):o("WALogger").ERROR(A||(A=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration failed ",""])),e).devConsole(e)})}function re(){var e=pe("closeSocket");e.socket&&(o("WALogger").LOG(F||(F=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," closed"])),e.socketId),o("WALogger").LOG(O||(O=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocket called"]))),e.socket.close())}function oe(){pe("onStreamErrorReceived").socketLoop.cancelReset()}function ae(){return pe("waitForConnection").sendPing(),q||(q=new(o("WAResolvable")).Resolvable),q.promise}function ie(e,t){var n=pe("castStanza");n.socket?n.castStanza(e,t):o("WALogger").LOG(B||(B=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket"])))}function le(e){var t=pe("castStanza");return t.socketId===e}function se(e,t,n,a,i){return n===void 0&&(n=0),i===void 0&&(i="iq"),new Promise(function(l){var s=pe("sendIq"),u=e.attrs.id;if(!u||typeof u!="string")throw r("err")("[comms] sendIq given iq without id: "+String(e));var c=s.socketId;if(t&&!c){l(Promise.reject(new(o("WAErrors")).Offline));return}var d=function(t){t===void 0&&(t="disconnect");var e=i==="iq"?s.pendingIqs.get(u):s.pendingSmaxStanzas.get(u);if(!e){l(Promise.reject(r("err")("[comms] _sendIq unexisting stanza to be cancelled: "+u)));return}s.removeHandler(e,t)},m=null;if(n>0){var p=setTimeout(d,n*1e3);m=function(){clearTimeout(p)}}if(a!=null)if(a.aborted){l(Promise.reject(new(o("WAErrors")).Disconnected));return}else{var _=function(){d("abort")};a.addEventListener("abort",_),m=function(){a.removeEventListener("abort",_)}}var f={resolve:l,stanza:e,attachedToSocketId:t?c:V,orderedId:U++,attempt:0,cleanup:m};if(i==="iq"){var g=babelHelpers.extends({type:i},f);s.pendingIqs.set(u,g),s.config.handlers.onSendIq==null||s.config.handlers.onSendIq(e),s.maybeSendPendingStanza(g)}else{var h=babelHelpers.extends({type:i},f);s.pendingSmaxStanzas.set(u,h),s.maybeSendPendingStanza(h)}})}function ue(e,t){var n,r,o,a=(n=t==null?void 0:t.withoutRetry)!=null?n:!1,i=(r=t==null?void 0:t.timeoutSeconds)!=null?r:0,l=(o=t==null?void 0:t.signal)!=null?o:null;return se(e,a,i,l,"smax")}function ce(){var e=pe("sendPing");return e.sendPing()}function de(){return pe("startHandlingRequests").startHandlingRequests()}function me(){W&&W.deadSocketTimer.cancel()}function pe(e){if(W)return W;throw r("err")("[comms] "+e+" called before startComms")}function _e(e){if(e.tag==="iq"){var t=e.attrs.type;if(t==="result"||t==="error")return o("WAWap").decodeAsString(e.attrs.id)||null}return null}function fe(){return U++}function ge(){W=null,q=new(o("WAResolvable")).Resolvable,U=1}l.DEFAULT_SOCKET_ID=V,l.getComms=G,l.startComms=z,l.stopComms=j,l.closeSocketAndPreventRetry=K,l.closeSocketAndPause=Q,l.closeSocketAndResume=X,l.openSocketLoop=Y,l.maybeResetSocketLoop=J,l.forceResetSocketLoop=Z,l.forceAbortSocketConnection=ee,l.isSocketConnected=te,l.socketLoopIteration=ne,l.closeSocket=re,l.onStreamErrorReceived=oe,l.waitForConnection=ae,l.castSmaxStanza=ie,l.isActiveSocket=le,l._sendIq=se,l.sendSmaxStanza=ue,l.sendPing=ce,l.startHandlingRequests=de,l.cancelDeadSocketTimer=me,l.singletonOrThrowIfUninitialized=pe,l.getAndIncrementNextOrderedId=fe,l.resetStateForTests=ge}),98);
__d("WADecimalStringMod",["WALogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n){if(!/^\d+$/.test(t))throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string'])),t),r("err")("decimalStringMod is given an invalid decimal string");var a=t.length;if(a<16||a===16&&t<="9007199254740991")return Number(t)%n;if(a>20||a===20&&t>"18446744073709551615")throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits'])),t),r("err")("decimalStringMod is given value over 64 bits");for(var i=0,l=0;l<t.length;l++){var u=Number(t[l]);i=(i*10+u)%n}return i}l.decimalStringMod=u}),98);
__d("WACreateGetVcaEnabledBucket",["WAArrayBufferUtils","WADecimalStringMod","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return function(){return t==null?null:o("WAArrayBufferUtils").arrayBufferMod(e,t)+100}}function u(t,n){return function(){if(n==null)return null;var r=t.split("/"),a=r[r.length-1],i=a.split("_")[1];return/^\d+$/.test(i)?i==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["mediaRouteSelection: can't get fbId from mediaDirectPath"]))),null):o("WADecimalStringMod").decimalStringMod(i,n)+100:null}}l.createGetVcaEnabledBucket=s,l.msgrCreateGetVcaEnabledBucket=u}),98);
__d("WAExtractNcHotTimestamp",["WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e==null)return null;var t=s(e);if(t.has("_nc_hot")){var n=parseInt(t.get("_nc_hot"),10);return Number.isInteger(n)?o("WATimeUtils").castToUnixTime(n):null}else return null}function s(e){var t=e.split("?");return new URLSearchParams(t.length===2?t[1]:"")}l.extractNcHotTimestamp=e}),98);
__d("WAXmlParsingFailure",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.parser=e,this.reason=t}var t=e.prototype;return t.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason},e})();i.XmlParsingFailure=e}),66);
__d("WAParsableXmlNode",["WAHasProperty","WAXmlParsingFailure","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){throw new TypeError('"'+e+'" is read-only')}var s=(function(){function e(e,t){var n=this;this.$1=e,this.$2=t,this.$3=Array.isArray(t.content)?t.content.map(function(t){return new n.constructor(e,t)}):null}var t=e.prototype;return t.name=function(){return this.$1},t.node=function(){return this.$2},t.hasAttr=function(t){return r("WAHasProperty")(this.$2.attrs,t)},t.assertTag=function(t){this.$2.tag!==t&&this.throw("to be <"+t+">")},t.tag=function(){return this.$2.tag},t.maybeChild=function(t){var e=this.$3;if(!e)return null;for(var n=0;n<e.length;n++)if(e[n].tag()===t)return e[n];return null},t.hasChild=function(t){return!!this.maybeChild(t)},t.child=function(t){var e=this.maybeChild(t);return e||this.throw("to have child <"+t+">")},t.assertAttr=function(t,n){var e=this.attrString(t);e!==n&&this.throw('to have "'+t+'"="'+n+'", but instead has "'+e+'"')},t.attrString=function(t){return r("WAHasProperty")(this.$2.attrs,t)?this.decodeAsString(this.$2.attrs[t]):this.throw('to have attribute "'+t+'"')},t.forEachAttributeKey=function(t){var e=this.$2.attrs;Object.keys(e).forEach(function(e){return t(e)})},t.maybeAttrString=function(t){return this.hasAttr(t)?this.decodeAsString(this.$2.attrs[t]):null},t.maybeAttrInt=function(t,n,r){return this.hasAttr(t)?this.attrInt(t,n,r):null},t.attrEnumValues=function(t,n,r){var e=new Set(n),o=this.attrString(t);if(!e.has(o)){if(r!=null)return r;var a=Array.from(e).join("|");return this.throw('to have "'+t+'"={'+a+'} but has value "'+o+'"')}return o},t.attrEnum=function(t,n){var e=this.attrString(t);if(!r("WAHasProperty")(n,e)){var o=Object.keys(n).join("|");return this.throw('to have "'+t+'"={'+o+'} but has value "'+e+'"')}return n[e]},t.attrEnumOrNullIfUnknown=function(t,n){var e=this.attrString(t);return r("WAHasProperty")(n,e)?n[e]:null},t.attrEnumOrDefault=function(t,n,r){return this.hasAttr(t)?this.attrEnum(t,n):r},t.attrInt=function(t,n,r){var e=this.attrString(t);return this.$4(e,t,n,r)},t.$4=function(t,n,r,o){var e=parseInt(t,10);return Number.isNaN(e)?this.throw('to have "'+n+'"={integer} but has value "'+t+'"'):r!==void 0&&e<r?this.throw('to have "'+n+'"={at least '+r+"} but has value "+e):o!==void 0&&e>=o?this.throw('to have "'+n+'"={below '+o+"} but has value "+e):e},t.forEachChild=function(t){var e=this.$3;if(e)e.forEach(function(e){return t(e)});else if(this.$2.content!=null)return this.throw("to have children")},t.forEachChildWithTag=function(t,n){this.forEachChild(function(e){e.tag()===t&&n(e)})},t.mapChildren=function(t){var e=this.$3;return!e&&this.$2.content!=null?this.throw("to have children"):e?e.map(function(e){return t(e)}):[]},t.mapChildrenWithTag=function(t,n){var e=this.$3;return!e&&this.$2.content!=null?this.throw("to have children"):e?e.filter(function(e){return e.tag()===t}).map(function(e){return n(e)}):[]},t.mapFirstChild=function(t){var e=this.$3;return!e||e.length===0?this.throw("to have children"):t(e[0])},t.hasContent=function(){return!this.$3&&!!this.$2.content},t.hasChildren=function(){return this.$3!=null},t.getChildren=function(){return this.$3},t.mapAttrKeys=function(t){var e=this.getAttrKeys();return e&&e.length?e.map(t):[]},t.getAttrKeys=function(){return Object.keys(this.$2.attrs)},t.hasAttrs=function(){var e=this.$2.attrs?Object.keys(this.$2.attrs):[];return e.length>0},t.getNode=function(){return this.$2},t.unsafeSetChildren=function(t){this.$3=t},t.unsafeSetNodeContent=function(t){this.$2.content=t},t.contentUint=function(t){var e=this.contentBytes(t);return u(e,t)},t.contentBytes=function(t){if(t===void 0&&(t=-1),this.$3)return this.throw("to have binary content, but has children instead");if(this.$2.content!=null){var e=this.$2.content;return t!==-1&&e.length!==t?this.throw("to be "+t+" bytes, but got "+e.length+" instead"):e}else return this.throw("to have content")},t.contentString=function(){return this.$3?this.throw("to have string content, but has children instead"):this.$2.content!=null?this.$2.content:this.throw("to have content")},t.contentInt=function(t,n){var e=this.contentString();return this.$4(e,"content",t,n)},t.contentEnum=function(t){var e=this.contentString();if(!r("WAHasProperty")(t,e)){var n=Object.keys(t).join("|");return this.throw("to have content {"+n+'} but has value "'+e+'"')}return t[e]},t.decodeAsString=function(t){if(typeof t!="string")throw r("err")("decodeAsString: attribute is "+typeof t+" not a string: "+t);return t},t.throw=function(t){throw new(o("WAXmlParsingFailure")).XmlParsingFailure(this.$1,"expected <"+this.$2.tag+"> "+t)},t.toString=function(){return this.$2.toString()},e})();function u(e,t){for(var n=0,r=0;r<t;r++)n=n*256+e[r];return n}l.ParsableXmlNode=s,l.convertBytesToUint=u}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={},b={},v={},S={};s.internalSpec={sessionVersion:[1,(e=o("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,e.TYPES.BYTES],remoteIdentityPublic:[3,e.TYPES.BYTES],rootKey:[4,e.TYPES.BYTES],previousCounter:[5,e.TYPES.UINT32],senderChain:[6,e.TYPES.MESSAGE,d],receiverChains:[7,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],pendingKeyExchange:[8,e.TYPES.MESSAGE,c],pendingPreKey:[9,e.TYPES.MESSAGE,u],remoteRegistrationId:[10,e.TYPES.UINT32],localRegistrationId:[11,e.TYPES.UINT32],needsRefresh:[12,e.TYPES.BOOL],aliceBaseKey:[13,e.TYPES.BYTES]},u.internalSpec={preKeyId:[1,e.TYPES.UINT32],signedPreKeyId:[3,e.TYPES.INT32],baseKey:[2,e.TYPES.BYTES]},c.internalSpec={sequence:[1,e.TYPES.UINT32],localBaseKey:[2,e.TYPES.BYTES],localBaseKeyPrivate:[3,e.TYPES.BYTES],localRatchetKey:[4,e.TYPES.BYTES],localRatchetKeyPrivate:[5,e.TYPES.BYTES],localIdentityKey:[7,e.TYPES.BYTES],localIdentityKeyPrivate:[8,e.TYPES.BYTES]},d.internalSpec={senderRatchetKey:[1,e.TYPES.BYTES],senderRatchetKeyPrivate:[2,e.TYPES.BYTES],chainKey:[3,e.TYPES.MESSAGE,p],messageKeys:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,m]},m.internalSpec={index:[1,e.TYPES.UINT32],cipherKey:[2,e.TYPES.BYTES],macKey:[3,e.TYPES.BYTES],iv:[4,e.TYPES.BYTES]},p.internalSpec={index:[1,e.TYPES.UINT32],key:[2,e.TYPES.BYTES]},_.internalSpec={currentSession:[1,e.TYPES.MESSAGE,s],previousSessions:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,s]},f.internalSpec={id:[1,e.TYPES.UINT32],publicKey:[2,e.TYPES.BYTES],privateKey:[3,e.TYPES.BYTES]},g.internalSpec={id:[1,e.TYPES.UINT32],publicKey:[2,e.TYPES.BYTES],privateKey:[3,e.TYPES.BYTES],signature:[4,e.TYPES.BYTES],timestamp:[5,e.TYPES.FIXED64]},h.internalSpec={publicKey:[1,e.TYPES.BYTES],privateKey:[2,e.TYPES.BYTES]},y.internalSpec={senderKeyId:[1,e.TYPES.UINT32],senderChainKey:[2,e.TYPES.MESSAGE,v],senderSigningKey:[3,e.TYPES.MESSAGE,C],senderMessageKeys:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,b]},C.internalSpec={public:[1,e.TYPES.BYTES],private:[2,e.TYPES.BYTES]},b.internalSpec={iteration:[1,e.TYPES.UINT32],seed:[2,e.TYPES.BYTES]},v.internalSpec={iteration:[1,e.TYPES.UINT32],seed:[2,e.TYPES.BYTES]},S.internalSpec={senderKeyStates:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y]},l.SessionStructureSpec=s,l.SessionStructure$PendingPreKeySpec=u,l.SessionStructure$PendingKeyExchangeSpec=c,l.SessionStructure$ChainSpec=d,l.SessionStructure$Chain$MessageKeySpec=m,l.SessionStructure$Chain$ChainKeySpec=p,l.RecordStructureSpec=_,l.PreKeyRecordStructureSpec=f,l.SignedPreKeyRecordStructureSpec=g,l.IdentityKeyPairStructureSpec=h,l.SenderKeyStateStructureSpec=y,l.SenderKeyStateStructure$SenderSigningKeySpec=C,l.SenderKeyStateStructure$SenderMessageKeySpec=b,l.SenderKeyStateStructure$SenderChainKeySpec=v,l.SenderKeyRecordStructureSpec=S}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAParsableXmlNode","decodeProtobuf","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e={name:"AES-CBC"},s={name:"HMAC",hash:"SHA-256"};function u(e,t){if(e.length!==t)throw r("err")("Signal expected "+t+" bytes, given "+e.length);return e}function c(e,t){return u(new Uint8Array(e),t)}function d(e){var t=e.buffer,n=e.byteOffset,r=e.length;return n===0&&r===t.byteLength?t:t.slice(n,n+r)}function m(e,t){return e.readByteArrayView(t)}function p(e){return new Uint8Array(e)}function _(e,t,n){if(e.length-t<n)throw r("err")("Can not split off "+n+" bytes from index "+t+" of "+e.length+" bytes");return e.slice(t,t+n)}function f(e){var t=e==="extendedRange"?2147483646:16380;return o("WACryptoUtils").randomNumberLessThan(t)+1}function g(e){return b(e)}function h(e){return o("WAParsableXmlNode").convertBytesToUint(e,4)}function y(){var e=2147483647;return o("WACryptoUtils").randomNumberLessThan(e)+1}function C(e){return b(e)}function b(e,t,n){if(t===void 0&&(t=0),n===void 0&&(n=4294967296),typeof e=="number"&&t<=e&&e<n&&Math.floor(e)===e)return e;throw r("err")("Expected integer in range ["+t+", "+n+"), given "+String(e))}function v(e,t){return o("encodeProtobuf").encodeProtobuf(e,t).readByteArrayView()}function S(e,t,n){return n(o("decodeProtobuf").decodeProtobuf(e,t))}function R(e,t,n,r){return o("WACryptoHkdf").extractWithSaltAndExpand(e,t,n,r).then(function(e){return new Uint8Array(e)})}function L(t,n){var r,a;return n==="hmac-sha256"?(r=s,a=["sign"]):(r=e,a=["encrypt","decrypt"]),o("WACryptoDependencies").getCrypto().subtle.importKey("raw",t,r,!1,a)}function E(e){return e}function k(e){return e}function I(e,t){return o("WACryptoUtils").arrayBuffersEqual(e,t)}l.AES_CBC=e,l.HMAC_SHA256=s,l.ensureSize=u,l.toBytes=c,l.toBuffer=d,l.readBytes=m,l.makeBytes=p,l.sliceBytes=_,l.makeRegistrationId=f,l.castRegistrationId=g,l.castRegistrationIdFromBytes=h,l.makeSenderKeyId=y,l.castSenderKeyId=C,l.ensureIntInRange=b,l.encodeSignalProto=v,l.decodeSignalProto=S,l.hkdf=R,l.makeCryptoKey=L,l.castToByteEncoded=E,l.castToSessionHash=k,l.areSessionHashesEqual=I}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WALogger","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=5,u=16777215;function c(e,t){return{publicKey:e,privateKey:t}}function d(e){var t=o("WACryptoPrimitives").keypairFromSecretKey(e),n=t.publicKey,r=t.secretKey;return c(o("WASignalOther").ensureSize(n,32),o("WASignalOther").ensureSize(r,32))}function m(e,t){return{publicKey:o("WASignalOther").toBytes(e,32),privateKey:o("WASignalOther").toBytes(t,32)}}function p(){var e=o("WACryptoPrimitives").keyPair(),t=e.publicKey,n=e.secretKey;return n[0]&=248,n[31]=64|n[31]&63,c(o("WASignalOther").ensureSize(t,32),o("WASignalOther").ensureSize(n,32))}function _(e,t){return c(o("WASignalOther").sliceBytes(t,1,32),e)}function f(e,t){return{serializedPubKey:t,privateKey:e}}function g(){var e=p();return f(e.privateKey,h(e))}function h(e){var t=o("WASignalOther").makeBytes(33);return t[0]=s,t.set(e.publicKey,1),t}function y(e){var t=o("WASignalOther").makeBytes(33);return t[0]=s,t.set(o("WASignalOther").ensureSize(e,32),1),t}function C(e){return f(e.privateKey,h(e))}function b(e,t){var n=(e-1)%u;n<=0&&(n+=u);for(var r=[],a=0;a<t;a++){var i=n===u?1:n+1,l=p(),s=o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:i,publicKey:h(l),privateKey:l.privateKey});r.push({plainObject:{id:i,keyPair:l},record:s}),n=i}return r}function v(t){try{var n=o("decodeProtobuf").decodeProtobuf(o("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,t),r=n.id,a=n.publicKey,i=n.privateKey;return r==null||a==null||i==null?null:{id:S(r),keyPair:_(o("WASignalOther").toBytes(i,32),L(new Uint8Array(a)))}}catch(t){return o("WALogger").DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["deserializePreKey error ",""])),t),null}}function S(e){return o("WASignalOther").ensureIntInRange(e,1,u)}function R(e){return o("WASignalOther").ensureIntInRange(e,0,u)}function L(e){if(e.length===0||e[0]!==s)throw r("err")("Unrecognized public key type");return o("WASignalOther").ensureSize(e,33)}function E(){var e=o("WASignalOther").makeBytes(32);return o("WACryptoDependencies").getCrypto().getRandomValues(e),e}function k(e,t){return o("WACryptoPrimitives").scalarMult(e,t.subarray(1)).buffer}l.KEY_TYPE=s,l.makeKeyPairFrom=d,l.makeKeyPairFromArrayBuffers=m,l.makeKeyPair=p,l.makeKeyPairFromSerialized=_,l.makeSerializedKeyPairFrom=f,l.makeSerializedKeyPair=g,l.serializePubKey=h,l.serializeIdentity=y,l.toSerializedKeyPair=C,l.makePreKeys=b,l.deserializePreKey=v,l.castToPreKeyId=S,l.castToSignedPreKeyId=R,l.castToSerializedPubKey=L,l.makeRawSenderKey=E,l.ecdh=k}),98);
__d("WAParsableWapNode",["WABinary","WAJids","WALogger","WALongInt","WAParsableXmlNode","WASignalKeys","WATimeUtils","WAWap","WAWapJid","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(function(e){function t(t,n){var r;return r=e.call(this,"XmppParsingFailure: "+t+": "+n)||this,r.name="XmppParsingFailure",r.parser=t,r.reason=n,r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.toString=function(){return"XmppParsingFailure: "+this.parser+": "+this.reason},t})(babelHelpers.wrapNativeSuper(Error)),c=(function(t){function n(e,n){return t.call(this,e,n)||this}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.assertFromServer=function(){var e=this.attrString("from");e!==o("WAJids").WA_SERVER_JID_SUFFIX&&this.throw('to have "from"="s.whatsapp.net", but instead has "'+e+'"')},a.attrUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.botJid!=null?n.botJid:n.userJid==null?this.throw('to have "'+t+'"={UserJid}, but instead has "'+e+'"'):n.userJid},a.attrPhoneUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneUser"?n.userJid:this.throw('to have "'+t+'"={PhoneUserJid}, but instead has "'+e+'"')},a.attrLidUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="lidUser"?n.userJid:this.throw('to have "'+t+'"={LidUserJid}, but instead has "'+e+'"')},a.maybeAttrUserJid=function(t){return this.hasAttr(t)?this.attrUserJid(t):null},a.maybeAttrPhoneUserJid=function(t){return this.hasAttr(t)?this.attrPhoneUserJid(t):null},a.maybeAttrLidUserJid=function(t){return this.hasAttr(t)?this.attrLidUserJid(t):null},a.attrGroupJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.groupJid==null?this.throw('to have "'+t+'"={GroupJid}, but instead has "'+e+'"'):n.groupJid},a.maybeAttrGroupJid=function(t){return this.hasAttr(t)?this.attrGroupJid(t):null},a.attrChatJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.userJid!=null?n.userJid:n.groupJid!=null?n.groupJid:n.botJid!=null?n.botJid:this.throw('to have "'+t+'"={ChatJid}, but instead has "'+e+'"')},a.attrPhoneChatJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneUser"?n.userJid:n.jidType==="group"?n.groupJid:this.throw('to have "'+t+'"={ChatJid}, but instead has "'+e+'"')},a.attrDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.deviceJid!=null?n.deviceJid:n.userJid!=null?o("WAJids").defaultDeviceJidForUser(n.userJid):n.hostedDeviceJid!=null?n.hostedDeviceJid:n.hostedLidDeviceJid!=null?n.hostedLidDeviceJid:n.botJid!=null?n.botJid:this.throw('to have "'+t+'"={DeviceJid}, but instead has "'+e+'"')},a.attrPhoneDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneDevice"?n.deviceJid:n.jidType==="phoneUser"?o("WAJids").defaultPhoneDeviceJidForUser(n.userJid):this.throw('to have "'+t+'"={PhoneDeviceJid}, but instead has "'+e+'"')},a.attrLidDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="lidDevice"?n.deviceJid:n.jidType==="lidUser"?o("WAJids").defaultLidDeviceJidForLidUserJid(n.userJid):this.throw('to have "'+t+'"={LidDeviceJid}, but instead has "'+e+'"')},a.attrDeviceId=function(t){var e=this.attrInt(t);return o("WAJids").interpretAsDeviceId(e)},a.attrFromJidChat=function(){var t=this.attrJidWithType();switch(t.jidType){case"msgrUser":{var n=t.userJid,a=o("WAJids").defaultDeviceJidForUser(n);return{type:"device",chat:n,deviceJid:a,author:a}}case"interopUser":{var i=t.userJid,l=o("WAJids").defaultDeviceJidForUser(i);return{type:"device",chat:i,deviceJid:l,author:l}}case"phoneUser":{var s=t.userJid,u=o("WAJids").defaultDeviceJidForUser(s);return{type:"device",chat:s,deviceJid:u,author:u}}case"lidUser":{var c=t.userJid,d=o("WAJids").defaultLidDeviceJidForLidUserJid(c);return{type:"device",chat:c,deviceJid:d,author:d}}case"phoneDevice":{var m=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(m),deviceJid:m,author:m}}case"msgrDevice":{var p=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(p),deviceJid:p,author:p}}case"interopDevice":{var _=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(_),deviceJid:_,author:_}}case"lidDevice":{var f=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(f),deviceJid:f,author:f}}case"group":{var g=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return g==null?this.throw("expected to have participant JID for group"):{type:"group",chat:t.groupJid,groupJid:t.groupJid,author:g}}case"broadcast":{var h=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return h==null?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:t.broadcastJid,chat:o("WAJids").extractUserJid(h),author:h}}case"hosted":{var y=t.hostedDeviceJid;return{type:"device",chat:o("WAJids").extractUserJid(y),deviceJid:y,author:y}}case"hostedLid":{var C=t.hostedLidDeviceJid;return{type:"device",chat:o("WAJids").extractUserJid(C),deviceJid:C,author:C}}case"call":throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""])),t.callJid),r("err")("ParsableWapNode: attrFromJid() does not support CallJid");default:return t.jidType,this.throw("attrFromJidChat should not be used with jid of type "+t.jidType)}},a.attrFromJidPhoneChat=function(){var e=this.attrJidWithType();switch(e.jidType){case"phoneUser":{var t=e.userJid,n=o("WAJids").defaultPhoneDeviceJidForUser(t);return{type:"device",chat:t,deviceJid:n,author:n}}case"phoneDevice":{var a=e.deviceJid;return{type:"device",chat:o("WAJids").extractPhoneUserJid(a),deviceJid:a,author:a}}case"group":{var i=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return i==null?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:i}}case"broadcast":{var l=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return l==null?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:o("WAJids").extractPhoneUserJid(l),author:l}}case"call":throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""])),e.callJid),r("err")("ParsableWapNode: attrFromJid() does not support CallJid");default:return e.jidType,this.throw("attrFromJidChat should not be used with jid of type "+e.jidType)}},a.attrFromPhoneJid=function(){var e=this.attrJidWithType();if(e.jidType==="status"){var t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return t==null?this.throw("to have participant for status msg"):{type:"status",author:t}}else return this.attrFromJidPhoneChat()},a.attrFromJid=function(){var e=this.attrJidWithType();if(e.jidType==="status"){var t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return t==null?this.throw("to have participant for status msg"):{type:"status",author:t}}return e.jidType==="newsletter"?{type:"newsletter",newsletterJid:e.newsletterJid}:e.jidType==="hosted"?{type:"hosted",hostedDeviceJid:e.hostedDeviceJid}:e.jidType==="hostedLid"?{type:"hostedLid",hostedLidDeviceJid:e.hostedLidDeviceJid}:this.attrFromJidChat()},a.attrJidWithType=function(t){t===void 0&&(t="from");var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="unknown"?this.throw('to have "'+t+'"={Jid}, but instead has "'+e+'"'):n},a.attrWapJid=function(t){t===void 0&&(t="from");var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="unknown"?o("WAWapJid").WapJid.create(null,e):o("WAWap").JID(o("WAJids").extractFromJid(n))},a.attrLongInt=function(t){var e=this.attrString(t);return o("WALongInt").decimalStringToLongInt(e)},a.attrTime=function(t){return o("WATimeUtils").castToUnixTime(this.attrInt(t))},a.attrFutureTime=function(t){var e=this.attrInt(t);return o("WATimeUtils").futureUnixTime(e)},a.contentString=function(){if(this.hasChildren())return this.throw("to have string content, but has children instead");if(this.hasContent()){var e=new(o("WABinary")).Binary(this.contentBytes());return e.readString(e.size())}else return this.throw("to have content")},a.decodeAsString=function(t){return o("WAWap").decodeAsString(t)},a.contentSerializedPubKey=function(){return this.hasContent()?o("WASignalKeys").serializeIdentity(this.contentBytes()):this.throw("to have content")},a.createParseError=function(t){return new u(this.name(),"expected <"+this.tag()+"> "+t)},a.throw=function(t){throw this.createParseError(t)},n})(o("WAParsableXmlNode").ParsableXmlNode);l.XmppParsingFailure=u,l.ParsableWapNode=c}),98);
__d("WADeprecatedWapParser",["WAParsableWapNode","err"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.parse=function(t){var e=new(o("WAParsableWapNode")).ParsableWapNode(this.$1,t);try{return{success:this.$2(e)}}catch(e){if(e instanceof o("WAParsableWapNode").XmppParsingFailure)return{error:e};throw e}},t.parseOrThrow=function(t){var e=this.parse(t);if(e.error)throw r("err")(String(e.error));return e.success},e})();l.default=e}),98);
__d("WAAckParser",["WADeprecatedWapParser","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("WADeprecatedWapParser"))("ack",function(e){return e.assertTag("ack"),{id:e.attrString("id"),ts:e.maybeAttrString("t"),class:e.attrString("class"),type:e.maybeAttrString("type"),from:e.attrJidWithType(),participant:e.hasAttr("participant")?e.attrDeviceJid("participant"):null,recipient:e.hasAttr("recipient")?e.attrUserJid("recipient"):null}});function s(e,t){return e.id===t.id&&(t.class===void 0||e.class===t.class)&&(t.type===void 0||e.type===t.type)&&(t.from===void 0||u(e.from,t.from))&&(t.participant===void 0||e.participant===t.participant)&&(t.recipient===void 0||e.recipient===t.recipient)&&(t.ts===void 0||e.ts===t.ts)}function u(e,t){if(o("WAJids").extractFromJid(e)===t)return!0;if(e.userJid!=null)return o("WAJids").defaultDeviceJidForUser(e.userJid)===t;if(e.deviceJid!=null){var n=e.deviceJid;return o("WAJids").extractDeviceId(n)===0&&o("WAJids").extractUserJid(n)===t}return!1}l.AckParser=e,l.ackMatchesTemplate=s,l.fromJidsAreEqual=u}),98);
__d("WAParseIqResponse",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r=e.content;if(r&&Array.isArray(r)&&r[0]){var a=r[0];if(a.tag==="error"){var i=a.attrs||{},l;n&&(typeof n=="function"?l=n(e):l=n.parseOrThrow(a));var u=l;return{success:!1,errorCode:parseInt(i.code,10),errorText:o("WAWap").decodeAsString(i.text)||"",errorType:o("WAWap").decodeAsString(i.type)||"",errorBackoff:parseInt(i.backoff,10),toString:s,customError:u}}}return typeof t=="function"?{success:!0,result:t(e)}:{success:!0,result:t.parseOrThrow(e)}}function s(){return"IqError "+this.errorCode+": "+this.errorText}l.parseIqResponse=e}),98);
__d("WADeprecatedSendIq",["Promise","WAAckParser","WAArrayUtils","WAComms","WALogger","WAParseIqResponse"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t){return o("WAComms")._sendIq(e,!1).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function c(e,t,n){return o("WAComms")._sendIq(e,!1).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t,n)})}function d(e,t,n){return o("WAComms")._sendIq(e,!1,n).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function m(e,t){return o("WAComms")._sendIq(e,!0).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function p(e,t){return _(e,t).then(function(){})}function _(t,r){return new(s||(s=n("Promise")))(function(a){var i=o("WAComms").singletonOrThrowIfUninitialized("deprecatedSendStanzaAndReturnAck"),l=function(t){var e=o("WAAckParser").AckParser.parse(t);return!e.error&&o("WAAckParser").ackMatchesTemplate(e.success,r)?t:null},u={type:"ack",parseAndTest:l,resolve:a,stanza:t,attachedToSocketId:o("WAComms").DEFAULT_SOCKET_ID,orderedId:o("WAComms").getAndIncrementNextOrderedId()};if(i.ackHandlers.push(u),!i.socket){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will send stanza when socket opens"])));return}i.callStanza(t).catch(function(e){var t=i.ackHandlers.indexOf(u);t!==-1&&(o("WAArrayUtils").removeIndexWithoutPreservingOrder(i.ackHandlers,t),u.resolve((s||(s=n("Promise"))).reject(e)))})})}function f(e,t){o("WAComms").castSmaxStanza(e,t)}l.deprecatedSendIq=u,l.deprecatedSendIqErrorParser=c,l.deprecatedSendIqIfConnectedWithin=d,l.deprecatedSendIqWithoutRetry=m,l.deprecatedSendStanzaAndWaitForAck=p,l.deprecatedSendStanzaAndReturnAck=_,l.deprecatedCastStanza=f}),98);
__d("WAMediaConnParser",["WADeprecatedWapParser","WAServerMediaType"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("WADeprecatedWapParser"))("mediaConnParser",function(e){var t,n,r=e.child("media_conn"),o=c(r);return{hosts:o,authToken:r.attrString("auth"),authTokenExpiryTs:r.attrFutureTime("auth_ttl"),routesExpiryTs:r.attrFutureTime("ttl"),maxBuckets:r.attrInt("max_buckets"),maxManualRetry:(t=r.maybeAttrInt("max_manual_retry",0,4))!=null?t:3,maxAutoDownloadRetry:(n=r.maybeAttrInt("max_auto_download_retry",0,4))!=null?n:3}});function s(e){var t,n;if(e.hasAttr("fallback_hostname"))return{domain:e.attrString("fallback_hostname"),class:e.maybeAttrString("fallback_class"),ip4:(t=e.maybeAttrString("fallback_ip4"))!=null?t:void 0,ip6:(n=e.maybeAttrString("fallback_ip6"))!=null?n:void 0}}function u(e){var t,n,r,o;return{domain:e.attrString("hostname"),fallback:s(e),uploadable:d(e,"upload"),downloadable:d(e,"download"),isFallback:e.maybeAttrString("type")==="fallback",downloadBuckets:(t=(n=e.maybeChild("download_buckets"))==null?void 0:n.mapChildren(function(e){return parseInt(e.tag(),10)}))!=null?t:[],class:e.maybeAttrString("class"),ip4:(r=e.maybeAttrString("ip4"))!=null?r:void 0,ip6:(o=e.maybeAttrString("ip6"))!=null?o:void 0}}function c(e){return e.mapChildrenWithTag("host",u)}function d(e,t){return e.hasChild(t)?e.child(t).mapChildren(function(e){var t=e.tag();return o("WAServerMediaType").castToServerMediaType(t)}).filter(Boolean):o("WAServerMediaType").SERVER_MEDIA}l.mediaConnParser=e}),98);
__d("WAGatherMediaInfo",["WADeprecatedSendIq","WAErrors","WALogger","WAMediaConnParser","WAPromiseManagement","WAPromiseRetryLoop","WAResultOrError","WAWap"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=507,p=o("WAPromiseManagement").cacheWhilePending(function(){return"gatherMediaInfo"},_);function _(){var e=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({name:"gatherMediaInfo",timer:{jitter:.25,max:987e3,algo:{type:"fibonacci",first:6e3,second:12e3},relativeDelay:!0},code:g});return e.start(),e.promise()}var f=60;function g(t){var n,r=(n=o("WAWap")).wap("iq",{id:n.generateId(),to:n.S_WHATSAPP_NET,type:"set",xmlns:"w:m"},n.wap("media_conn",null));return o("WADeprecatedSendIq").deprecatedSendIqIfConnectedWithin(r,o("WAMediaConnParser").mediaConnParser,f).then(function(n){if(n.success)o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," hosts"])),n.result.hosts.length),t(o("WAResultOrError").makeResult(n.result));else if(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo failure ",""])),n),n.errorCode===m){var r=n.errorBackoff;o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," seconds backoff"])),r),t(o("WAResultOrError").makeError({type:"backoff",backoffMs:r*1e3}))}else n.errorCode<500&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got client error: ",""])),n.errorCode),t(o("WAResultOrError").makeError({type:"client-error",code:n.errorCode,text:n.errorText})))}).catch(function(e){e instanceof o("WAErrors").Disconnected?t(o("WAResultOrError").makeError("disconnected")):o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo error ",""])),e)})}l.gatherMediaInfo=p}),98);
__d("WAMediaRouteSelection",["WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=null,n=null,r=null,a=e.hosts,i=e.operation,l=e.mediaType;if(e.operation==="download"){var s,u=e.catHotTimespan,c=e.ncHot,d=e.getVcaEnabledBucket,m=new Map;a.forEach(function(e){e.downloadBuckets.forEach(function(t){m.set(t,e)})});var p=m.get(0);u>0&&c!=null&&o("WATimeUtils").happenedWithin(o("WATimeUtils").castToUnixTime(c),u)?t=1:d&&(t=d());var _=null;t!=null&&(_=m.get(t)),(s=_)!=null&&s.downloadable.includes(l)?n=_:p!=null&&p.downloadable.includes(l)&&(n=p)}for(var f=0;f<a.length;f++){var g=a[f];if((i==="upload"&&g.uploadable.includes(l)||i==="download"&&g.downloadable.includes(l))&&(n==null?n=g:g.isFallback&&r==null&&(r=g)),n!=null&&r!=null)break}return{selectedHost:n,fallbackHost:r,bucket:t}}l.mediaRouteSelection=e}),98);
__d("WAGetMediaRoute",["$InternalEnum","WACreateGetVcaEnabledBucket","WAExtractNcHotTimestamp","WAGatherMediaInfo","WAMediaRouteSelection","WAPromiseManagement","WAResultOrError","WATagsLogger","WATimeUtils","WAWaitForComms","WAWorkerGlobalScope"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f=o("WATagsLogger").TAGS(["GetMediaRoute"]),g=86400,h=n("$InternalEnum")({Fresh:"fresh",Cached:"cached",Stale:"stale"}),y=null,C=!1,b=null;async function v(t,n){n==null||n.addPoint("get_cached_or_fresh_media_access_start");var r=await E();if(n==null||n.addPoint("get_cached_or_fresh_media_access_end"),!r.success)return f.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to get mediaAccess: ",""])),r.error),n==null||n.addPoint("get_media_access_failed",{string:{mediaAccessStatus:r.error}}),r;n==null||n.addAnnotations({string:{mediaAccessStatus:r.value.state}});var a=r.value.mediaAccess,i=a.authToken,l=a.hosts,u=a.maxBuckets,c=t.operation==="upload"?o("WAMediaRouteSelection").mediaRouteSelection({operation:"upload",mediaType:t.serverMediaType,hosts:l}):o("WAMediaRouteSelection").mediaRouteSelection({operation:"download",mediaType:t.serverMediaType,hosts:l,catHotTimespan:g,ncHot:o("WAExtractNcHotTimestamp").extractNcHotTimestamp(t.directPath),getVcaEnabledBucket:o("WACreateGetVcaEnabledBucket").msgrCreateGetVcaEnabledBucket(t.directPath,u)}),d=c.selectedHost,m=c.fallbackHost,p=c.bucket;return d==null?(f.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error: no media host"]))),o("WAResultOrError").makeError("no-host")):o("WAResultOrError").makeResult({authToken:i,selectedHost:d,fallbackHost:m,bucket:p})}function S(){var e=b;e!=null&&(o("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(e),b=null)}function R(e){S();var t=Math.max(e.authTokenExpiryTs-o("WATimeUtils").unixTime(),0);if(!(t<=300)){var n=o("WATimeUtils").pastUnixTime(300,e.authTokenExpiryTs),r=o("WATimeUtils").pastUnixTime(Math.floor(t*.2),e.authTokenExpiryTs),a=n<r?n:r,i=o("WATimeUtils").cappedMillisecondsUntil(a),l=Math.floor(Math.random()*o("WATimeUtils").MINUTE_MILLISECONDS),s=o("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){f.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["AuthTTL approaching expiry, refreshing MediaAccess routes"]))),L().catch(function(e){f.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Error occurred during authTTL automatic refresh: ",""])),e)})},i+l);b=s}}var L=o("WAPromiseManagement").cacheWhilePending(function(){return"all"},async function(){if(C)return f.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, but we are still locked by backoff"]))),o("WAResultOrError").makeError("backoff");await o("WAWaitForComms").waitForComms(),f.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, gather a new one"]))),S();var e=await o("WAGatherMediaInfo").gatherMediaInfo();if(e.success)return y=e.value,R(e.value),o("WAResultOrError").makeResult({mediaAccess:e.value,state:h.Fresh});var t=e.error,n=t==="disconnected"?"disconnected":t.type;return f.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Can not get mediaAccess: ",""])),n),t==="disconnected"||t.type==="client-error"?o("WAResultOrError").makeError("disconnected"):(t.type,C=!0,o("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){C=!1,L().catch(function(e){f.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Error occurred on gather after backoff expiry: ",""])),e)})},t.backoffMs),o("WAResultOrError").makeError("backoff"))}),E=function(){var e=y;if(e==null)return L();if(o("WATimeUtils").isInFuture(e.routesExpiryTs))return Promise.resolve(o("WAResultOrError").makeResult({mediaAccess:e,state:h.Cached}));var t=L();return o("WATimeUtils").isInFuture(e.authTokenExpiryTs)?Promise.resolve(o("WAResultOrError").makeResult({mediaAccess:e,state:h.Stale})):t};function k(){y=null,C=!1,S()}l.getMediaRoute=v,l.getCachedOrFreshMediaAccess=E,l.clearCachedMediaAccessForTest=k}),98);
__d("WAMediaOperationsRetrier",["WALogger","WAPromiseBackoffs"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=4,c={algo:{type:"constant",delay:1e3},jitter:0},d=(function(){function t(e,t,n){this.$1=e,this.routesInfo=t,this.$2=o("WAPromiseBackoffs").createPromiseTimer(c),this.$3=0,this.$4=!1,this.$5=n}var n=t.prototype;return n.run=async function(n,r){for(;this.$3<u;){o("WALogger").DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Running retrier"]))),await this.$2();var t=void 0;if(this.$3>0){var a;t=this.$3>=u-2&&!this.$4,o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["MediaOperationsRetrier:"," wait for internet, attempt = ",""])),this.$1,this.$3),await((a=this.$5)==null?void 0:a.call(this))}else t=!1;var i=this.routesInfo;if(!i)return null;var l=i.host;t&&i.fallbackHost&&(l=i.fallbackHost);var c=await n(l,i.authToken,this.$3,r);if(c.success)return c.value;++this.$3,this.$4=c.error.progressMade}return null},t})();l.MAX_ATTEMPTS=u,l.BACKOFF_OPTIONS=c,l.MediaOperationsRetrier=d}),98);
__d("WACreateMediaDownloadRetrier",["WAComms","WAGetMediaRoute","WAMediaOperationsRetrier","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.directPath,n=e.eventFlow,r=e.fileEncSha256,a=e.mediaTypeDetails,i=a.type==="regular"?a.mediaType:"preview";n==null||n.addPoint("get_media_route_start");var l=await o("WAGetMediaRoute").getMediaRoute({operation:"download",serverMediaType:i,fileEncSha256:r,directPath:t},n);if(!l.success)return n==null||n.addPoint("get_media_route_fail"),l;n==null||n.addPoint("get_media_route_end");var s=l.value,u=s.selectedHost,c=s.fallbackHost,d=s.authToken,m=new(o("WAMediaOperationsRetrier")).MediaOperationsRetrier("download",{host:{domain:u.domain,class:u.class},fallbackHost:c&&{domain:c.domain,class:c.class},authToken:d,timeElapsed:null},o("WAComms").waitForConnection);return o("WAResultOrError").makeResult({retrier:m,mediaRouteDetails:l.value})}l.createMediaDownloadRetrier=e}),98);
__d("WAHttpDownloadMedia",["WAErrorMessage","WALogger","WAMediaQplHelper","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d="URL signature expired";async function m(t,n){var r=n!=null?n:{},a=r.mediaMetrics,i=r.abortSignal;a==null||a.addPoint("http_fetch_start");var l=await self.fetch(t,{method:"GET",mode:"cors",cache:"no-store",signal:i}).then(function(e){return a==null||a.addPoint("http_fetch_end"),o("WAResultOrError").makeResult(e)}).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return a==null||a.addPoint("http_fetch_fail",{string:{httpFetchError:n}}),o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to initiate fetch: ",", message: ",""])),t,n),t.name==="AbortError"?o("WAResultOrError").makeError("http-fetch-aborted"):o("WAResultOrError").makeError("http-fetch-exception")});if(l.success===!1)return l;var m=l.value,p=m.headers.get("content-length"),_=m.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""])),_),a==null||a.addAnnotations({string:{ciphertextMediaSizeBucket:p!=null?o("WAMediaQplHelper").convertIntegerSizeToStringBucket(Number(p)):null},int:{httpStatus:_}}),_){case 200:case 206:return o("WAResultOrError").makeResult(m);case 401:return o("WAResultOrError").makeError("access-expired");case 403:return m.text().then(function(e){return e===d?o("WAResultOrError").makeError("signature-expired"):o("WAResultOrError").makeError("access-expired")}).catch(function(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body: ",""])),e),o("WAResultOrError").makeError("access-expired")});case 404:case 410:return o("WAResultOrError").makeError("media-not-found");case 408:return o("WAResultOrError").makeError("server-timeout");case 416:return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: can not resume from offset"]))),o("WAResultOrError").makeError("request-error");case 429:case 507:return o("WAResultOrError").makeError("download-throttled");default:return _>=400&&_<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}l.httpDownloadMedia=m}),98);
__d("WAHttpUtils",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){if(!/^https:\/\/[-\w.]+\.\w+$/.test(e))throw r("err")('buildUrl given invalid host "'+e+'"');if(!t.startsWith("/"))throw r("err")('buildUrl given invalid path "'+t+'"');var o=n,a=""+e+t;if(!o)return a;var i=Object.keys(o).map(function(e){var t=o[e];t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n=t instanceof Uint8Array?Array.from(t).map(function(e){return"%"+e.toString(16)}).join(""):encodeURIComponent(t.toString());return encodeURIComponent(e)+"="+n});if(i.length>0){var l=i.join("&");return a.includes("?")?a+"&"+l:a+"?"+l}else return a}l.buildUrl=e}),98);
__d("WAMediaUrl",["WABase64","WAGlobals","WAHttpUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=1;function s(t,n,r,a,i,l,s){var u=o("WAGlobals").getDependencies().mediaUploadRoot(),c=o("WABase64").encodeB64UrlSafe(r),d=o("WABase64").encodeB64UrlSafe(n),m={auth:i,token:d};return l&&(m.resume=e),s!=null&&s>0&&(m.bytestart=s),o("WAHttpUtils").buildUrl("https://"+a,u+"/"+t+"/"+c,m)}function u(e,t,n,r,a,i,l){var s=o("WABase64").encodeB64UrlSafe(t),u={hash:s,mode:r};return a!=null&&(u._nc_cat=a),i!=null&&i>=0&&(u.bytestart=i),l!=null&&l>0&&(u.byteend=l),o("WAHttpUtils").buildUrl("https://"+n,e,u)}l.RESUME_PARAM=e,l.buildUploadUrl=s,l.buildDownloadUrl=u}),98);
__d("WADownloadCiphertext",["WAAssertUnreachable","WABase64","WACreateMediaDownloadRetrier","WACryptoSha256","WACryptoUtils","WAHashUtils","WAHttpDownloadMedia","WALogger","WAMediaUrl","WAPromiseManagement","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p;async function _(t){var n=t.abortSignal,a=t.mediaTypeDetails,i=t.fileEncSha256,l=t.directPath,_=t.plaintextHash,f=t.eventFlow,h=t.fromBytes,y=t.toBytes;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Start download ciphertext for hash: ",""])),o("WAHashUtils").sanitisePlaintextHash(_)),f.addPoint("create_retrier_start");var C=await o("WACreateMediaDownloadRetrier").createMediaDownloadRetrier({mediaTypeDetails:a,directPath:l,eventFlow:f,fileEncSha256:i});if(!C.success)return f.addPoint("create_retrier_fail"),C;f.addPoint("create_retrier_end");var b=C.value,v=b.retrier,S=b.mediaRouteDetails,R=await v.run(function(e,t,r){var a=e.domain,m="http_download_media_"+r,p=o("WAMediaUrl").buildDownloadUrl(l,i,a,"manual",S.bucket,h,y);return o("WALogger").DEV_XMPP(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Downloading ciphertext for hash : "," from ",". Attempt: ",""])),o("WAHashUtils").sanitisePlaintextHash(_),p,r),f.addPoint(m+"_start"),o("WAHttpDownloadMedia").httpDownloadMedia(p,{mediaMetrics:f,abortSignal:n,cachePolicy:r>0?"no-store":"force-cache"}).then(function(e){if(e.success)return e.value.arrayBuffer().then(function(e){return f.addPoint(m+"_end"),o("WAResultOrError").makeResult(o("WAResultOrError").makeResult(e))}).catch(function(e){return f.addPoint("response_array_buffer_error"),f.addPoint(m+"_fail"),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body ",""])),e),o("WAResultOrError").makeResult(o("WAResultOrError").makeError("body-network-error"))});f.addPoint(m+"_fail");var t=e.error;switch(o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: ",""])),t),f.addPoint(t),t){case"signature-expired":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("signature-expired"));case"http-fetch-aborted":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("http-fetch-aborted"));case"http-fetch-exception":case"server-timeout":case"unspecified-http-error":return o("WAResultOrError").makeError({progressMade:!0});default:return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(t))}}).catch(function(e){return f.addPoint(m+"_fail"),o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["downloadCiphertext http download exception: ",""])),e),o("WAResultOrError").makeError({progressMade:!1})})});if(R==null)return o("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded");if(R.success===!1){var L=R.error;switch(o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext failed: ",""])),L),L){case"signature-expired":case"http-fetch-aborted":case"media-not-found":case"download-throttled":case"body-network-error":case"request-error":return o("WAResultOrError").makeError(L);case"access-expired":return o("WAResultOrError").makeError("disconnected");default:throw r("WAAssertUnreachable")(L)}}else{var E=R.value;return!g(h,y)&&!o("WACryptoUtils").arrayBuffersEqual(await o("WACryptoSha256").sha256(E),i)?o("WAResultOrError").makeError("ciphertext-hash-mismatch"):(f.addPoint("download_finish",{int:{byteLength:E.byteLength},bool:{isPartialDownload:g(h,y)}}),o("WAResultOrError").makeResult(E))}}var f=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.fileEncSha256,n=e.fromBytes,r=e.toBytes;return o("WABase64").encodeB64UrlSafe(t)+"-"+(n!=null?n:"X")+"-"+(r!=null?r:"X")},_);function g(e,t){return e!=null&&e>0?!0:t!=null}l.cachedDownloadCiphertext=f}),98);
__d("WADownloadAndDecryptMedia",["WADecryptMedia","WADownloadCiphertext","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.abortSignal,n=e.mediaTypeDetails,r=e.fileEncSha256,a=e.directPath,i=e.mediaKey,l=e.plaintextHash,s=e.eventFlow,u=await o("WADownloadCiphertext").cachedDownloadCiphertext({abortSignal:t,mediaTypeDetails:n,fileEncSha256:r,directPath:a,eventFlow:s,plaintextHash:l});if(u.success!==!0)return u;var c=await o("WADecryptMedia").decryptMedia({mediaKey:i,mediaTypeDetails:n,plaintextHash:l,ciphertextHmac:u.value});return c.success!==!0?c:(c.value.alternativeHmacSaltUsed!=null&&s.addAnnotations({string:{alternativeHmacSaltUsed:c.value.alternativeHmacSaltUsed}}),o("WAResultOrError").makeResult(c.value.plaintext))}l.downloadAndDecryptMedia=e}),98);
__d("WACreateMediaDecrypterStream",["WABinary","WAMediaCrypto","WAResultOrError","WATagsLogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["WADecryptStream"]);function f(t,n,r,a,i){if(a.byteLength===0)return _.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["expectedHmacs must have at least one element"]))),o("WAResultOrError").makeError("missing-expected-hmacs");if(a.byteLength!==i.length*o("WAMediaCrypto").HMAC_LENGTH)return _.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["expectedHmacs and ciphertextLengths must have the same length"]))),o("WAResultOrError").makeError("hmac-chiphertext-array-mismatch");var l=g(a),m=n,p=new(o("WABinary")).Binary,f=0,y=async function(n,a){for(p.writeByteArray(n);f<l.length&&p.size()>=i[f];f++){var e=p.readByteArrayView(i[f]);_.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Processing scan "," of size ",""])),f,e.length);var s=f===i.length-1;try{var d=await o("WAMediaCrypto").hmacAndDecryptPartial(t,m,e,r,l[f]),g=d.plaintext,y=d.nextIv;s?a.enqueue(h(g)):a.enqueue(g),m=y}catch(e){_.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt chunk. isLastChunk: "," error: ",""])),s,e),e instanceof o("WAMediaCrypto").HmacValidationError?a.error("enc-hash-mismatch"):a.error("decryption-error")}}},C=new TransformStream({transform:function(t,n){var e=t;return y(e,n)},flush:function(t){p.size()>0&&_.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Unexpected ciphertext in buffer following flush"])))}});return o("WAResultOrError").makeResult(C)}function g(e){var t=[];if(e.byteLength%o("WAMediaCrypto").HMAC_LENGTH!==0)throw r("err")("Sidecar length is not a multiple of hmac length");for(var n=0;n<e.byteLength;n+=o("WAMediaCrypto").HMAC_LENGTH){var a=new Uint8Array(e,n,o("WAMediaCrypto").HMAC_LENGTH);t.push(a)}return t}function h(e){if(e.length<o("WAMediaCrypto").CBC_BLOCK_SIZE)return _.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Plaintext size is less than CBC_BLOCK_SIZE"]))),e;var t=e[e.length-1];return t===0||t>o("WAMediaCrypto").CBC_BLOCK_SIZE?(_.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Invalid PKCS padding length"]))),e):e.subarray(0,-t)}l.createDefaultDecryptStream=f}),98);
__d("WAMediaProgressiveJpegTransformStream",["WABinary"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.scanLengths,n=[],r=0;for(var a of t)r+=a,n.push(r);var i=new(o("WABinary")).Binary,l=0,s=0,u=new TransformStream({transform:function(r,o){var e=r;for(s+=e.byteLength,i.writeByteArray(e);l<t.length&&n[l]<s;l++){var a=i.readByteArrayView(t[l]);o.enqueue(a)}},flush:function(t){t.enqueue(i.readByteArrayView())}});return u}l.makeProgressiveJpegHandlerTransformStream=e}),98);
__d("WADownloadProgressiveJpegPlaintextStreamerWithoutRetry",["WACreateMediaDecrypterStream","WAHttpDownloadMedia","WAMediaCrypto","WAMediaProgressiveJpegTransformStream","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["WADownloadProgressiveJpegPlaintextStreamer"]);function c(e){return e}async function d(t){var n=t.abortSignal,r=t.serverMediaType,a=t.downloadUrl,i=t.eventFlow,l=t.progressiveJpegDetails,c=t.mediaKey,d=t.cachePolicy,m=await o("WAHttpDownloadMedia").httpDownloadMedia(a,{mediaMetrics:i,abortSignal:n,cachePolicy:d});if(m.success!==!0)return m;var p=m.value.body;if(p==null)return o("WAResultOrError").makeError("body-network-error");var _=m.value.headers.get("Content-Length");if(_==null)return u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Content-Length header is missing"]))),o("WAResultOrError").makeError("missing-content-length-header");var f=Number(_);if(Number.isNaN(f))return u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Content-Length header is not a number"]))),o("WAResultOrError").makeError("invalid-content-length-header");var g=o("WAProgressiveJpegGetPJpegDetails").getExtendedProgressiveJpegDetails({progressiveJpegDetails:l,ciphertextLength:f}),h=await o("WAMediaCrypto").computeMediaKeys(c,r),y=o("WACreateMediaDecrypterStream").createDefaultDecryptStream(h.cipherKey,h.iv,h.hmacKey,g.sidecar,g.alignedScanLengths);if(y.success!==!0)return y;var C=y.value,b=o("WAMediaProgressiveJpegTransformStream").makeProgressiveJpegHandlerTransformStream(g),v=p.pipeThrough(C).pipeThrough(b);return o("WAResultOrError").makeResult(v)}l.unsafeCastToDownloadAndDecryptPJpegStream=c,l.downloadProgressiveJpegPlaintextUsingStreamsWithoutRetry=d}),98);
__d("WADownloadProgressiveJpegPlaintextStreamer",["WAAssertUnreachable","WACreateMediaDownloadRetrier","WADownloadProgressiveJpegPlaintextStreamerWithoutRetry","WAMediaUrl","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WATagsLogger").TAGS(["WADownloadProgressiveJpegPlaintextStreamer"]);async function u(t){var n=t.abortSignal,a=t.serverMediaType,i=t.fileEncSha256,l=t.directPath,u=t.eventFlow,c=t.progressiveJpegDetails,d=t.mediaKey,m=await o("WACreateMediaDownloadRetrier").createMediaDownloadRetrier({directPath:l,eventFlow:u,fileEncSha256:i,mediaTypeDetails:{type:"regular",mediaType:a}});if(!m.success)return m;var p=m.value,_=p.retrier,f=p.mediaRouteDetails,g=f.bucket,h=await _.run(async function(e,t,s){var m=e.domain,p=o("WAMediaUrl").buildDownloadUrl(l,i,m,"manual",g),_=await o("WADownloadProgressiveJpegPlaintextStreamerWithoutRetry").downloadProgressiveJpegPlaintextUsingStreamsWithoutRetry({abortSignal:n,downloadUrl:p,eventFlow:u,mediaKey:d,progressiveJpegDetails:c,serverMediaType:a,cachePolicy:s>0?"no-store":"force-cache"});if(_.success===!0)return o("WAResultOrError").makeResult(_);var f=_.error;switch(f){case"http-fetch-exception":case"server-timeout":case"unspecified-http-error":case"invalid-content-length-header":case"missing-content-length-header":return o("WAResultOrError").makeError({progressMade:!0});case"access-expired":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("disconnected"));case"body-network-error":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("request-error"));case"media-not-found":case"request-error":case"download-throttled":case"signature-expired":case"http-fetch-aborted":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(f));case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(f));default:throw r("WAAssertUnreachable")(f)}});return h==null?(s.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Download with stream given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded")):h}l.downloadProgressiveJpegPlaintextUsingStreams=u}),98);
__d("WAPrepareMediaDownload",["Promise","WAErrorMessage","WAGetAgeBucketForMediaKeyTimestamp","WAHashUtils","WAMediaQplHelper","WAProgressiveJpegGetPJpegDetails","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=typeof((e=navigator.storage)==null?void 0:e.getDirectory)=="function",m=typeof self.caches=="object",p=0;function _(e){var t,r=e.mediaDownloadFlow,a=e.mediaEntry,i=e.logger,l=e.hash,_=a.mediaKeyTimestamp,f=a.size,g=a.serverMediaType,h=a.downloadableThumbnail,y=a.directPath,C=o("WAGetAgeBucketForMediaKeyTimestamp").getAgeBucketForMediaKeyTimestamp(_);i.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["start download ",". mediaKeyTimestampAgeBucket: ",", size: ",", serverMediaType: ",""])),o("WAHashUtils").sanitisePlaintextHash(l),C,f,g);var b=(t=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(a).value)!=null?t:null;return r.addPoint("wa_protocol_media_download_start",{string:{mediaType:g,mediaKeyTimestampAgeBucket:C,sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(l)},bool:{isOPFSSupported:d,isWebCacheSupported:m,duplicateDirectPath:(h==null?void 0:h.directPath)===y,hasDownloadableThumbnail:(h==null?void 0:h.directPath)!=null,isProgressiveJpeg:b!=null}}),{logDownloadResult:function(t){return p++,r.addAnnotations({int:{concurrentDownloadCount:p}}),t.then(function(e){if(e.success){var t=e.value.plaintext.byteLength;r.addPoint("wa_protocol_media_download_end",{string:{media_size:o("WAMediaQplHelper").convertIntegerSizeToStringBucket(t)}})}else r.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:e.error}});return e}).catch(function(e){r.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"runtime-error"}});var t=o("WAErrorMessage").maybeGetMessageFromError(e);return i.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media due to runtime-error: ",""])),t),(c||(c=n("Promise"))).resolve(o("WAResultOrError").makeError("runtime-error"))}).finally(function(){p--})}}}l.prepareMediaDownload=_}),98);
__d("WAProgressiveJpegAddJPEGTrailingTag",["WATypedArraysConcat"],(function(t,n,r,o,a,i,l){"use strict";var e=new Uint8Array([255,217]);function s(t){return o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[new Uint8Array(t),e]).buffer}l.JPEG_TRAILING_TAG=e,l.addJPEGTrailingTag=s}),98);
__d("WAStreamAsyncIterator",[],(function(t,n,r,o,a,i){"use strict";function e(e){return l.apply(this,arguments)}function l(){return l=babelHelpers.wrapAsyncGenerator(function*(e){var t=e.getReader();try{for(;;){var n=yield babelHelpers.awaitAsyncGenerator(t.read()),r=n.done,o=n.value;if(r)return;yield o}}finally{t.releaseLock()}}),l.apply(this,arguments)}i.streamAsyncIterator=e}),66);
__d("WADownloadMedia",["WAByteArray","WACryptoSha256","WACryptoUtils","WADownloadAndDecryptMedia","WADownloadDownloadablePreview","WADownloadProgressiveJpegPlaintextStreamer","WADownloadProgressiveJpegPreview","WAErrorMessage","WAHashUtils","WAMediaCrypto","WAMediaUtils","WAPrepareMediaDownload","WAProgressiveJpegAddJPEGTrailingTag","WAProgressiveJpegGetPJpegDetails","WAPromiseManagement","WAResultOrError","WAStreamAsyncIterator","WATagsLogger","WATypedArraysConcat"],(function(t,n,r,o,a,i,l){"use strict";var e=["hash"],s,u,c,d,m,p,_,f,g,h,y,C,b,v,S=o("WATagsLogger").TAGS(["MediaDownload"]);function R(e){var t=e.downloadMediaMetric,n=e.hash,r=e.mediaEntry,a=e.protocolMsgId,i=e.handleMediaPreviewDownload,l=e.handleMediaPreviewBeforeDownload,s=e.handleMediaPreviewDownloadFailed,u=o("WAPrepareMediaDownload").prepareMediaDownload({mediaDownloadFlow:t,mediaEntry:r,hash:n,logger:S}),c=u.logDownloadResult;return c(E({downloadMediaMetric:t,hash:n,mediaEntry:r,protocolMsgId:a,handleMediaPreviewDownload:i,handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:s}))}var L=async function(t){var e=t.downloadMediaMetric,n=t.hash,r=t.mediaEntry,a=t.protocolMsgId,i=t.handleMediaPreviewDownload,l=t.handleMediaPreviewBeforeDownload,p=t.handleMediaPreviewDownloadFailed,_=o("WAMediaUtils").validateDecodedMediaEntryForDownload(r);if(!_.success)return S.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mediaEntry is incomplete. ",""])),_.error),_;var f=_.value,g=f.directPath,h=f.fileEncSha256,y=f.fileSha256,C=f.mediaKey,b=f.serverMediaType,v=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(r);v.success===!1&&(S.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to get ProgressiveJpeg details: ",""])),v.error),e.addPoint(v.error));var R=v.success===!0?v.value:null,L=function(t){if(t==null)return Promise.resolve();var e=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(b);return e==null?(S.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - unsupported preview media type ",""])),b),Promise.resolve()):i(n,t,e,a).then(function(){})};if(R!=null&&o("WAMediaUtils").isTransformStreamSupported()&&b==="image"){var E=await x({directPath:g,downloadFlow:e,fileEncSha256:h,handleMediaPreviewBlob:L,hash:n,mediaKey:C,progressiveJpegDetails:R,serverMediaType:b,fileSha256:y,handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:p});if(E.success)return o("WAResultOrError").makeResult({mimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(b),plaintext:E.value,serverMediaType:b});var I=E.error;switch(S.WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Media Streaming failed to download progressive jpeg. Reason: ",". PlaintextHash: ",""])),I,o("WAHashUtils").sanitisePlaintextHash(n)),I){case"signature-expired":case"request-error":return S.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Skipping fallback for ",". PlaintextHash: ",""])),I,o("WAHashUtils").sanitisePlaintextHash(n)),o("WAResultOrError").makeError(I)}}e==null||e.addPoint("fallback_to_non_streaming_download");var T=D({hash:n,mediaEntry:r,progressiveJpegDetails:R,protocolMsgId:a,serverMediaType:b,handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:p,downloadEntry:e.downloadEntry,triggerUIView:e.triggerUIView});return T.then(function(e){return e.success===!1?L(null):L(e.value)}),k({downloadMediaMetric:e,mediaEntry:_.value})},E=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.hash;return t},L),k=async function(t){var e=t.abortSignal,n=t.downloadMediaMetric,r=t.mediaEntry,a=r.directPath,i=r.fileEncSha256,l=r.fileSha256,s=r.mediaKey,u=r.serverMediaType,c=await T({abortSignal:e,downloadFlow:n,mediaTypeDetails:{mediaType:u,type:"regular"},directPath:a,fileEncSha256:i,fileSha256:l,mediaKey:s});return c.success?o("WAResultOrError").makeResult({mimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(u),plaintext:c.value,serverMediaType:u}):c},I=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.hash;return t},function(t){var n=t.hash,r=babelHelpers.objectWithoutPropertiesLoose(t,e),a=o("WAPrepareMediaDownload").prepareMediaDownload({hash:n,mediaDownloadFlow:r.downloadMediaMetric,mediaEntry:r.mediaEntry,logger:S}),i=a.logDownloadResult;return i(k(r))});async function T(e){var t=e.abortSignal,n=e.downloadFlow,r=e.mediaTypeDetails,a=e.directPath,i=e.fileEncSha256,l=e.fileSha256,s=e.mediaKey,u=o("WAHashUtils").toPlaintextHash(l),c=await o("WADownloadAndDecryptMedia").downloadAndDecryptMedia({abortSignal:t,directPath:a,eventFlow:n,fileEncSha256:i,mediaKey:s,mediaTypeDetails:r,plaintextHash:u});if(c.success===!1){var d=c.error;switch(d){case"signature-expired":case"media-not-found":return o("WAResultOrError").makeError(d);case"enc-hash-mismatch":return S.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia: enc-hash-mismatch"]))),o("WAResultOrError").makeError(d);default:return o("WAResultOrError").makeError(d)}}else{var m=c.value;return o("WAResultOrError").makeResult(m)}}function D(e){var t=e.hash,n=e.mediaEntry,r=e.progressiveJpegDetails,a=e.protocolMsgId,i=e.serverMediaType,l=e.handleMediaPreviewBeforeDownload,s=e.handleMediaPreviewDownloadFailed,u=e.downloadEntry,c=e.triggerUIView;return r==null?o("WADownloadDownloadablePreview").maybeDownloadDownloadablePreview(a,t,i,n,u,{handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:s},c):o("WADownloadProgressiveJpegPreview").maybeDownloadProgressiveJpegPreview({protocolMsgId:a,hash:t,serverMediaType:i,mediaEntry:n,progressiveJpegDetails:r,handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:s,downloadEntry:u,triggerUIView:c}).then(function(e){return e.success!==!0?o("WADownloadDownloadablePreview").maybeDownloadDownloadablePreview(a,t,i,n,u,{handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:s},c):e})}async function x(e){var t=e.directPath,n=e.downloadFlow,r=e.fileEncSha256,a=e.fileSha256,i=e.handleMediaPreviewBlob,l=e.hash,s=e.mediaKey,u=e.progressiveJpegDetails,c=e.serverMediaType,d=e.handleMediaPreviewBeforeDownload,m=e.handleMediaPreviewDownloadFailed,p=S.TAGS(["MediaStreaming"]);p.LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Using Media Streaming to download ProgressiveJpeg. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(l)),n.addPoint("media_streaming_start");var R=o("WADownloadProgressiveJpegPreview").getPreviewTargetScan(u.scanLengths)-1;p.LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Targeting scanIndex "," for preview. PlaintextHash: ",""])),R,o("WAHashUtils").sanitisePlaintextHash(l)),n.addAnnotations({int:{scans:u.scanLengths.length}}),d(l);var L=await o("WADownloadProgressiveJpegPlaintextStreamer").downloadProgressiveJpegPlaintextUsingStreams({directPath:t,eventFlow:n,fileEncSha256:r,mediaKey:s,progressiveJpegDetails:u,serverMediaType:c});if(L.success===!1)return n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:L.error}}),m(l,L.error),L;n.addPoint("download_pjpeg_preview_start");var E=[],k=0;try{var I=!1,T=!1,D;try{for(var x=babelHelpers.asyncIterator(o("WAStreamAsyncIterator").streamAsyncIterator(L.value)),$;I=!($=await x.next()).done;I=!1){var P=$.value;{if(P==null)continue;if(p.LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Processing scan "," for plaintextHash ",""])),k,o("WAHashUtils").sanitisePlaintextHash(l)),E.push(P),k===R){n.addPoint("media_streaming_preview_processed"),p.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Handling preview from scan "," for plaintextHash ",""])),k,o("WAHashUtils").sanitisePlaintextHash(l));var N=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(E,[o("WAProgressiveJpegAddJPEGTrailingTag").JPEG_TRAILING_TAG])));i(N),n.addPoint("download_pjpeg_preview_end")}k++}}}catch(e){T=!0,D=e}finally{try{I&&x.return!=null&&await x.return()}finally{if(T)throw D}}k<R&&(p.ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["pjpeg stream ended before reaching previewTargetScanIndex for plaintextHash ",""])),o("WAHashUtils").sanitisePlaintextHash(l)),n.addPoint("download_pjpeg_preview_fail"));var M=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(E))),w=await o("WACryptoSha256").sha256(M);return o("WACryptoUtils").arrayBuffersEqual(a,w)?(p.LOG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download successful. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(l)),n.addPoint("media_streaming_end"),o("WAResultOrError").makeResult(M)):(p.WARN(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download failed due to plaintext hash mismatch. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(l)),n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:"hash-mismatch"}}),o("WAResultOrError").makeError("hash-mismatch"))}catch(e){return p.ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Exception occurred during Media Streaming: Reason: ",""])),e),k<R&&(n.addPoint("download_pjpeg_preview_fail"),m(l,o("WAErrorMessage").maybeGetMessageFromError(e))),n==null||n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WAResultOrError").makeError("stream-error")}}l.mediaDownloadLogger=S,l.downloadMedia=R,l.downloadFullMediaOnly=k,l.cachedDownloadFullMediaOnly=I,l.downloadMediaImpl=T}),98);
__d("WADownloadProgressiveJpegPlaintext",["WADownloadCiphertext","WAMediaCrypto","WAProgressiveJpegAddJPEGTrailingTag","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS(["DownloadProgressiveJpeg"]);async function d(e){var t=e.abortSignal,n=e.mediaTypeDetails,r=e.fileEncSha256,a=e.directPath,i=e.mediaKey,l=e.eventFlow,s=e.progressiveJpegDetails,u=e.targetScan,c=e.plaintextHash,d=e.size,_=o("WAProgressiveJpegGetPJpegDetails").getExtendedProgressiveJpegDetails({progressiveJpegDetails:s,ciphertextLength:p(d)}),f=o("WAProgressiveJpegGetPJpegDetails").getTotalByteSizeForScan(_.alignedScanLengths,u),g=await o("WADownloadCiphertext").cachedDownloadCiphertext({abortSignal:t,mediaTypeDetails:n,fileEncSha256:r,directPath:a,fromBytes:0,toBytes:f-1,eventFlow:l,plaintextHash:c});return g.success!==!0?g:m(i,n,u,_,g.value)}async function m(t,n,r,a,i){c.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Using progressiveJpeg decryptAndVerify"])));var l=new Uint8Array(i),d;n.type==="preview"?d=o("WAMediaCrypto").computeMediaKeysForPreview(t):d=o("WAMediaCrypto").computeMediaKeys(t,n.mediaType);var m=await d.then(function(e){var t=e.iv,n=e.cipherKey,i=e.hmacKey;return o("WAMediaCrypto").decryptPartialChunks(n,t,l,i,r,a)}).then(o("WAResultOrError").makeResult).catch(function(e){return c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""])),e),e instanceof o("WAMediaCrypto").HmacValidationError?o("WAResultOrError").makeError("enc-hash-mismatch"):o("WAResultOrError").makeError("decryption-error")});if(!m.success)return m;c.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["ProgressiveJpeg download and decrypt successful. Partial: ",""])),r<a.scanLengths.length);var p=o("WAProgressiveJpegAddJPEGTrailingTag").addJPEGTrailingTag(m.value.plaintext);return o("WAResultOrError").makeResult(p)}function p(e){if(e==null)return null;var t=o("WAMediaCrypto").CBC_BLOCK_SIZE-e%o("WAMediaCrypto").CBC_BLOCK_SIZE;return e+t+o("WAMediaCrypto").HMAC_LENGTH}l.downloadProgressiveJpegPlaintext=d}),98);
__d("WALoggerTag",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["CryptoManager","MediaPreview","PrekeyGenerateAndUpload","SignedPrekey","SignedPrekeyRotation","OneTimePrekey"]),l=e;i.default=l}),66);
__d("WAProgressiveJpegGetTargetScanLengthForBytes",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){for(var n=0,r=0,o=0;o<e.length&&(r=o+1,n+=e[o],!(n>=t));o++);return r}i.getTargetScanBasedOnByteSize=e}),66);
__d("WADownloadProgressiveJpegPreview",["WADownloadMedia","WADownloadProgressiveJpegPlaintext","WAGlobals","WALoggerTag","WAProgressiveJpegGetTargetScanLengthForBytes","WAResultOrError","WAStartMediaDownloadQplFlow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WADownloadMedia").mediaDownloadLogger.TAGS([r("WALoggerTag").MediaPreview]),c=3;async function d(t){var n=t.protocolMsgId,r=t.hash,a=t.serverMediaType,i=t.mediaEntry,l=t.progressiveJpegDetails,c=t.handleMediaPreviewBeforeDownload,d=t.handleMediaPreviewDownloadFailed,p=t.downloadEntry,_=t.triggerUIView,f=i.directPath,g=i.fileEncSha256,h=i.mediaKey,y=i.size;if(f==null||g==null||h==null)return o("WAResultOrError").makeError("pjpeg-failed");var C=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({protocolMsgId:n,downloadEntry:p,isPreview:!0,msgType:null,triggerUIView:_});C.addAnnotations({bool:{isProgressiveJpeg:!0},string:{mediaType:"preview",fullSizeMediaType:i.serverMediaType},int:{mediaEntrySize:i.size}}),u.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Starting progressiveJpeg preview download"]))),C.addPoint("wa_protocol_media_download_start");var b=o("WAGlobals").getConfig().pjpegPreviewAvoidLastScan()===!0?l.scanLengths.length-1:l.scanLengths.length,v=Math.min(m(l.scanLengths,y),b);await c(r);var S=await o("WADownloadProgressiveJpegPlaintext").downloadProgressiveJpegPlaintext({directPath:f,eventFlow:C,fileEncSha256:g,mediaKey:h,mediaTypeDetails:{mediaType:a,type:"regular"},progressiveJpegDetails:l,plaintextHash:r,targetScan:v,size:y});if(!S.success)return d(r,S.error),C.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:S.error}}),o("WAResultOrError").makeError("pjpeg-failed");var R=S.value;return u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Finished progressiveJpeg preview download"]))),C.addPoint("wa_protocol_media_download_end"),C.endSuccess(),o("WAResultOrError").makeResult(R)}function m(e,t){var n=o("WAGlobals").getConfig().jpegThumbnailTargetByteSizeKB()*1024,r=o("WAProgressiveJpegGetTargetScanLengthForBytes").getTargetScanBasedOnByteSize(e,n);return(t==null||t===0)&&(r=Math.min(r,e.length-1)),r=Math.max(r,c),r}function p(e){var t=e.abortSignal,n=e.hash,r=e.serverMediaType,a=e.mediaEntry,i=e.progressiveJpegDetails,l=e.mediaDownloadFlow,s=a.directPath,u=a.fileEncSha256,c=a.mediaKey,d=a.size,p=o("WAGlobals").getConfig().pjpegPreviewAvoidLastScan()===!0?i.scanLengths.length-1:i.scanLengths.length,_=Math.min(m(i.scanLengths,d),p);return o("WADownloadProgressiveJpegPlaintext").downloadProgressiveJpegPlaintext({abortSignal:t,directPath:s,fileEncSha256:u,mediaKey:c,mediaTypeDetails:{mediaType:r,type:"regular"},progressiveJpegDetails:i,plaintextHash:n,targetScan:_,size:d,eventFlow:l})}l.maybeDownloadProgressiveJpegPreview=d,l.getPreviewTargetScan=m,l.maybeDownloadProgressiveJpegPreviewV2=p}),98);
__d("WAGetKaleidoscopeWasm",["WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("33861")),s=function(){return o("WAWasmModuleCache").loadWasmModule(e)};l.getKaleidoscopeWasm=s}),98);
__d("WAMediaUtilsWasmUrl",["bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("237"));l.WAMediaUtilsWasmUrl=e}),98);
__d("WAPreloadWamediaUtilsWasm",["WAMediaUtilsWasmUrl","WAWasmModuleCache"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){o("WAWasmModuleCache").loadWasmModule(o("WAMediaUtilsWasmUrl").WAMediaUtilsWasmUrl)};l.preloadWamediaUtilsWasm=e}),98);
__d("WAPreloadWebpCheckWasm",["WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("6946")),s=function(){o("WAWasmModuleCache").loadWasmModule(e)};l.preloadWebpCheckWasm=s}),98);
__d("WAPrewarmMediaValidate",["WAGetKaleidoscopeWasm","WALogger","WAPreloadWamediaUtilsWasm","WAPreloadWebpCheckWasm","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){if(r("gkx")("3272")){o("WAGetKaleidoscopeWasm").getKaleidoscopeWasm().catch(function(t){var n=r("getErrorSafe")(t);o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["prewarm Kaleidoscop wasm failed with error: ",""])),n.message)});return}if(t==null){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["prewarmMediaValidate: serverMediaType is null"])));return}(t==="sticker"||t==="image")&&o("WAPreloadWebpCheckWasm").preloadWebpCheckWasm(),(t==="video"||t==="audio")&&o("WAPreloadWamediaUtilsWasm").preloadWamediaUtilsWasm()}l.prewarmMediaValidate=u}),98);
__d("WAMediaManagerPrepareMediaDownload",["Promise","WAErrorMessage","WAGetAgeBucketForMediaKeyTimestamp","WAHashUtils","WAMediaQplHelper","WAPrewarmMediaValidate","WAProgressiveJpegGetPJpegDetails","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=0;function d(t){var r,a=t.hash,i=t.logger,l=t.mediaDownloadFlow,d=t.mediaEntry,m=d.directPath,p=d.downloadableThumbnail,_=d.mediaKeyTimestamp,f=d.serverMediaType,g=d.size;o("WAPrewarmMediaValidate").prewarmMediaValidate(f);var h=o("WAGetAgeBucketForMediaKeyTimestamp").getAgeBucketForMediaKeyTimestamp(_);i.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start download ",". entry: "," mediaKeyTimestampAgeBucket: ",", size: ",", serverMediaType: ",""])),o("WAHashUtils").sanitisePlaintextHash(a),l.downloadEntry,h,g,f);var y=(r=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(d).value)!=null?r:null;return l.addPoint("wa_protocol_media_download_start",{bool:{duplicateDirectPath:(p==null?void 0:p.directPath)===m,hasDownloadableThumbnail:(p==null?void 0:p.directPath)!=null,isProgressiveJpeg:y!=null},string:{mediaKeyTimestampAgeBucket:h,mediaType:f}}),{logDownloadResult:function(t){return c++,l.addAnnotations({int:{concurrentDownloadCount:c}}),t.then(function(e){if(e.success){var t=e.value.validatedResult.validatedPlaintext.byteLength;l.addPoint("wa_protocol_media_download_end",{string:{media_size:o("WAMediaQplHelper").convertIntegerSizeToStringBucket(t)}})}else l.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:e.error}});return e}).catch(function(e){l.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"runtime-error"}});var t=o("WAErrorMessage").maybeGetMessageFromError(e);return i.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media due to runtime-error: ",""])),t),(u||(u=n("Promise"))).resolve(o("WAResultOrError").makeError("runtime-error"))}).finally(function(){c--})}}}l.mediaManagerPrepareMediaDownload=d}),98);
__d("WAIsMp4",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.length<8?!1:e[4]===102&&e[5]===116&&e[6]===121&&e[7]===112}i.isMp4=e}),66);
__d("WAIsWebP",[],(function(t,n,r,o,a,i){"use strict";function e(e){return!(e.length<12||e[0]!==82||e[1]!==73||e[2]!==70||e[3]!==70||e[8]!==87||e[9]!==69||e[10]!==66||e[11]!==80)}i.isWebP=e}),66);
__d("WAKaleidoscopeLogger",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return r("FBLogger")("wmi").tags(["Kaleidoscope"])};l.ksLogger=e}),98);
__d("WAKaleidoscopeCheck",["WAGetKaleidoscopeWasm","WAKaleidoscopeLogger","WAResultOrError","WASI","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_="input",f="output",g="/"+_,h="/"+f;function y(e){var t,n=e.input,r=e.stdout,o=e.stderr,a=e.rawMimeType,i=e.mediaType;return{args:["kaleidoscope","check","--json-report="+f,"--mimetype-hint="+a,_],fs:(t={},t[g]={path:g,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(n)},t[h]={path:h,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:""},t),stdout:r,stderr:o,moduleName:"WAKaleidoscopeCheck_CLI"}}function C(t){var n=t.getWasmModule;return async function(a){var t,i,l,_,f=a.input,g=a.rawMimeType,C=a.mediaType,b=o("WASI").createWasi(y({input:f,rawMimeType:g,mediaType:C,stderr:function(n){o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),n)},stdout:function(t){o("WAKaleidoscopeLogger").ksLogger().DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)}})),v=b.getImportObject,S=b.start,R=await n(),L=await WebAssembly.instantiate(R,v()),E=S(L),k=E.exitCode,I=E.fs;if(k!==0)return o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed with exit code ",""])),k),o("WAResultOrError").makeError("wasm-runtime-error");var T=(t=I[h])==null?void 0:t.content;if(typeof T!="string")return o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed invalid result type"]))),o("WAResultOrError").makeError("wasm-result-not-json");var D={};try{D=JSON.parse(T)}catch(e){return o("WAKaleidoscopeLogger").ksLogger().catching(r("getErrorSafe")(e)).MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed to parse JSON"]))),o("WAResultOrError").makeError("wasm-invalid-json")}return typeof((i=D)==null?void 0:i.score)!="number"?(o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck score is null"]))),o("WAResultOrError").makeError("wasm-invalid-json")):(o("WAKaleidoscopeLogger").ksLogger().DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck called with rawMimeType: ",", mediaType: ",""])),g,C),o("WAResultOrError").makeResult({mimetype:((l=D)==null?void 0:l.mimetype)||"application/octet-stream",extension:((_=D)==null?void 0:_.extension)||null,score:D.score}))}}var b=C({getWasmModule:o("WAGetKaleidoscopeWasm").getKaleidoscopeWasm});l.kaleidoscopeCheck=b}),98);
__d("WAMp4Check",["WAMediaUtilsWasmUrl","WAResultOrError","WASI","WAWasmModuleCache"],(function(t,n,r,o,a,i,l){"use strict";var e="input",s="output",u="/"+e,c="/"+s;function d(t){var n,r=t.input,o=t.stdout,a=t.stderr;return{args:["wamediautil","mp4check","--error-tolerance=2","--json-report="+s,e],fs:(n={},n[u]={path:u,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(r)},n[c]={path:c,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:""},n),stdout:o,stderr:a,moduleName:"WAMp4Check_CLI"}}function m(e){var t=e.getWasmModule,n=e.logError,r=e.logMessage;return async function(a){var e,i,l,s,u,m,p,_,f,g,h,y,C,b=a.input,v=o("WASI").createWasi(d({input:b,stderr:n,stdout:r})),S=v.getImportObject,R=v.start,L=await t(),E=await WebAssembly.instantiate(L,S()),k=R(E),I=k.exitCode,T=k.fs;if(I!==0)return n("mp4Check failed with exit code "+I),o("WAResultOrError").makeError("invalid-media");var D=(e=T[c])==null?void 0:e.content;if(typeof D!="string")return n("mp4check failed invalid result type"),o("WAResultOrError").makeError("runtime-error");var x=(i=JSON.parse(D))!=null?i:{};return o("WAResultOrError").makeResult({videoStreamReport:(x==null?void 0:x.video_stream_report)==null?null:{streamType:(l=x.video_stream_report)==null?void 0:l.stream_type,calculatedFps:(s=x.video_stream_report)==null?void 0:s.calculated_fps,nominalFps:(u=x.video_stream_report)==null?void 0:u.nominal_fps,videoWidth:(m=x.video_stream_report)==null?void 0:m.video_width,videoHeight:(p=x.video_stream_report)==null?void 0:p.video_height,duration:(_=x.video_stream_report)==null?void 0:_.duration,avgBitsPerSecond:(f=x.video_stream_report)==null?void 0:f.avg_bits_per_second},audioStreamReport:(x==null?void 0:x.audio_stream_report)==null?null:{streamType:(g=x.audio_stream_report)==null?void 0:g.stream_type,samplingRate:(h=x.audio_stream_report)==null?void 0:h.sampling_rate,numberOfChannels:(y=x.audio_stream_report)==null?void 0:y.number_of_channels,avgBitsPerSecond:(C=x.audio_stream_report)==null?void 0:C.avg_bits_per_second}})}}var p=function(){return o("WAWasmModuleCache").loadWasmModule(o("WAMediaUtilsWasmUrl").WAMediaUtilsWasmUrl)};l.createMp4Check=m,l.getMp4CheckWasm=p}),98);
__d("WAParseWav",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=new DataView(e);return e.byteLength<44||t.getUint32(0)!==1380533830||t.getUint32(8)!==1463899717?null:e}function l(e){var t=new DataView(e),n=t.getUint16(22,!0),r=t.getUint32(24,!0);return{numChannels:n,sampleRate:r}}i.validateWav=e,i.parseWav=l}),66);
__d("WAWebPCheck",["WAResultOrError","WASI","WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e="input",s="/"+e;function u(t){var n,r=t.input,o=t.stdout,a=t.stderr;return{args:["webpcheck",e],fs:(n={},n[s]={path:s,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(r)},n),stdout:o,stderr:a,moduleName:"WAWebPCheck_CLI"}}function c(e){var t=e.getWasmModule,n=e.logError,r=e.logMessage;return async function(a){var e=a.input,i=o("WASI").createWasi(u({input:e,stderr:n,stdout:r})),l=i.getImportObject,s=i.start,c=await t(),d=await WebAssembly.instantiate(c,l()),m=s(d),p=m.exitCode;return p!==0?(n("WebPCheck failed with exit code "+p),o("WAResultOrError").makeError("invalid-media")):o("WAResultOrError").makeResult()}}var d=r("bx").getURL(r("bx")("6946")),m=function(){return o("WAWasmModuleCache").loadWasmModule(d)};l.createWebPCheck=c,l.getWebpCheckWasm=m}),98);
__d("WAValidateMedia",["FBLogger","WAIsMp4","WAIsOgg","WAIsWebP","WAKaleidoscopeCheck","WAMp4Check","WAParseWav","WAResultOrError","WAWebPCheck","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=function(){return r("FBLogger")("wmi").tags(["WAValidateMedia"])};function m(t,n){return n.addPoint("media_validation_start"),(r("gkx")("3272")?p(t):_(t)).then(function(e){return e.success?n.addPoint("media_validation_end",{bool:{is_validation_setup_failed:e.value.validationSetupFailed,is_validation_skipped:e.value.skipValidation},string:{validated_mime_type:e.value.mimeType}}):n.addPoint("media_validation_fail",{string:{validationError:e.error}}),e}).catch(function(a){var i=r("getErrorSafe")(a);return d().catching(i).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["validateMedia threw an exception: ",""])),i.message),n.addPoint("media_validation_fail",{string:{validationError:i.message}}),o("WAResultOrError").makeResult({skipValidation:!0,mimeType:null,validatedPlaintext:t,validationSetupFailed:!0})})}async function p(e){var t=await o("WAKaleidoscopeCheck").kaleidoscopeCheck({input:e,rawMimeType:"application/octet-stream",mediaType:"unknown"});if(!t.success)return d().MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed with error: ",""])),t.error),o("WAResultOrError").makeError("runtime-error");var n=t.value,r=n.score,a=n.mimetype;return r>=80?o("WAResultOrError").makeError("invalid-media"):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:a,validatedPlaintext:e,validationSetupFailed:!1,isKaleidoscopeCheck:!0})}function _(e){var t=new Uint8Array(e);if(o("WAIsWebP").isWebP(t))return h(e);if(o("WAIsMp4").isMp4(t))return y(e);if(o("WAIsOgg").isOgg(t))return Promise.resolve(o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/ogg",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:null}));var n=o("WAParseWav").validateWav(e);return n!=null?Promise.resolve(C(n)):Promise.resolve(o("WAResultOrError").makeResult({mimeType:null,skipValidation:!0,validatedPlaintext:e,validationSetupFailed:!1}))}var f=function(t){t!==""&&d().WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)},g=function(t){t!==""&&d().DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)};async function h(e){var t=o("WAWebPCheck").createWebPCheck({getWasmModule:o("WAWebPCheck").getWebpCheckWasm,logError:f,logMessage:g}),n=await t({input:e});return n.success?o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"image/webp",validatedPlaintext:e,validationSetupFailed:!1}):n}async function y(e){var t=o("WAMp4Check").createMp4Check({getWasmModule:o("WAMp4Check").getMp4CheckWasm,logError:f,logMessage:g}),n=await t({input:e});if(!n.success)return o("WAResultOrError").makeError(n.error);var r=n.value,a=r.videoStreamReport,i=r.audioStreamReport;return a==null?i==null?o("WAResultOrError").makeError("invalid-media"):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/mp4",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:i}):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"video/mp4",validatedPlaintext:e,validationSetupFailed:!1,videoStreamReport:a,audioStreamReport:i})}function C(e){var t=o("WAParseWav").parseWav(e),n=t.numChannels,r=t.sampleRate;return o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/wav",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:{streamType:"LPCM",samplingRate:r,numberOfChannels:n}})}l.validateMedia=m}),98);
__d("WADownloadFullSizeOnlyTask",["EncryptedBackupsResignCdnUrl","MAWCastToMsgrServerMediaType","MAWEBSwitch","WADownloadMedia","WAFindMostRecentMediaEntry","WAIsMediaExpiredError","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAResultOrError","WAValidateMedia","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.logger,i=e.mediaDownloadFlow;i.addPoint("get_media_entries_start");var l=await n.getMediaEntries(r);if(!l.success)return i.addPoint("get_media_entries_fail"),{fullsizePromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var s=l.value;i.addPoint("get_media_entries_end");var u=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(s);if(!u.success)return{fullsizePromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var c=u.value,m=c[0],p=c[1],_=o("WAMediaUtils").validateDecodedMediaEntryForDownload(p);if(!_.success)return{fullsizePromise:Promise.resolve(_)};var f=_.value,g=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:a,mediaDownloadFlow:i,mediaEntry:f}),h=g.logDownloadResult,y=d({abortSignal:t,dbCallbacks:n,logger:a,mediaDownloadFlow:i,mediaEntries:s,msgIdOfRecentMediaEntry:m,recentMediaEntry:f}).then(async function(e){if(!e.success)return e;var t=await o("WAValidateMedia").validateMedia(e.value.plaintext,i);return t.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:[m,f],serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.mimeType,validatedResult:t.value}):t});return{fullsizePromise:h(y)}}async function d(t){var n=t.abortSignal,a=t.dbCallbacks,i=t.logger,l=t.mediaDownloadFlow,c=t.mediaEntries,d=t.msgIdOfRecentMediaEntry,m=t.recentMediaEntry,p=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");p&&l.addPoint("forcing_eb_download");var _=p?o("WAResultOrError").makeError("signature-expired"):await o("WADownloadMedia").downloadFullMediaOnly({abortSignal:n,downloadMediaMetric:l,mediaEntry:m});if(_.success||!o("WAIsMediaExpiredError").isMediaExpiredError(_.error)||!r("MAWEBSwitch").isEnabled())return _;var f=await a.getProtocolMsgIdAndSortOrderMs(d);if(f==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var g=f.protocolMsgId,h=f.sortOrderMs,y=m,C=d,b=o("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(y.serverMediaType);if(b==null||y.objectId==null)return i.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and can not restore: ",""])),_.error),_;var v=await o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:y.objectId,logger:i,mediaDownloadFlow:l,mediaKey:y.mediaKey,mediaType:b,msgId:C,protocolMsgId:g,sortOrderMs:h});if(!v.success)return i.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and restore failed: ",""])),v.error),v;var S=await o("WADownloadMedia").downloadFullMediaOnly({abortSignal:n,downloadMediaMetric:babelHelpers.extends({},l,{addPoint:function(t,n){l.addPoint("second_"+t,n)}}),mediaEntry:babelHelpers.extends({},y,{directPath:v.value})});return S.success?o("WAResultOrError").makeResult(S.value):(i.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media after restore CDN URL: ",""])),S.error),S)}l.startDownloadFullSizeTask=c,l.downloadOrRestoreFullSize=d}),98);
__d("WADownloadMediaPreviewV2",["WADownloadMedia","WADownloadProgressiveJpegPreview","WAMediaCrypto","WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=t.abortSignal,r=t.hash,a=t.mediaEntry,i=t.progressiveJpegDetails,l=t.mediaDownloadFlow,s=t.logger,u=a.serverMediaType,c=o("WAMediaUtils").getMimeTypeFromServerMediaType(u),d=i==null?o("WAResultOrError").makeError("jpeg-stream-not-supported"):await o("WADownloadProgressiveJpegPreview").maybeDownloadProgressiveJpegPreviewV2({abortSignal:n,hash:r,serverMediaType:u,mediaEntry:a,progressiveJpegDetails:i,mediaDownloadFlow:l});if(d.success===!0)return o("WAResultOrError").makeResult({plaintext:d.value,mimeType:c,serverMediaType:u});l.addPoint("fallback_to_downloadable_thumbnail");var m=a.downloadableThumbnail;if((m==null?void 0:m.directPath)==null)return o("WAResultOrError").makeError("media-not-found");var p=o("WAMediaUtils").validateDownloadableThumbnailForDownload(m);if(p.success===!1)return s.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["preview mediaEntry is incomplete: ",""])),p.error),o("WAResultOrError").makeError(p.error[0]);var _=p.value,f=_.directPath,g=_.fileEncSha256,h=_.fileSha256,y=_.mediaKey,C=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(u);if(C==null)return o("WAResultOrError").makeError("request-error");var b=await o("WADownloadMedia").downloadMediaImpl({abortSignal:n,downloadFlow:l,mediaTypeDetails:{messageType:C,type:"preview"},directPath:f,fileEncSha256:g,fileSha256:h,mediaKey:y});return b.success===!1?b:o("WAResultOrError").makeResult({plaintext:b.value,mimeType:c,serverMediaType:u})}l.downloadMediaPreview=s}),98);
__d("WAIsPreviewSupported",["$InternalEnum","WAProgressiveJpegGetPJpegDetails"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum").Mirrored(["NO","YES"]),s=n("$InternalEnum").Mirrored(["NO","YES","DuplicatedWithFullSize"]);function u(t){var n=t.serverMediaType;switch(n){case"image":{var r,a,i=(r=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(t).value)!=null?r:null,l=i!=null?e.YES:e.NO;if(((a=t.downloadableThumbnail)==null?void 0:a.directPath)==null)return[l,s.NO];t.downloadableThumbnail.directPath;var u=t.downloadableThumbnail.directPath===t.directPath?s.DuplicatedWithFullSize:s.YES;return[l,u]}case"video":{var c;if(((c=t.downloadableThumbnail)==null?void 0:c.directPath)==null)return[e.NO,s.NO];t.downloadableThumbnail.directPath;var d=t.downloadableThumbnail.directPath===t.directPath?s.NO:s.YES;return[e.NO,d]}case"sticker":case"ptt":case"audio":case"document":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"template":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"novi-video":case"novi-image":case"payment-bg-image":case"xma-image":case"biz-cover-photo":case"preview":case"newsletter-audio":case"newsletter-document":case"newsletter-image":case"newsletter-gif":case"newsletter-music-artwork":case"newsletter-ptt":case"newsletter-sticker":case"newsletter-sticker-pack":case"newsletter-thumbnail-link":case"newsletter-video":case"newsletter-ptv":case"sticker-pack":case"thumbnail-sticker-pack":case"music-artwork":case"group-history":case"ads-image":case"ads-video":case"ptv":return[e.NO,s.NO];default:return[e.NO,s.NO]}}l.PjpegPreviewSupport=e,l.DownloadablePreviewSupport=s,l.checkPreviewSupport=u}),98);
__d("WADownloadPreviewOnlyTask",["EncryptedBackupsResignCdnUrl","MAWEBSwitch","WADownloadMediaPreviewV2","WAFindMostRecentMediaEntry","WAIsMediaExpiredError","WAIsPreviewSupported","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAValidateMedia","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.logger,i=e.mediaDownloadFlow;i.addPoint("get_media_entries_start");var l=await n.getMediaEntries(r);if(!l.success)return i.addPoint("get_media_entries_fail"),{previewPromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};i.addPoint("get_media_entries_end");var s=l.value,u=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(s);if(!u.success)return{previewPromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var d=u.value,m=d[0],p=d[1],_=o("WAMediaUtils").validateDecodedMediaEntryForDownload(p);if(!_.success)return{previewPromise:Promise.resolve(_)};var f=_.value,g=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:a,mediaDownloadFlow:i,mediaEntry:f}),h=g.logDownloadResult,y=c({abortSignal:t,dbCallbacks:n,fullSizePlaintextHash:r,logger:a,mediaDownloadFlow:i,mediaEntries:l.value,msgIdOfRecentMediaEntry:m,recentMediaEntry:f}).then(async function(e){if(!e.success)return e;var t=await o("WAValidateMedia").validateMedia(e.value.plaintext,i);return t.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:[m,f],serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.mimeType,validatedResult:t.value}):t});return{previewPromise:h(y)}}async function c(t){var n,a=t.abortSignal,i=t.dbCallbacks,l=t.fullSizePlaintextHash,u=t.logger,c=t.mediaDownloadFlow,d=t.mediaEntries,m=t.msgIdOfRecentMediaEntry,p=t.recentMediaEntry,_=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");_&&c.addPoint("forcing_eb_download");var f=o("WAIsPreviewSupported").checkPreviewSupport(p),g=f[0],h=f[1];if(g===o("WAIsPreviewSupported").PjpegPreviewSupport.NO&&h===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return o("WAResultOrError").makeError("preview-not-supported");var y=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(p),C=y.success===!0?y.value:null,b={abortSignal:a,hash:l,logger:u,mediaDownloadFlow:c,progressiveJpegDetails:C};c.addPoint("download_preview_start",{string:{preview_downloadable_support:h,preview_pjpeg_support:g}});var v=_?o("WAResultOrError").makeError("signature-expired"):await o("WADownloadMediaPreviewV2").downloadMediaPreview(babelHelpers.extends({},b,{mediaEntry:p}));if(v.success)return c.addPoint("download_preview_end"),o("WAResultOrError").makeResult({mimeType:v.value.mimeType,plaintext:v.value.plaintext,serverMediaType:v.value.serverMediaType});if(c.addPoint("download_preview_fail"),!o("WAIsMediaExpiredError").isMediaExpiredError(v.error)||!r("MAWEBSwitch").isEnabled()||r("gkx")("1327")!==!0)return v;var S=await i.getProtocolMsgIdAndSortOrderMs(m);if(S==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var R=S.protocolMsgId,L=S.sortOrderMs,E=p,k=m,I=h===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO||((n=E.downloadableThumbnail)==null?void 0:n.objectId)==null?null:o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:E.downloadableThumbnail.objectId,logger:u,mediaDownloadFlow:c,mediaKey:E.mediaKey,mediaType:"preview",msgId:k,protocolMsgId:R,sortOrderMs:L}),T=g===o("WAIsPreviewSupported").PjpegPreviewSupport.NO||E.objectId==null?null:o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:E.objectId,logger:u,mediaDownloadFlow:c,mediaKey:E.mediaKey,mediaType:"image",msgId:k,protocolMsgId:R,sortOrderMs:L}),D=await Promise.all([I,T]),x=D[0],$=D[1];if((x==null?void 0:x.success)!==!0&&($==null?void 0:$.success)!==!0){var P;return u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and restore failed. downloadableThumbnail error: ",". pjpegPreview error: ",""])),x==null?void 0:x.error,$==null?void 0:$.error),(P=$!=null?$:x)!=null?P:o("WAResultOrError").makeError("preview-not-supported")}c.addPoint("second_download_preview_start");var N=await o("WADownloadMediaPreviewV2").downloadMediaPreview(babelHelpers.extends({},b,{mediaDownloadFlow:babelHelpers.extends({},c,{addPoint:function(t,n){c.addPoint("second_"+t,n)}}),mediaEntry:babelHelpers.extends({},E,{directPath:($==null?void 0:$.success)===!0?$.value:E.directPath,downloadableThumbnail:E.downloadableThumbnail==null?null:babelHelpers.extends({},E.downloadableThumbnail,{directPath:(x==null?void 0:x.success)===!0?x.value:E.downloadableThumbnail.directPath})})}));return N.success?(c.addPoint("second_download_preview_end"),o("WAResultOrError").makeResult({mimeType:N.value.mimeType,plaintext:N.value.plaintext,serverMediaType:N.value.serverMediaType})):(u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media after restore CDN URL: ",""])),N.error),c.addPoint("second_download_preview_fail"),N)}l.startDownloadPreviewTask=u,l.downloadOrRestorePreviewOnly=c}),98);
__d("WADownloadProgressiveJpegUsingMediaStreaming",["WAByteArray","WACryptoSha256","WACryptoUtils","WADownloadProgressiveJpegPlaintextStreamer","WADownloadProgressiveJpegPreview","WAErrorMessage","WAMediaUtils","WAProgressiveJpegAddJPEGTrailingTag","WAResolvable","WAResultOrError","WAStreamAsyncIterator","WATypedArraysConcat"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;async function f(t){var n=t.abortSignal,r=t.directPath,a=t.downloadFlow,i=t.fileEncSha256,l=t.fileSha256,m=t.logger,p=t.mediaKey,_=t.progressiveJpegDetails,f=t.serverMediaType,h=m.TAGS(["MediaStreaming"]);h.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Using Media Streaming to download ProgressiveJpeg."]))),a.addPoint("create_pjpeg_stream_start");var y=await o("WADownloadProgressiveJpegPlaintextStreamer").downloadProgressiveJpegPlaintextUsingStreams({abortSignal:n,directPath:r,eventFlow:a,fileEncSha256:i,mediaKey:p,progressiveJpegDetails:_,serverMediaType:f}).catch(function(e){return h.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["create DownloadAndDecryptPJpegStream unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});if(y.success===!1)return a.addPoint("create_pjpeg_stream_fail"),y;a.addPoint("create_pjpeg_stream_end");var C=new(o("WAResolvable")).Resolvable,b=!1,v=g({downloadFlow:a,fileSha256:l,mediaStreamingLogger:h,previewResolvable:C,progressiveJpegDetails:_,progressiveJpegDownloadStream:y.value,serverMediaType:f}).then(function(e){return b=!0,h.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["handleProgressiveJpegDownloadStream completed"]))),e}).catch(function(e){return b=!0,h.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["handleProgressiveJpegDownloadStream unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),C.reject(e),o("WAResultOrError").makeError("runtime-error")}),S=o("WAMediaUtils").getMimeTypeFromServerMediaType(f);function R(e){return e.success===!1?e:o("WAResultOrError").makeResult({mimeType:S,plaintext:e.value,serverMediaType:f})}var L=v.then(R),E=C.promise.then(R),k=await C.promise;if(k.success===!0&&b===!0&&h.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["fullsizeResolvable is settled before previewResolvable"]))),k.success===!0)return o("WAResultOrError").makeResult({fullsizePromise:L,previewPromise:E});var I=await v;return k.success,I.success===!0?o("WAResultOrError").makeResult({fullsizePromise:L,previewPromise:E}):(I.success,I)}async function g(e){var t=e.downloadFlow,n=e.fileSha256,r=e.mediaStreamingLogger,a=e.previewResolvable,i=e.progressiveJpegDetails,l=e.progressiveJpegDownloadStream;t.addPoint("download_pjpeg_preview_start");var s=0,u=o("WADownloadProgressiveJpegPreview").getPreviewTargetScan(i.scanLengths)-1;try{var c=[],d=!1,f=!1,g;try{for(var h=babelHelpers.asyncIterator(o("WAStreamAsyncIterator").streamAsyncIterator(l)),y;d=!(y=await h.next()).done;d=!1){var C=y.value;{if(C==null)continue;if(c.push(C),s===u){t.addPoint("media_streaming_preview_processed");var b=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(c,[o("WAProgressiveJpegAddJPEGTrailingTag").JPEG_TRAILING_TAG])));a.resolve(o("WAResultOrError").makeResult(b)),t.addPoint("download_pjpeg_preview_end")}s++}}}catch(e){f=!0,g=e}finally{try{d&&h.return!=null&&await h.return()}finally{if(f)throw g}}a.isSettled===!1&&(r.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["pjpeg stream ended before reaching previewTargetScanIndex"]))),a.resolve(o("WAResultOrError").makeError("runtime-error")),t.addPoint("download_pjpeg_preview_fail"));var v=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(c))),S=await o("WACryptoSha256").sha256(v);return o("WACryptoUtils").arrayBuffersEqual(n,S)?o("WAResultOrError").makeResult(v):(r.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download failed due to plaintext hash mismatch."]))),o("WAResultOrError").makeError("hash-mismatch"))}catch(e){return r.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Exception occurred during Media Streaming: Reason: ",""])),e),a.isSettled===!1&&(a.resolve(o("WAResultOrError").makeError("runtime-error")),t.addPoint("download_pjpeg_preview_fail")),o("WAResultOrError").makeError("runtime-error")}}l.downloadProgresiveJpegUsingMediaStreaming=f}),98);
__d("WADownloadFullSizeAndPreviewTask",["EncryptedBackupsResignCdnUrl","MAWCastToMsgrServerMediaType","MAWEBSwitch","UserAgent","WADownloadFullSizeOnlyTask","WADownloadPreviewOnlyTask","WADownloadProgressiveJpegUsingMediaStreaming","WAErrorMessage","WAFindMostRecentMediaEntry","WAHashUtils","WAIsMediaExpiredError","WAIsPreviewSupported","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAStartMediaDownloadQplFlow","WAValidateMedia","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h;async function y(t){var n=t.abortSignal,r=t.dbCallbacks,a=t.fullSizePlaintextHash,i=t.logger,l=t.mediaDownloadFlow;l.addPoint("get_media_entries_start");var c=await r.getMediaEntries(a);if(!c.success)return l.addPoint("get_media_entries_fail"),{fullsizePromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry")),previewPromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};l.addPoint("get_media_entries_end");var d=c.value,m=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(d);if(!m.success)return{fullsizePromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry")),previewPromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var p=m.value,_=p[0],f=p[1],g=o("WAMediaUtils").validateDecodedMediaEntryForDownload(f);return g.success?b({abortSignal:n,dbCallbacks:r,fullSizePlaintextHash:a,logger:i,mediaDownloadFlow:l,mediaEntries:d,msgIdOfRecentMediaEntry:_,recentMediaEntry:g.value}).then(function(e){return i.DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["outter promise: ",""])),e.success===!0?"success":e.error),e.success?e.value:(i.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["outter promise failed: ",""])),e.error),{fullsizePromise:Promise.resolve(e),previewPromise:Promise.resolve(e)})}):(i.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["invalid mediaEntry for download: ",""])),g.error),{fullsizePromise:Promise.resolve(g),previewPromise:Promise.resolve(g)})}async function C(e,t,n){var r=await e;if(!r.success)return Promise.resolve(r);var a=await o("WAValidateMedia").validateMedia(r.value.plaintext,n);return a.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:t,serverMediaType:r.value.serverMediaType,unvalidatedMimeType:r.value.mimeType,validatedResult:a.value}):a}async function b(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.logger,i=e.mediaDownloadFlow,l=e.mediaEntries,s=e.msgIdOfRecentMediaEntry,u=e.recentMediaEntry,d=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:a,mediaDownloadFlow:i,mediaEntry:u}),m=d.logDownloadResult,p={abortSignal:t,dbCallbacks:n,logger:a,mediaDownloadFlow:i,mediaEntries:l,msgIdOfRecentMediaEntry:s,recentMediaEntry:u},_=await v(babelHelpers.extends({},p,{fullSizePlaintextHash:r}));if(_.success){var f=_.value,g=f.fullsizePromise,h=f.previewPromise,y=g.then(function(e){return e.success?e:(i.addPoint("fallback_to_non_streaming_download",{string:{streaming_fallback_reason:e.error}}),o("WADownloadFullSizeOnlyTask").downloadOrRestoreFullSize(p))}),b=[s,u];return o("WAResultOrError").makeResult({fullsizePromise:m(C(y,b,i)),previewPromise:C(h,b,i)})}var R=L(_.error);if(!R.shouldFallback)return o("WAResultOrError").makeError(R.error);i.addPoint("fallback_to_non_streaming_download",{string:{streaming_fallback_reason:R.error}}),a.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["fallback to non-streaming download"])));var E=C(o("WADownloadFullSizeOnlyTask").downloadOrRestoreFullSize(p),[s,u],i),k=S(babelHelpers.extends({},p,{fullSizePlaintextHash:r,fullsizePromise:E}));return o("WAResultOrError").makeResult({fullsizePromise:m(E),previewPromise:k})}async function v(e){var t,n=e.abortSignal,a=e.dbCallbacks,i=e.logger,l=e.mediaDownloadFlow,s=e.mediaEntries,u=e.msgIdOfRecentMediaEntry,c=e.recentMediaEntry,g=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");g&&l.addPoint("forcing_eb_download");var h=c.directPath,y=c.fileEncSha256,C=c.fileSha256,b=c.mediaKey,v=c.serverMediaType,S=(t=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(c).value)!=null?t:null;if(S==null||c.serverMediaType!=="image"||!o("WAMediaUtils").isTransformStreamSupported()||r("UserAgent").isBrowser("Safari < 18")||r("UserAgent").isBrowser("Mobile Safari < 18"))return c.serverMediaType==="image"&&S==null&&(i.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["skip pjpeg streaming because pjpeg metadata is null"]))),i.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["media entry: ",""])),c)),o("WAResultOrError").makeError("jpeg-stream-not-supported");l.addPoint("media_streaming_start");var L=g?o("WAResultOrError").makeError("signature-expired"):await o("WADownloadProgressiveJpegUsingMediaStreaming").downloadProgresiveJpegUsingMediaStreaming({abortSignal:n,directPath:h,downloadFlow:l,fileEncSha256:y,fileSha256:C,logger:i,mediaKey:b,progressiveJpegDetails:S,serverMediaType:v}).catch(function(e){return i.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["downloadProgresiveJpegUsingMediaStreaming unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});if(L.success)return l.addPoint("media_streaming_end"),L;if(!o("WAIsMediaExpiredError").isMediaExpiredError(L.error)||!r("MAWEBSwitch").isEnabled())return R(l,L),L;var E=await a.getProtocolMsgIdAndSortOrderMs(u);if(E==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var k=E.protocolMsgId,I=E.sortOrderMs,T=c,D=u,x=T.fileEncSha256,$=T.fileSha256,P=T.mediaKey,N=T.serverMediaType,M=o("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(N);if(M==null||T.objectId==null)return i.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and can not restore: ",""])),L.error),L;var w=await o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:T.objectId,logger:i,mediaDownloadFlow:l,mediaKey:T.mediaKey,mediaType:M,msgId:D,protocolMsgId:k,sortOrderMs:I});if(!w.success)return w;l.addPoint("second_media_streaming_start");var A=await o("WADownloadProgressiveJpegUsingMediaStreaming").downloadProgresiveJpegUsingMediaStreaming({abortSignal:n,directPath:w.value,downloadFlow:babelHelpers.extends({},l,{addPoint:function(t,n){l.addPoint("second_"+t,n)}}),fileEncSha256:x,fileSha256:$,logger:i,mediaKey:P,progressiveJpegDetails:S,serverMediaType:N}).catch(function(e){return i.ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["downloadProgresiveJpegUsingMediaStreaming unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});return A.success?(l.addPoint("second_media_streaming_end"),A):(R(l,A),A)}function S(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.fullsizePromise,i=e.logger,l=e.mediaDownloadFlow,s=e.mediaEntries,u=e.msgIdOfRecentMediaEntry,c=e.recentMediaEntry,d=c.serverMediaType,m=o("WAIsPreviewSupported").checkPreviewSupport(c),p=m[0],_=m[1];if(p===o("WAIsPreviewSupported").PjpegPreviewSupport.NO&&_===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return i.LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["preview not supported"]))),Promise.resolve(o("WAResultOrError").makeError("preview-not-supported"));if(_===o("WAIsPreviewSupported").DownloadablePreviewSupport.DuplicatedWithFullSize)return i.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["preview duplicated with fullsize"]))),a;var f=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:l.downloadEntry,isPreview:!0,msgType:null,protocolMsgId:null,triggerUIView:null}),y=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:i,mediaDownloadFlow:f,mediaEntry:c}),b=y.logDownloadResult;f.addAnnotations({bool:{isMediaManager:!0},string:{downloadKind:"fullsizeAndPreview",fullSizeMediaType:d,mediaType:"preview",sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)}});var v=o("WADownloadPreviewOnlyTask").downloadOrRestorePreviewOnly({abortSignal:t,dbCallbacks:n,fullSizePlaintextHash:r,logger:i,mediaDownloadFlow:f,mediaEntries:s,msgIdOfRecentMediaEntry:u,recentMediaEntry:c});return b(C(v,[u,c],f)).then(function(e){return e.success?f.endSuccess():f.endFail(e.error,{string:{failReason:e.error}}),e}).catch(function(e){return f.endFail("runtime-error",{string:{failReason:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WAResultOrError").makeError("runtime-error")})}function R(e,t){e.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:o("WAErrorMessage").maybeGetMessageFromError(t.error)}})}function L(e){switch(e){case"runtime-error":case"jpeg-stream-not-supported":return{error:e,shouldFallback:!0};case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return{error:e,shouldFallback:!0};case"missing-media-entry":case"missing-media-entry-for-restore":case"missing-sort-order-ms-for-restore":case"preview-not-supported":return{error:e,shouldFallback:!1};case"derive-primary-key-secret-error":case"derive-access-token-secret-error":case"direct-path-undefined":case"direct-path-corrupted":case"direct-path-empty":case"create-payload-failed":case"resign-cdn-url-request-error":case"resign-cdn-url-runtime-error":case"resign-cdn-url-timeout":case"resign-cdn-url-gql-error":return{error:e,shouldFallback:!1};case"invalid-media":return{error:e,shouldFallback:!1};case"decryption-error":case"enc-hash-mismatch":case"hash-mismatch":case"ciphertext-hash-mismatch":return{error:e,shouldFallback:!0};case"access-expired":case"disconnected":case"backoff":case"body-network-error":case"http-fetch-exception":case"http-fetch-aborted":case"no-host":case"server-timeout":case"unspecified-http-error":case"media-not-found":case"download-throttled":case"request-error":case"max-attempts-exceeded":case"signature-expired":case"media-entry-invalid":return{error:e,shouldFallback:!1};case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":return{error:e,shouldFallback:!1}}}l.startDownloadFullSizeAndPreviewTask=y}),98);
__d("WAMediaManagerLogger",["WAHashUtils","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WATagsLogger").TAGS(["MediaManager"]);function s(t){var n=t.downloadKind,r=t.fullSizePlaintextHash,a=e.TAGS(["download","hash:"+o("WAHashUtils").sanitisePlaintextHash(r),n]);return a}function u(t){var n=t.plaintextHash,r=t.uploadKind,a=e.TAGS(["upload","hash:"+o("WAHashUtils").sanitisePlaintextHash(n),r]);return a}l.baseLogger=e,l.createDownloadLogger=s,l.createUploadLogger=u}),98);
__d("WAMediaManagerTypes",["WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.success?o("WAResultOrError").makeResult({serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.unvalidatedMimeType,validatedResult:e.value.validatedResult}):e}l.transformInternalMediaDownloadResult=e}),98);
__d("WAMediaManagerWorkerScheduler",["WorkerScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return e==null&&(e=o("WorkerScheduler").makeScheduler("MediaManager",{concurrency:16,maxTaskLimit:32,maxThrottleMs:3e4,timeoutMs:6e4})),e}l.mediaManagerWorkerScheduler=s}),98);
__d("WACreateRetrier",["WAComms","WAGetMediaRoute","WAMediaOperationsRetrier","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t){var n=await o("WAGetMediaRoute").getMediaRoute({operation:"upload",serverMediaType:e},t);if(!n.success)return n;var r=n.value,a=r.selectedHost,i=r.fallbackHost,l=r.authToken,s=new(o("WAMediaOperationsRetrier")).MediaOperationsRetrier("upload",{host:{domain:a.domain,class:a.class},fallbackHost:i&&{domain:i.domain,class:i.class},authToken:l,timeElapsed:null},o("WAComms").waitForConnection);return o("WAResultOrError").makeResult(s)}l.createUploadRetrier=e}),98);
__d("WAHttpRegularUploadMedia",["WADirectPath","WALogger","WAResultOrError","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,n){var a;try{a=await fetch(t,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"text/plain"},body:new Blob([n])})}catch(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to initiate fetch ",""])),t),t}var i=a,l=i.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""])),l),l){case 200:return a.json().then(function(e){if(!Object.prototype.hasOwnProperty.call(e,"direct_path"))throw r("err")("direct_path not available in wa upload http response");if(typeof e.direct_path!="string")throw r("err")('directPath: "'+e.direct_path+'" is not a string');if(e.object_id&&typeof e.object_id!="string")throw r("err")('objectId: "'+e.object_id+'" is not a string');if(e.handle&&typeof e.handle!="string")throw r("err")('handle: "'+e.handle+'" is not a string');var t={directPath:o("WADirectPath").unsafeCastToDirectPath(e.direct_path),objectId:e.object_id,handle:e.handle};return o("WAResultOrError").makeResult(t)}).catch(function(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to parse request body ",""])),e),o("WAResultOrError").makeError("body-network-error")});case 408:return o("WAResultOrError").makeError("server-timeout");case 413:return o("WAResultOrError").makeError("payload-too-large");case 415:return o("WAResultOrError").makeError("invalid-media");case 429:case 507:return o("WAResultOrError").makeError("upload-throttled");default:return l>=400&&l<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}l.httpRegularUploadMedia=c}),98);
__d("WAHttpResumeCheck",["WADirectPath","WALogger","WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m;async function p(t){var n;try{n=await fetch(t,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"text/plain"}})}catch(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to initiate fetch ",""])),t),t}var r=n,a=r.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: response status ",""])),a),a){case 200:return n.json().then(function(e){var t=e.resume,n=e.direct_path,r=e.object_id;if(t==="complete")return n==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: direct_path is missing"]))),o("WAResultOrError").makeResult({type:"media-not-found"})):r==null?(o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: object_id is missing"]))),o("WAResultOrError").makeResult({type:"media-not-found"})):o("WAResultOrError").makeResult({type:"media-found",directPath:o("WADirectPath").unsafeCastToDirectPath(n),objectId:o("WAMediaUtils").stringToDeliveryObjectId(r)});var a=parseInt(t,10);return a===0?o("WAResultOrError").makeResult({type:"media-not-found"}):Number.isNaN(a)?(o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: resume is NaN: ",""])),t),o("WAResultOrError").makeResult({type:"media-not-found"})):o("WAResultOrError").makeResult({type:"media-partial-found",resumeFromBytes:a})}).catch(function(e){return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to parse request body ",""])),e),o("WAResultOrError").makeError("body-network-error")});case 404:return o("WAResultOrError").makeResult({type:"media-not-found"});case 408:return o("WAResultOrError").makeError("server-timeout");case 429:case 507:return o("WAResultOrError").makeError("upload-throttled");default:return a>=400&&a<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}l.httpResumeCheck=p}),98);
__d("WAEncryptAndUploadPlaintext",["WABase64","WAErrorMessage","WAGlobals","WAHttpRegularUploadMedia","WAHttpResumeCheck","WALogger","WAMediaCrypto","WAMediaUrl","WAProgressiveJpegGetPJpegDetails","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;async function f(t){var n=t.serverMediaType,r=t.plaintextHash,a=t.plaintext,i=t.mediaKey,l=t.mediaKeyTimestamp,f=t.uploadToken,g=t.uploadRetrier,h=t.mediaUploadFlow,y=t.fromOffset,C=y===void 0?0:y;h.addPoint("encrypt_and_upload_plaintext_start"),h.addPoint("compute_media_keys_start");var b=n==="preview"?await o("WAMediaCrypto").computeMediaKeysForPreview(i):await o("WAMediaCrypto").computeMediaKeys(i,n),v=b.iv,S=b.cipherKey,R=b.hmacKey;h.addPoint("compute_media_keys_end"),h.addPoint("encrypt_and_hmac_start");var L=await o("WAMediaCrypto").encryptAndHmac(S,v,R,a,n),E=L.ciphertext,k=L.ciphertextHash,I=L.sidecar,T=L.ivCiphertextHmac;h.addPoint("encrypt_and_hmac_end");var D=null;if(n==="image"){h.addPoint("get_progressive_jpeg_details_start");var x=await o("WAProgressiveJpegGetPJpegDetails").getProgressiveJpegDetails(new Uint8Array(a),T,R),$=o("WAProgressiveJpegGetPJpegDetails").isValidProgressiveJpegDetails(x);$.success===!1?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Created invalid progressiveJpeg details during encrypt and upload: ",""])),$.error),h.addPoint($.error)):$.value===!0&&o("WAGlobals").getConfig().isProgressiveJpegSendEnabled()&&(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Found valid progressiveJpeg details. Adding to media entry."]))),D=x,h.addPoint("get_progressive_jpeg_details_end"))}var P={fileSha256:o("WABase64").decodeB64UrlSafe(r),fileEncSha256:k,mediaKey:i,mediaKeyTimestamp:l,serverMediaType:n,uploadToken:f,sidecar:I,progressiveJpegDetails:D,size:a.byteLength,filename:void 0,lastDownloadAttemptTimestamp:void 0,directPath:void 0},N,M=await g.run(async function(e,t,r){var a=e.domain,i=C;if(r>0){h.addPoint("network_retry",{int:{network_retry_attempt:r}});try{h.addPoint("resume_check_start");var l=o("WAMediaUrl").buildUploadUrl(n,f,k,a,t,!0),s=await o("WAHttpResumeCheck").httpResumeCheck(l);if(s.success){h.addPoint("resume_check_end");var p=s.value;if(p.type==="media-found")return h.addAnnotations({bool:{existingMediaFound:!0}}),o("WAResultOrError").makeResult(o("WAResultOrError").makeResult({directPath:p.directPath,objectId:null,handle:null}));p.type==="media-partial-found"&&(i=p.resumeFromBytes)}h.addPoint("resume_check_fail",{string:{resume_check_error:s.error}})}catch(e){h.addPoint("resume_check_fail",{string:{resume_check_error:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: error during retrier ",""])),e)}}i>0&&i<E.byteLength?(h.addAnnotations({int:{fromOffset:i},bool:{continuedFromOffset:!0}}),N=E.subarray(i)):N=E;var _=o("WAMediaUrl").buildUploadUrl(n,f,k,a,t,!1,i);return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: start upload media to ",""])),_),h.addPoint("http_upload_start"),o("WAHttpRegularUploadMedia").httpRegularUploadMedia(_,N).then(function(e){if(e.success)return h.addPoint("http_upload_end",{int:{attempt:r}}),o("WAResultOrError").makeResult(e);var t=e.error;switch(h.addPoint("http_upload_fail",{string:{http_upload_error:t}}),o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""])),t),t){case"server-timeout":case"unspecified-http-error":return o("WAResultOrError").makeError({progressMade:!0});default:return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(t))}}).catch(function(e){var t=o("WAErrorMessage").maybeGetMessageFromError(e);return h.addPoint("http_upload_fail",{string:{http_upload_error:t}}),o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""])),t),o("WAResultOrError").makeError({progressMade:!1})})});if(M==null)return o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded");if(M.success===!1)return M;var w=M.value,A=w.directPath,F=w.objectId,O=w.handle,B=babelHelpers.extends({},P,{directPath:A,handle:O,objectId:F});return o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: upload success "," ",""])),{directPath:A},{objectId:F}),h.addPoint("encrypt_and_upload_plaintext_end"),o("WAResultOrError").makeResult(B)}l.encryptAndUploadPlaintext=f}),98);
__d("WAUploadMediaQuick",["WACreateRetrier","WAEncryptAndUploadPlaintext","WAMediaUtils","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=t.mediaUploadFlow,r=t.plaintext,a=t.plaintextHash,i=t.serverMediaType,l=t.logger;l.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start uploadMediaQuick"]))),n.addPoint("create_upload_retrier_start");var s=await o("WACreateRetrier").createUploadRetrier(i,n);if(!s.success)return n.addPoint("create_upload_retrier_fail"),s;n.addPoint("create_upload_retrier_end"),n.addPoint("create_media_key_start");var u=o("WAMediaUtils").createMediaKey(),c=o("WAMediaUtils").createUploadToken(),d=o("WATimeUtils").unixTime();n.addPoint("create_media_key_end");var m=await o("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({mediaKey:u,mediaKeyTimestamp:d,serverMediaType:i,mediaUploadFlow:n,plaintext:r,plaintextHash:a,uploadRetrier:s.value,uploadToken:c});return m}l.uploadMediaQuick=s}),98);
__d("mapWorkerSchedulerTask",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return babelHelpers.extends({},e,{promise:e.promise.then(t),run:function(){return e.run().then(t)}})}i.mapWorkerSchedulerTask=e}),66);
__d("WAMediaManager",["$InternalEnum","WADownloadFullSizeAndPreviewTask","WADownloadFullSizeOnlyTask","WADownloadPreviewOnlyTask","WAErrorMessage","WAHashUtils","WAMediaManagerCache","WAMediaManagerLogger","WAMediaManagerTypes","WAMediaManagerWorkerScheduler","WAResultOrError","WATimeUtils","WAUploadMediaQuick","WorkerScheduler","gkx","justknobx","mapWorkerSchedulerTask"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S=n("$InternalEnum").Mirrored(["HIGH","MEDIUM","LOW"]);function R(){return{fullsizeCache:new Map,previewCache:new Map,uploadCache:new Map}}function L(t){var n=t.createCacheState,a=t.dbCallbacks,i=o("WAMediaManagerWorkerScheduler").mediaManagerWorkerScheduler(),l=o("WAMediaManagerCache").createAttachmentCache(a.getProtocolMsgIdAndSortOrderMs,n),v=function(n){var t=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"fullsize",fullSizePlaintextHash:n.fullSizePlaintextHash}),r=l.getFullsize(n);if(t.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),r.type),r.type==="cache-hit")return r.cache;var c=new AbortController,d=i.task({fn:function(){return o("WADownloadFullSizeOnlyTask").startDownloadFullSizeTask({abortSignal:c.signal,dbCallbacks:a,fullSizePlaintextHash:n.fullSizePlaintextHash,logger:t,mediaDownloadFlow:n.mediaDownloadFlow})},name:"media-manager-download-fullsize-only",priority:E(n.priority)}),m=d.run();return r.setDownloadCache({abortController:c,fullSizePlaintextHash:n.fullSizePlaintextHash,mediaDownloadFlow:n.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(d,function(e){return e.fullsizePromise})}),m.then(function(e){return e.fullsizePromise}).then(function(e){return $(n.fullSizePlaintextHash,e,r.setDownloadedAttachmentToUploadCache)}).catch(function(e){return t.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){t.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["end"])))})},S=function(t){var e=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"preview",fullSizePlaintextHash:t.fullSizePlaintextHash}),n=l.getPreview(t);if(e.DEV(c||(c=babelHelpers.taggedTemplateLiteralLoose(["",""])),n.type),n.type==="cache-hit")return n.cache;var r=new AbortController,s=i.task({fn:function(){return o("WADownloadPreviewOnlyTask").startDownloadPreviewTask({abortSignal:r.signal,dbCallbacks:a,fullSizePlaintextHash:t.fullSizePlaintextHash,logger:e,mediaDownloadFlow:t.mediaDownloadFlow})},name:"media-manager-download-preview-only",priority:E(t.priority)});n.setDownloadCache({abortController:r,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(s,function(e){return e.previewPromise})});var u=s.run();return u.then(function(e){return e.previewPromise}).then(function(e){return P(e,n.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["end"])))})},R=function(t){var e=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"fullsizeAndPreview",fullSizePlaintextHash:t.fullSizePlaintextHash}),n=l.getFullsizeAndPreview(t),r=n.fullsizeCacheResult,s=n.previewCacheResult;if(e.DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["fullsize: ",", preview: ",""])),r.type,s.type),r.type==="cache-hit"&&s.type==="cache-hit")return{fullsizePromise:r.cache,previewPromise:s.cache};if(s.type==="cache-hit"){var u=v(t);return{fullsizePromise:u,previewPromise:s.cache}}if(r.type==="cache-hit"){var c=S(t);return{fullsizePromise:r.cache,previewPromise:c}}r.type,s.type;var d=new AbortController,m=i.task({fn:function(){return o("WADownloadFullSizeAndPreviewTask").startDownloadFullSizeAndPreviewTask({abortSignal:d.signal,dbCallbacks:a,fullSizePlaintextHash:t.fullSizePlaintextHash,logger:e,mediaDownloadFlow:t.mediaDownloadFlow})},name:"media-manager-download-fullsize-and-preview",priority:E(t.priority)});r.setDownloadCache({abortController:d,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(m,function(e){return e.fullsizePromise})}),s.setDownloadCache({abortController:d,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(m,function(e){return e.previewPromise})});var y=m.run();return{fullsizePromise:y.then(function(e){return e.fullsizePromise}).then(function(e){return $(t.fullSizePlaintextHash,e,r.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["fullsizePromise runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(f||(f=babelHelpers.taggedTemplateLiteralLoose(["fullsize end"])))}),previewPromise:y.then(function(e){return e.previewPromise}).then(function(e){return P(e,s.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["previewPromise runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["preview end"])))})}},L=x(),k=L.isInMemoryMediaUploadCache,I=function(t){var e=o("WAMediaManagerLogger").createUploadLogger({plaintextHash:t.plaintextHash,uploadKind:"fullsize"}),n;if(r("gkx")("19103")&&(n=l.getUploadedAttachment(t),e.DEV(y||(y=babelHelpers.taggedTemplateLiteralLoose(["cache result: ",""])),n.type),t.mediaUploadFlow.addAnnotations({string:{dedupe_result:n.type}}),n.type==="in-thread-cache-hit"))return n.cache;if(r("justknobx")._("4810")){var a=k({chatJid:t.chatJid,plaintextHash:t.plaintextHash});t.mediaUploadFlow.addAnnotations({bool:{is_cross_thread_dedupe_candidate:a==="cross-thread",is_in_thread_dedupe_candidate:a==="in-thread"}})}var i=o("WAUploadMediaQuick").uploadMediaQuick({logger:e,mediaUploadFlow:t.mediaUploadFlow,plaintext:t.plaintext,plaintextHash:t.plaintextHash,serverMediaType:t.serverMediaType}).catch(function(t){return e.ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(b||(b=babelHelpers.taggedTemplateLiteralLoose(["upload end"])))});return n!=null&&r("gkx")("19103")&&n.setUploadCache({chatJid:t.chatJid,plaintextHash:t.plaintextHash,scheduledTask:i}),i};return{clearCache:l.clearCache,dequeueDownload:l.cancelTask,enqueueDownloadFullSize:T("fullsize",v),enqueueDownloadFullSizeAndPreview:T("fullsizeAndPreview",R),enqueueDownloadPreview:T("preview",S),enqueueUploadFullSize:D(I)}}function E(e){return e===S.HIGH?o("WorkerScheduler").BLOCKING_PRIORITY:e===S.MEDIUM?o("WorkerScheduler").REGULAR_PRIORITY:e===S.LOW?o("WorkerScheduler").BACKGROUND_PRIORITY:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}var k=typeof((v=navigator.storage)==null?void 0:v.getDirectory)=="function",I=typeof self.caches=="object";function T(e,t){return function(n){var r=n.fullSizePlaintextHash,a=n.mediaDownloadFlow;try{a.addPoint("enqueue_start",{bool:{isOPFSSupported:k,isWebCacheSupported:I},string:{downloadKind:e,sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)}});var i=t(n);return a.addPoint("enqueue_end"),i}catch(e){throw a.addPoint("enqueue_fail"),e}}}function D(e){return function(t){var n=t.mediaUploadFlow,r=t.plaintextHash;try{n.addPoint("enqueue_start",{string:{sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)}});var a=e(t);return n.addPoint("enqueue_end"),a}catch(e){throw n.addPoint("enqueue_fail"),e}}}function x(){var e=new Map;return{isInMemoryMediaUploadCache:function(n){var t=n.chatJid,r=n.plaintextHash,a=e.get(r);if(a==null)return a=new Map,e.set(r,a),a.set(t,o("WATimeUtils").futureUnixTime(2*o("WATimeUtils").DAY_SECONDS)),"no-cache";var i=a.get(t);if(i!=null&&o("WATimeUtils").isInFuture(i))return"in-thread";var l=!1;for(var s of a){var u=s[1];if(o("WATimeUtils").isInFuture(u)){l=!0;break}}return a.set(t,o("WATimeUtils").futureUnixTime(2*o("WATimeUtils").DAY_SECONDS)),l?"cross-thread":"no-cache"}}}function $(e,t,n){if(!t.success)return t;if(r("gkx")("19103")===!1)return o("WAMediaManagerTypes").transformInternalMediaDownloadResult(t);var a=t.value.msgIdAndMediaEntry,i=a[0],l=a[1];return n({mediaEntry:l,msgId:i,plaintextHash:e}),o("WAMediaManagerTypes").transformInternalMediaDownloadResult(t)}function P(e,t){if(!e.success)return e;if(r("gkx")("19103")===!1)return o("WAMediaManagerTypes").transformInternalMediaDownloadResult(e);var n=e.value.msgIdAndMediaEntry,a=n[0],i=n[1],l=i.downloadableThumbnail;return l==null||l.directPath==null||l.fileEncSha256==null||l.fileSha256==null||l.mediaKey==null||l.mediaKeyTimestamp==null||l.objectId==null||t({mediaEntry:babelHelpers.extends({},i,{directPath:l.directPath,downloadableThumbnail:null,fileSha256:l.fileSha256,mediaKey:l.mediaKey,mediaKeyTimestamp:l.mediaKeyTimestamp,objectId:l.objectId,serverMediaType:"preview",size:e.value.validatedResult.validatedPlaintext.byteLength}),msgId:a,plaintextHash:o("WAHashUtils").toPlaintextHash(l.fileSha256)}),o("WAMediaManagerTypes").transformInternalMediaDownloadResult(e)}l.MediaTaskPriority=S,l.createCacheState=R,l.createMediaManager=L,l.toWorkerSchedulerPriority=E}),98);
__d("WAMediaManagerCache",["Promise","WAErrorMessage","WAHashUtils","WAMediaManager","WAMediaManagerLogger","WAMediaManagerTypes","WAPromiseDelays","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=["mediaKeyTimestamp","objectId","size"],s,u,c,d,m,p,_,f=3e4,g=1e3*60*60*24*2;function h(e,t){t===void 0&&(t=o("WAMediaManager").createCacheState);var r=t(),a=r.fullsizeCache,i=r.previewCache,l=r.uploadCache,h=function(t){var e=t.abortController,n=t.fullSizePlaintextHash,r=t.mediaDownloadFlow,i=t.scheduledTask;a.set(n,{abortController:e,mediaDownloadFlow:r,task:i}),i.promise.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(f):void 0}).finally(function(){a.delete(n)})},b=function(t){var e=t.abortController,n=t.fullSizePlaintextHash,r=t.mediaDownloadFlow,a=t.scheduledTask;i.set(n,{abortController:e,mediaDownloadFlow:r,task:a}),a.promise.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(f):void 0}).finally(function(){i.delete(n)})},v=function(t){var e=t.chatJid,n=t.plaintextHash,r=t.scheduledTask,a=t.cacheTtlMs,i=a===void 0?g:a,s=l.get(n)||new Map;s.set(e,r),l.set(n,s),r.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(i):void 0}).finally(function(){l.delete(n)})},S=function(r){var t=r.mediaEntry,a=r.msgId,i=r.plaintextHash;e(a).then(function(e){if(e==null){o("WAMediaManagerLogger").baseLogger.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["missing chatJid, skip setDownloadedAttachmentToUploadCache"])));return}var r=e.protocolMsgId.chat,a=C(t);if(a==null){o("WAMediaManagerLogger").baseLogger.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["can not covert mediaEntry from download to upload for cache"])));return}var l=o("WATimeUtils").timeoutFor(a.mediaKeyTimestamp,g/1e3);if(l!==0){var c=o("WATimeUtils").pastUnixTime(o("WATimeUtils").DAY_SECONDS,a.mediaKeyTimestamp);o("WATimeUtils").isInFuture(c)||v({cacheTtlMs:l,chatJid:r,plaintextHash:i,scheduledTask:(_||(_=n("Promise"))).resolve(o("WAResultOrError").makeResult(a))})}}).catch(function(e){o("WAMediaManagerLogger").baseLogger.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["setDownloadedAttachmentToUploadCache getProtocolMsgIdAndSortOrderMs: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e))})};return{cancelTask:function(t){var e=o("WAMediaManagerLogger").baseLogger.TAGS(["hash:"+o("WAHashUtils").sanitisePlaintextHash(t),"cancelTask"]);e.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["start"])));var n=[a,i];for(var r of n){var l=r.get(t);if(l!=null){var s=l.task.cancel();l.mediaDownloadFlow.addPoint("cancel_download_triggered"),s===!1?(l.abortController.abort(),l.mediaDownloadFlow.addPoint("http_abort_cancel"),e.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["http abort cancel"])))):(l.mediaDownloadFlow.addPoint("worker_task_cancel_cancel"),e.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["worker task cancel"])))),r.delete(t)}}},clearCache:function(){i.clear(),a.clear(),l.clear()},getFullsize:function(t){var e=a.get(t.fullSizePlaintextHash);return e!=null?(y(t.mediaDownloadFlow,"hit","fullsize"),e.task.promote(o("WAMediaManager").toWorkerSchedulerPriority(t.priority)),{cache:e.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}):(y(t.mediaDownloadFlow,"miss","fullsize"),{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"})},getFullsizeAndPreview:function(t){var e=o("WAMediaManager").toWorkerSchedulerPriority(t.priority),n=a.get(t.fullSizePlaintextHash),r=i.get(t.fullSizePlaintextHash);return n!=null&&r!=null?(y(t.mediaDownloadFlow,"hit","fullsize-and-preview"),n.task.promote(e),r.task.promote(e),{fullsizeCacheResult:{cache:n.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"},previewCacheResult:{cache:r.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}}):n!=null?(y(t.mediaDownloadFlow,"hit","fullsize"),n.task.promote(e),{fullsizeCacheResult:{cache:n.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"},previewCacheResult:{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"}}):r!=null?(y(t.mediaDownloadFlow,"hit","preview"),r.task.promote(e),{fullsizeCacheResult:{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"},previewCacheResult:{cache:r.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}}):(y(t.mediaDownloadFlow,"miss","fullsize-and-preview"),{fullsizeCacheResult:{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"},previewCacheResult:{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"}})},getPreview:function(t){var e=i.get(t.fullSizePlaintextHash);return e!=null?(y(t.mediaDownloadFlow,"hit","preview"),e.task.promote(o("WAMediaManager").toWorkerSchedulerPriority(t.priority)),{cache:e.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}):(y(t.mediaDownloadFlow,"miss","preview"),{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"})},getUploadedAttachment:function(t){var e=l.get(t.plaintextHash);if(e==null)return{setUploadCache:v,type:"cache-miss-no-plaintext-hash"};var n=e.get(t.chatJid);return n==null?{setUploadCache:v,type:"cache-miss-no-thread"}:{cache:n,type:"in-thread-cache-hit"}}}}function y(e,t,n){e.addAnnotations({string:{media_manager_cache_result:t,media_manager_cache_type:n}})}function C(t){var n=t.mediaKeyTimestamp,r=t.objectId,o=t.size,a=babelHelpers.objectWithoutPropertiesLoose(t,e);return n==null||r==null||o==null?null:babelHelpers.extends({},a,{mediaKeyTimestamp:n,objectId:r,size:o})}l.DOWNLOAD_TASK_CACHE_TTL_MS=f,l.UPLOAD_TASK_CACHE_TTL_MS=g,l.createAttachmentCache=h}),98);
__d("blobToDataUri",["err"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=new FileReader,n=new Promise(function(e,n){t.onloadend=e,t.onerror=n});t.readAsDataURL(e),await n;var o=t.result;if(typeof o!="string")throw r("err")('Unexpected result type "%s" when reading Blob as DataURL.',o instanceof ArrayBuffer?"ArrayBuffer":typeof o);return o}l.default=e}),98);
__d("MAWGetThumbnailBlobDataUrlByMediaIdApi",["MAWCreateMaybeAddPointForMediaRender","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWIndexedDb","MAWMaybeWithTimeout","MAWMediaManager","MAWMediaPreviewDownloadManager","MAWMpsGating","MAWTransactionMode","MWFBLogger","WAErrorMessage","WAHashUtils","WAMediaManager","WAResultOrError","WAStartMediaDownloadQplFlow","blobToDataUri"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D=o("MWFBLogger").MWMediaLogger().tags(["getThumbnailBlobDataUrlByMediaId"]),x=async function(n,a,i){D.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Get thumbnail blob for "," from , from ",""])),n,a);var t=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(i),l={string:{description:a,fetch_by:"mediaId"}};t("fetch_thumbnail_blob_api_start",l),t("get_media_from_db_start",l);var g=await M(n);if(t("get_media_from_db_finish",{bool:{db_media_found:g!=null}}),g==null)throw D.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No media found for ",""])),n),t("fetch_thumbnail_blob_api_fail_no_media_found_in_db",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because media is not in the media db. mediaId is %s, from %s",n,a);var h=A(g);if(h.success===!0){D.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Found jpegThumbnail entry for ",""])),n),t("fetch_thumbnail_blob_api_success",l);var y=await r("blobToDataUri")(h.value);if(!y)throw D.MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),n),t("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",n,a);return D.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),n),y}var C=h.error;switch(C){case"missing_jpeg_thumbnail":if(g.mediaType===o("MAWDbMedia").MEDIA_TYPE.IMAGE||g.mediaType===o("MAWDbMedia").MEDIA_TYPE.VIDEO){var b=await P(g,i);if(b!=null){t("fetch_thumbnail_blob_api_success",l);var v=await r("blobToDataUri")(b);if(!v)throw D.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),n),t("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",n,a);return D.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),n),v}if((g==null?void 0:g.mediaType)===o("MAWDbMedia").MEDIA_TYPE.VIDEO)throw t("fetch_thumbnail_blob_api_fail_not_able_to_generate_video_thumbnail_on_the_fly",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId in time (for video). mediaId is %s, from %s",n,a);var S=await N(g,i);if(S==null)throw t("fetch_thumbnail_blob_api_fail_not_able_to_generate_image_thumbnail_on_the_fly",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId in time or to generate thumnbail on the fly. mediaId is %s, from %s",n,a);t("fetch_thumbnail_blob_api_success",l);var R=await r("blobToDataUri")(S);if(!R)throw D.MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),n),t("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",n,a);return D.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),n),R}throw t("fetch_thumbnail_blob_api_fail_missing_thumbnail",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media (missing_jpeg_thumbnail). mediaId is %s, from %s",n,a);case"invalid_media":throw t("fetch_thumbnail_blob_api_fail_invalid_media",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media. mediaId is %s, from %s",n,a)}},$=async function(t,n,a){var e=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(a),i={string:{description:n,fetch_by:"hashedPlaintextHash"}};if(e("fetch_thumbnail_blob_api_start",i),D.DEBUG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Get thumbnail blob for "," from ",""])),o("WAHashUtils").sanitisePlaintextHash(t),n),o("MAWMpsGating").isMpsMessageRendering()){var l=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"UILayout",msgType:null,protocolMsgId:null,triggerUIView:null}),s=await o("MAWMediaManager").getMawMediaManager(),u=s.enqueueDownloadFullSizeAndPreview({fullSizePlaintextHash:t,mediaDownloadFlow:l,priority:o("WAMediaManager").MediaTaskPriority.HIGH}),c=await u.previewPromise;if(c.success){var d;l.endSuccess();var m=c.value.validatedResult.validatedPlaintext,p=new Blob([m],{type:(d=c.value.validatedResult.mimeType)!=null?d:void 0}),_=await r("blobToDataUri")(p);return _}if(c.error!=="preview-not-supported")throw l.endFail(c.error,{string:{failReason:c.error}}),o("MWFBLogger").MPSLogger().mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash. plaintextHash is %s, from %s, error: %s",o("WAHashUtils").sanitisePlaintextHash(t),n,c.error);var f=await u.fullsizePromise;if(f.success){var E;l.endSuccess();var k=f.value.validatedResult.validatedPlaintext,I=new Blob([k],{type:(E=f.value.validatedResult.mimeType)!=null?E:void 0}),T=await r("blobToDataUri")(I);return T}throw l.endFail(f.error,{string:{failReason:f.error}}),o("MWFBLogger").MPSLogger().mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash. plaintextHash is %s, from %s, error: %s",o("WAHashUtils").sanitisePlaintextHash(t),n,f.error)}var x=await w(t);if(x==null)throw D.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["No media found for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),e("fetch_thumbnail_blob_api_fail_no_media_found_in_db",i),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash because media is not in the media db. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);var $=A(x);if($.success===!0){D.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Found jpegThumbnail entry for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),e("fetch_thumbnail_blob_api_success",i);var M=await r("blobToDataUri")($.value);if(!M)throw D.MUSTFIX(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),e("fetch_thumbnail_blob_api_fail_no_data_uri",i),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);return D.DEBUG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),M}var F=$.error;switch(F){case"missing_jpeg_thumbnail":if(x.mediaType===o("MAWDbMedia").MEDIA_TYPE.IMAGE||x.mediaType===o("MAWDbMedia").MEDIA_TYPE.VIDEO){var O=await P(x,a);if(O!=null){e("fetch_thumbnail_blob_api_success",i);var B=await r("blobToDataUri")(O);if(!B)throw D.MUSTFIX(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),e("fetch_thumbnail_blob_api_fail_no_data_uri",i),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);return D.DEBUG(S||(S=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),B}if((x==null?void 0:x.mediaType)===o("MAWDbMedia").MEDIA_TYPE.VIDEO)throw e("fetch_thumbnail_blob_api_fail_not_able_to_generate_video_thumbnail_on_the_fly",i),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash in time (for video). plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);var W=await N(x,a);if(W==null)throw e("fetch_thumbnail_blob_api_fail_not_able_to_generate_image_thumbnail_on_the_fly",i),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash in time or to generate thumnbail on the fly. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);var q=await r("blobToDataUri")(W);if(!q)throw D.MUSTFIX(R||(R=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),e("fetch_thumbnail_blob_api_fail_no_data_uri",i),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);return D.DEBUG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),q}throw e("fetch_thumbnail_blob_api_fail_missing_thumbnail",i),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media (missing_jpeg_thumbnail). plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);case"invalid_media":throw e("fetch_thumbnail_blob_api_fail_invalid_media",i),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n)}},P=function(t,n){var e=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(n);e("fetch_thumbnail_blob_api_thumbnail_download_start");var r=o("MAWMediaPreviewDownloadManager").getMediaPreviewDownloadingResolvable(t.plaintextHash);return r==null?(e("fetch_thumbnail_blob_api_thumbnail_download_fail_no_resolvable"),Promise.resolve(null)):o("MAWMaybeWithTimeout").maybeWithTimeout(r.promise,1e4,function(){throw D.mustfixThrow("timeout waiting for thumbnail to download")}).then(function(t){return e("fetch_thumbnail_blob_api_thumbnail_download_success"),t}).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return D.MUSTFIX(E||(E=babelHelpers.taggedTemplateLiteralLoose(["Exception when waiting for thumbnail to download: ",""])),n),e("fetch_thumbnail_blob_api_thumbnail_download_fail_exception",{string:{wait_for_thumbnail_download_exception:n}}),null})},N=o("MAWIndexedDb").makeMsgrTransactor({chunk:(T=o("MAWTransactionMode")).READONLY,media:T.READONLY},"generateThumbnailFromMediaChunk",function(e){return function(t,n){var r=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(n);return r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_start"),o("MAWDbChunkTxns").maybeGetChunkFromHash(e,t.hashedPlaintextHash).then(function(e){if(e==null){D.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: unable to get a thumbnail as the media chunk is missing"]))),r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_fail_chunk_missing");return}return D.WARN(I||(I=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: using media chunk as the thumbnail"]))),r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_success"),new Blob([e.blobData],{type:e.mimetype})})}}),M=o("MAWIndexedDb").makeMsgrTransactor({media:T.READONLY},"getFullMedia",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromMediaId(e,t)}}),w=o("MAWIndexedDb").makeMsgrTransactor({media:T.READONLY},"getFullMedia",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(e,t)}}),A=function(t){var e=F(t);if(e.success===!1)return e;var n=e.value.jpegThumbnail;return n!=null?o("WAResultOrError").makeResult(new Blob([n],{type:"image/jpeg"})):o("WAResultOrError").makeError("missing_jpeg_thumbnail")},F=function(t){var e,n;switch(t.mediaType){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:return o("WAResultOrError").makeResult({jpegThumbnail:(e=t.validatedImageInfo)==null?void 0:e.jpegThumbnail});case o("MAWDbMedia").MEDIA_TYPE.VIDEO:return o("WAResultOrError").makeResult({jpegThumbnail:(n=t.validatedVideoInfo)==null?void 0:n.jpegThumbnail});case o("MAWDbMedia").MEDIA_TYPE.PTT:case o("MAWDbMedia").MEDIA_TYPE.STICKER:case o("MAWDbMedia").MEDIA_TYPE.GIF:case o("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return o("WAResultOrError").makeError("invalid_media");default:return t.mediaType,o("WAResultOrError").makeError("invalid_media")}};l.getThumbnailBlobDataUrlByMediaId=x,l.getThumbnailBlobDataUrlByHashedPlaintextHash=$,l.getFullMediaWithPlaintextHash=w}),98);
__d("MAWMediaManager",["MAWGetMostRescentDecodedMediaEntry","MAWGetProtocolMsgIdAndSortOrderMsApi","MAWMpsGating","MpsMediaManager","WAMediaManager","memoize"],(function(t,n,r,o,a,i,l){"use strict";var e=r("memoize")(function(){return o("WAMediaManager").createCacheState()}),s=r("memoize")(function(){return o("MpsMediaManager").getMpsMediaManager(e)}),u=r("memoize")(function(){return o("WAMediaManager").createMediaManager({createCacheState:e,dbCallbacks:{getMediaEntries:o("MAWGetMostRescentDecodedMediaEntry").getMediaEntries,getProtocolMsgIdAndSortOrderMs:o("MAWGetProtocolMsgIdAndSortOrderMsApi").getProtocolMsgIdAndSortOrderMs}})}),c=function(){return o("MAWMpsGating").isMpsMessageRendering()?s():u()};l.getMawMediaManager=c}),98);
__d("WmiChunkApi",["CoalescingLoader","MAWDbChunkTxns","MAWDexieTable","MAWIndexedDb","MAWMediaUtils","MAWTransactionMode","emptyFunction","memoizeWithArgsLFUCache"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READONLY},"wms_getCachedChunkResult",function(e){return function(t){return o("MAWDbChunkTxns").maybeBulkGetChunksFromPlaintextHash(e,t)}}),n=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READWRITE},"wms_storeChunk",function(t){return function(n){return n.map(function(t){return e(t[0])}),o("MAWDexieTable").dexieAll(n.map(function(e){return o("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(t,e[0],e[1],e[2],e[3])})).then(r("emptyFunction"))}}),a=new(o("CoalescingLoader")).CoalescingLoader(async function(n){var r=await t(n);return n.map(function(t){var n=r.get(t);return n==null&&e(t),n})}),i=new(o("CoalescingLoader")).CoalescingLoader(async function(e){return await n(e),[]}),l=r("memoizeWithArgsLFUCache")(function(e){return a.gen(e)},function(e){return e},1,function(t){e=t}),s=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READWRITE},"wms_deleteChunk",function(t){return function(n){n.map(e);var r=n.map(o("MAWMediaUtils").genHMACPlaintextHash);return t.chunk.where("hashedPlaintextHash").anyOf(r).delete()}});return{delete:s,get:l,store:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.gen(t)}}}l.getChunkApi=e}),98);
__d("MediaServiceLogger",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return r("FBLogger")("wmi_media_service",t)};l.MediaServiceLogger=e}),98);
__d("WmiMediaServiceSchema",["MAWWormOdsLogger","MediaServiceLogger","WAHex","Worm","WormEAR","WormIDbDriver","WormMemoryDriver"],(function(t,n,r,o,a,i,l){"use strict";var e={autoIncrement:!0,indexes:{"[plaintextHash+updatedAtMs]":{fields:["plaintextHash","updatedAtMs"],unique:!1},"[threadId+messageId+plaintextHash]":{fields:["threadId","messageId","plaintextHash"],unique:!0}},nonEncryptedFields:["updatedAtMs","messageId"],primaryKey:"pk",secure:!0},s={messageChunk:e};function u(e){var t=e.blockingErrorThreshold,n=e.dbName,r=e.onBlockingError,a=e.qplEvent,i=e.strEncKey,l=o("WAHex").parseHex(i),u="wmi_media_service",c=new(o("WormEAR")).WormEAR(s,u,l),d=new(o("Worm")).WormDatabase(new(o("WormIDbDriver")).WormIDbDriver(n,u,s,c,o("MAWWormOdsLogger").wormOdsWorkerLogger,{blockingErrorThreshold:t,onBlockingError:r,onTransactionError:function(t){if(t instanceof o("WormEAR").DecryptionError){var e=t;o("MediaServiceLogger").MediaServiceLogger().mustfix("EAR decryption error in store: %s. Dropping corrupted entity %s",e.store,e.maybeHashedPk),d.runInTransaction([e.store],"readwrite",function(t){var n=t.stores[e.store];return e.maybeHashedPk!=null?n.delete(e.maybeHashedPk):n.clear()},"delete-corrupted-entity")}}}),a);return d}function c(e){return new(o("Worm")).WormDatabase(new(o("WormMemoryDriver")).WormMemoryDriver(s),e)}l.SCHEMA=s,l.makeSchema=u,l.makeInMemorySchema_TEST_ONLY=c}),98);
__d("WmiMediaServiceDb",["MediaServiceLogger","WAResolvable","WmiMediaServiceSchema","err","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WAResolvable")).Resolvable;async function u(t){try{var n=o("WmiMediaServiceSchema").makeSchema(t);return e=n,await n.init(),s.resolve(n),n}catch(e){throw o("MediaServiceLogger").MediaServiceLogger().catching(r("getErrorSafe")(e)).mustfix("Error performing Media Service init"),e}}function c(){if(e==null)throw r("err")("DB is not initialized");return e}l.makeMediaServiceDb=u,l.getDb=c}),98);
__d("WmiMediaService",["MpsTypes","WmiChunkApi","WmiMediaServiceDb","err","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e,this.$2=o("WmiChunkApi").getChunkApi()}var t=e.prototype;return t.getChunk=async function(t){var e,n=await this.$2.get(t);return n==null?null:{blobData:n.blobData,isProgressivePreview:(e=n.isProgressivePreview)!=null?e:!1,mimetype:n.mimetype,plaintextHash:n.plaintextHash}},t.getMessageChunkForHash=function(t){return this.$1.runInTransaction(["messageChunk"],"readonly",async function(e){var n=await e.stores.messageChunk.readIndexRange("[plaintextHash+updatedAtMs]",{only:[t]},{limit:1,order:"desc"});return n.at(0)},"WmiGetMessagesForHash")},t.handleMessageDeletion=function(t,n){return this.$3(function(e){return e.stores.messageChunk.readIndexRange("[threadId+messageId+plaintextHash]",{only:[t,n]})})},t.handleThreadDeletion=function(t){return this.$3(function(e){return e.stores.messageChunk.readIndexRange("[threadId+messageId+plaintextHash]",{only:[t]})})},t.storeChunk=function(t){var e=t.blobData,n=t.isProgressivePreview,r=t.mimetype,o=t.plaintextHash;return this.$2.store(o,e,r,n)},t.storeMessageChunks=function(t){return this.$1.runInTransaction(["messageChunk"],"readwrite",async function(e){await e.stores.messageChunk.bulkUpsert("[threadId+messageId+plaintextHash]",t.map(function(e){return{item:{messageId:e.messageId,plaintextHash:e.plaintextHash,threadId:e.threadId,updatedAtMs:o("MpsTypes").toTimestamp(Date.now())},selector:[e.threadId,e.messageId,e.plaintextHash]}}))},"WmiMediaServiceStoreChunkMessage")},t.$3=async function(t){var e=await this.$1.runInTransaction(["messageChunk"],"readwrite",async function(e){var n=await t(e);await e.stores.messageChunk.bulkDelete(n.map(function(e){return e.pk}));var r=new Set(n.map(function(e){return e.plaintextHash})),o=await e.stores.messageChunk.readIndexAnyOf("[plaintextHash+updatedAtMs]",Array.from(r).map(function(e){return[e]}));return o.forEach(function(e){return r.delete(e.plaintextHash)}),Array.from(r)},"WmiMediaServiceDeleteMessageChunkEntries");e.length>0&&await this.$2.delete(Array.from(e))},e})(),s=null;async function u(t){if(s!=null)throw r("err")("Media Service already initialised");var n=await o("WmiMediaServiceDb").makeMediaServiceDb(t);s=new e(n)}function c(){return r("nullthrows")(s,"Media Service not initialised")}function d(){s=null}l.MediaService=e,l.wmiMediaServiceSetup=u,l.mediaService=c,l.wmiMediaServiceClear__TESTONLY=d}),98);
__d("MpsMediaManager",["MAWGetThumbnailBlobDataUrlByMediaIdApi","MpsMediaEntryCache","MpsMessageToBridgeWrapper","MpsToBridgeMessageId","WAIsPreviewSupported","WAJids","WAMediaManager","WAMediaManagerCache","WAMediaUtils","WAResultOrError","WAStanzaUtils","WAValidateMedia","WebMps","WmiMediaService","getErrorSafe","memoize","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=["kind"];function s(e){throw new TypeError('"'+e+'" is read-only')}async function u(e){var t=e.fullSizePlaintextHash,n=e.mediaDownloadFlow,r=o("MpsMediaEntryCache").getEntry(t);if(r!=null)return n.addPoint("media_entry_cache_hit"),r;var a=await o("WmiMediaService").mediaService().getMessageChunkForHash(t);if(a==null){n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"missing_message_chunk"}});return}var i=await o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:"local-only"},debug:{purpose:"MpsMediaManager-getEntryWithFallback"},messageId:a.messageId,threadId:a.threadId}),l=i.value;if(l==null){n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"missing_reverb_message"}});return}o("MpsMediaEntryCache").hydrateCache(l.toplevelProtobuf);var s=o("MpsMediaEntryCache").getEntry(t);return s==null?(n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"unable_to_cache"}}),null):(n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"success"}}),s)}async function c(e){var t=o("MpsToBridgeMessageId").bridgeMsgIdToMps(e),n=t.messageId,r=t.threadId,a=await o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:"local-first"},debug:{purpose:"mps_media_manager"},messageId:n,threadId:r});if(a.value){var i=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.value.toplevelProtobuf),l=i.getAuthor();if(!o("WAJids").isAuthorSystem(l))return{protocolMsgId:{author:l,chat:i.getChatJid(),externalId:o("WAStanzaUtils").toStanzaId(i.getExternalId())},sortOrderMs:i.message.timestampMs}}}var d=function(t){return o("WAMediaManager").createMediaManager({createCacheState:t,dbCallbacks:{getMediaEntries:function(t){var e=o("MpsMediaEntryCache").getEntry(t);if(e==null)return Promise.resolve(o("WAResultOrError").makeError("no-media-by-plaintext-hash"));var n=e.mediaEntry,r=e.message,a=o("MpsToBridgeMessageId").mpsToBridgeMsgId(r.threadId,r.messageId);return Promise.resolve(o("WAResultOrError").makeResult(new Map([[a,n]])))},getProtocolMsgIdAndSortOrderMs:c}})};function m(e){var t=o("WAIsPreviewSupported").checkPreviewSupport(e.decodedMediaEntry),n=t[0],r=t[1];return(function(t){if(Array.isArray(t)&&t.length===2&&t[0]===o("WAIsPreviewSupported").PjpegPreviewSupport.YES)return{kind:"progressive",thumbnailHash:e.plaintextHash};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.YES)return e.thumbnailHash!=null?{kind:"withThumbnail",thumbnailHash:e.thumbnailHash}:{kind:"noPreview"};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.DuplicatedWithFullSize)return{kind:"duplicatedWithFullSize",thumbnailHash:e.plaintextHash};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return{kind:"noPreview"};throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)})([n,r])}async function p(e,t,n){if(e!=null){var r=await o("WAValidateMedia").validateMedia(e,t);if(r.value!=null)return o("WAResultOrError").makeResult({serverMediaType:n,unvalidatedMimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(n),validatedResult:r.value})}}async function _(e,t,n){var r=await o("WmiMediaService").mediaService().getChunk(e),a=await p(r==null?void 0:r.blobData,t,n);if(!(r==null||a==null))return t.addAnnotations({bool:{from_chunk:!0}}),{chunk:r,result:a}}function f(e,t,n,a){if(n.success===!0){var i;o("WmiMediaService").mediaService().storeChunk({blobData:n.value.validatedResult.validatedPlaintext,isProgressivePreview:a,mimetype:(i=n.value.validatedResult.mimeType)!=null?i:n.value.unvalidatedMimeType,plaintextHash:e}).then(function(){return t.addAnnotations({string:{chunk_store_result:"success"}})}).catch(function(e){var n=r("getErrorSafe")(e).message;t.addAnnotations({string:{chunk_store_result:n}})})}}async function g(e,t,n){var r,a=n.fullSizePlaintextHash,i=n.mediaDownloadFlow;if(e.success||e.error!=="signature-expired")return e;var l=await o("MAWGetThumbnailBlobDataUrlByMediaIdApi").getFullMediaWithPlaintextHash(a);if(l==null)return i.addAnnotations({string:{signature_expired_fallback:"media not found"}}),e;var s=(r=l.validatedAudioInfo)!=null?r:l.validatedVideoInfo,u=s==null?void 0:s.jpegThumbnail;if(u==null)return i.addAnnotations({string:{signature_expired_fallback:"thumbnail not found"}}),e;var c=await o("WAValidateMedia").validateMedia(u,i);return c.value==null?(i.addAnnotations({string:{signature_expired_fallback:"validation failed"}}),e):(i.addAnnotations({string:{signature_expired_fallback:"success"}}),o("WAResultOrError").makeResult({serverMediaType:t.serverMediaType,unvalidatedMimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType("image"),validatedResult:c.value}))}var h=function(n){var t=d(n),a=o("WAMediaManagerCache").createAttachmentCache(c,n),i={clearCache:t.clearCache,dequeueDownload:t.dequeueDownload,enqueueDownloadFullSize:async function(n){n.mediaDownloadFlow.addAnnotations({string:{downloadKind:"fullsize"}});var e=a.getFullsize(n);if(e.type==="cache-hit")return e.cache;var r=await u(n);if(!r)return o("WAResultOrError").makeError("missing-media-entry");var i=await _(n.fullSizePlaintextHash,n.mediaDownloadFlow,r.serverMediaType);if(i!=null&&!i.chunk.isProgressivePreview)return i.result;n.mediaDownloadFlow.addPoint("mps_actual_download");var l=await t.enqueueDownloadFullSize(n);return f(n.fullSizePlaintextHash,n.mediaDownloadFlow,l,!1),l},enqueueDownloadFullSizeAndPreview:function(i){i.mediaDownloadFlow.addAnnotations({string:{downloadKind:"fullsizeAndPreview"}});var n=a.getFullsizeAndPreview(i),l=n.fullsizeCacheResult,s=n.previewCacheResult;if(l.type==="cache-hit"&&s.type==="cache-hit")return{fullsizePromise:l.cache,previewPromise:s.cache};var c=r("memoize")(function(){return u(i)}),d=r("memoize")(async function(){var e=r("nullthrows")(await c()),t=_(i.fullSizePlaintextHash,i.mediaDownloadFlow,e.serverMediaType);return t});i.mediaDownloadFlow.addPoint("mps_actual_download");var p=r("memoize")(function(){return t.enqueueDownloadFullSizeAndPreview(i)});return{fullsizePromise:(async function(){var e=await c();if(e==null)return o("WAResultOrError").makeError("missing-media-entry");var t=await d();if(t!=null&&!t.chunk.isProgressivePreview)return t.result;var n=await p().fullsizePromise;return f(i.fullSizePlaintextHash,i.mediaDownloadFlow,n,!1),n})(),previewPromise:(async function(){var t=await c();if(t==null)return o("WAResultOrError").makeError("missing-media-entry");var n=m(t);if(n.kind==="noPreview")return o("WAResultOrError").makeError("preview-not-supported");var r=await(function(n){if((typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="duplicatedWithFullSize"||(typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="progressive")return d();if((typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="withThumbnail"){var r=n.kind,o=babelHelpers.objectWithoutPropertiesLoose(n,e);return _(o.thumbnailHash,i.mediaDownloadFlow,t.serverMediaType)}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+n)})(n);if(r!=null)return r.result;var a=await p().previewPromise,l=await g(a,t,i);return n.kind==="withThumbnail"&&f(n.thumbnailHash,i.mediaDownloadFlow,l,!1),l})()}},enqueueDownloadPreview:async function(n){n.mediaDownloadFlow.addAnnotations({string:{downloadKind:"preview"}});var e=a.getPreview(n);if(e.type==="cache-hit")return e.cache;var r=await u(n);if(r==null)return o("WAResultOrError").makeError("missing-media-entry");var i=m(r),l=i.kind==="progressive";if(i.kind==="noPreview")return o("WAResultOrError").makeError("preview-not-supported");var s=i.thumbnailHash,c=await _(s,n.mediaDownloadFlow,r.serverMediaType);if(c!=null)return c.result;n.mediaDownloadFlow.addPoint("mps_actual_download");var d=await t.enqueueDownloadPreview(n),p=await g(d,r,n);return f(s,n.mediaDownloadFlow,p,l),p},enqueueUploadFullSize:function(){return t.enqueueUploadFullSize.apply(t,arguments)}};return i};l.getMpsMediaManager=h}),98);
__d("MpsFutureProofKey",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({WCEPlaintextPayloadFutureProofPlaceholder:0,WCEPlaintextPayloadFutureProofNoPlaceholder:1,WCEPlaintextPayloadFutureProofIgnore:2});i.WCEPlaintextPayloadFutureProof=e}),66);
__d("WABuildMpsPayload",["MpsFutureProofKey","MpsTypes","WAArmadilloBackupMessage.pb","WAArmadilloMiTransportAdminMessage.pb","WAArmadilloTransportEvent.pb","WAGlobals","WAJids","WALogger","WATimeUtils","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){var n=o("WAJids").extractUserId(t.senderJid),r;t.hideDecryptionFailure!=null&&(r=t.hideDecryptionFailure?o("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofNoPlaceholder:o("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofPlaceholder);var a=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloBackupMessage.pb").BackupMessageSpec,babelHelpers.extends({},e,{metadata:{frankingMetadata:{frankingTag:t.frankingTag,reportingTag:t.reportingTag},messageId:t.externalId,payloadVersion:2,senderId:n,futureProofBehavior:r,timestampMs:t.timestampMs}})).readBuffer();return a}function d(e,t){var n=o("WAJids").extractUserId(t.senderJid),r=o("MpsTypes").toThreadId(t.threadId),a=t.millisServerTs!=null?t.millisServerTs:t.serverTs*1e3+o("WAGlobals").getDependencies().extractMsFromStanzaId(t.externalId),i=c(e,{senderJid:t.senderJid,externalId:t.externalId,frankingTag:t.frankingTag,reportingTag:t.reportingTag,hideDecryptionFailure:t.hideDecryptionFailure,threadId:t.threadId,timestampMs:o("MpsTypes").toTimestamp(a)});return{messageId:o("MpsTypes").toMessageId(t.externalId),payload:o("MpsTypes").toBytes(i),senderId:n,threadId:r,timestampMs:o("MpsTypes").toTimestamp(a)}}function m(t,n,r){try{var a={};switch(r.type){case"message":a={encryptedTransportMessage:r.applicationPayload};break;case"ciphertext":a={encryptedTransportEvent:{payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{placeholder:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE}}).readBuffer(),version:3}};break;case"unavailable":a={encryptedTransportEvent:{payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{placeholder:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE}}).readBuffer(),version:3}};break;default:r.type}return d(a,{senderJid:o("WAJids").extractUserJid(n.from),externalId:t.stanzaId,serverTs:t.serverTs,frankingTag:t.frankingTag,reportingTag:t.reportingTag,hideDecryptionFailure:t.hideDecryptionFailure,threadId:n.chat})}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["buildMpsMessagePayload: ",""])),t),null}}function p(e,t,n){if(n.payload==null)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["buildMpsAppdataPayload: No appdata payload"]))),null;try{return d({encryptedTransportMessage:n.payload},{senderJid:o("WAJids").extractUserJid(e.from),externalId:e.stanzaId,serverTs:t,threadId:o("WAJids").extractUserJid(e.from)})}catch(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["buildMpsAppdataPayload: ",""])),e),null}}function _(e,t,n,r,a){var i={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupMembershipAddModeChanged:{mode:n}}).readBuffer(),version:3};return d({miTransportAdminMessage:i},{serverTs:r!=null?r:o("WATimeUtils").unixTime(),externalId:a,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function f(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupAdminChanged:{targetUserId:n.map(o("WAJids").extractUserId),action:r}}).readBuffer(),version:3};return d({miTransportAdminMessage:l},{serverTs:a!=null?a:o("WATimeUtils").unixTime(),externalId:i,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function g(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupParticipantChanged:{targetUserId:n.map(o("WAJids").extractUserId),action:r}}).readBuffer(),version:3};return d({miTransportAdminMessage:l},{serverTs:a!=null?a:o("WATimeUtils").unixTime(),externalId:i,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function h(e,t,n,r,a){var i={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupNameChanged:{groupName:n}}).readBuffer(),version:3};return d({miTransportAdminMessage:i},{serverTs:r!=null?r:o("WATimeUtils").unixTime(),externalId:a,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function y(e,t,n){var r={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{event:{icdcAlert:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$IcdcAlert$Type.DETECTED}}}).readBuffer(),version:3};return d({encryptedTransportEvent:r},{serverTs:t!=null?t:o("WATimeUtils").unixTime(),externalId:n,hideDecryptionFailure:!1,senderJid:e,threadId:e})}function C(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{event:{deviceChange:{type:r,devicePlatform:a,deviceModel:i}}}).readBuffer(),version:3};return d({encryptedTransportEvent:l},{serverTs:t!=null?t:o("WATimeUtils").unixTime(),externalId:n,hideDecryptionFailure:!1,senderJid:e,threadId:e})}l.buildBackupProtobufBytes=c,l.buildMpsMessage=d,l.buildMpsMessageFromIncomingMessage=m,l.buildMpsAppdataPayload=p,l.buildMpsGroupMemberAddType=_,l.buildMpsGroupAdminChangedMsg=f,l.buildMpsGroupParticipantsChanged=g,l.buildMpsGroupNameChangedMsg=h,l.buildMpsIcdcAdminMessage=y,l.buildMpsDeviceChangeAdminMessage=C}),98);/*FB_PKG_DELIM*/
__d("AsyncStorage",["Promise","WebAsyncStorage"],(function(t,n,r,o,a,i,l){"use strict";var e,s={getItem:function(o,a){return new(e||(e=n("Promise")))(function(e,t){r("WebAsyncStorage").getItem(o,function(n,r){a&&a(n,r),n!=null?t(n):e(r)})})},removeItem:function(o,a){return new(e||(e=n("Promise")))(function(e,t){r("WebAsyncStorage").removeItem(o,function(n){a&&a(n),n!=null?t(n):e()})})},setItem:function(o,a,i){return new(e||(e=n("Promise")))(function(e,t){r("WebAsyncStorage").setItem(o,a,function(n){i&&i(n),n!=null?t(n):e()})})}},u=s;l.default=u}),98);
__d("useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork",["react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.useCallback,c=s.useEffect,d=s.useRef,m=s.useState;function p(e,t){var n=o("react-compiler-runtime").c(9),r=e.dataSource,a=t===void 0?!1:t,i=m(a),l=i[0],s=i[1],u=d(null),p;n[0]!==r?(p=function(t){var e,n=t.onResolvePayload,o=t.requestParams;(e=u.current)==null||e.unsubscribe(),u.current=r.fetchNetwork(o).subscribe({complete:function(){s(!1)},error:function(t){s(!1)},next:function(t){return n(t)},start:function(t){s(!0)},unsubscribe:function(){s(!1)}})},n[0]=r,n[1]=p):p=n[1];var _=p,f,g;n[2]===Symbol.for("react.memo_cache_sentinel")?(f=function(){return(function(){var e;(e=u.current)==null||e.unsubscribe()})},g=[],n[2]=f,n[3]=g):(f=n[2],g=n[3]),c(f,g);var h;n[4]!==l?(h={isLoading:l},n[4]=l,n[5]=h):h=n[5];var y;return n[6]!==_||n[7]!==h?(y=[h,_],n[6]=_,n[7]=h,n[8]=y):y=n[8],y}l.default=p}),98);
__d("useBaseTypeaheadSubscriptionDataSourceFetchResolver",["FBLogger","cometTypeaheadODSLogFetchNetworkEvent","react","react-compiler-runtime","useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork","useDebouncedComet"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.useCallback,c=s.useEffect,d=s.useRef;function m(e,t){var n=o("react-compiler-runtime").c(17),a=e.dataSource,i=e.dataSourceFetchConfigParams,l=e.onResolvePayload,s;n[0]!==i?(s=i===void 0?{}:i,n[0]=i,n[1]=s):s=n[1];var u=s,m=u.requestFlow,p=u.shouldDebounceNetwork,_=p===void 0?!0:p,f;n[2]!==a?(f={dataSource:a},n[2]=a,n[3]=f):f=n[3];var g=r("useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork")(f),h=g[0],y=g[1],C=h.isLoading,b=r("useDebouncedComet")(y),v;n[4]!==l?(v=function(t,n){var e=n.isTraceComplete,o=n.source;try{l(t,{isTraceComplete:e,source:o})}catch(e){r("FBLogger")("search").mustfix("Failed to resolve fetched payload")}return o},n[4]=l,n[5]=v):v=n[5];var S=v,R=d(m),L;n[6]!==S?(L=function(t){S(t,{isTraceComplete:!0,source:t.entries.length>0?"network":"network-no-results"}),r("cometTypeaheadODSLogFetchNetworkEvent")&&r("cometTypeaheadODSLogFetchNetworkEvent")("comet.ta.fetch",!0,1)},n[6]=S,n[7]=L):L=n[7];var E=L,k,I;n[8]!==y||n[9]!==b||n[10]!==t||n[11]!==E||n[12]!==_?(k=function(){var e=function(t){var e=t.requestParams,n=e.requestFlow;n!=null&&(R.current=n);var r={onResolvePayload:E,requestParams:babelHelpers.extends({},e,{requestFlow:R.current})};_?b(r):y(r)};t!=null&&e(t)},I=[y,b,t,E,_],n[8]=y,n[9]=b,n[10]=t,n[11]=E,n[12]=_,n[13]=k,n[14]=I):(k=n[13],I=n[14]),c(k,I);var T;return n[15]!==C?(T=[{isLoading:C}],n[15]=C,n[16]=T):T=n[16],T}l.default=m}),98);
__d("useBaseTypeaheadSubscriptionDataSourceFetch",["FBLogger","react","react-compiler-runtime","useBaseTypeaheadSubscriptionDataSourceFetchResolver"],(function(t,n,r,o,a,i,l){"use strict";var e=["loggingEventTrace"],s,u=s||(s=o("react")),c=u.useCallback,d=u.useState;function m(t){var n,a=o("react-compiler-runtime").c(9),i=d(null),l=i[0],s=i[1],u=r("useBaseTypeaheadSubscriptionDataSourceFetchResolver")(t,l),c=u[0],m=c.isLoading,p;a[0]===Symbol.for("react.memo_cache_sentinel")?(p=function(t,n){var e=n===void 0?"all":n;s({requestParams:t,source:e})},a[0]=p):p=a[0];var _=p,f;a[1]!==l?(f=function(n){var t=n||{},o=t.requestFlow,a=t.source;if(l==null){r("FBLogger")("search").mustfix("Refetch cannot be called with undefined `fetchParams`");return}var i=l.requestParams,s=i.loggingEventTrace,u=babelHelpers.objectWithoutPropertiesLoose(i,e),c=babelHelpers.extends({loggingEventTrace:babelHelpers.extends({},s,{sequenceID:String(Date.now())}),requestFlow:o},u);_(c,a)},a[1]=l,a[2]=f):f=a[2];var g=f,h=(n=l==null?void 0:l.source)!=null?n:"all",y;a[3]!==m||a[4]!==h?(y={isLoading:m,source:h},a[3]=m,a[4]=h,a[5]=y):y=a[5];var C;return a[6]!==g||a[7]!==y?(C=[y,_,g],a[6]=g,a[7]=y,a[8]=C):C=a[8],C}l.default=m}),98);
__d("TypeaheadLoggingFetchRequestFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("1880031"),s=o("FalcoLoggerInternal").create("typeahead_logging_fetch_request",e),u=s;l.default=u}),98);
__d("CometTypeaheadVolumeLoggingProvider",["FBLogger","TypeaheadLoggingFetchRequestFalcoEvent"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return Math.random().toString()},s=(function(){function t(t){this.$2=null,this.$1=t,this.$2=e()}var n=t.prototype;return n.getContext=function(){return this.$1},n.getSessionID=function(){return this.$2==null&&r("FBLogger")("search").mustfix("Logging sessionID requested from %s surface does not exist.",this.getContext()),this.$2},n.logRequest=function(t){var e={context:this.getContext(),requestType:t,sessionID:this.getSessionID()};r("TypeaheadLoggingFetchRequestFalcoEvent").log(function(){return{fetchRequest:e}})},t})();l.default=s}),98);
__d("useCometTypeaheadVolumeLoggingProvider",["CometTypeaheadVolumeLoggingProvider","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useMemo;function u(e){var t=o("react-compiler-runtime").c(2),n=e===void 0?"UNKNOWN":e,a;return t[0]!==n?(a=new(r("CometTypeaheadVolumeLoggingProvider"))(n),t[0]=n,t[1]=a):a=t[1],a}l.default=u}),98);
__d("CometInternalTypeaheadSubscriptionProvider",["CometInternalTypeaheadEmptyFetchProvider","CometInternalTypeaheadFetchContext","react","useBaseTypeaheadSubscriptionDataSourceFetch","useCometInternalTypeaheadStateDispatcher","useCometTypeaheadVolumeLoggingProvider"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useCallback,d=u.useMemo;function m(e){var t=e.children,n=e.dataSource,o=e.dataSourceFetchConfigParams,a=e.loggingContext,i=e.onFetchEntries_DO_NOT_USE,l=e.traceProvider,u=r("useCometInternalTypeaheadStateDispatcher")(),m=u.dispatchActiveEntries,p=r("useCometTypeaheadVolumeLoggingProvider")(a),_=r("useBaseTypeaheadSubscriptionDataSourceFetch")({dataSource:n,dataSourceFetchConfigParams:o,onResolvePayload:c(function(e,t){var n=e.entries,r=t.isTraceComplete,o=t.source;m(n!=null?n:[]),p.logRequest(h),i&&i(n),l&&!l.isResolved()&&r&&(o==="cache"&&n.length>=l.getEntriesCountForVisualComplete()?l.setEndReason("max_suggestions_reached"):o==="network"?l.setEndReason("all_queries_completed"):o==="network-no-results"&&l.setEndReason("all_queries_completed_no_network_results"),l.resolve())},[m,i,l])}),f=_[0],g=f.isLoading,h=f.source,y=_[1],C=_[2],b=d(function(){return{fetch:y,isLoading:g,refetch:C,source:h}},[y,g,C,h]);return s.jsx(r("CometInternalTypeaheadFetchContext").Provider,{value:b,children:s.jsx(r("CometInternalTypeaheadEmptyFetchProvider"),{isLoading:g,source:h,children:t})})}m.displayName=m.name+" [from "+i.id+"]",l.default=m}),98);
__d("BaseSubscriptionTypeahead.react",["CometHeroInteractionContextPassthrough.react","CometInternalTypeahead.react","CometInternalTypeaheadStateProvider","CometInternalTypeaheadSubscriptionProvider","emptyFunction","react","react-compiler-runtime","withCometTypeaheadInputStrategyShouldQueryStringFollowHighlightedEntry"],(function(t,n,r,o,a,i,l){"use strict";var e=["autoOpen","autoFocus","isDisabled","errorMessage","inputStrategyRenderer","dataSource","dataSourceFetchConfigParams","decorators","emptyEntries_DO_NOT_USE","id","label","loggingContext","onBackspace","onBlur","onChange","onClose","onEnter","onEscape","onFetchEntries_DO_NOT_USE","onFocus","onOpen","onPressEntry","placeholder","shouldQueryStringFollowHighlightedEntry","shouldQueryStringUpdateFromSelectedEntryOnClick","testid","traceProvider","inputRef","viewRole","viewStrategyRenderer"],s,u=s||(s=o("react")),c=s,d=c.useCallback,m=c.useId,p=c.useMemo;function _(t){var n=o("react-compiler-runtime").c(77),a,i,l,s,c,d,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N,M,w,A,F;n[0]!==t?(y=t.autoOpen,T=t.autoFocus,D=t.isDisabled,x=t.errorMessage,a=t.inputStrategyRenderer,l=t.dataSource,s=t.dataSourceFetchConfigParams,$=t.decorators,c=t.emptyEntries_DO_NOT_USE,_=t.id,P=t.label,p=t.loggingContext,N=t.onBackspace,M=t.onBlur,f=t.onChange,w=t.onClose,C=t.onEnter,b=t.onEscape,g=t.onFetchEntries_DO_NOT_USE,v=t.onFocus,S=t.onOpen,h=t.onPressEntry,R=t.placeholder,L=t.shouldQueryStringFollowHighlightedEntry,E=t.shouldQueryStringUpdateFromSelectedEntryOnClick,k=t.testid,A=t.traceProvider,d=t.inputRef,I=t.viewRole,i=t.viewStrategyRenderer,F=babelHelpers.objectWithoutPropertiesLoose(t,e),n[0]=t,n[1]=a,n[2]=i,n[3]=l,n[4]=s,n[5]=c,n[6]=d,n[7]=p,n[8]=_,n[9]=f,n[10]=g,n[11]=h,n[12]=y,n[13]=C,n[14]=b,n[15]=v,n[16]=S,n[17]=R,n[18]=L,n[19]=E,n[20]=k,n[21]=I,n[22]=T,n[23]=D,n[24]=x,n[25]=$,n[26]=P,n[27]=N,n[28]=M,n[29]=w,n[30]=A,n[31]=F):(a=n[1],i=n[2],l=n[3],s=n[4],c=n[5],d=n[6],p=n[7],_=n[8],f=n[9],g=n[10],h=n[11],y=n[12],C=n[13],b=n[14],v=n[15],S=n[16],R=n[17],L=n[18],E=n[19],k=n[20],I=n[21],T=n[22],D=n[23],x=n[24],$=n[25],P=n[26],N=n[27],M=n[28],w=n[29],A=n[30],F=n[31]);var O=y===void 0?!1:y,B=T===void 0?!1:T,W=D===void 0?!1:D,q=x===void 0?null:x,U;n[32]!==$?(U=$===void 0?[]:$,n[32]=$,n[33]=U):U=n[33];var V=U,H=P===void 0?"":P,G=N===void 0?r("emptyFunction"):N,z=M===void 0?r("emptyFunction"):M,j=w===void 0?r("emptyFunction"):w,K=C===void 0?r("emptyFunction"):C,Q=b===void 0?r("emptyFunction"):b,X=v===void 0?r("emptyFunction"):v,Y=S===void 0?r("emptyFunction"):S,J=R===void 0?"":R,Z=L===void 0?!0:L,ee=E===void 0?!0:E,te=k===void 0?"":k,ne=I===void 0?"listbox":I,re=m(),oe;n[34]!==V?(oe=r("CometInternalTypeahead.react"),V.forEach(function(e){var t=e.decorate,n=e.params;oe=t(oe,n)}),n[34]=V,n[35]=oe):oe=n[35];var ae=oe,ie;n[36]!==f||n[37]!==h||n[38]!==ee?(ie=function(t){ee&&f(t.label),h&&h(t)},n[36]=f,n[37]=h,n[38]=ee,n[39]=ie):ie=n[39];var le=ie,se;n[40]!==a||n[41]!==Z?(se=r("withCometTypeaheadInputStrategyShouldQueryStringFollowHighlightedEntry")(a,{shouldQueryStringFollowHighlightedEntry:Z}),n[40]=a,n[41]=Z,n[42]=se):se=n[42];var ue=se,ce=H||J,de=_!=null?_:re,me;if(n[43]!==ue||n[44]!==ae||n[45]!==i||n[46]!==B||n[47]!==q||n[48]!==d||n[49]!==G||n[50]!==z||n[51]!==K||n[52]!==Q||n[53]!==X||n[54]!==le||n[55]!==W||n[56]!==f||n[57]!==J||n[58]!==ce||n[59]!==de||n[60]!==te||n[61]!==F||n[62]!==ne){var pe;me=u.jsx(ae,babelHelpers.extends({},F,{autoFocus:B,errorMessage:q,id:de,inputRef:d,inputStrategyRenderer:ue,isDisabled:W,label:ce,onBackspace:G,onBlur:z,onChange:f,onDownArrow:pe=r("emptyFunction"),onEnter:K,onEscape:Q,onFocus:X,onHighlightEntry:pe,onPressEntry:le,onShiftTab:pe,onTab:pe,onUpArrow:pe,placeholder:J,testid:void 0,viewRole:ne,viewStrategyRenderer:i})),n[43]=ue,n[44]=ae,n[45]=i,n[46]=B,n[47]=q,n[48]=d,n[49]=G,n[50]=z,n[51]=K,n[52]=Q,n[53]=X,n[54]=le,n[55]=W,n[56]=f,n[57]=J,n[58]=ce,n[59]=de,n[60]=te,n[61]=F,n[62]=ne,n[63]=me}else me=n[63];var _e;n[64]!==l||n[65]!==s||n[66]!==p||n[67]!==g||n[68]!==me||n[69]!==A?(_e=u.jsx(r("CometInternalTypeaheadSubscriptionProvider"),{dataSource:l,dataSourceFetchConfigParams:s,loggingContext:p,onFetchEntries_DO_NOT_USE:g,traceProvider:A,children:me}),n[64]=l,n[65]=s,n[66]=p,n[67]=g,n[68]=me,n[69]=A,n[70]=_e):_e=n[70];var fe;return n[71]!==O||n[72]!==c||n[73]!==j||n[74]!==Y||n[75]!==_e?(fe=u.jsx(r("CometHeroInteractionContextPassthrough.react"),{clear:!0,children:u.jsx(r("CometInternalTypeaheadStateProvider"),{autoOpen:O,emptyEntries_DO_NOT_USE:c,onClose:j,onOpen:Y,children:_e})}),n[71]=O,n[72]=c,n[73]=j,n[74]=Y,n[75]=_e,n[76]=fe):fe=n[76],fe}l.default=_}),98);
__d("CancellablePromise",["Promise","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s="CancellationToken.TokenCancelled";function u(t,o,a){return a.then(function(a){return t.isCancelled()?(e||(e=n("Promise"))).reject(r("err")(s)):o(a)})}function c(t,o){return o.catch(function(o){return o instanceof Error&&o.message===s?(e||(e=n("Promise"))).resolve(t):(e||(e=n("Promise"))).reject(r("err"))})}l.then_=u,l.ignoreFailed=c}),98);
__d("CancellationToken",[],(function(t,n,r,o,a,i){"use strict";function e(){var e={contents:!1};return{cancel:function(){e.contents=!0},isCancelled:function(){return e.contents}}}i.default=e}),66);
__d("MWTopNavListDropdownTitle.react",["fbt","BaseHeading.react","Locale","MWXCircleButton.react","MWXIconArrowLeft","MWXIconArrowRight","MWXRow.react","MWXRowItem.react","MWXText.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=[];function d(e){var t=o("react-compiler-runtime").c(16),n=e.actions,a=e.onReturn,i=e.testid,l=e.title,d=n===void 0?c:n,p;t[0]===Symbol.for("react.memo_cache_sentinel")?(p={className:"x6s0dn4 x78zum5 x2lah0s x1qughib x21xpn4 x1whwgri x1hndj7l xdwfu72 xnx504b"},t[0]=p):p=t[0];var _;t[1]!==a?(_=a!=null?u.jsx(r("MWXRowItem.react"),{children:u.jsx(r("MWXCircleButton.react"),{"aria-label":s._(/*BTDS*/"Atr\u00e1s"),icon:o("Locale").isRTL()?r("MWXIconArrowRight"):r("MWXIconArrowLeft"),iconRatio:"large",onPress:a,size:32,type:"deemphasized"})}):null,t[1]=a,t[2]=_):_=t[2];var f;t[3]!==l?(f=u.jsx(r("MWXRowItem.react"),{verticalAlign:"center",children:u.jsx(r("BaseHeading.react"),{isPrimaryHeading:!0,children:u.jsx(r("MWXText.react"),{type:"headlineEmphasized1",children:l})})}),t[3]=l,t[4]=f):f=t[4];var g;t[5]!==_||t[6]!==f?(g=u.jsxs(r("MWXRow.react"),{paddingHorizontal:0,paddingTop:0,spacingHorizontal:8,children:[_,f]}),t[5]=_,t[6]=f,t[7]=g):g=t[7];var h;t[8]!==d?(h=d.map(m),t[8]=d,t[9]=h):h=t[9];var y;t[10]!==h?(y=u.jsx(r("MWXRow.react"),{paddingHorizontal:0,paddingTop:0,spacingHorizontal:8,children:h}),t[10]=h,t[11]=y):y=t[11];var C;return t[12]!==g||t[13]!==y||t[14]!==i?(C=u.jsxs("header",babelHelpers.extends({},p,{"data-testid":void 0,children:[g,y]})),t[12]=g,t[13]=y,t[14]=i,t[15]=C):C=t[15],C}function m(e,t){return u.jsx(r("MWXRowItem.react"),{children:e},t)}m.displayName=m.name+" [from "+i.id+"]",l.default=d}),226);
__d("CometMessagingJewelDropdownContentGlimmer.react",["FDSListCellGlimmer.react","MWTopNavListDropdownTitle.react","emptyFunction","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(9),n=e.isFullHeight,a=e.title,i=e.withBackButton,l=n===void 0?!1:n,u=i===void 0?!1:i,c;t[0]!==l?(c={0:{},1:{className:"x9f619 x20eyyc xvv7f4i x1cvmir6"}}[!!l<<0],t[0]=l,t[1]=c):c=t[1];var d;t[2]!==a||t[3]!==u?(d=a!=null&&s.jsx(r("MWTopNavListDropdownTitle.react"),{onReturn:u?r("emptyFunction"):void 0,title:a}),t[2]=a,t[3]=u,t[4]=d):d=t[4];var m;t[5]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsx(r("FDSListCellGlimmer.react"),{imageSize:56,imageStyle:"circle",numberOfItems:Math.max(Math.ceil((window.innerHeight-72-45)/76),1)}),t[5]=m):m=t[5];var p;return t[6]!==c||t[7]!==d?(p=s.jsxs("div",babelHelpers.extends({},c,{children:[d,m]})),t[6]=c,t[7]=d,t[8]=p):p=t[8],p}l.default=u}),98);
__d("CometMessagingJewelDropdownEBUpsellContainerQuery.graphql",["CometMessagingJewelDropdownEBUpsellContainerQuery_facebookRelayOperation","MWEBNewUserOnboardingShouldLoadUpsells.relayprovider","relay-runtime"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},r={alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_timeout_remaining_secs",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CometMessagingJewelDropdownEBUpsellContainerQuery",selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsJewelNuxWrapper_query"},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"CometMessagingJewelDropdownQPBannerContainer_viewer"}],storageKey:null},action:"THROW",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[{defaultValue:null,kind:"LocalArgument",name:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider"}],kind:"Operation",name:"CometMessagingJewelDropdownEBUpsellContainerQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},e],storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},e,t],storageKey:null},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_auto_eb_upsells",plural:!1,selections:[t],storageKey:null},{condition:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_new_user_onboarding_upsells",plural:!1,selections:[{args:null,documentName:"MWEncryptedBackupsJewelNuxWrapper_query",fragmentName:"MWEBNewUserOnboardingThreadListUpsellWrapper_viewer",fragmentPropName:"viewer",kind:"ModuleImport"}],storageKey:null}]},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]},{alias:"jewel_qp",args:[{kind:"Literal",name:"surface_nux_id",value:8439},{kind:"Literal",name:"trigger",value:"MESSAGING_JEWEL_OPEN"}],concreteType:"ViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"CometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"7v0g"}],concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[t,{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMWXCardRendererStrategy_strategy",fragmentPropName:"strategy",kind:"ModuleImport"}],type:"CometQuickPromotionMWXCardRendererStrategy",abstractKey:null}],storageKey:'renderer_strategy(supported:"7v0g")'}],storageKey:null},e],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:8439,trigger:"MESSAGING_JEWEL_OPEN")'}],storageKey:null},{if:null,kind:"Defer",label:"MWEncryptedBackupsJewelNuxWrapper_query$defer$MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query",selections:[{if:null,kind:"Defer",label:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query$defer$MWEncryptedBackupsThreadListRestoreQPWrapper_query",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[r,{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null},e],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"qp_with_pin_state",storageKey:null}]}],storageKey:null}]}]}]},params:{id:n("CometMessagingJewelDropdownEBUpsellContainerQuery_facebookRelayOperation"),metadata:{},name:"CometMessagingJewelDropdownEBUpsellContainerQuery",operationKind:"query",text:null,providedVariables:{__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider:n("MWEBNewUserOnboardingShouldLoadUpsells.relayprovider")}}}})();n("relay-runtime").PreloadableQueryRegistry.set(e.params.id,e),a.exports=e}),null);
__d("CometMessagingJewelDropdownQPBannerContainer_viewer.graphql",[],(function(t,n,r,o,a,i){"use strict";var e={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CometMessagingJewelDropdownQPBannerContainer_viewer",selections:[{alias:"jewel_qp",args:[{kind:"Literal",name:"surface_nux_id",value:8439},{kind:"Literal",name:"trigger",value:"MESSAGING_JEWEL_OPEN"}],concreteType:"ViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"CometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"7v0g"}],concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMWXCardRendererStrategy_strategy",fragmentPropName:"strategy",kind:"ModuleImport"}],type:"CometQuickPromotionMWXCardRendererStrategy",abstractKey:null}],storageKey:'renderer_strategy(supported:"7v0g")'}],storageKey:null}],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:8439,trigger:"MESSAGING_JEWEL_OPEN")'}],type:"Viewer",abstractKey:null};a.exports=e}),null);
__d("CometMessagingJewelDropdownQPBannerContainer.react",["CometMessagingJewelDropdownQPBannerContainer_viewer.graphql","CometMessagingJewelDropdownQPBannerPlaceholder.react","CometPageletWithDiv.react","CometQuickPromotionLoggerContext.react","CometRelay","react","react-compiler-runtime","useQuickPromotionFalcoEvent"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react"));function c(t){var a,i,l=o("react-compiler-runtime").c(9),s=t.viewer,c=o("CometRelay").useFragment(e!==void 0?e:e=n("CometMessagingJewelDropdownQPBannerContainer_viewer.graphql"),s),m;l[0]===Symbol.for("react.memo_cache_sentinel")?(m={context_surface_id:8439,context_trigger:"messaging_jewel_open"},l[0]=m):m=l[0];var p=r("useQuickPromotionFalcoEvent")(m),_;if(l[1]!==(c==null||(a=c.jewel_qp)==null?void 0:a.nodes)){var f,g;_=c==null||(f=c.jewel_qp)==null||(f=f.nodes)==null?void 0:f.find(d),l[1]=c==null||(g=c.jewel_qp)==null?void 0:g.nodes,l[2]=_}else _=l[2];var h=_,y=h==null||(i=h.comet_qp_sections)==null?void 0:i.renderer_strategy;if(y==null)return null;var C;l[3]===Symbol.for("react.memo_cache_sentinel")?(C=u.jsx(r("CometMessagingJewelDropdownQPBannerPlaceholder.react"),{}),l[3]=C):C=l[3];var b;l[4]!==y?(b=u.jsx(o("CometRelay").MatchContainer,{match:y}),l[4]=y,l[5]=b):b=l[5];var v;return l[6]!==p||l[7]!==b?(v=u.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:C,name:"CometMessagingJewelDropdownQPBannerContainer",children:u.jsx(r("CometQuickPromotionLoggerContext.react").Provider,{value:p,children:b})}),l[6]=p,l[7]=b,l[8]=v):v=l[8],v}function d(e){var t;return((t=e.comet_qp_sections)==null?void 0:t.renderer_strategy)!=null}l.default=c}),98);
__d("MWEncryptedBackupsJewelNuxWrapperDeferred.react",["deferredLoadComponent","react","requireDeferredForDisplay"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=r("deferredLoadComponent")(r("requireDeferredForDisplay")("MWEncryptedBackupsJewelNuxWrapper.react").__setRef("MWEncryptedBackupsJewelNuxWrapperDeferred.react"));function c(e){return s.jsx(u,babelHelpers.extends({},e))}c.displayName=c.name+" [from "+i.id+"]",l.default=c}),98);
__d("MWInboxQuickPromotionWrapper.react",["CometErrorBoundary.react","CometPageletWithDiv.react","deferredLoadComponent","react","react-compiler-runtime","requireDeferredForDisplay"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=r("deferredLoadComponent")(r("requireDeferredForDisplay")("MAWUserVisibleErrorsNuxWrapper.react").__setRef("MWInboxQuickPromotionWrapper.react"));function c(e){var t=o("react-compiler-runtime").c(5),n=e.children,a=e.onError,i;t[0]!==n?(i=s.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWInboxQuickPromotionWrapper",children:s.jsx(u,{children:n})}),t[0]=n,t[1]=i):i=t[1];var l;return t[2]!==a||t[3]!==i?(l=s.jsx(r("CometErrorBoundary.react"),{onError:a,children:i}),t[2]=a,t[3]=i,t[4]=l):l=t[4],l}l.default=c}),98);
__d("CometMessagingJewelDropdownEBUpsellContainer.react",["CometMessagingJewelDropdownEBUpsellContainerQuery.graphql","CometMessagingJewelDropdownQPBannerContainer.react","CometRelay","FBLogger","MWEncryptedBackupsJewelNuxWrapperDeferred.react","MWInboxContextSwitcherUtils","MWInboxQuickPromotionWrapper.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react"));function c(e){var t=o("react-compiler-runtime").c(4),n=e.ebSoftblockUpsell,a=e.ebUpsellContainerQueryRef,i=e.selectedFilterTab,l;return t[0]!==n||t[1]!==a||t[2]!==i?(l=o("MWInboxContextSwitcherUtils").shouldShowEBUpsellFromFilter(i)&&n==null?u.jsx(r("MWInboxQuickPromotionWrapper.react"),{onError:d,children:u.jsx(m,{ebUpsellContainerQueryRef:a})}):null,t[0]=n,t[1]=a,t[2]=i,t[3]=l):l=t[3],l}function d(e){r("FBLogger")("messenger_web_entrypoints").catching(e).mustfix("CometMessagingJewelDropdownQPBannerContainer failed to render")}function m(t){var a=o("react-compiler-runtime").c(5),i=t.ebUpsellContainerQueryRef,l=o("CometRelay").usePreloadedQuery(e!==void 0?e:e=n("CometMessagingJewelDropdownEBUpsellContainerQuery.graphql"),i),s;a[0]!==l.viewer?(s=u.jsx(r("CometMessagingJewelDropdownQPBannerContainer.react"),{viewer:l.viewer}),a[0]=l.viewer,a[1]=s):s=a[1];var c;return a[2]!==l||a[3]!==s?(c=u.jsx(r("MWEncryptedBackupsJewelNuxWrapperDeferred.react"),{query:l,children:s}),a[2]=l,a[3]=s,a[4]=c):c=a[4],c}l.default=c}),98);
__d("MWInboxContextSwitcherDeferred.react",["deferredLoadComponent","react","react-compiler-runtime","requireDeferredForDisplay"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=r("deferredLoadComponent")(r("requireDeferredForDisplay")("MWInboxContextSwitcher.react").__setRef("MWInboxContextSwitcherDeferred.react"));function c(e){var t=o("react-compiler-runtime").c(2),n;return t[0]!==e?(n=s.jsx(u,babelHelpers.extends({},e)),t[0]=e,t[1]=n):n=t[1],n}l.default=c}),98);
__d("MWInboxContextSwitcherGlimmer.react",["MDSGlimmer.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u={tabPlaceholder:{borderStartStartRadius:"x1xn7y0n",borderStartEndRadius:"x1uxb8k9",borderEndEndRadius:"x1vmbcc8",borderEndStartRadius:"x16xm01d",display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0}};function c(){var e=o("react-compiler-runtime").c(1),t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=s.jsx("div",{className:"x78zum5 xu0aao5 x1y1aw1k xwib8y2 xf7dkkf xv54qhq x3bhodz",children:s.jsx(r("MDSGlimmer.react"),{index:0,xstyle:u.tabPlaceholder})}),e[0]=t):t=e[0],t}l.default=c}),98);
__d("useMWJewelSettingsButtonBadge",["cr:4042","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(){var e,t=(e=n("cr:4042")==null?void 0:n("cr:4042")())!=null?e:{},r=t.badge,o=r===void 0?null:r;return{badge:o,onButtonPress:function(){}}}l.default=u}),98);
__d("MWJewelDropdownHeader.react",["fbt","CometHomeChatSettings.entrypoint","FDSCircleButton.react","FDSComposeFilled16Icon","FDSDots3HorizontalFilled20Icon","FDSEntryPointPopoverTrigger.react","FDSTooltip.react","LSThreadAttributionStore","MWJewelDropdownHeaderSeeAllButton.react","MWJewelPopoverDialogContext.react","MWPSearchSystem","MWTopNavListDropdownTitle.react","MessengerWebUXLogger","emptyFunction","react","react-compiler-runtime","useCometPreloader","useMWChatOpenNewTab","useMWJewelSettingsButtonBadge","useMWNewChatTabContainerPreload","useReStore","useShouldShowMessagingEntrypointInCometRoot"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=u||(u=o("react")),d=u,m=d.useCallback,p=d.useContext;function _(e){var t=o("react-compiler-runtime").c(13),n=e.onOpenArchivedChats,a=e.onOpenMessageRequests,i=e.onOpenRestrictedAccountsList,l;t[0]===Symbol.for("react.memo_cache_sentinel")?(l=s._(/*BTDS*/"Opciones"),t[0]=l):l=t[0];var u=l,d=p(r("MWJewelPopoverDialogContext.react")),m=d.setIsOpenForDialog,_=r("useMWJewelSettingsButtonBadge")(),f=_.badge,g=_.onButtonPress,h;t[1]===Symbol.for("react.memo_cache_sentinel")?(h={},t[1]=h):h=t[1];var y=n!=null?n:void 0,C=a!=null?a:void 0,b=i!=null?i:void 0,v;t[2]!==y||t[3]!==C||t[4]!==b?(v={onOpenArchivedChats:y,onOpenMessageRequests:C,onOpenRestrictedAccountsList:b},t[2]=y,t[3]=C,t[4]=b,t[5]=v):v=t[5];var S;t[6]!==f||t[7]!==g||t[8]!==m?(S=function(t,n,o,a,i,l){return c.jsxs(r("FDSTooltip.react"),{align:"end",tooltip:u,children:[f,c.jsx(r("FDSCircleButton.react"),{"aria-label":u,color_DEPRECATED:"secondary",icon:r("FDSDots3HorizontalFilled20Icon"),onHoverIn:a,onHoverOut:i,onPress:function(){m(!1),n(),g()},onPressIn:l,ref:t,size:32,testid:void 0,type_DEPRECATED:"deemphasized"})]})},t[6]=f,t[7]=g,t[8]=m,t[9]=S):S=t[9];var R;return t[10]!==v||t[11]!==S?(R=c.jsx(r("FDSEntryPointPopoverTrigger.react"),{align:"end",entryPointParams:h,otherProps:v,popoverEntryPoint:r("CometHomeChatSettings.entrypoint"),position:"below",preloadTrigger:"button",children:S}),t[10]=v,t[11]=S,t[12]=R):R=t[12],R}function f(t){var n=o("react-compiler-runtime").c(35),a=t.inboxUrl,i=t.onClose,l=t.onOpenArchivedChats,u=t.onOpenMessageRequests,d=t.onOpenRestrictedAccountsList,m=t.onReturn,p=t.title,f=r("useShouldShowMessagingEntrypointInCometRoot")("CHAT"),g=r("useMWChatOpenNewTab")("jewelNewMessage"),h=r("MessengerWebUXLogger").useInteractionLogger(),y;n[0]!==f||n[1]!==h||n[2]!==i||n[3]!==g?(y=function(){o("LSThreadAttributionStore").setSourceForNewThread("jewelNewMessage"),f&&(g(!1),i()),h==null||h({eventName:"create_thread"})},n[0]=f,n[1]=h,n[2]=i,n[3]=g,n[4]=y):y=n[4];var C=y,b=r("useMWNewChatTabContainerPreload")(),v=b[0],S=b[1],R=(e||(e=r("useReStore")))(),L;n[5]!==R?(L=function(){return o("MWPSearchSystem").makeAll(R)},n[5]=R,n[6]=L):L=n[6];var E=L,k=r("useCometPreloader")("button_aggressive",r("emptyFunction"),E),I=k.onHoverInPreloader,T=k.onHoverMovePreloader,D=k.onHoverOutPreloader,x;n[7]===Symbol.for("react.memo_cache_sentinel")?(x=s._(/*BTDS*/"Nuevo mensaje"),n[7]=x):x=n[7];var $=x,P;n[8]!==l||n[9]!==u||n[10]!==d?(P=c.jsx(_,{onOpenArchivedChats:l,onOpenMessageRequests:u,onOpenRestrictedAccountsList:d},"mw-jewel-settings"),n[8]=l,n[9]=u,n[10]=d,n[11]=P):P=n[11];var N;n[12]!==a||n[13]!==i?(N=c.jsx(r("MWJewelDropdownHeaderSeeAllButton.react"),{onClose:i,testid:void 0,url:a},"mw-jewel-see-all-button"),n[12]=a,n[13]=i,n[14]=N):N=n[14];var M;n[15]!==v||n[16]!==I?(M=function(t){v(t),I(t)},n[15]=v,n[16]=I,n[17]=M):M=n[17];var w;n[18]!==S||n[19]!==D?(w=function(){S(),D()},n[18]=S,n[19]=D,n[20]=w):w=n[20];var A;n[21]!==C||n[22]!==E||n[23]!==T||n[24]!==M||n[25]!==w?(A=c.jsx(r("FDSTooltip.react"),{align:"end",tooltip:$,children:c.jsx(r("FDSCircleButton.react"),{"aria-label":$,color_DEPRECATED:"secondary",icon:r("FDSComposeFilled16Icon"),onFocusIn:E,onHoverIn:M,onHoverMove:T,onHoverOut:w,onPress:C,role:"button",size:32,testid:void 0,type_DEPRECATED:"deemphasized"})},"mw-jewel-new-message"),n[21]=C,n[22]=E,n[23]=T,n[24]=M,n[25]=w,n[26]=A):A=n[26];var F;n[27]!==P||n[28]!==N||n[29]!==A?(F=[P,N,A].filter(Boolean),n[27]=P,n[28]=N,n[29]=A,n[30]=F):F=n[30];var O;return n[31]!==m||n[32]!==F||n[33]!==p?(O=c.jsx(r("MWTopNavListDropdownTitle.react"),{actions:F,onReturn:m,title:p}),n[31]=m,n[32]=F,n[33]=p,n[34]=O):O=n[34],O}l.default=f}),226);
__d("MWJewelNestedFolderThreadListHeader.react",["MWTopNavListDropdownTitle.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(3),n=e.onReturn,a=e.title,i;return t[0]!==n||t[1]!==a?(i=s.jsx(r("MWTopNavListDropdownTitle.react"),{onReturn:n,title:a}),t[0]=n,t[1]=a,t[2]=i):i=t[2],i}l.default=u}),98);
__d("MWXListCellStrict.react",["cr:1357","cr:2004","cr:321","cr:3296","cr:6221","cr:842","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e=["ref"],s,u=s||(s=o("react"));function c(t){var r=o("react-compiler-runtime").c(22),a,i;if(r[0]!==t?(i=t.ref,a=babelHelpers.objectWithoutPropertiesLoose(t,e),r[0]=t,r[1]=a,r[2]=i):(a=r[1],i=r[2]),n("cr:1357")!=null){var l;return r[3]!==a||r[4]!==i?(l=u.jsx(n("cr:1357"),babelHelpers.extends({},a,{ref:i})),r[3]=a,r[4]=i,r[5]=l):l=r[5],l}if(n("cr:321")!=null&&n("cr:6221")!=null&&n("cr:3296")!=null&&n("cr:842")!=null&&n("cr:2004")!=null){var s=a,c=s.addOnStart,d=s.disabled,m=s.headline,p=s.linkProps,_=s.onHoverIn,f=s.onHoverOut,g=s.onPress,h=s.onPressIn,y=s.selected,C=s.testid,b;r[6]!==c||r[7]!==d?(b=c!=null?u.jsx(n("cr:3296"),{addOnStart:c,disabled:d!=null?d:!1}):void 0,r[6]=c,r[7]=d,r[8]=b):b=r[8];var v=b,S;r[9]!==m?(S=u.jsx(n("cr:6221"),{type:"headline4",children:m}),r[9]=m,r[10]=S):S=r[10];var R;return r[11]!==p||r[12]!==_||r[13]!==f||r[14]!==g||r[15]!==h||r[16]!==i||r[17]!==y||r[18]!==S||r[19]!==C||r[20]!==v?(R=u.jsx(n("cr:842"),{paddingHorizontal:8,paddingVertical:0,children:u.jsx(n("cr:2004"),{children:u.jsx(n("cr:321"),{addOnStart:v,content:S,linkProps:p,onHoverIn:_,onHoverOut:f,onPress:g,onPressIn:h,ref:i,selected:y,size:"medium",testid:void 0})})}),r[11]=p,r[12]=_,r[13]=f,r[14]=g,r[15]=h,r[16]=i,r[17]=y,r[18]=S,r[19]=C,r[20]=v,r[21]=R):R=r[21],R}return null}l.default=c}),98);
__d("MWJewelMessageRequestsThread.react",["fbt","FDSChevronLeftFilled16Icon","FDSChevronRightFilled16Icon","FDSIcon.react","FDSMessagesFilled24Icon","I64","LSIntEnum","Locale","MWJewelThreadSnippet.react","MWXListCellStrict.react","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d,m=d||(d=o("react"));function p(){var t=o("react-compiler-runtime").c(5),n=(e||(e=r("useReStore")))(),a;t[0]!==n.tables.contacts||t[1]!==n.tables.threads?(a=function(){return o("ReQL").fromTableDescending(n.tables.threads.index("parentThreadKeyLastActivityTimestampMs")).getKeyRange((u||(u=o("LSIntEnum"))).ofNumber(-1)).filter(_).map(function(e){var t=e.snippetSenderContactId;if(t!=null){var r=o("ReQLSuspense").first(o("ReQL").fromTableAscending(n.tables.contacts).getKeyRange(t),i.id+":51");return r?r.name:void 0}})},t[0]=n.tables.contacts,t[1]=n.tables.threads,t[2]=a):a=t[2];var l;return t[3]!==n?(l=[n],t[3]=n,t[4]=l):l=t[4],o("ReQLSuspense").useFirst(a,l,i.id+":36")}function _(e){return(c||(c=o("I64"))).gt(e.lastActivityTimestampMs,e.lastReadWatermarkTimestampMs)}function f(e){var t=o("react-compiler-runtime").c(17),n=e.onOpenMessageRequests,a=e.unreadRequestsCount,i;t[0]!==a?(i=s._(/*BTDS*/"_j{\"*\":\"Nuevas solicitudes de mensajes\",\"_1\":\"Nueva solicitud de mensaje\"}",[s._plural(a)]),t[0]=a,t[1]=i):i=t[1];var l=i,u;t[2]!==a?(u=s._(/*BTDS*/"_j{\"someone\":\"De alguien que quiz\\u00e1 conozcas\",\"people\":\"De personas que quiz\\u00e1 conozcas\"}",[s._enum(a===1?"someone":"people",{someone:"someone",people:"people"})]),t[2]=a,t[3]=u):u=t[3];var c=u,d=p();if(d!=null)if(a===1){var _;t[4]!==d?(_=s._(/*BTDS*/"De {name}",[s._param("name",d)]),t[4]=d,t[5]=_):_=t[5],c=_}else{var f;t[6]!==d||t[7]!==a?(f=s._(/*BTDS*/"De {name} y {count} m\u00e1s",[s._param("name",d),s._param("count",a-1)]),t[6]=d,t[7]=a,t[8]=f):f=t[8],c=f}var g,h;t[9]===Symbol.for("react.memo_cache_sentinel")?(g={addOn:m.jsx(r("FDSIcon.react"),{color:"secondary",icon:o("Locale").isRTL()?r("FDSChevronLeftFilled16Icon"):r("FDSChevronRightFilled16Icon")}),type:"body"},h={icon:r("FDSMessagesFilled24Icon"),size:56,type:"contained-icon"},t[9]=g,t[10]=h):(g=t[9],h=t[10]);var y;t[11]!==c?(y=m.jsx(r("MWJewelThreadSnippet.react"),{isUnread:!0,text:c}),t[11]=c,t[12]=y):y=t[12];var C;return t[13]!==n||t[14]!==y||t[15]!==l?(C=m.jsx(r("MWXListCellStrict.react"),{addOnEnd:g,addOnStart:h,body:y,headline:l,level:4,onPress:n}),t[13]=n,t[14]=y,t[15]=l,t[16]=C):C=t[16],C}l.default=f}),226);
__d("useMWLSJewelLoadMoreThreads",["Int64Hooks","loadMoreLSThreads","promiseDone","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=o("react-compiler-runtime").c(4),a=(e||(e=r("useReStore")))(),l,s;return n[0]!==t||n[1]!==a?(l=function(){return(function(){var e=a.runInTransaction(function(e){return r("loadMoreLSThreads")(e,t)},"readwrite",void 0,void 0,i.id+":26");r("promiseDone")(e)})},s=[a,t],n[0]=t,n[1]=a,n[2]=l,n[3]=s):(l=n[2],s=n[3]),o("Int64Hooks").useMemoInt64(l,s)}l.default=s}),98);
__d("useMWLSLoadThreadFolderIfNotPresent",["CancellablePromise","CancellationToken","I64","Int64Hooks","ReQL","promiseDone","react-compiler-runtime","useMWLSJewelLoadMoreThreads","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){var n=o("react-compiler-runtime").c(8),a=(s||(s=r("useReStore")))(),i=r("useMWLSJewelLoadMoreThreads")(t),l;n[0]!==a.tables.threads_ranges_v2__generated||n[1]!==i||n[2]!==t?(l=function(){var n=r("CancellationToken")();return r("promiseDone")(o("CancellablePromise").ignoreFailed(void 0,o("CancellablePromise").then_(n,function(e){e==null&&i()},o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.threads_ranges_v2__generated).filter(function(n){return(e||(e=o("I64"))).equal(n.parentThreadKey,t)}))))),n.cancel},n[0]=a.tables.threads_ranges_v2__generated,n[1]=i,n[2]=t,n[3]=l):l=n[3];var u;n[4]!==a||n[5]!==i||n[6]!==t?(u=[i,a,t],n[4]=a,n[5]=i,n[6]=t,n[7]=u):u=n[7],o("Int64Hooks").useEffectInt64(l,u)}l.default=u}),98);
__d("MWLSJewelMessageRequestsThreadContainer.react",["I64","LSIntEnum","MWJewelMessageRequestsThread.react","ReQL","ReQLSuspense","gkx","react","react-compiler-runtime","useMWLSLoadThreadFolderIfNotPresent","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=c||(c=o("react"));function m(){var t=o("react-compiler-runtime").c(4),n=(e||(e=r("useReStore")))(),a;t[0]!==n.tables.threads?(a=function(){return o("ReQL").fromTableDescending(n.tables.threads.index("parentThreadKeyLastActivityTimestampMs")).getKeyRange((s||(s=o("LSIntEnum"))).ofNumber(-1)).filter(p)},t[0]=n.tables.threads,t[1]=a):a=t[1];var l;t[2]!==n?(l=[n],t[2]=n,t[3]=l):l=t[3];var u=o("ReQLSuspense").useArray(a,l,i.id+":27");return u.length}function p(e){return(u||(u=o("I64"))).gt(e.lastActivityTimestampMs,e.lastReadWatermarkTimestampMs)}function _(e){var t=o("react-compiler-runtime").c(4),n=e.onOpenMessageRequests,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=(s||(s=o("LSIntEnum"))).ofNumber(-1),t[0]=a):a=t[0],r("useMWLSLoadThreadFolderIfNotPresent")(a);var i=m();if(n==null||i===0||r("gkx")("17132"))return null;var l;return t[1]!==n||t[2]!==i?(l=d.jsx(r("MWJewelMessageRequestsThread.react"),{onOpenMessageRequests:n,unreadRequestsCount:i}),t[1]=n,t[2]=i,t[3]=l):l=t[3],l}l.default=_}),98);
__d("LSFilteredThreadsRangesQuery",["LSGetCursor","LSIssueNewTaskAndGetTaskID"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.i64.neq(e[10],void 0)?r[0]=e[10]:r[0]=t.i64.cast([0,0]),e[11]!==void 0?r[1]=e[11]:r[1]="",(e[2]&&t.i64.neq(e[7],void 0)&&t.i64.neq(e[4],void 0)||e[3]&&t.i64.neq(e[6],void 0)&&t.i64.neq(e[5],void 0))&&!(e[2]&&t.i64.neq(e[7],void 0)&&t.i64.neq(e[4],void 0)&&e[3]&&t.i64.neq(e[6],void 0)&&t.i64.neq(e[5],void 0))?t.sequence([function(o){return r[3]=e[4]==null?t.i64.cast([-2147483648,0]):e[4],r[4]=e[7]==null?t.i64.cast([0,1]):e[7],r[10]=t.i64.gt(r[4],t.i64.cast([0,1]))&&t.i64.gt(r[3],t.i64.cast([-2147483648,0])),t.storedProcedure(n("LSGetCursor"),t.i64.cast([0,1])).then(function(e){var t;return t=e,r[2]=t[0],t})},function(o){return r[5]=new t.Map,r[5].set("cursor",r[2]),r[5].set("filter",e[1]),r[5].set("is_after",e[3]),r[5].set("parent_thread_key",e[0]),r[5].set("reference_activity_timestamp",e[3]?e[6]:e[7]),r[5].set("reference_thread_key",e[3]?e[5]:e[4]),r[5].set("secondary_filter",r[0]),r[5].set("filter_value",r[1]),r[5].set("sync_group",t.i64.cast([0,1])),t.i64.gt(t.i64.cast([0,0]),t.i64.cast([0,0]))?(r[11]=t.i64.of_float(Date.now()),r[6]=t.i64.add(r[11],t.i64.cast([0,0]))):r[6]=t.i64.cast([0,0]),r[7]=t.toJSON(r[5]),t.storedProcedure(n("LSIssueNewTaskAndGetTaskID"),"trq",t.i64.cast([0,313]),r[7],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,r[6],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[8]=t[0],t})},function(n){return t.filter(t.db.table(247).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&t.i64.eq(n.threadRangeFilter,e[1])&&t.i64.eq(n.secondaryThreadRangeFilter,r[0])&&n.threadRangeFilterValue===r[1]}).next().then(function(n,o){var a=n.done,i=n.value;return a?t.db.table(247).add({folderName:"",parentThreadKey:e[0],minThreadKey:r[3]==null?t.i64.cast([-2147483648,0]):r[3],minLastActivityTimestampMs:r[4]==null?t.i64.cast([0,1]):r[4],threadRangeFilter:e[1],secondaryThreadRangeFilter:r[0],threadRangeFilterValue:r[1],maxLastActivityTimestampMs:t.i64.cast([0,1]),maxThreadKey:t.i64.cast([-2147483648,0]),isLoadingBefore:!0,isLoadingAfter:!1,hasMoreBefore:r[10],hasMoreAfter:!1,syncGroup:t.i64.cast([0,1])}):(o=i.item,t.forEach(t.filter(t.db.table(247).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&t.i64.eq(n.threadRangeFilter,e[1])&&t.i64.eq(n.secondaryThreadRangeFilter,r[0])&&n.threadRangeFilterValue===r[1]}),function(e){var t=e.update,n=e.item;return t({isLoadingBefore:!0,isLoadingAfter:!1,hasMoreBefore:r[10],hasMoreAfter:!1})}))})}]):t.resolve()},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxFilteredThreadsRangesQueryStoredProcedure",e.__tables__=["filtered_threads_ranges_v3__generated"],a.exports=e}),null);
__d("LSFilteredThreadsRangesQueryStoredProcedure",["LSFilteredThreadsRangesQuery","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSFilteredThreadsRangesQuery"),a.parentThreadKey,a.filter,a.isLoadingBefore,a.isLoadingAfter,a.minThreadKey,a.maxThreadKey,a.maxLastActivityTimestampMs,a.minLastActivityTimestampMs,a.numThreads,a.numMessages,a.secondaryFilter,a.filterValue);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MWPBaseThreadListUtils",["I64","LSFactory","LSFilteredThreadsRangesQueryStoredProcedure","LSIntEnum","LSThreadRangeFilter","LSThreadsRangesQueryStoredProcedure","ReQL","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n,a,l,u,c){c===void 0&&(c=!1);var d=(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").NONE));r("promiseDone")((async function(){var m=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.sync_groups).getKeyRange((s||(s=o("LSIntEnum"))).ofNumber(1)));m!=null&&(e||(e=o("I64"))).equal(m.syncStatus,(s||(s=o("LSIntEnum"))).ofNumber(2))&&await t.runInTransaction(function(t){return u==null||u(),d?r("LSThreadsRangesQueryStoredProcedure")(r("LSFactory")(t),{additionalPagesToFetch:(e||(e=o("I64"))).zero,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:e.max_int,maxThreadKey:e.max_int,minLastActivityTimestampMs:e.max_int,minThreadKey:e.max_int,parentThreadKey:n,shouldSkipE2eeThreadsRanges:c}):r("LSFilteredThreadsRangesQueryStoredProcedure")(r("LSFactory")(t),{filter:a,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:(e||(e=o("I64"))).max_int,maxThreadKey:e.max_int,minLastActivityTimestampMs:e.max_int,minThreadKey:e.max_int,parentThreadKey:n,secondaryFilter:l})},"readwrite","ui",void 0,i.id+":56")})())}l.loadMoreThreadsForEmptyRangeDefault=u}),98);
__d("ReQLScrollAnchored.react",["BaseScrollableAreaContext","BaseThemeProvider.react","CometPlaceholder.react","CometSSRSuspendOnServer.react","MWXScrollableAreaStyles","intersectionObserverEntryIsIntersecting","react","react-compiler-runtime","stylex","useResizeObserver"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react")),c=s,d=c.useCallback,m=c.useContext,p=c.useEffect,_=c.useImperativeHandle,f=c.useLayoutEffect,g=c.useMemo,h=c.useRef,y=c.useState,C=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.render=function(){return t.props.children},babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.componentDidUpdate=function(t,n,r){var e=t.children;this.props.componentDidUpdate(e,r)},n.getSnapshotBeforeUpdate=function(t){var e=t.children;return this.props.getSnapshotBeforeUpdate(e)},t})(u.PureComponent),b={hideScrollbar:{MsOverflowStyle:"x1pq812k",scrollbarWidth:"x1rohswg","::-webkit-scrollbar_height":"x1yqm8si","::-webkit-scrollbar_width":"xjx87ck",$$css:!0},overscrollBehaviorContain:{overscrollBehavior:"xish69e",$$css:!0},scrollArea:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"xs83m0k",overflowAnchor:"x1xzczws",overflowX:"x6ikm8r",overflowY:"x1odjw0f",position:"x1n2onr6",width:"xh8yej3",$$css:!0}},v=typeof ResizeObserver!="undefined";function S(e){var t=e.clientHeight,n=e.scrollTop;return n>t*2}function R(e,t){return e-t.scrollTop>t.clientHeight*2}var L=5;function E(t){var n=o("react-compiler-runtime").c(99),a=t.ref,i=t.hasReachedBottom,l=t.hasReachedTop,s=t.setScrollTopInResetForBottomAnchor,c=t.initialAnchor,d=t.initialRenderComplete,g=t.onReachingBottom,E=t.onReachingTop,k=t.onScroll,I=t.onUserScroll,T=t.renderEmptyContent,D=t.renderFooter,x=t.renderHeader,$=t.renderHeaderContentSpacer,P=t.renderLoadingAnimation,N=t.isSufficientContentLoadedAbove,M=t.isSufficientContentLoadedBelow,w=t.headerStyle,A=t.hideScrollbar,F=t.snapThreshold,O=t.xstyle,B=t.shouldOverscrollBehaviourContain,W=t.elements,q=i===void 0?!0:i,U=l===void 0?!0:l,V=s===void 0?!0:s,H=N===void 0?S:N,G=M===void 0?R:M,z=F===void 0?5:F,j=m(r("BaseScrollableAreaContext")),K=h(),Q;n[0]===Symbol.for("react.memo_cache_sentinel")?(Q={getDOMNode:function(){return K==null?void 0:K.current}},n[0]=Q):Q=n[0];var X;n[1]!==j?(X=[].concat(j,[Q]),n[1]=j,n[2]=X):X=n[2];var Y=X,J=h(),Z=h(),ee=y(c),te=ee[0],ne=ee[1],re=h(c),oe=h(null),ae;n[3]!==q||n[4]!==U||n[5]!==H||n[6]!==G||n[7]!==g||n[8]!==E?(ae=function(){var e=K.current,t=Z.current;if(!(e==null||t==null||e.offsetParent===null||t.offsetParent===null)){var n=G(t.clientHeight,e);if(oe.current=e.scrollTop,!n&&!q&&g!=null){g();return}var r=H(e);oe.current=e.scrollTop,!r&&!U&&E!=null&&E()}},n[3]=q,n[4]=U,n[5]=H,n[6]=G,n[7]=g,n[8]=E,n[9]=ae):ae=n[9];var ie=ae,le;n[10]!==W.length||n[11]!==ie?(le=[ie,W.length],n[10]=W.length,n[11]=ie,n[12]=le):le=n[12],p(ie,le);var se;n[13]!==q||n[14]!==z?(se=function(t){if(t.scrollHeight!==t.clientHeight){var e=t.scrollHeight-t.clientHeight-t.scrollTop<z&&q?"bottom":"top";ne(re.current=e),oe.current=t.scrollTop}},n[13]=q,n[14]=z,n[15]=se):se=n[15];var ue=se,ce;n[16]!==k?(ce=function(){var e=K.current,t=oe.current;t==null||e==null||e.scrollTop!==t&&(e.scrollTop=t,k&&k(e))},n[16]=k,n[17]=ce):ce=n[17];var de=ce,me;n[18]!==q||n[19]!==U||n[20]!==c||n[21]!==k||n[22]!==V||n[23]!==z?(me=function(){var e=K.current,t=Z.current;e==null||t==null||(c==="bottom"?(V&&(e.scrollTop=e.scrollHeight),k&&k(e)):U||(e.scrollTop=t.offsetTop,k&&k(e)),q&&e.scrollHeight-e.clientHeight-e.scrollTop<z?ne(re.current="bottom"):ne(re.current=c),oe.current=e.scrollTop)},n[18]=q,n[19]=U,n[20]=c,n[21]=k,n[22]=V,n[23]=z,n[24]=me):me=n[24];var pe=me,_e=h(!1),fe,ge;n[25]!==pe?(fe=function(){_e.current||(pe(),_e.current=!0)},ge=[pe],n[25]=pe,n[26]=fe,n[27]=ge):(fe=n[26],ge=n[27]),f(fe,ge);var he;n[28]!==d||n[29]!==k?(he=function(){var e=K.current;e!=null&&(d&&e.scrollHeight>e.clientHeight&&d(),re.current==="bottom"&&(e.scrollTop=e.scrollHeight,k&&k(e)),oe.current=e.scrollTop)},n[28]=d,n[29]=k,n[30]=he):he=n[30];var ye=he,Ce;n[31]!==ie||n[32]!==k||n[33]!==I||n[34]!==ue?(Ce=function(){var e=K.current;e!=null&&(k&&k(e),e.scrollTop!==oe.current&&(oe.current=null,ie(),ue(e),I&&I()))},n[31]=ie,n[32]=k,n[33]=I,n[34]=ue,n[35]=Ce):Ce=n[35];var be=Ce,ve;n[36]!==ie||n[37]!==ye?(ve=function(){ye(),ie()},n[36]=ie,n[37]=ye,n[38]=ve):ve=n[38];var Se=ve,Re;n[39]!==ye?(Re=function(){return ye()},n[39]=ye,n[40]=Re):Re=n[40];var Le=Re,Ee=r("useResizeObserver")(Le),ke=r("useResizeObserver")(Se),Ie;n[41]!==Ee?(Ie=function(t){Ee(t),Z.current=t},n[41]=Ee,n[42]=Ie):Ie=n[42];var Te=Ie,De;n[43]!==ke?(De=function(t){ke(t),K.current=t},n[43]=ke,n[44]=De):De=n[44];var xe=De,$e;n[45]!==k?($e=function(t,n){if(n!=null){var e=n.element,r=n.height,o=n.scrollAreaElement,a=e.clientHeight;oe.current=o.scrollTop,a!==r&&!(a<=r&&re.current==="bottom")&&(o.scrollTop=o.scrollTop+(a-r),oe.current=o.scrollTop,k&&k(o))}},n[45]=k,n[46]=$e):$e=n[46];var Pe=$e,Ne;n[47]!==q||n[48]!==k?(Ne=function(){if(K.current!=null){var e=K.current;e.scrollTop=e.scrollHeight,oe.current=e.scrollTop,k&&k(e)}ne(re.current=q?"bottom":"top")},n[47]=q,n[48]=k,n[49]=Ne):Ne=n[49];var Me=Ne,we;n[50]===Symbol.for("react.memo_cache_sentinel")?(we=function(){if(K.current!=null){var e=K.current,t=e.scrollHeight-e.scrollTop-e.clientHeight<L;return oe.current=e.scrollTop,t}else return!1},n[50]=we):we=n[50];var Ae=we,Fe=h(null),Oe;n[51]===Symbol.for("react.memo_cache_sentinel")?(Oe=function(t,n){var e=Fe.current,o=K.current;if(e!=null&&o!=null){var a=new IntersectionObserver(function(e){var t=e[0];(t.boundingClientRect.height!==0||t.boundingClientRect.width!==0)&&n(r("intersectionObserverEntryIsIntersecting")(t))},{root:o,rootMargin:t+"px"});return a.observe(e),(function(){return a.disconnect()})}},n[51]=Oe):Oe=n[51];var Be=Oe,We;n[52]===Symbol.for("react.memo_cache_sentinel")?(We=function(){var e=K.current;if(e!=null){var t=e.scrollHeight-e.clientHeight>0;return oe.current=e.scrollTop,t}return!1},n[52]=We):We=n[52];var qe=We,Ue;n[53]===Symbol.for("react.memo_cache_sentinel")?(Ue=function(){var e=K.current;if(e==null)return null;var t={clientHeight:e.clientHeight,scrollHeight:e.scrollHeight,scrollTop:e.scrollTop};return oe.current=e.scrollTop,t},n[53]=Ue):Ue=n[53];var Ve=Ue,He,Ge;n[54]!==pe||n[55]!==de||n[56]!==Me?(He=function(){return{doesContentFillScroll:qe,getScrollAreaElement:function(){return K.current},getScrollerMeasurements:Ve,isAtBottom:Ae,onCloseToBottom:Be,resetScrollPosition:pe,restoreScrollPosition:de,scrollToBottom:Me}},Ge=[qe,Be,pe,de,Me],n[54]=pe,n[55]=de,n[56]=Me,n[57]=He,n[58]=Ge):(He=n[57],Ge=n[58]),_(a,He,Ge);var ze;n[59]!==W[0]||n[60]!==W.length||n[61]!==U?(ze=function(t){var e=Z.current,n=K.current;if(e!=null&&n!=null&&!(U&&n.scrollTop===0)&&(!t.length||W.length&&t[0].key!==W[0].key&&t.length!==W.length)){var r=e.clientHeight;return oe.current=n.scrollTop,{element:e,height:r,scrollAreaElement:n}}return null},n[59]=W[0],n[60]=W.length,n[61]=U,n[62]=ze):ze=n[62];var je;n[63]!==W||n[64]!==Pe||n[65]!==ze?(je=u.jsx(C,{componentDidUpdate:Pe,getSnapshotBeforeUpdate:ze,children:W}),n[63]=W,n[64]=Pe,n[65]=ze,n[66]=je):je=n[66];var Ke=je,Qe;n[67]!==O?(Qe=(e||(e=r("stylex"))).props(O),n[67]=O,n[68]=Qe):Qe=n[68];var Xe;n[69]!==te?(Xe={0:{className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62 x1n2onr6"},1:{className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62 x1n2onr6 x1xzczws"}}[(te==="bottom")<<0],n[69]=te,n[70]=Xe):Xe=n[70];var Ye;n[71]!==Te||n[72]!==W.length||n[73]!==Ke||n[74]!==Pe||n[75]!==ye||n[76]!==be||n[77]!==Se||n[78]!==q||n[79]!==U||n[80]!==w||n[81]!==A||n[82]!==T||n[83]!==D||n[84]!==x||n[85]!==$||n[86]!==P||n[87]!==xe||n[88]!==B?(Ye=u.jsx(r("BaseThemeProvider.react"),{children:function(n,o){return u.jsxs("div",{className:(e||(e=r("stylex")))(b.scrollArea,B===!0&&b.overscrollBehaviorContain,A===!0&&b.hideScrollbar,r("MWXScrollableAreaStyles").themed,n),"data-testid":void 0,onScroll:be,ref:xe,style:o,children:[u.jsx(r("CometPlaceholder.react"),{fallback:null,name:"ReQLScrollAnchored.ScrollArea",children:u.jsx(r("CometSSRSuspendOnServer.react"),{children:!v&&u.jsx("iframe",{className:"x76ihet xtmcdsl x112ta8 x4gj9lk x5yr21d x1o0tod x1ty9z65 xg01cxk x47corl x10l6tqk x1yhy09f xh8yej3",ref:function(t){t!=null&&(t.contentWindow.onresize=Se)}})})}),u.jsxs(C,{componentDidUpdate:Pe,getSnapshotBeforeUpdate:function(){var e=J.current,t=K.current;if(e!=null&&t!=null&&(oe.current=t.scrollTop,oe.current!==0)){var n=e.clientHeight;return{element:e,height:n,scrollAreaElement:t}}return null},children:[u.jsx("div",babelHelpers.extends({},e.props(w),{ref:J,children:U?x&&x():P&&P("onTop",W.length)})),T!=null?T():null]}),$!=null&&$(),u.jsx("div",babelHelpers.extends({},{0:{},1:{className:"x1us19tq"}}[(W.length!==0&&!U&&!q)<<0],{children:u.jsxs("div",{className:"x1n2onr6",ref:Te,children:[u.jsx(r("CometPlaceholder.react"),{fallback:null,name:"ReQLScrollAnchored.elementsHOC",children:u.jsx(r("CometSSRSuspendOnServer.react"),{children:!v&&u.jsx("iframe",{className:"x76ihet xtmcdsl x112ta8 x4gj9lk x5yr21d x1o0tod x1ty9z65 xg01cxk x47corl x10l6tqk x1yhy09f xh8yej3",ref:function(t){t!=null&&(t.contentWindow.onresize=ye)}})})}),Ke,u.jsx("div",{className:"x1ey2m1c xjm9jq1 x1y332i5 x47corl x10l6tqk",ref:Fe}),q?D&&D():P&&P("onBottom",W.length)]})}))]})}}),n[71]=Te,n[72]=W.length,n[73]=Ke,n[74]=Pe,n[75]=ye,n[76]=be,n[77]=Se,n[78]=q,n[79]=U,n[80]=w,n[81]=A,n[82]=T,n[83]=D,n[84]=x,n[85]=$,n[86]=P,n[87]=xe,n[88]=B,n[89]=Ye):Ye=n[89];var Je;n[90]!==Xe||n[91]!==Ye?(Je=u.jsx("div",babelHelpers.extends({},Xe,{children:Ye})),n[90]=Xe,n[91]=Ye,n[92]=Je):Je=n[92];var Ze;n[93]!==Qe||n[94]!==Je?(Ze=u.jsx("div",babelHelpers.extends({},Qe,{children:Je})),n[93]=Qe,n[94]=Je,n[95]=Ze):Ze=n[95];var et;return n[96]!==Y||n[97]!==Ze?(et=u.jsx(r("BaseScrollableAreaContext").Provider,{value:Y,children:Ze}),n[96]=Y,n[97]=Ze,n[98]=et):et=n[98],et}l.default=E}),98);
__d("useStableValue",["I64","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e||(e=o("react"))).useRef;function c(e){return d(e,(s||(s=o("I64"))).equal)}function d(e,t){var n=u(e);return t(n.current,e)||(n.current=e),n.current}l.useStableI64=c,l.useStableValue=d}),98);
__d("useStableBounds",["deepEquals","useStableValue"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("useStableValue").useStableValue(e,r("deepEquals"))}l.default=e}),98);
__d("ReQLPaginatedList.react",["FBLogger","I64","PromiseOrValue","ReQL","ReQLScrollAnchored.react","ReQLSuspense","SortedAsyncIterable","deepEquals","getErrorSafe","promiseDone","react","react-compiler-runtime","useMergeRefs","useStableBounds","useStableValue"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=e||(e=o("react")),d=e,m=d.useCallback,p=d.useEffect,_=d.useLayoutEffect,f=d.useMemo,g=d.useRef,h=d.useState,y=d.useTransition;function C(e,t){return t==null?e:e.bounds(t)}function b(e){if(e instanceof Promise)throw e;return e}function v(e){return{direction:e.direction,iterator:function(n,r){var t=e.iterator(n,r);return{next:function(n){return(s||(s=o("PromiseOrValue"))).map(t.next(n),function(e){return e.done?e:{done:!1,value:[e.value[0],e.value]}})}}},keyLength:e.keyLength,subscribe:function(n,r){return e.subscribe(async function(e,t,r){t.operation==="delete"?await n(e,t,r):t.operation==="add"?await n(e,{operation:"add",value:[e,t.value]},r):t.operation==="put"&&await n(e,{operation:"put",value:[e,t.value]},r)},r)}}}function S(e){var t=e.clientHeight,n=e.scrollTop;return n>t*2}function R(e){var t,n,a,l=o("react-compiler-runtime").c(163),s=e.bounds,u=e.direction,d=e.hasReachedBottom,m=e.hasReachedTop,f=e.imperativeRef,R=e.initialAnchor,T=e.initialRenderComplete,D=e.onDataLoaded,x=e.onPageLoaded,$=e.onReachingBottom,P=e.onReachingTop,N=e.onScroll,M=e.onUserScroll,w=e.pageSize,A=e.renderEmptyContent,F=e.renderFooter,O=e.renderHeader,B=e.renderHeaderContentSpacer,W=e.renderItem,q=e.renderLoadingAnimation,U=e.headerStyle,V=e.isSufficientContentLoadedAbove,H=e.isSufficientContentLoadedBelow,G=e.snapThreshold,z=e.setScrollTopInResetForBottomAnchor,j=e.data,K=e.xstyle,Q=e.isLogDuplicatedItemEnabled,X=e.shouldOverscrollBehaviourContain,Y=u===void 0?"asc":u,J=d===void 0?!0:d,Z=m===void 0?!0:m,ee=w===void 0?15:w,te=V===void 0?S:V,ne=G===void 0?5:G,re=z===void 0?!0:z,oe=j.ascending,ae=j.descending,ie=Q===void 0?!1:Q,le=y(),se=le[1],ue=r("useStableBounds")(s);if(R!=null&&R!=="top"&&R!=="bottom"){var ce;l[0]!==ue||l[1]!==ae||l[2]!==R?(ce=C(ae,ue).bounds({lt:R}).iterator(new WeakMap).next(),l[0]=ue,l[1]=ae,l[2]=R,l[3]=ce):ce=l[3];var de=ce;if(de instanceof Promise)throw de;R=de.done?"top":de.value[0]}var me=o("useStableValue").useStableValue(R,r("deepEquals")),pe,_e;if(me==="top"||me==null){var fe;l[4]===Symbol.for("react.memo_cache_sentinel")?(fe=o("ReQL").empty(),l[4]=fe):fe=l[4],pe=fe,_e=Y==="asc"?oe:ae}else if(me==="bottom"){pe=Y==="asc"?ae:oe;var ge;l[5]===Symbol.for("react.memo_cache_sentinel")?(ge=o("ReQL").empty(),l[5]=ge):ge=l[5],_e=ge}else{var he;l[6]!==oe||l[7]!==ae||l[8]!==Y||l[9]!==me?(he=Y==="asc"?ae.bounds({lt:me}):oe.bounds({gt:me}),l[6]=oe,l[7]=ae,l[8]=Y,l[9]=me,l[10]=he):he=l[10],pe=he;var ye;l[11]!==oe||l[12]!==ae||l[13]!==Y||l[14]!==me?(ye=Y==="asc"?oe.bounds({gte:me}):ae.bounds({lte:me}),l[11]=oe,l[12]=ae,l[13]=Y,l[14]=me,l[15]=ye):ye=l[15],_e=ye}var Ce;l[16]!==_e||l[17]!==pe?(Ce={after:_e,before:pe},l[16]=_e,l[17]=pe,l[18]=Ce):Ce=l[18];var be=Ce,ve=g(!1),Se;l[19]!==ue||l[20]!==me||l[21]!==be.before||l[22]!==ee?(Se=b(o("SortedAsyncIterable").toArray(C(be.before,ue).take(me==="bottom"?ee:0),i.id+":204")).reverse(),l[19]=ue,l[20]=me,l[21]=be.before,l[22]=ee,l[23]=Se):Se=l[23];var Re=Se,Le;l[24]!==ue||l[25]!==be.after||l[26]!==ee?(Le=b(o("SortedAsyncIterable").toArray(C(be.after,ue).take(ee),i.id+":211")),l[24]=ue,l[25]=be.after,l[26]=ee,l[27]=Le):Le=l[27];var Ee=Le,ke=me==="bottom"?!0:Ee.length<ee,Ie=me==="top"||me==null?!0:me==="bottom"?Re.length<ee:!1,Te=Ie?void 0:me==="bottom"?(t=Re[0])==null?void 0:t[0]:(n=Ee[0])==null?void 0:n[0],De=ke||(a=Ee[Ee.length-1])==null?void 0:a[0],xe;l[28]!==Te||l[29]!==De?(xe={firstKey:Te,lastKey:De},l[28]=Te,l[29]=De,l[30]=xe):xe=l[30];var $e=xe,Pe;l[31]!==me||l[32]!==$e||l[33]!==be?(Pe=function(){return{anchor:me,iterables:be,values:$e}},l[31]=me,l[32]=$e,l[33]=be,l[34]=Pe):Pe=l[34];var Ne=h(Pe),Me=Ne[0],we=Ne[1],Ae=Me.iterables===be&&Me.anchor===me,Fe=Ae?Me.values:$e,Oe=Fe.firstKey,Be=Fe.lastKey,We,qe;l[35]!==ue||l[36]!==Y||l[37]!==Oe||l[38]!==be.before||l[39]!==ee?(We=function(){return v(Oe==null?C(be.before,ue).take(ee):C(be.before,ue).bounds(Y==="asc"?{gte:Oe}:{lte:Oe}))},qe=[ue,Y,Oe,be.before,ee],l[35]=ue,l[36]=Y,l[37]=Oe,l[38]=be.before,l[39]=ee,l[40]=We,l[41]=qe):(We=l[40],qe=l[41]);var Ue=o("ReQLSuspense").useArray(We,qe,i.id+":246"),Ve;l[42]!==Ue?(Ve=[].concat(Ue).reverse(),l[42]=Ue,l[43]=Ve):Ve=l[43];var He=Ve,Ge;l[44]!==He[0]||l[45]!==He.length||l[46]!==Oe||l[47]!==me||l[48]!==be||l[49]!==Be||l[50]!==ee?(Ge=function(){He.length===ee&&Oe==null&&se(function(){return we({anchor:me,iterables:be,values:{firstKey:He[0][0],lastKey:Be}})})},l[44]=He[0],l[45]=He.length,l[46]=Oe,l[47]=me,l[48]=be,l[49]=Be,l[50]=ee,l[51]=Ge):Ge=l[51];var ze;l[52]!==He||l[53]!==Oe||l[54]!==me||l[55]!==be||l[56]!==Be||l[57]!==ee?(ze=[He,Oe,me,be,Be,ee],l[52]=He,l[53]=Oe,l[54]=me,l[55]=be,l[56]=Be,l[57]=ee,l[58]=ze):ze=l[58],p(Ge,ze);var je,Ke;l[59]!==ue||l[60]!==Y||l[61]!==be.after||l[62]!==Be||l[63]!==ee?(je=function(){return v(Be==null?C(be.after,ue).take(ee):C(be.after,ue).bounds(Y==="asc"?{lte:Be}:{gte:Be}))},Ke=[ue,Y,be.after,Be,ee],l[59]=ue,l[60]=Y,l[61]=be.after,l[62]=Be,l[63]=ee,l[64]=je,l[65]=Ke):(je=l[64],Ke=l[65]);var Qe=o("ReQLSuspense").useArray(je,Ke,i.id+":273"),Xe,Ye;l[66]!==Qe||l[67]!==Oe||l[68]!==me||l[69]!==be||l[70]!==Be||l[71]!==ee?(Xe=function(){Qe.length===ee&&Be==null&&se(function(){return we({anchor:me,iterables:be,values:{firstKey:Oe,lastKey:Qe[Qe.length-1][0]}})})},Ye=[Qe,Oe,me,be,Be,ee],l[66]=Qe,l[67]=Oe,l[68]=me,l[69]=be,l[70]=Be,l[71]=ee,l[72]=Xe,l[73]=Ye):(Xe=l[72],Ye=l[73]),p(Xe,Ye);var Je;l[74]!==Qe||l[75]!==He?(Je=[].concat(He,Qe),l[74]=Qe,l[75]=He,l[76]=Je):Je=l[76];var Ze=Je,et,tt;l[77]!==Ze||l[78]!==D?(et=function(){D==null||D(Ze)},tt=[Ze,D],l[77]=Ze,l[78]=D,l[79]=et,l[80]=tt):(et=l[79],tt=l[80]),p(et,tt);var nt;l[81]!==ue||l[82]!==Y||l[83]!==Ze[0]||l[84]!==Ze.length||l[85]!==be.before?(nt=function(){return Ze.length===0?o("ReQL").empty():C(be.before,ue).bounds(Y==="asc"?{lt:Ze[0][0]}:{gt:Ze[0][0]})},l[81]=ue,l[82]=Y,l[83]=Ze[0],l[84]=Ze.length,l[85]=be.before,l[86]=nt):nt=l[86];var rt;l[87]!==ue||l[88]!==Y||l[89]!==Ze||l[90]!==be.before?(rt=[Ze,ue,Y,be.before],l[87]=ue,l[88]=Y,l[89]=Ze,l[90]=be.before,l[91]=rt):rt=l[91];var ot=o("ReQLSuspense").useFirst(nt,rt,i.id+":305")==null,at,it;l[92]!==ue||l[93]!==Y||l[94]!==Ze||l[95]!==be.after?(at=function(){return Ze.length===0?o("ReQL").empty():C(be.after,ue).bounds(Y==="asc"?{gt:Ze[Ze.length-1][0]}:{lt:Ze[Ze.length-1][0]})},it=[Ze,ue,Y,be.after],l[92]=ue,l[93]=Y,l[94]=Ze,l[95]=be.after,l[96]=at,l[97]=it):(at=l[96],it=l[97]);var lt=o("ReQLSuspense").useFirst(at,it,i.id+":315")==null,st=y(),ut=st[0],ct=st[1],dt;l[98]!==oe||l[99]!==ue||l[100]!==ae||l[101]!==Y||l[102]!==Ze||l[103]!==Oe||l[104]!==lt||l[105]!==J||l[106]!==me||l[107]!==ut||l[108]!==be||l[109]!==x||l[110]!==$||l[111]!==ee?(dt=function(){if(!(ve.current||ut))if(lt){if(!J&&$!=null)return $()}else{ve.current=!0,r("promiseDone")(Promise.resolve(o("SortedAsyncIterable").toArray(C(Y==="asc"?oe:ae,ue).bounds(Y==="asc"?{gt:Ze[Ze.length-1][0]}:{lt:Ze[Ze.length-1][0]}).take(ee),i.id+":342")),function(e){ve.current=!1,x!=null&&x("bottom",Ze[Ze.length-1][1],e.map(k)),ct(function(){var t,n;return we({anchor:me,iterables:be,values:{firstKey:Oe,lastKey:(t=(n=e[e.length-1])==null?void 0:n[0])!=null?t:Ze[Ze.length-1][0]}})})});return}},l[98]=oe,l[99]=ue,l[100]=ae,l[101]=Y,l[102]=Ze,l[103]=Oe,l[104]=lt,l[105]=J,l[106]=me,l[107]=ut,l[108]=be,l[109]=x,l[110]=$,l[111]=ee,l[112]=dt):dt=l[112];var mt=dt,pt=y(),_t=pt[0],ft=pt[1],gt=g(!0),ht;l[113]!==oe||l[114]!==ue||l[115]!==ae||l[116]!==Y||l[117]!==Ze||l[118]!==ot||l[119]!==Z||l[120]!==me||l[121]!==_t||l[122]!==be||l[123]!==Be||l[124]!==x||l[125]!==P||l[126]!==ee?(ht=function(){if(!(ve.current||_t)){if(ot)return Z||P==null?void 0:P();ve.current=!0,r("promiseDone")(Promise.resolve(o("SortedAsyncIterable").toArray(C(Y==="asc"?ae:oe,ue).bounds(Y==="asc"?{lt:Ze[0][0]}:{gt:Ze[0][0]}).take(ee),i.id+":414")),function(e){ve.current=!1,x!=null&&(gt.current?(gt.current=!1,x("top",null,Ze.slice(0,ee).map(E).reverse())):x("top",Ze[0][1],e.map(L))),e.reverse(),ft(function(){var t,n;return we({anchor:me,iterables:be,values:{firstKey:(t=(n=e[0])==null?void 0:n[0])!=null?t:Ze[0][0],lastKey:Be}})})})}},l[113]=oe,l[114]=ue,l[115]=ae,l[116]=Y,l[117]=Ze,l[118]=ot,l[119]=Z,l[120]=me,l[121]=_t,l[122]=be,l[123]=Be,l[124]=x,l[125]=P,l[126]=ee,l[127]=ht):ht=l[127];var yt=ht,Ct=ot&&Z?0:1,bt=Ze.length-(lt&&J?0:1),vt;if(l[128]!==Ze||l[129]!==Ct||l[130]!==W||l[131]!==bt){vt=new Array(bt>Ct?bt-Ct:0);for(var St=Ct;St<bt;St++){var Rt,Lt;vt[St-Ct]=W(Ze[St][1],{nextItem:(Rt=Ze[St+1])==null?void 0:Rt[1],previousItem:(Lt=Ze[St-1])==null?void 0:Lt[1]},bt-Ct-St)}l[128]=Ze,l[129]=Ct,l[130]=W,l[131]=bt,l[132]=vt}else vt=l[132];var Et=vt,kt=g(null),It=r("useMergeRefs")(kt,f),Tt;l[133]===Symbol.for("react.memo_cache_sentinel")?(Tt=function(){var e;(e=kt.current)==null||e.resetScrollPosition()},l[133]=Tt):Tt=l[133];var Dt;l[134]!==me?(Dt=[me],l[134]=me,l[135]=Dt):Dt=l[135],_(Tt,Dt);var xt;l[136]!==Ze||l[137]!==F?(xt=function(){return F==null?void 0:F(Ze.length>0?Ze[Ze.length-1][1]:void 0)},l[136]=Ze,l[137]=F,l[138]=xt):xt=l[138];var $t=xt;I(ie,Ze);var Pt=lt&&J,Nt=ot&&Z,Mt=me==="bottom"?"bottom":"top",wt;return l[139]!==Et||l[140]!==U||l[141]!==T||l[142]!==te||l[143]!==H||l[144]!==mt||l[145]!==yt||l[146]!==N||l[147]!==M||l[148]!==ee||l[149]!==It||l[150]!==A||l[151]!==$t||l[152]!==O||l[153]!==B||l[154]!==q||l[155]!==re||l[156]!==X||l[157]!==ne||l[158]!==Pt||l[159]!==Nt||l[160]!==Mt||l[161]!==K?(wt=c.jsx(r("ReQLScrollAnchored.react"),{elements:Et,hasReachedBottom:Pt,hasReachedTop:Nt,headerStyle:U,initialAnchor:Mt,initialRenderComplete:T,isSufficientContentLoadedAbove:te,isSufficientContentLoadedBelow:H,onReachingBottom:mt,onReachingTop:yt,onScroll:N,onUserScroll:M,pageSize:ee,ref:It,renderEmptyContent:A,renderFooter:$t,renderHeader:O,renderHeaderContentSpacer:B,renderLoadingAnimation:q,setScrollTopInResetForBottomAnchor:re,shouldOverscrollBehaviourContain:X,snapThreshold:ne,xstyle:K}),l[139]=Et,l[140]=U,l[141]=T,l[142]=te,l[143]=H,l[144]=mt,l[145]=yt,l[146]=N,l[147]=M,l[148]=ee,l[149]=It,l[150]=A,l[151]=$t,l[152]=O,l[153]=B,l[154]=q,l[155]=re,l[156]=X,l[157]=ne,l[158]=Pt,l[159]=Nt,l[160]=Mt,l[161]=K,l[162]=wt):wt=l[162],wt}function L(e){return e[1]}function E(e){return e[1]}function k(e){return e[1]}function I(e,t){var n=h(!1),a=n[0],i=n[1];p(function(){try{if(e&&!a){var n=new Set,l=[];for(var s of t){var c=s[1];if(typeof c=="object"&&(c==null?void 0:c.threadKey)!=null&&(u||(u=o("I64"))).isI64(c==null?void 0:c.threadKey)){var d=(u||(u=o("I64"))).to_string(c==null?void 0:c.threadKey);n.has(d)&&l.push(d),n.add(d)}}n.size!==t.length&&(i(!0),r("FBLogger")("messenger_web").warn("Duplicated thread item detected in ReQLPaginatedList %s",l.join(",")))}}catch(e){var m=r("getErrorSafe")(e);r("FBLogger")("messenger_web").warn("Duplicated thread item error",m.message)}},[t,a,e])}l.default=R}),98);
__d("useMWCMMarkBumpedThreadsSeen",["Int64Hooks","react-compiler-runtime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("MWCMMarkBumpedThreadsSeen").__setRef("useMWCMMarkBumpedThreadsSeen");function s(t){var n=o("react-compiler-runtime").c(3),r,a;return n[0]!==t?(r=function(){return{load:async function(){var n=await e.load();return(function(e){return n.MWCMMarkBumpedThreadsSeen(t,e)})}}},a=[t],n[0]=t,n[1]=r,n[2]=a):(r=n[1],a=n[2]),o("Int64Hooks").useMemoInt64(r,a)}l.default=s}),98);
__d("useMarkSeenWhenVisible",["CometDebounce","Int64Hooks","ReQL","UserActivity","promiseDone","react","useMWCMMarkBumpedThreadsSeen","useMWPMarkSeen","useMWPWatchFolderFocusChanges","useReStore","useSimpleImpression","useVisibilityObserver"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react")),c=u.useCallback,d=u.useRef;function m(t){var n=(e||(e=r("useReStore")))(),a=d(!1),l=r("useMWCMMarkBumpedThreadsSeen")(t),s=r("useVisibilityObserver")({onHidden:function(){a.current=!1},onVisible:function(){a.current=!0}}),u=r("useMWPMarkSeen")(t),m=r("CometDebounce")(c(function(){r("promiseDone")((async function(){var e=await Promise.all([u.load(),l.load()]),t=e[0],r=e[1];await n.runInTransaction(async function(e){await t(e),await r(e)},"readwrite",void 0,void 0,i.id+":56")})())},[u,l,n]),{leading:!0,wait:500});return r("useMWPWatchFolderFocusChanges")(m,a),r("useSimpleImpression")(m),o("Int64Hooks").useEffectInt64(function(){return o("ReQL").fromTableDescending(n.tables.threads.index("parentThreadKeyLastActivityTimestampMs"),[]).getKeyRange(t).take(1).subscribe(function(){r("UserActivity").isOnTab()&&a.current===!0&&m()})},[n,t,m]),s}l.default=m}),98);
__d("MWPBaseThreadList.react",["Box.react","FBLogger","I64","Int64Hooks","LSFactory","LSFilteredThreadsRangesQueryStoredProcedure","LSIntEnum","LSThreadRangeFilter","LSThreadsRangesQueryStoredProcedure","MAWMaybeWithTimeout","MWPBaseThreadListHooks","MWPBaseThreadListUtils","MWThreadListFocusableTable.react","ReQL","ReQLPaginatedList.react","ReQLSuspense","react","react-compiler-runtime","useMarkSeenWhenVisible","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=s||(s=o("react")),m=s,p=m.useCallback,_=m.useEffect,f={container:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"xs83m0k",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0},emptyContentContainer:{alignItems:"x6s0dn4",display:"x78zum5",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0},list:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0}},g=1e4;function h(e,t,n,a){a===void 0&&(a=!1),o("MAWMaybeWithTimeout").maybeWithTimeout(e.runInTransaction(async function(e){var i,l=await(i=e.threads_ranges_v2__generated).get.apply(i,t);if(!(l==null||l.isLoadingBefore))return n&&n(),r("LSThreadsRangesQueryStoredProcedure")(r("LSFactory")(e),{additionalPagesToFetch:(u||(u=o("I64"))).zero,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:l.maxLastActivityTimestampMs,maxThreadKey:l.maxThreadKey,minLastActivityTimestampMs:l.minLastActivityTimestampMs,minThreadKey:l.minThreadKey,parentThreadKey:l.parentThreadKey,shouldSkipE2eeThreadsRanges:a})},"readwrite","ui",void 0,i.id+":91"),g,function(){r("FBLogger")("messenger_web").warn("Paginated threads load took longer than "+g/1e3+` seconds.
        parent_thread_key: `+(u||(u=o("I64"))).to_string(t[0])+`
        min_thread_key: `+u.to_string(t[1])+`
        min_last_activity_timestamp_ms: `+u.to_string(t[2]))})}function y(e,t,n,a,l){a===void 0&&(a=(c||(c=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").NONE)),o("MAWMaybeWithTimeout").maybeWithTimeout(e.runInTransaction(async function(e){var o,i=await(o=e.filtered_threads_ranges_v3__generated).get.apply(o,t);if(!(i==null||i.isLoadingBefore))return l&&l(),r("LSFilteredThreadsRangesQueryStoredProcedure")(r("LSFactory")(e),{filter:n,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:i.maxLastActivityTimestampMs,maxThreadKey:i.maxThreadKey,minLastActivityTimestampMs:i.minLastActivityTimestampMs,minThreadKey:i.minThreadKey,parentThreadKey:i.parentThreadKey,secondaryFilter:a})},"readwrite","ui",void 0,i.id+":150"),g,function(){r("FBLogger")("messenger_web").warn("Filtered paginated threads load took longer than "+g/1e3+` seconds.
        parent_thread_key: `+(u||(u=o("I64"))).to_string(t[0])+`
        min_thread_key: `+u.to_string(t[1])+`
        min_last_activity_timestamp_ms: `+u.to_string(t[2])+`
        thread_range_filter: `+u.to_string(t[3])+`
        secondary_thread_range_filter: `+u.to_string(t[5]))})}function C(e,t,n,a,i,l){if(a===void 0&&(a=(c||(c=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").NONE)),l===void 0&&(l=!1),t!=null)if(t.threadRangeFilter){var u=[t.parentThreadKey,t.minThreadKey,t.minLastActivityTimestampMs,t.threadRangeFilter,t.folderName,t.secondaryThreadRangeFilter,t.threadRangeFilterValue];y(e,u,n,a,i)}else{var s=[t.parentThreadKey,t.minThreadKey,t.minLastActivityTimestampMs];h(e,s,i,l)}}function b(e,t,n,a){var l=o("react-compiler-runtime").c(14),s;l[0]!==n?(s=(u||(u=o("I64"))).equal(n,(c||(c=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").NONE)),l[0]=n,l[1]=s):s=l[1];var d=s,m,p;l[2]!==e||l[3]!==d||l[4]!==t?(m=function(){return d?o("ReQL").fromTableDescending(e.tables.threads_ranges_v2__generated).getKeyRange(t):o("ReQL").empty()},p=[e,t,d],l[2]=e,l[3]=d,l[4]=t,l[5]=m,l[6]=p):(m=l[5],p=l[6]);var _=o("ReQLSuspense").useFirst(m,p,i.id+":250"),f,g;l[7]!==e||l[8]!==n||l[9]!==d||l[10]!==t||l[11]!==a?(f=function(){return d?o("ReQL").empty():o("ReQL").fromTableDescending(e.tables.filtered_threads_ranges_v3__generated).getKeyRange(t).filter(function(e){return(u||(u=o("I64"))).equal(e.threadRangeFilter,n)&&(a==null||(u||(u=o("I64"))).equal(e.secondaryThreadRangeFilter,a))})},g=[e,n,t,a,d],l[7]=e,l[8]=n,l[9]=d,l[10]=t,l[11]=a,l[12]=f,l[13]=g):(f=l[12],g=l[13]);var h=o("ReQLSuspense").useFirst(f,g,i.id+":257");return d?_:h}function v(t){var n=o("react-compiler-runtime").c(71),a=t.afterContent,l=t.beforeContent,s=t.containerStyle,m=t.customThreadFilter,p=t.emptyContent,g=t.filter,h=t.gridLabel,y=t.imperativeRef,v=t.isSufficientContentLoadedBelow,S=t.loadMoreThreads,R=t.loadMoreThreadsForEmptyRange,L=t.onDataLoaded,E=t.onLoadMoreThreads,k=t.onReachingTop,I=t.onScroll,T=t.onThreadsLoaded,D=t.pageSize,x=t.parentThreadKey,$=t.renderItem,P=t.renderLoadingAnimation,N=t.role,M=t.secondaryFilter,w=t.setIsEmptyInbox,A=t.shouldSkipE2eeThreadsRanges,F;n[0]!==g?(F=g===void 0?(c||(c=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").NONE):g,n[0]=g,n[1]=F):F=n[1];var O=F,B=S===void 0?C:S,W=R===void 0?o("MWPBaseThreadListUtils").loadMoreThreadsForEmptyRangeDefault:R,q=N===void 0?"grid":N,U=A===void 0?!1:A,V=(e||(e=r("useReStore")))(),H=b(V,x,O,M);H!=null&&!H.isLoadingBefore&&T&&T();var G=o("MWPBaseThreadListHooks").useMWPBaseThreadListBounds(H),z;n[2]!==m||n[3]!==V||n[4]!==x?(z={customThreadFilter:m,db:V,parentThreadKey:x},n[2]=m,n[3]=V,n[4]=x,n[5]=z):z=n[5];var j=o("MWPBaseThreadListHooks").useMWPBaseThreadListFilteredData(z),K;n[6]!==G||n[7]!==j.descending?(K=function(){return j.descending.bounds(G)},n[6]=G,n[7]=j.descending,n[8]=K):K=n[8];var Q;n[9]!==G||n[10]!==j?(Q=[G,j],n[9]=G,n[10]=j,n[11]=Q):Q=n[11];var X=o("ReQLSuspense").useFirst(K,Q,i.id+":345")==null,Y,J;n[12]!==X||n[13]!==w?(Y=function(){w&&w(X)},J=[X,w],n[12]=X,n[13]=w,n[14]=Y,n[15]=J):(Y=n[14],J=n[15]),_(Y,J);var Z,ee;n[16]!==V||n[17]!==H||n[18]!==O||n[19]!==W||n[20]!==E||n[21]!==x||n[22]!==M?(Z=function(){H==null&&W(V,x,O,M,E)},ee=[x,H,V,O,M,E,W],n[16]=V,n[17]=H,n[18]=O,n[19]=W,n[20]=E,n[21]=x,n[22]=M,n[23]=Z,n[24]=ee):(Z=n[23],ee=n[24]),o("Int64Hooks").useEffectInt64(Z,ee);var te=r("useMarkSeenWhenVisible")(x),ne;n[25]!==V||n[26]!==H||n[27]!==O||n[28]!==B||n[29]!==E||n[30]!==M||n[31]!==U?(ne=function(){B(V,H,O,M,E,U)},n[25]=V,n[26]=H,n[27]=O,n[28]=B,n[29]=E,n[30]=M,n[31]=U,n[32]=ne):ne=n[32];var re=ne,oe;n[33]!==$?(oe=function(t){return d.jsx(d.Fragment,{children:$(t)},(u||(u=o("I64"))).to_string(t.threadKey))},n[33]=$,n[34]=oe):oe=n[34];var ae=oe,ie;if(H==null){var le;n[35]!==P?(le=P!=null?P("nullState",0):null,n[35]=P,n[36]=le):le=n[36],ie=le}else{var se=!H.hasMoreBefore,ue=!H.hasMoreAfter,ce;n[37]!==H.isLoadingAfter||n[38]!==H.isLoadingBefore||n[39]!==p||n[40]!==X?(ce=function(){return X&&!H.isLoadingAfter&&!H.isLoadingBefore?d.jsx(r("Box.react"),{xstyle:f.emptyContentContainer,children:p}):null},n[37]=H.isLoadingAfter,n[38]=H.isLoadingBefore,n[39]=p,n[40]=X,n[41]=ce):ce=n[41];var de;n[42]!==a?(de=function(){return a},n[42]=a,n[43]=de):de=n[43];var me;n[44]!==l?(me=function(){return l},n[44]=l,n[45]=me):me=n[45];var pe;n[46]!==G||n[47]!==j||n[48]!==y||n[49]!==v||n[50]!==L||n[51]!==re||n[52]!==k||n[53]!==I||n[54]!==D||n[55]!==ae||n[56]!==P||n[57]!==se||n[58]!==ue||n[59]!==ce||n[60]!==de||n[61]!==me?(pe=d.jsx(o("MWThreadListFocusableTable.react").MWThreadListFocusableTable,{children:d.jsx(r("ReQLPaginatedList.react"),{bounds:G,data:j,direction:"desc",hasReachedBottom:se,hasReachedTop:ue,imperativeRef:y,isLogDuplicatedItemEnabled:!0,isSufficientContentLoadedBelow:v,onDataLoaded:L,onReachingBottom:re,onReachingTop:k,onScroll:I,pageSize:D,renderEmptyContent:ce,renderFooter:de,renderHeader:me,renderItem:ae,renderLoadingAnimation:P,shouldOverscrollBehaviourContain:!0,xstyle:f.list})}),n[46]=G,n[47]=j,n[48]=y,n[49]=v,n[50]=L,n[51]=re,n[52]=k,n[53]=I,n[54]=D,n[55]=ae,n[56]=P,n[57]=se,n[58]=ue,n[59]=ce,n[60]=de,n[61]=me,n[62]=pe):pe=n[62],ie=pe}var _e;n[63]!==s?(_e=[f.container,s],n[63]=s,n[64]=_e):_e=n[64];var fe;return n[65]!==ie||n[66]!==h||n[67]!==q||n[68]!==_e||n[69]!==te?(fe=d.jsx(r("Box.react"),{"aria-label":h,"data-testid":void 0,ref:te,role:q,xstyle:_e,children:ie}),n[65]=ie,n[66]=h,n[67]=q,n[68]=_e,n[69]=te,n[70]=fe):fe=n[70],fe}l.default=v}),98);
__d("MWPParentThreadKeyContext",["react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.createContext(null);l.default=u}),98);
__d("MWThreadListFolderItem.react",["BaseView.react","CometTextWithEntities.react","I64","MAWVault","MWAddOnCircleContainer.react","MWCMThreadTypes.react","MWChatTextTransform","MWPIsThreadUnread","MWThreadListFocusableTable.react","MWThreadListLastMessage.react","MWXListCellPressable.react","MWXTextPairing.react","react","react-compiler-runtime","useMatchMedia"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useMemo;function p(e){var t=o("react-compiler-runtime").c(28),n=e.icon,a=e.onClick,i=e.responsive,l=e.selected,c=e.size,d=e.thread,m=e.threadName,p=r("useMatchMedia")("(min-width: 900px)")||!i,_;t[0]!==d.snippet?(_=d.snippet!=null?o("MAWVault").unvault(d.snippet):null,t[0]=d.snippet,t[1]=_):_=t[1];var f=_,g;t[2]!==d.lastActivityTimestampMs?(g=(s||(s=o("I64"))).to_float(d.lastActivityTimestampMs),t[2]=d.lastActivityTimestampMs,t[3]=g):g=t[3];var h=g,y=o("MWPIsThreadUnread").useIsThreadUnread(d.threadKey),C;t[4]!==n||t[5]!==c?(C=u.jsx(r("MWAddOnCircleContainer.react"),{size:c,children:n}),t[4]=n,t[5]=c,t[6]=C):C=t[6];var b=C,v=m!=null?m:d.threadName,S;t[7]!==a?(S=function(){return a()},t[7]=a,t[8]=S):S=t[8];var R=S,L;t[9]===Symbol.for("react.memo_cache_sentinel")?(L={className:"xmzvs34 xf159sx"},t[9]=L):L=t[9];var E;t[10]!==p||t[11]!==y||t[12]!==h||t[13]!==f||t[14]!==d.threadType?(E=p?u.jsx(r("MWThreadListLastMessage.react"),{hasOngoingCall:!1,isUnread:y,lastMessageCtaType:null,lastMessageTimestamp:h,showTimestamp:!o("MWCMThreadTypes.react").isUnjoinedCMThread(d.threadType),snippet:f}):null,t[10]=p,t[11]=y,t[12]=h,t[13]=f,t[14]=d.threadType,t[15]=E):E=t[15];var k;t[16]!==v||t[17]!==p?(k=p?u.jsx(r("CometTextWithEntities.react"),{text:v.toString(),transforms:o("MWChatTextTransform").textTransforms}):null,t[16]=v,t[17]=p,t[18]=k):k=t[18];var I=!y,T;t[19]!==E||t[20]!==k||t[21]!==I?(T=u.jsx(r("MWXTextPairing.react"),{body:E,bodyLineLimit:1,headline:k,headlineLineLimit:1,level:4,reduceEmphasis:I}),t[19]=E,t[20]=k,t[21]=I,t[22]=T):T=t[22];var D;return t[23]!==b||t[24]!==R||t[25]!==l||t[26]!==T?(D=u.jsx(r("BaseView.react"),{testid:void 0,children:u.jsx(o("MWThreadListFocusableTable.react").MWThreadListFocusableTableRow,{children:u.jsx("div",{role:"row",children:u.jsx(o("MWThreadListFocusableTable.react").MWThreadListFocusableTableCell,{children:u.jsx("div",babelHelpers.extends({},L,{role:"gridcell",children:u.jsx(r("MWXListCellPressable.react"),{addOnStart:b,content:T,onPress:R,selected:l,size:"large"})}))})})})}),t[23]=b,t[24]=R,t[25]=l,t[26]=T,t[27]=D):D=t[27],D}l.default=p}),98);
__d("MWThreadListJobsItem.react",["fbt","ix","LSIntEnum","MWThreadListFolderItem.react","MWXIcon_DEPRECATED.react","fbicon","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s,u){"use strict";var e,c,d=e||(e=o("react"));function m(e){var t=o("react-compiler-runtime").c(11),n=e.onClick,a=e.responsive,i=e.selected,l=e.size,m=e.thread,p;t[0]!==n?(p=function(){return n((c||(c=o("LSIntEnum"))).ofNumber(-13))},t[0]=n,t[1]=p):p=t[1];var _=p,f;t[2]===Symbol.for("react.memo_cache_sentinel")?(f=d.jsx(r("MWXIcon_DEPRECATED.react"),{color:"primary",icon:o("fbicon")._(u("512668"),32),size:48}),t[2]=f):f=t[2];var g;t[3]===Symbol.for("react.memo_cache_sentinel")?(g=(c||(c=o("LSIntEnum"))).ofNumber(-13),t[3]=g):g=t[3];var h;t[4]===Symbol.for("react.memo_cache_sentinel")?(h=s._(/*BTDS*/"Empleos").toString(),t[4]=h):h=t[4];var y;return t[5]!==_||t[6]!==a||t[7]!==i||t[8]!==l||t[9]!==m?(y=d.jsx(r("MWThreadListFolderItem.react"),{icon:f,onClick:_,responsive:a,selected:i,size:l,systemFolder:g,thread:m,threadName:h}),t[5]=_,t[6]=a,t[7]=i,t[8]=l,t[9]=m,t[10]=y):y=t[10],y}l.default=m}),226);
__d("MWThreadList.react",["CometHeroHoldTrigger.react","CometHideableComponentExperiment.react","CometPageletWithDiv.react","CometRouterFocusRegion.react","CometTransientDialogProvider.react","CometVisualCompletion","CurrentEnvironment","FBLogger","FocusRegion.react","FocusRegionType","GroupsCometChatsEngagementLogger","I64","Int64Hooks","LSAuthorityLevel","LSIntEnum","LSThreadBitOffset","MWCMGetValidId","MWCreatorMessagingUtils","MWJewelPopoverThreadlistContext.react","MWLSJewelMessageRequestsThreadContainer.react","MWPBaseThreadList.react","MWPBumpEntityKey","MWPParentThreadKeyContext","MWPThreadIsPage.react","MWPThreadsForThreadList","MWResponsiveLayoutConstants","MWResponsiveLayoutContext.react","MWThreadKey.react","MWThreadListEmptyContainer.react","MWThreadListGlimmer.react","MWThreadListItem.react","MWThreadListJobsItem.react","MWThreadListSupportedThreadTypes","MWXacGating","MessagingFolderTag","MessengerWebUXLogger","QPLUserFlow","ReQL","ReQLSuspense","VirtualizationContainerContext","cr:12043","cr:13568","cr:21161","cr:21162","cr:2261","cr:6055","emptyFunction","focusScopeQueries","gkx","isMWXacGroupThread","mwCMIsThreadBumped","qpl","react","react-compiler-runtime","useCommunityFolder","useEmptyFunction","useGroupsCometIsInCCNegativeTest","useMWGetInboxFocusTargetFromRoute","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=d||(d=o("react")),f=d,g=f.useCallback,h=f.useContext,y=f.useId,C=f.useMemo,b=f.useRef;function v(e){var t=o("react-compiler-runtime").c(1),n;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n={computeInboxFollowUps:S,reminders:[]},t[0]=n):n=t[0],n}function S(){}var R=(e=n("cr:12043"))!=null?e:{useInboxFollowUps:v},L=(s=(u=n("cr:21162"))==null?void 0:u.useFilterPinnedThreads)!=null?s:r("useEmptyFunction"),E=n("cr:6055")||r("useEmptyFunction");function k(e){return(m||(m=o("I64"))).equal(e.threadType,(p||(p=o("LSIntEnum"))).ofNumber(15))&&(m||(m=o("I64"))).equal(e.authorityLevel,(p||(p=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))&&(m||(m=o("I64"))).equal(e.lastReadWatermarkTimestampMs,(m||(m=o("I64"))).of_int32(-1))&&(m||(m=o("I64"))).equal(e.lastActivityTimestampMs,(m||(m=o("I64"))).of_int32(-1))}var I=5;function T(e){var t=e.lsEntryPoint,a=e.lsSubEntryPoint,i=e.messagingEntrypoint,l=e.onClickNestedFolderThread,s=e.onClose,u=e.responsive,c=e.selected,d=e.showFollowUpReminder,f=e.thread,g=h(r("MWJewelPopoverThreadlistContext.react")),y=r("useCommunityFolder")({parentThreadKey:(m||(m=o("I64"))).equal(f.threadType,(p||(p=o("LSIntEnum"))).ofNumber(17))?f.threadKey:f.parentThreadKey}),C=h(r("MWResponsiveLayoutContext.react")),v=C.pushCard,S=f.threadKey;o("Int64Hooks").useEffectInt64(function(){if(n("cr:2261")!=null)return g==null||g.add(S),function(){g==null||g.delete(S)}},[g,S]);var R=b({loggingTimeout:null,threadKey:(m||(m=o("I64"))).of_int32(-1)}),L=b(m.of_int32(-1)),E=h(r("MWPParentThreadKeyContext"));o("Int64Hooks").useEffectInt64(function(){if(E!=null){var e=(m||(m=o("I64"))).to_string(f.parentThreadKey),t=m.to_string(E);!(m||(m=o("I64"))).equal(L.current,S)&&f.folderName!==r("MessagingFolderTag").COMMUNITY&&e!==t&&r("FBLogger")("messenger_threadlist_folder_inconsistency").mustfix("Render thread item expected folder %s but receive %s",t,e)}k(f)?(m||(m=o("I64"))).equal(R.current.threadKey,S)||(R.current.threadKey=S,R.current.loggingTimeout=window.setTimeout(function(){r("FBLogger")("messenger_web").mustfix("Thread ID %s showing up as ghost",(m||(m=o("I64"))).to_string(S)),R.current.loggingTimeout=null},5e3)):(m||(m=o("I64"))).equal(R.current.threadKey,S)&&R.current.loggingTimeout!=null&&window.clearTimeout(R.current.loggingTimeout)},[E,f,S]);var I=o("Int64Hooks").useCallbackInt64(function(){o("MWCreatorMessagingUtils").isAPPlusMessageRequest(f)&&r("QPLUserFlow").start(r("qpl")._(421070823,"2981"),{annotations:{string:{entrypoint:o("MWCreatorMessagingUtils").fetchQPLEntrypoint(f)}},instanceKey:(m||(m=o("I64"))).to_int32(f.threadKey)}),r("mwCMIsThreadBumped")({secondaryParentThreadKey:f.secondaryParentThreadKey,threadType:f.threadType})&&o("GroupsCometChatsEngagementLogger").log({action:"tap",client_extras:{is_bumped:"true"},community_id:y?(m||(m=o("I64"))).to_string(y.folderId):(m||(m=o("I64"))).to_string(f.parentThreadKey),event:"thread_open",group_id:o("MWCMGetValidId").MWCMHasValidFbGroupId(y==null?void 0:y.fbGroupId)?(m||(m=o("I64"))).to_string(y.fbGroupId):null,source:"chat_row",surface:t==="jewel"?"jewel_tray":"messenger_inbox",thread_id:(m||(m=o("I64"))).to_string(S)}),c&&v(o("MWResponsiveLayoutConstants").MWLayoutPanel.MESSAGE_LIST_PANEL)},[f.secondaryParentThreadKey,f.threadType,f.parentThreadKey,y,t,S,c,v]);return(m||(m=o("I64"))).equal(f.threadType,(p||(p=o("LSIntEnum"))).ofNumber(6))?(m||(m=o("I64"))).equal(S,(p||(p=o("LSIntEnum"))).ofNumber(-13))?_.jsx(r("MWThreadListJobsItem.react"),{onClick:l,responsive:u,selected:c,size:56,thread:f}):n("cr:2261")!=null&&(m||(m=o("I64"))).equal(S,(p||(p=o("LSIntEnum"))).ofNumber(-12))&&!r("gkx")("17132")?_.jsx(n("cr:2261"),{onClick:l,responsive:u,selected:c,size:56,thread:f}):n("cr:13568")!=null&&(m||(m=o("I64"))).equal(S,(p||(p=o("LSIntEnum"))).ofNumber(-18))?_.jsx(n("cr:13568"),{onClick:l,responsive:u,selected:c,size:56,thread:f}):null:_.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:_.jsx(r("MWThreadListGlimmer.react"),{parentComponentForDebug:"MWThreadListItem"}),name:"MWThreadListThreadListRow",children:_.jsx(o("MWPThreadIsPage.react").Provider,{threadKey:f.threadKey,children:_.jsx(o("MWThreadKey.react").MWThreadKeyProvider,{id:f.threadKey,children:_.jsx(r("CometTransientDialogProvider.react"),{children:_.jsx(r("MWThreadListItem.react"),{lsEntryPoint:t,lsSubEntryPoint:a,messagingEntrypoint:i,onClose:s,onThreadSelected:I,selected:c,showFollowUpReminder:d,size:56,thread:f})})})})})}T.displayName=T.name+" [from "+i.id+"]";var D=_.memo(T);function x(e){var t=e.gridLabel,a=e.filter,l=e.customThreadFilter,s=e.header,u=e.lsEntryPoint,d=e.onOpenMessageRequests,f=e.lsSubEntryPoint,h=e.parentThreadKey,v=e.responsive,S=e.selectedThreadKey,k=e.setHasScrolled,T=e.setIsEmptyInbox,x=e.threadListMessagingEntrypoint,P=e.onClose,N=P===void 0?r("emptyFunction"):P,M=e.onClickNestedFolderThread,w=M===void 0?r("emptyFunction"):M,A=e.preamble,F=(c||(c=r("useReStore")))(),O=o("ReQLSuspense").useFirst(function(){return o("ReQL").fromTableAscending(F.tables.threads_ranges_v2__generated).getKeyRange(h)},[F,h],i.id+":385"),B=o("ReQLSuspense").useArray(function(){return o("MWPThreadsForThreadList").createIterable(F,h,O,["lastActivityTimestampMs","threadType"].concat(o("LSThreadBitOffset").threadCapabilityFields)).filter(function(e){return r("MWThreadListSupportedThreadTypes").some(function(t){return(m||(m=o("I64"))).equal(e.threadType,t)})?o("MWXacGating").isGroupsEnabled()?!0:!r("isMWXacGroupThread")(e):!1}).take(5)},[F,h,O],i.id+":398").pop(),W=y(),q=o("ReQLSuspense").useFirst(function(){return S!=null?o("ReQL").fromTableAscending(F.tables.threads,["parentThreadKey"]).getKeyRange(S):o("ReQL").empty()},[F,S],i.id+":424");E(W);var U=o("useGroupsCometIsInCCNegativeTest").useShouldDisableBumpToInboxForNegativeTest(),V=R.useInboxFollowUps(F),H=V.computeInboxFollowUps,G=V.reminders,z=g(function(e){if(e==null)return _.jsx("div",{});if(o("CurrentEnvironment").facebookdotcom&&r("mwCMIsThreadBumped")({secondaryParentThreadKey:e.secondaryParentThreadKey,threadType:e.threadType})&&U)return _.jsx("div",{});var t;return(m||(m=o("I64"))).equal(e.threadKey,(p||(p=o("LSIntEnum"))).ofNumber(-13))||(m||(m=o("I64"))).equal(e.threadKey,(p||(p=o("LSIntEnum"))).ofNumber(-12))||(m||(m=o("I64"))).equal(e.threadKey,(p||(p=o("LSIntEnum"))).ofNumber(-18))?t=q!=null&&(m||(m=o("I64"))).equal(e.threadKey,q.parentThreadKey):t=S!=null&&(m||(m=o("I64"))).equal(S,e.threadKey),e!=null?_.jsx(r("CometHideableComponentExperiment.react"),{callingSurface:"thread_list",disableHiding:!0,children:_.jsx(D,{lsEntryPoint:u==="inboxThreadList"?B!=null&&(m||(m=o("I64"))).le(e.lastActivityTimestampMs,B.lastActivityTimestampMs)?"inboxRecentThreads":"inboxRemainingThreads":u,lsSubEntryPoint:f,messagingEntrypoint:x!=null?x:"jewel",onClickNestedFolderThread:w,onClose:N,responsive:v,selected:t,showFollowUpReminder:G.find(function(t){return(m||(m=o("I64"))).equal(t,e.threadKey)})!=null,thread:e})}):_.jsx("div",{})},[u,B,x,w,N,v,q,S,U,G]),j=g(function(e){k&&k(function(t){return e.scrollTop>0})},[k]),K=r("MessengerWebUXLogger").useImpressionLoggerRef({eventName:"threadlist_impression"}),Q=b(null),X=C(function(){return{rootElementRef:Q}},[Q]),Y=g(function(e){var t;Q.current=(t=e==null?void 0:e.getScrollAreaElement())!=null?t:null},[]),J=L(),Z=g(function(e){return(J!=null?J(e):!0)&&(l!=null?l(e):!0)},[J,l]),ee=r("useMWGetInboxFocusTargetFromRoute")(),te=ee===1,ne=_.jsx(o("CometPageletWithDiv.react").Placeholder,{className:"x78zum5 xmz0i5r x6ikm8r x10wlt62",fallback:null,name:"MWThreadList",children:_.jsx(r("MWPParentThreadKeyContext").Provider,{value:h,children:_.jsx(r("VirtualizationContainerContext").Provider,{value:X,children:_.jsx(r("MWPBaseThreadList.react"),{beforeContent:_.jsxs(_.Fragment,{children:[_.jsx(r("MWLSJewelMessageRequestsThreadContainer.react"),{onOpenMessageRequests:d}),A,n("cr:21161")&&_.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWPinnedThreadsList",children:_.jsx(n("cr:21161"),{customThreadFilter:l,parentThreadKey:h,renderItem:z})})]}),customThreadFilter:Z,emptyContent:_.jsx(r("MWThreadListEmptyContainer.react"),{filter:a,parentThreadKey:h}),filter:a,gridLabel:t,imperativeRef:Y,onDataLoaded:H,onLoadMoreThreads:function(){o("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.threadlist","load_more_threads"),r("CometVisualCompletion").addFirstMarkerPoint("threadListLoadMoreThreads")},onScroll:j,pageSize:15,parentThreadKey:h,renderItem:z,renderLoadingAnimation:function(t,n){var e=t==="onBottom"&&n>I;return _.jsxs("div",{children:[_.jsx(r("MWThreadListGlimmer.react"),{numberOfItems:2,parentComponentForDebug:"MWThreadListLoadingAnimation",vcIgnore:e}),_.jsx(r("CometHeroHoldTrigger.react"),{description:"ThreadListLoadingMoreItems."+t,hold:!e})]})},setIsEmptyInbox:T})})})});return _.jsxs("div",{className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62",id:W,ref:K,children:[s!=null?_.jsx(o("FocusRegion.react").FocusRegion,{children:s}):null,_.jsx($,{autoFocusQuery:o("focusScopeQueries").tabbableScopeQuery,enabled:te,children:_.jsx(o("FocusRegion.react").FocusRegion,{autoFocusQuery:te?o("focusScopeQueries").tabbableScopeQuery:void 0,recoverFocusQuery:o("focusScopeQueries").tabbableScopeQuery,recoverFocusStrategy:o("FocusRegionType").RecoverFocusStrategy.Nearest,children:ne})})]})}x.displayName=x.name+" [from "+i.id+"]";function $(e){var t=o("react-compiler-runtime").c(3),n=e.autoFocusQuery,a=e.children,i=e.enabled;if(!i)return a;var l;return t[0]!==n||t[1]!==a?(l=_.jsx(r("CometRouterFocusRegion.react"),{autoFocusQuery:n,children:a}),t[0]=n,t[1]=a,t[2]=l):l=t[2],l}l.default=x}),98);
__d("MWJewelNestedFolderThreadList.react",["CometScrollView.react","CometTopNavListDropdownCard.react","MWJewelNestedFolderThreadListHeader.react","MWThreadList.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(13),n=e.folder,a=e.onClose,i=e.onReturn,l=e.title,u;t[0]!==i||t[1]!==l?(u=s.jsx(r("MWJewelNestedFolderThreadListHeader.react"),{onReturn:i,title:l}),t[0]=i,t[1]=l,t[2]=u):u=t[2];var c;t[3]!==l?(c=typeof l=="string"?l:l.toString(),t[3]=l,t[4]=c):c=t[4];var d;t[5]!==n||t[6]!==a||t[7]!==c?(d=s.jsx(r("MWThreadList.react"),{gridLabel:c,lsEntryPoint:"jewelNestedFolder",onClose:a,parentThreadKey:n,responsive:!1}),t[5]=n,t[6]=a,t[7]=c,t[8]=d):d=t[8];var m;t[9]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsx("div",{className:"x1qx5ct2"}),t[9]=m):m=t[9];var p;return t[10]!==u||t[11]!==d?(p=s.jsx(r("CometTopNavListDropdownCard.react"),{useMaxHeight:!0,children:s.jsxs(r("CometScrollView.react"),{showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!0,children:[u,d,m]})}),t[10]=u,t[11]=d,t[12]=p):p=t[12],p}l.default=u}),98);
__d("MWSearchLoggingTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({Jewel:"jewel",Inbox:"inbox"});i.SearchSurface=e}),66);
__d("UniversalSearchQueryChangedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("843"),s=o("FalcoLoggerInternal").create("universal_search_query_changed",e),u=s;l.default=u}),98);
__d("UniversalSearchStartFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("840"),s=o("FalcoLoggerInternal").create("universal_search_start",e),u=s;l.default=u}),98);
__d("MWJewelLightspeedSearchTypeaheadViewList.react",["CometScrollView.react","MWChatSearchLightspeedTypeaheadViewList.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e=["xstyle"],s,u=s||(s=o("react")),c={scroll:{maxHeight:"x1wxkln1",$$css:!0}};function d(t){var n=o("react-compiler-runtime").c(10),a,i;n[0]!==t?(i=t.xstyle,a=babelHelpers.objectWithoutPropertiesLoose(t,e),n[0]=t,n[1]=a,n[2]=i):(a=n[1],i=n[2]);var l;n[3]!==i?(l=[c.scroll,i],n[3]=i,n[4]=l):l=n[4];var s;n[5]!==a?(s=u.jsx(r("MWChatSearchLightspeedTypeaheadViewList.react"),babelHelpers.extends({showActionItems:!1},a)),n[5]=a,n[6]=s):s=n[6];var d;return n[7]!==l||n[8]!==s?(d=u.jsx(r("CometScrollView.react"),{showsHorizontalScrollIndicator:!1,xstyle:l,children:s}),n[7]=l,n[8]=s,n[9]=d):d=n[9],d}l.default=d}),98);
__d("MWJewelSearchEmptyState.react",["fbt","MWXText.react","react","react-compiler-runtime","useCometTypeaheadEmptyState"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react"));function c(e){var t=o("react-compiler-runtime").c(3),n=e.queryString,a=r("useCometTypeaheadEmptyState")(),i;return t[0]!==a||t[1]!==n?(i=a?u.jsxs("div",{className:"xz9dl7a xpdmqnj xsag5q8 x1g0dm76",children:[u.jsx(r("MWXText.react"),{align:"center",type:"body2",children:s._(/*BTDS*/"No se ha encontrado ning\u00fan resultado")}),u.jsx("br",{}),u.jsx(r("MWXText.react"),{align:"center",color:"tertiary",type:"body3",children:s._(/*BTDS*/"No hemos encontrado ninguna coincidencia para \"{query}\". Comprueba que no haya errores de escritura y usa palabras completas.",[s._param("query",n)])})]}):null,t[0]=a,t[1]=n,t[2]=i):i=t[2],i}l.default=c}),226);
__d("createMWJewelSearchTypeaheadViewStrategy.react",["CometTypeaheadProgressGlimmer.react","MWJewelLightspeedSearchTypeaheadViewList.react","MWJewelSearchEmptyState.react","MWJewelSearchTypeaheadViewItem.react","gkx","react"],(function(t,n,r,o,a,i,l){"use strict";var e=["ariaProps","entries","extraViewProps","highlightedEntry","isLoading","onAbandonTypeahead_DO_NOT_USE"],s,u=s||(s=o("react"));function c(t,n,o){return function(i){var a=i.ariaProps,l=i.entries,s=i.extraViewProps,c=i.highlightedEntry,d=i.isLoading,m=i.onAbandonTypeahead_DO_NOT_USE,p=babelHelpers.objectWithoutPropertiesLoose(i,e),_=l.length===0&&p.queryString.length>0,f=l.length>0&&d,g=l.length===0&&d&&p.queryString.length===0&&r("gkx")("15587");return g?u.jsx(r("CometTypeaheadProgressGlimmer.react"),{}):_?u.jsx(r("MWJewelSearchEmptyState.react"),{queryString:p.queryString}):u.jsxs(u.Fragment,{children:[u.jsx(r("MWJewelLightspeedSearchTypeaheadViewList.react"),{ariaProps:a,entries:l,highlightedEntry:c,xstyle:t,children:function(t){var e=t.entry,a=t.isActive,i=t.itemRole;return u.createElement(r("MWJewelSearchTypeaheadViewItem.react"),babelHelpers.extends({},p,{entry:e,extraViewItemProps:{loggingSessionId:n,onBeforeTokenAdded:o},isActive:a,key:e.key,role:i}))}}),f&&u.jsx(r("CometTypeaheadProgressGlimmer.react"),{})]})}}l.default=c}),98);
__d("MWJewelSearchSubscriptionTypeahead.react",["fbt","BaseSubscriptionTypeahead.react","CometTypeaheadBackButton.react","CometTypeaheadInputRoundedStrategy.react","CometTypeaheadLayoutContextualStrategy.react","MWChatSearchResultType","MWChatSearchSurfaces","MWChatSearchTypeaheadLightspeedSubscriptionDataSource","MWFacebookUserWithoutMessengerAccess","MWInboxRouteBuilder","MWLSSearchIssueSearchQuerySupportedTypes","MWLSThreadDisplayContext","MWPConversationSearchLogger","MWSearchLogging","MWSearchLoggingTypes","MWSearchQPLLogger","UniversalSearchEndFalcoEvent","UniversalSearchQueryChangedFalcoEvent","UniversalSearchStartFalcoEvent","cr:2012305","cr:8414","createMWJewelSearchTypeaheadViewStrategy.react","gkx","isArmadillo","react","useCometRouterDispatcher","useReStore","uuidv4","xplatToDOMRef"],(function(t,n,r,o,a,i,l,s){"use strict";var e=["onChange","onFocus","onPressEntry","onSelectFreeformQuery"],u,c,d=c||(c=o("react")),m=c,p=m.useCallback,_=m.useEffect,f=m.useMemo,g=m.useRef,h=m.useState,y={searchInput:{marginTop:"x1xmf6yo",marginInlineEnd:"x14z9mp",marginBottom:"x1e56ztr",marginInlineStart:"x1lziwak",paddingTop:"xexx8yu",paddingInlineEnd:"xv54qhq",paddingBottom:"x18d9i69",paddingInlineStart:"xf7dkkf",$$css:!0},searchView:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",boxShadow:"x1gnnqk1",display:"x78zum5",minHeight:"xphu8jj",$$css:!0}},C=function(t){return r("createMWJewelSearchTypeaheadViewStrategy.react")(null,t)},b=r("gkx")("23390");function v(t){var a=t.onChange,i=t.onFocus,l=t.onPressEntry,c=t.onSelectFreeformQuery,m=babelHelpers.objectWithoutPropertiesLoose(t,e),v=h(null),S=v[0],R=v[1],L=g(null),E=(u||(u=r("useReStore")))(),k=g(!1),I=n("cr:8414")();_(function(){var e=L.current;return n("cr:2012305")!==null&&e!=null&&n("cr:2012305").trackTypingPerf(e,"MWJewelSearchTypeahead"),function(){n("cr:2012305")!==null&&e!=null&&n("cr:2012305").unregisterTypingPerf(e)}},[L]);var T=o("MWLSThreadDisplayContext").useMWLSThreadDisplayContext(),D=f(function(){return new(r("MWChatSearchTypeaheadLightspeedSubscriptionDataSource"))({database:E,excludedIDs:[],includeGroupSearch:T!=="ChatTab",includeMessageSearchEntry:r("gkx")("5801"),includeRecommendations:!0,lightspeedSupportedTypes:o("MWLSSearchIssueSearchQuerySupportedTypes").allSupportedTypes,source:r("MWChatSearchSurfaces").universal})},[E,T]),x=p(function(){R(null),S!=null&&(k.current||(r("UniversalSearchEndFalcoEvent").log(function(){return{end_action:8,is_epd:b,session_id:S,transport_type:null}}),k.current=!0)),o("MWSearchQPLLogger")==null||o("MWSearchQPLLogger").qplCancel("abandon"),a("")},[a,S]),$=r("useCometRouterDispatcher")(),P=p(function(e){var t=e.rawData.resultType;if(t===r("MWChatSearchResultType").MESSAGE&&e.rawData.query!=null&&r("gkx")("5801")){var n=o("MWInboxRouteBuilder").buildMultiThreadMesageSearchURL({search:e.rawData.query});$!=null&&n!=null&&(r("MWPConversationSearchLogger").logUniversalMessageSearch(),$.go(n,{}))}else I==null||I(e);var a=function(){l!=null&&l(e)};if(S==null){a();return}o("MWSearchLogging").logResultSelected(S,m.queryString,e,k),a()},[l,S,m.queryString,$,I]);_(function(){return function(){o("MWSearchQPLLogger")==null||o("MWSearchQPLLogger").qplCancel("abandon")}},[]);var N=p(function(){var e=r("uuidv4")();R(e),o("MWSearchQPLLogger")==null||o("MWSearchQPLLogger").qplStart({queryString:"",sessionInstanceId:e,surface:o("MWSearchLoggingTypes").SearchSurface.Jewel}),k.current=!1,r("UniversalSearchStartFalcoEvent").log(function(){return{is_epd:b,search_surface:0,session_id:e}}),r("UniversalSearchQueryChangedFalcoEvent").log(function(){return{query_length:"0",query_string:null,session_id:e}})},[E]),M=p(function(e){S!=null&&(r("UniversalSearchQueryChangedFalcoEvent").log(function(){return{query_length:e.length.toString(),query_string:e,session_id:S}}),o("MWSearchQPLLogger")==null||o("MWSearchQPLLogger").qplStart({queryString:e,sessionInstanceId:S,surface:o("MWSearchLoggingTypes").SearchSurface.Jewel})),a(e)},[a,S]),w=function(){i()},A=o("MWFacebookUserWithoutMessengerAccess").useIsFacebookUserWithoutMessengerAccess(),F=s._(/*BTDS*/"Buscar en Messenger"),O=s._(/*BTDS*/"Buscar mensajes"),B=A?O:F;return d.jsx(r("BaseSubscriptionTypeahead.react"),{dataSource:D,dataSourceFetchConfigParams:r("isArmadillo")()?{requestFlow:"network-upon-approve"}:void 0,inputExtraProps:{hideIconAnimation:!0,hideIconOnFocus:!0},inputRef:o("xplatToDOMRef").xplatToInputRef(L),inputStartContent:S!=null?d.jsx(r("CometTypeaheadBackButton.react"),{testid:void 0}):null,inputStrategyRenderer:r("CometTypeaheadInputRoundedStrategy.react"),layoutStrategyRenderer:r("CometTypeaheadLayoutContextualStrategy.react"),loggingContext:"messenger_jewel",onChange:M,onClose:x,onFocus:w,onOpen:N,onPressEntry:P,onSelectFreeformQuery:c,placeholder:B,queryString:m.queryString,shouldCloseOnEnter:!1,shouldHandleCloseAfterHandlePressEntry:!0,shouldQueryStringUpdateFromSelectedEntryOnClick:!1,viewStrategyRenderer:C(S),xstyles:{inputXStyle:y.searchInput,viewXStyle_DO_NOT_USE:y.searchView}})}v.displayName=v.name+" [from "+i.id+"]",l.default=v}),226);
__d("MWJewelThreadListSearchTypeahead.react",["CometRelay","FBLogger","I64","MWChatSearchFilteringUtils","MWChatSearchResultType","MWJewelSearchSubscriptionTypeahead.react","MWLogInboxFiltersInteraction","MWLogInteraction","MWPSearchSystem","MWThreadCreationUtil","QPLUserFlow","emptyFunction","qpl","react","react-compiler-runtime","setTimeoutCometSpeculative","useCometPreloader","useMWChatOpenTabForGroup","useMWChatOpenTabForPage","useMWChatOpenTabForUser","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=u||(u=o("react")),d=u,m=d.useCallback,p=d.useEffect,_=d.useState;function f(t){var n=o("react-compiler-runtime").c(25),a=t.onClose,i=_(""),l=i[0],u=i[1],d=r("useMWChatOpenTabForGroup")("jewelSearch"),m=d[0],f=r("useMWChatOpenTabForPage")("jewelSearch"),h=r("useMWChatOpenTabForUser")("jewelSearch"),y=h.openTabByThreadKey,C=h.openTabForUserWithoutPreloadedNavigationData,b=(e||(e=r("useReStore")))(),v=o("CometRelay").useRelayEnvironment(),S;n[0]!==b?(S=function(){return o("MWPSearchSystem").makeAll(b)},n[0]=b,n[1]=S):S=n[1];var R=S,L;n[2]!==R?(L=function(){r("setTimeoutCometSpeculative")(R,1e4)},n[2]=R,n[3]=L):L=n[3],p(L,void 0);var E;n[4]!==b||n[5]!==v||n[6]!==y||n[7]!==C?(E=function(t,n){var e=o("MWChatSearchFilteringUtils").getIsE2ee(n.rawData);if(e)return y(t,!0);o("MWThreadCreationUtil").getIsSecureBasedOnContactCapabilitiesForOneToOneThreadV2(n,v,b).then(async function(e){var r=e.isSecureThread,a=e.reason;if(a==="default_e2ee")C({unpreloadedReason:"jewelsearch_not_support_gql",userId:t});else{var i,l,u,c,d=await b.tables.threads.get((s||(s=o("I64"))).of_string(t));C({isSecureThread:r,reason:"MWJewelThreadListSearchTypeahead, FBID: "+t+", reason: "+(a!=null?a:"")+", searchSource: "+((i=n.rawData.searchSource)!=null?i:"")+", otherUserId: "+((l=n.rawData.otherUserId)!=null?l:"")+", hasCutoverThread: "+((u=(c=n.rawData.hasCutoverThread)==null?void 0:c.toString())!=null?u:"false")+", threadAuthorityLevel: "+(d!=null?(s||(s=o("I64"))).to_string(d.authorityLevel):"null"),unpreloadedReason:"jewelsearch_not_support_gql",userId:t})}}).catch(g)},n[4]=b,n[5]=v,n[6]=y,n[7]=C,n[8]=E):E=n[8];var k=E,I;n[9]!==a||n[10]!==m||n[11]!==f||n[12]!==k?(I=function(t){var e=t.rawData,n=e.id,o=e.resultType;e:switch(o){case r("MWChatSearchResultType").MESSAGE:break e;case r("MWChatSearchResultType").GROUP:{m(n);break e}case r("MWChatSearchResultType").USER:case r("MWChatSearchResultType").AI_BOT:{k(n,t);break e}case r("MWChatSearchResultType").PAGE:f(n)}a()},n[9]=a,n[10]=m,n[11]=f,n[12]=k,n[13]=I):I=n[13];var T=I,D=r("useCometPreloader")("button_aggressive",r("emptyFunction"),R),x=D.onHoverInPreloader,$=D.onHoverMovePreloader,P=D.onHoverOutPreloader,N;n[14]!==R?(N=function(){o("MWLogInteraction").logPopoverOpenCancel("initiate_search"),o("MWLogInboxFiltersInteraction").logInboxFiltersNavigationCancel("initiate_search"),R(),r("QPLUserFlow").start(r("qpl")._(25312244,"1683"))},n[14]=R,n[15]=N):N=n[15];var M;n[16]!==T||n[17]!==l||n[18]!==N?(M=c.jsx(r("MWJewelSearchSubscriptionTypeahead.react"),{onChange:u,onFocus:N,onPressEntry:T,queryString:l}),n[16]=T,n[17]=l,n[18]=N,n[19]=M):M=n[19];var w;return n[20]!==x||n[21]!==$||n[22]!==P||n[23]!==M?(w=c.jsx("div",{onMouseEnter:x,onMouseLeave:P,onMouseMove:$,children:M}),n[20]=x,n[21]=$,n[22]=P,n[23]=M,n[24]=w):w=n[24],w}function g(e){r("FBLogger")("messenger_search").mustfix("Error fetching contact capabilities: %s",e)}var h=c.memo(f);l.default=h}),98);
__d("CometMessagingJewelDropdownContent.react",["fbt","CometErrorBoundary.react","CometHeroInteractionWithDiv.react","CometMessagingJewelDropdownContentGlimmer.react","CometMessagingJewelDropdownEBUpsellContainer.react","CometPageletWithDiv.react","CometPlaceholder.react","CometRelay","CometTopNavListDropdownCard.react","FBLogger","I64","InteractionTracing","JSResourceForInteraction","LSContactBitOffset","LSIntEnum","LSPlatformErrorsCatcher.react","LSThreadRangeFilter","MAWUnrecoverableErrorBoundary.react","MWCMJewelContext","MWInboxContextSwitcherDeferred.react","MWInboxContextSwitcherGlimmer.react","MWInboxContextSwitcherUtils","MWJewelDropdownHeader.react","MWJewelMessengerLink.react","MWJewelNestedFolderThreadList.react","MWJewelPopoverDialogContext.react","MWJewelThreadListSearchTypeahead.react","MWThreadList.react","ODS","ReQL","ReQLSuspense","WebUXLoggingEntryPointContextProvider","XCometMessengerControllerRouteBuilder","gkx","lazyLoadComponent","qpl","react","react-compiler-runtime","useCometInteractionTracing","useMWChatSearchClearSearchResults","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d,m,p=m||(m=o("react")),_=m,f=_.memo,g=_.useCallback,h=_.useContext,y=_.useEffect,C=_.useState,b=r("lazyLoadComponent")(r("JSResourceForInteraction")("MAWJewelMessageRequestsAndSpamDropdownWithTab.react").__setRef("CometMessagingJewelDropdownContent.react")),v=r("lazyLoadComponent")(r("JSResourceForInteraction")("MWRestrictedAccountsList.react").__setRef("CometMessagingJewelDropdownContent.react")),S=r("lazyLoadComponent")(r("JSResourceForInteraction")("MWJewelArchivedChatsDropdown.react").__setRef("CometMessagingJewelDropdownContent.react")),R=r("lazyLoadComponent")(r("JSResourceForInteraction")("CometMessagingJewelDropdownErrorState.react").__setRef("CometMessagingJewelDropdownContent.react")),L=s._(/*BTDS*/"Chats");function E(e){r("FBLogger")("messenger_web_entrypoints").catching(e).mustfix("CometMessagingJewelDropdownQPBannerContainer failed to render")}var k=r("gkx")("22839")===!0;function I(t){var n=o("react-compiler-runtime").c(97),a=t.ebSoftblockUpsell,l=t.ebUpsellContainerQueryRef,m=t.onClose,_=t.pushPage,f=h(r("MWJewelPopoverDialogContext.react")),g=f.setIsOpenForDialog,R=r("useMWChatSearchClearSearchResults")(),I;n[0]!==R||n[1]!==m?(I=function(){R(),m()},n[0]=R,n[1]=m,n[2]=I):I=n[2];var D=I,x,$;n[3]!==R?(x=function(){return R},$=[R],n[3]=R,n[4]=x,n[5]=$):(x=n[4],$=n[5]),y(x,$);var P;n[6]===Symbol.for("react.memo_cache_sentinel")?(P=r("XCometMessengerControllerRouteBuilder").buildURL({}),n[6]=P):P=n[6];var N=P,M=h(r("MWCMJewelContext")),w=M.MWCMBlendedThreadListEntrypointRef,A=M.selectedFilterTab,F=M.setSelectedFilterTab,O=C(),B=O[0],W=O[1],q;n[7]===Symbol.for("react.memo_cache_sentinel")?(q=r("qpl")._(30610001,"3003"),n[7]=q):q=n[7];var U=r("useCometInteractionTracing")(q,"fast","INTERACTION"),V=(e||(e=r("useReStore")))(),H;n[8]!==V.tables._user_info?(H=function(){return o("ReQL").fromTableAscending(V.tables._user_info).map(T)},n[8]=V.tables._user_info,n[9]=H):H=n[9];var G;n[10]!==V?(G=[V],n[10]=V,n[11]=G):G=n[11];var z=o("ReQLSuspense").useFirst(H,G,i.id+":148"),j;n[12]!==V.tables.contacts||n[13]!==z?(j=function(){return z!=null?o("ReQL").fromTableAscending(V.tables.contacts,["capabilities","capabilities2"]).getKeyRange(z):o("ReQL").empty()},n[12]=V.tables.contacts,n[13]=z,n[14]=j):j=n[14];var K;n[15]!==V||n[16]!==z?(K=[V,z],n[15]=V,n[16]=z,n[17]=K):K=n[17];var Q=o("ReQLSuspense").useFirst(j,K,i.id+":152"),X;n[18]!==D||n[19]!==_?(X=function(){var e=r("InteractionTracing").startInteraction({interactionClass:"fast",qplEvent:r("qpl")._(30607516,"756"),tracePolicy:"comet.jewel.message_requests",traceType:"INTERACTION"});_(function(t){var n=t.onReturn;return p.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:p.jsx(r("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!1,title:L,withBackButton:!0}),name:"MAWJewelMessageRequestsAndSpamDropdownWithTab",children:p.jsx(b,{interactionID:e,onClose:D,onReturn:n})})})},n[18]=D,n[19]=_,n[20]=X):X=n[20];var Y=X,J;n[21]!==Y||n[22]!==A?(J=o("MWInboxContextSwitcherUtils").shouldShowMessageRequestsFromFilter(A)?Y:void 0,n[21]=Y,n[22]=A,n[23]=J):J=n[23];var Z=J,ee;n[24]!==D||n[25]!==_?(ee=function(){_(function(e){var t=e.onReturn;return p.jsx(v,{hidePage:t,onClose:D})})},n[24]=D,n[25]=_,n[26]=ee):ee=n[26];var te=ee,ne;n[27]!==D||n[28]!==_?(ne=function(){(u||(u=o("ODS"))).bumpEntityKey(3185,"mw_jewel","archived_chats"),_(function(e){var t=e.onReturn;return p.jsx(S,{onClose:D,onReturn:t})})},n[27]=D,n[28]=_,n[29]=ne):ne=n[29];var re=ne,oe;n[30]!==D||n[31]!==_||n[32]!==Q?(oe=function(t){_(function(e){var n=e.onReturn;switch((c||(c=o("I64"))).to_int32(t)){case-13:return p.jsx(r("MWJewelNestedFolderThreadList.react"),{folder:t,onClose:D,onReturn:n,title:s._(/*BTDS*/"Empleos")});case-12:{var a=Q!=null&&o("LSContactBitOffset").has(86,Q),i=s._(/*BTDS*/"Marketplace");return a&&(i=s._(/*BTDS*/"_j[\"Grupos de compraventa\",\"6a9a0529abd169ff91b49b4022dbf5a5\",1]")),p.jsx(r("MWJewelNestedFolderThreadList.react"),{folder:t,onClose:D,onReturn:n,title:i})}default:return r("FBLogger")("messenger_web_entrypoints").mustfix("Attempted to show an unimplemented nested system folder"),null}})},n[30]=D,n[31]=_,n[32]=Q,n[33]=oe):oe=n[33];var ae=oe,ie;n[34]!==a||n[35]!==l||n[36]!==A?(ie=p.jsx(r("CometMessagingJewelDropdownEBUpsellContainer.react"),{ebSoftblockUpsell:a,ebUpsellContainerQueryRef:l,selectedFilterTab:A}),n[34]=a,n[35]=l,n[36]=A,n[37]=ie):ie=n[37];var le=ie,se;n[38]!==A?(se=o("MWInboxContextSwitcherUtils").getCustomThreadFilter(A),n[38]=A,n[39]=se):se=n[39];var ue=se,ce;n[40]!==A?(ce=o("MWInboxContextSwitcherUtils").getParentThreadKeyFromFilter(A),n[40]=A,n[41]=ce):ce=n[41];var de=ce,me;n[42]!==a||n[43]!==A?(me=a!=null&&o("MWInboxContextSwitcherUtils").shouldShowEBUpsellFromFilter(A),n[42]=a,n[43]=A,n[44]=me):me=n[44];var pe=!me,_e;n[45]!==D||n[46]!==re||n[47]!==Y||n[48]!==te?(_e=p.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWJewelDropdownHeader",children:p.jsx(r("MWJewelDropdownHeader.react"),{inboxUrl:N,onClose:D,onOpenArchivedChats:re,onOpenMessageRequests:Y,onOpenRestrictedAccountsList:te,title:L})}),n[45]=D,n[46]=re,n[47]=Y,n[48]=te,n[49]=_e):_e=n[49];var fe;n[50]===Symbol.for("react.memo_cache_sentinel")?(fe={className:"x1c4vz4f"},n[50]=fe):fe=n[50];var ge;n[51]!==D||n[52]!==_?(ge=p.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWJewelThreadListSearchTypeahead",children:p.jsx(r("MWJewelThreadListSearchTypeahead.react"),{onClose:D,pushPage:_})}),n[51]=D,n[52]=_,n[53]=ge):ge=n[53];var he;n[54]===Symbol.for("react.memo_cache_sentinel")?(he=p.jsx(r("MWInboxContextSwitcherGlimmer.react"),{}),n[54]=he):he=n[54];var ye;n[55]!==U||n[56]!==g||n[57]!==F?(ye=function(t){U(function(e){W(e.getTraceId())},void 0,void 0,"comet.jewel.messenger."+o("MWInboxContextSwitcherUtils").getTracePolicyFromFilter(t)),g(!1),F==null||F(t)},n[55]=U,n[56]=g,n[57]=F,n[58]=ye):ye=n[58];var Ce;n[59]!==ae||n[60]!==Y||n[61]!==de||n[62]!==A||n[63]!==ye?(Ce=p.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:he,name:"MWInboxContextSwitcher",children:p.jsx(r("MWInboxContextSwitcherDeferred.react"),{entryPoint:"jewel",onTabChange:ye,parentThreadKey:de,selectedFilterTab:A,showMessageRequests:Y,showNestedFolderThreads:ae})}),n[59]=ae,n[60]=Y,n[61]=de,n[62]=A,n[63]=ye,n[64]=Ce):Ce=n[64];var be;n[65]!==ge||n[66]!==Ce?(be=p.jsxs("div",babelHelpers.extends({},fe,{children:[ge,Ce]})),n[65]=ge,n[66]=Ce,n[67]=be):be=n[67];var ve=pe&&le,Se;n[68]!==_e||n[69]!==be||n[70]!==ve?(Se=p.jsxs(p.Fragment,{children:[_e,be,ve]}),n[68]=_e,n[69]=be,n[70]=ve,n[71]=Se):Se=n[71];var Re=Se,Le;n[72]!==A?(Le=o("MWInboxContextSwitcherUtils").getJewelEntryPointFromFilter(A),n[72]=A,n[73]=Le):Le=n[73];var Ee=Le,ke;n[74]!==A?(ke=o("MWInboxContextSwitcherUtils").getJewelLsSubEntryPointFromFilter(A),n[74]=A,n[75]=ke):ke=n[75];var Ie=ke,Te;n[76]!==w||n[77]!==ue||n[78]!==a||n[79]!==Ie||n[80]!==ae||n[81]!==D||n[82]!==Z||n[83]!==de||n[84]!==A?(Te=a!=null&&o("MWInboxContextSwitcherUtils").shouldShowEBUpsellFromFilter(A)?p.jsx(p.Fragment,{children:a}):p.jsxs(p.Fragment,{children:[k&&(c||(c=o("I64"))).equal(A,(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").COMMUNITIES))?p.jsx(r("CometPlaceholder.react"),{fallback:p.jsx(r("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!0}),name:"CometMessagingJewelDropdownContent.MWCMBlendedThreadList",children:w!=null?p.jsx(o("CometRelay").EntryPointContainer,{entryPointReference:w,props:{filter:A,gridLabel:L.toString(),header:null,lsEntryPoint:"jewel",lsSubEntryPoint:Ie,onDropdownClose:D,onError:E,parentThreadKey:de}}):null}):p.jsx(r("MWThreadList.react"),{customThreadFilter:ue,filter:A,gridLabel:L.toString(),lsEntryPoint:"jewel",lsSubEntryPoint:Ie,onClickNestedFolderThread:ae,onClose:D,onOpenMessageRequests:Z,parentThreadKey:de,responsive:!1},(c||(c=o("I64"))).to_string(A)),p.jsx(r("MWJewelMessengerLink.react"),{onClick:D,url:N})]}),n[76]=w,n[77]=ue,n[78]=a,n[79]=Ie,n[80]=ae,n[81]=D,n[82]=Z,n[83]=de,n[84]=A,n[85]=Te):Te=n[85];var De;n[86]!==Re||n[87]!==Te?(De=p.jsxs(r("CometTopNavListDropdownCard.react"),{testid:void 0,useFullHeight:!0,useMaxHeight:!0,children:[Re,Te]}),n[86]=Re,n[87]=Te,n[88]=De):De=n[88];var xe=De,$e;n[89]===Symbol.for("react.memo_cache_sentinel")?($e=p.jsx(r("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!0,title:L}),n[89]=$e):$e=n[89];var Pe;n[90]!==B||n[91]!==A||n[92]!==xe?(Pe=B!=null?p.jsx(r("CometHeroInteractionWithDiv.react"),{interactionDesc:"JewelThreadList."+o("MWInboxContextSwitcherUtils").getInteractionDescFromFilter(A),interactionUUID:B,children:xe}):xe,n[90]=B,n[91]=A,n[92]=xe,n[93]=Pe):Pe=n[93];var Ne;return n[94]!==Pe||n[95]!==Ee?(Ne=p.jsx(o("CometPageletWithDiv.react").Placeholder,{fallback:$e,name:"MWJewelDropdownContent",children:p.jsx(o("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:Ee,children:Pe})}),n[94]=Pe,n[95]=Ee,n[96]=Ne):Ne=n[96],Ne}function T(e){return e.facebookUserId}function D(e){var t=o("react-compiler-runtime").c(2),n=x,a;return t[0]!==e?(a=p.jsx(r("MAWUnrecoverableErrorBoundary.react"),{fallback:n,children:p.jsx(r("CometErrorBoundary.react"),{fallback:n,children:p.jsx(r("LSPlatformErrorsCatcher.react"),{fallback:n,children:p.jsx(I,babelHelpers.extends({},e))})})}),t[0]=e,t[1]=a):a=t[1],a}function x(e){return p.jsx(R,{error:e})}x.displayName=x.name+" [from "+i.id+"]";var $=f(D);l.default=$}),226);
__d("CometMessagingJewelDropdown.react",["fbt","BaseMultiStepContainer.react","BasePopoverReflowSheetContext","CometMessagingJewelDropdownContent.react","CometTopNavListDropdown.react","MWLogInboxFiltersInteraction","MWLogInteraction","justknobx","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useContext;function p(e){var t=o("react-compiler-runtime").c(9),n=e.props,a=e.queries,i=n.onClose,l=a.ebUpsellContainerQueryRef,c=o("MWLogInteraction").getPopoverTrace();c==null||c.addAnnotation("PopoverEntrypoint","CometMessagingJewelDropdown");var d=m(r("BasePopoverReflowSheetContext")),p=d.isReflowSheet,f=_,g;t[0]===Symbol.for("react.memo_cache_sentinel")?(g=s._(/*BTDS*/"Messenger"),t[0]=g):g=t[0];var h;t[1]!==p?(h={0:{className:"x1cvmir6"},1:{className:"x14atkfc"}}[!!p<<0],t[1]=p,t[2]=h):h=t[2];var y;t[3]!==l||t[4]!==i?(y=u.jsx(r("BaseMultiStepContainer.react"),{fitContentWidth:!0,onPageChange:f,children:function(t){return u.jsx(r("CometMessagingJewelDropdownContent.react"),{ebUpsellContainerQueryRef:l,onClose:i,pushPage:t})}}),t[3]=l,t[4]=i,t[5]=y):y=t[5];var C;return t[6]!==h||t[7]!==y?(C=u.jsx(r("CometTopNavListDropdown.react"),{label:g,name:"MWJewelDropdown",children:u.jsx("div",babelHelpers.extends({},h,{children:y}))}),t[6]=h,t[7]=y,t[8]=C):C=t[8],C}function _(e){e>0&&r("justknobx")._("3802")&&(o("MWLogInteraction").logPopoverOpenCancel("popover_page_change"),o("MWLogInboxFiltersInteraction").logInboxFiltersNavigationCancel("popover_page_change"))}l.default=p}),226);
__d("FDSResizeFreeFilled20PNGIcon.react",["ix","fbicon"],(function(t,n,r,o,a,i,l,s){"use strict";var e=o("fbicon")._(s("580260"),20),u=e;l.default=u}),98);
__d("LSVerifyThreadsActivityStatus",["LSIssueNewTaskWithExtraOperations"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return r[0]=new t.Map,r[0].set("server_mode",e[1]),r[0].set("from_timestamp_ms",e[2]),r[0].set("threads",e[3]),r[0].set("session_id",e[0]),r[1]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewTaskWithExtraOperations"),"verify_threads_activity_status",t.i64.cast([0,648]),r[1],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),void 0,t.i64.cast([0,0]))},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxVerifyThreadsActivityStatusStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSVerifyThreadsActivityStatusStoredProcedure",["LSSynchronousPromise","LSVerifyThreadsActivityStatus","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSVerifyThreadsActivityStatus"),a.sessionId,a.serverMode,a.fromTimestampMs,a.threads);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWUnsupportedIndexedDBNuxKey",["WebStorage"],(function(t,n,r,o,a,i,l){"use strict";var e,s="maw_unsupported_browser_nux_dismissed",u="dismissed",c=function(){var t;return((t=(e||(e=r("WebStorage"))).getLocalStorageForRead())==null?void 0:t.getItem(s))===u},d=function(){var t;(t=(e||(e=r("WebStorage"))).getLocalStorage())==null||t.setItem(s,u)};l.getIsDismissed=c,l.setIsDismissed=d}),98);
__d("MAWUserVisibleErrorsNux.react",["ix","MAWLoggerUtils","MWXIconCautionTriangle","MWXQPCard.react","QPLUserFlow","gkx","qpl","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e.useEffect,d={hasNoMargin:{marginTop:"xdj266r",marginInlineEnd:"x14z9mp",marginBottom:"xat24cr",marginInlineStart:"x1lziwak",$$css:!0}};function m(e){var t=o("react-compiler-runtime").c(17),n=e.hasNoMargin,a=e.icon,i=e.nuxBodyText,l=e.nuxButtonProps,m=e.nuxTitleText,p=e.onCloseButtonClick,_=e.ref,f=e.secondaryButtonProps,g;t[0]===Symbol.for("react.memo_cache_sentinel")?(g=o("MAWLoggerUtils").getInstanceKey(),t[0]=g):g=t[0];var h=g,y,C;t[1]!==m?(y=function(){return r("QPLUserFlow").start(r("qpl")._(1056846286,"652"),{annotations:{string:{nuxTitleText:m.toString()}},instanceKey:h}),(function(){return r("QPLUserFlow").endSuccess(r("qpl")._(1056846286,"652"),{instanceKey:h})})},C=[h,m],t[1]=m,t[2]=y,t[3]=C):(y=t[2],C=t[3]),c(y,C);var b;t[4]===Symbol.for("react.memo_cache_sentinel")?(b=r("gkx")("4425")?s("428841"):s("212797"),t[4]=b):b=t[4];var v=b,S;t[5]===Symbol.for("react.memo_cache_sentinel")?(S=r("gkx")("4425")?{props:{src:s("1745665")},type:"image"}:{props:{color:"negative",icon:r("MWXIconCautionTriangle"),size:24},type:"icon"},t[5]=S):S=t[5];var R=S,L;t[6]!==a?(L=a!=null?a:r("gkx")("23219")?{props:{src:v},type:"image"}:R,t[6]=a,t[7]=L):L=t[7];var E=n===!0?d.hasNoMargin:void 0,k;return t[8]!==i||t[9]!==l||t[10]!==m||t[11]!==p||t[12]!==_||t[13]!==f||t[14]!==L||t[15]!==E?(k=u.jsx("div",{"data-testid":void 0,children:u.jsx(r("MWXQPCard.react"),{addOnPrimary:l,addOnSecondary:f,body:i,headline:m,icon:L,onClose:p,ref:_,xstyle:E})}),t[8]=i,t[9]=l,t[10]=m,t[11]=p,t[12]=_,t[13]=f,t[14]=L,t[15]=E,t[16]=k):k=t[16],k}l.default=m}),98);
__d("MAWUserVisibleErrorsNuxWrapper.react",["fbt","CometPlaceholder.react","MAWIssueNewUserVisibleErrors","MAWUnsupportedIndexedDBNuxKey","cr:4216","cr:9767","promiseDone","react","react-compiler-runtime","requireDeferred","useMAWGetUserVisibleErrors","useMAWUnsupportedBrowserNUX"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useState,p=r("requireDeferred")("MAWEncryptionErrorHandler").__setRef("MAWUserVisibleErrorsNuxWrapper.react");function _(e){var t=o("react-compiler-runtime").c(23),a=e.children,i=e.hasNoMargin,l;t[0]===Symbol.for("react.memo_cache_sentinel")?(l=o("MAWUnsupportedIndexedDBNuxKey").getIsDismissed(),t[0]=l):l=t[0];var c=m(l),d=c[0],_=c[1],g;if(t[1]===Symbol.for("react.memo_cache_sentinel")){var h;g=(h=n("cr:4216").buildUri({cms_id:"597429858389632"}).setDomain("www.facebook.com"))==null||(h=h.setProtocol("https"))==null?void 0:h.toString(),t[1]=g}else g=t[1];var y=g,C;t[2]===Symbol.for("react.memo_cache_sentinel")?(C={label:s._(/*BTDS*/"M\u00e1s informaci\u00f3n"),linkProps:{target:"_blank",url:y}},t[2]=C):C=t[2];var b=C,v=o("useMAWUnsupportedBrowserNUX").useMAWUnsupportedBrowserNUX(),S=v.shouldShowQP,R=m(!1),L=R[0],E=R[1],k=r("useMAWGetUserVisibleErrors")(),I=k[0],T=k[1],D;t[3]!==T||t[4]!==(I==null?void 0:I.errorExtraData)?(D=function(){r("promiseDone")((async function(){if(E(!0),(I==null?void 0:I.errorExtraData)==="MAWEARKeychainDecryptionError"){var e=await p.load();await e.handleEARKeychainError()}return T()})(),f,function(){E(!1)})},t[3]=T,t[4]=I==null?void 0:I.errorExtraData,t[5]=D):D=t[5];var x=D,$;t[6]!==(I==null?void 0:I.errorBodyText)?($=o("MAWIssueNewUserVisibleErrors").errorMsgBodyToFbtMap.get(I==null?void 0:I.errorBodyText),t[6]=I==null?void 0:I.errorBodyText,t[7]=$):$=t[7];var P=$,N;t[8]!==(I==null?void 0:I.errorTitleText)?(N=o("MAWIssueNewUserVisibleErrors").errorMsgTitleToFbtMap.get(I==null?void 0:I.errorTitleText),t[8]=I==null?void 0:I.errorTitleText,t[9]=N):N=t[9];var M=N,w;t[10]!==a||t[11]!==T||t[12]!==d||t[13]!==P||t[14]!==M||t[15]!==I||t[16]!==i||t[17]!==L||t[18]!==x||t[19]!==S?(w=n("cr:9767")&&S&&!d?u.jsx(n("cr:9767"),{hasNoMargin:i,nuxBodyText:o("MAWIssueNewUserVisibleErrors").MAWUnsupportedIndexedDBErrorMsg,nuxButtonProps:b,nuxTitleText:o("MAWIssueNewUserVisibleErrors").MAWUnsupportedIndexedDBErrorMsgTitle,onCloseButtonClick:function(){_(!0),o("MAWUnsupportedIndexedDBNuxKey").setIsDismissed()}}):I&&n("cr:9767")&&M!=null&&P!=null?u.jsx(n("cr:9767"),{nuxBodyText:P,nuxButtonProps:{disabled:L,label:s._(/*BTDS*/"Actualizar"),loading:L,onPress:x},nuxTitleText:M,onCloseButtonClick:function(){r("promiseDone")(T())}}):a,t[10]=a,t[11]=T,t[12]=d,t[13]=P,t[14]=M,t[15]=I,t[16]=i,t[17]=L,t[18]=x,t[19]=S,t[20]=w):w=t[20];var A;return t[21]!==w?(A=u.jsx(r("CometPlaceholder.react"),{fallback:null,name:"MAWUserVisibleErrorsNuxWrapper",children:w}),t[21]=w,t[22]=A):A=t[22],A}function f(){window.location.reload(!0)}l.default=_}),226);
__d("MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react",["cr:1266"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:1266")}),98);
__d("MWEBVirtualDevicesContextProvider.react",["MAWOneTimeCodeGating","MWEBVirtualDevicesContext.react","cr:12343","react","react-compiler-runtime","useMWEncryptedBackupsListenForChangesToVirtualDevicesV2"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useMemo;function c(e){var t=o("react-compiler-runtime").c(16),a=e.children,i=e.hasOtcEligibleDevicesInitialValue,l=e.hsmCreationTimeInitialValue,u=e.offlineDevicesCountInitialValue,c=e.vestaClientIDInitialValue,d=u===void 0?-1:u,m=c!=null?c:void 0,p;t[0]!==l||t[1]!==d||t[2]!==m?(p={hsmCreationTimeInitialValue:l,offlineDevicesCountInitialValue:d,vestaClientIDInitialValue:m},t[0]=l,t[1]=d,t[2]=m,t[3]=p):p=t[3];var _=r("useMWEncryptedBackupsListenForChangesToVirtualDevicesV2")(p),f=_.hsmCreationTime,g=_.offlineDevicesCount,h=_.vestaClientID,y=n("cr:12343")(),C=y.hasOtcEligibleDevices,b;t[4]!==C||t[5]!==i?(b=o("MAWOneTimeCodeGating").isOneTimeCodeEnabled()&&(i===!0||C),t[4]=C,t[5]=i,t[6]=b):b=t[6];var v=b,S=h!=null,R;t[7]!==v||t[8]!==f||t[9]!==g||t[10]!==S||t[11]!==h?(R={virtualDeviceInfo:{doesUserHaveOtcEligibleDevices:v,hsmCreationTime:f,isPINCodeRegistered:S,offlineDevicesCount:g,vestaClientID:h}},t[7]=v,t[8]=f,t[9]=g,t[10]=S,t[11]=h,t[12]=R):R=t[12];var L=R,E;return t[13]!==a||t[14]!==L?(E=s.jsx(o("MWEBVirtualDevicesContext.react").MWEBVirtualDevicesContext.Provider,{value:L,children:a}),t[13]=a,t[14]=L,t[15]=E):E=t[15],E}l.default=c}),98);
__d("MWEncryptedBackupsJewelNuxWrapper_query.graphql",[],(function(t,n,r,o,a,i){"use strict";var e={argumentDefinitions:[{kind:"RootArgument",name:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider"}],kind:"Fragment",metadata:null,name:"MWEncryptedBackupsJewelNuxWrapper_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup"},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'}],storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"MWEBVestaUserInfoContextProvider_viewer"},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_auto_eb_upsells",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null}],storageKey:null},{condition:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_new_user_onboarding_upsells",plural:!1,selections:[{args:null,documentName:"MWEncryptedBackupsJewelNuxWrapper_query",fragmentName:"MWEBNewUserOnboardingThreadListUpsellWrapper_viewer",fragmentPropName:"viewer",kind:"ModuleImport"}],storageKey:null}]}],storageKey:null},action:"THROW",path:"viewer"},{kind:"Defer",selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query"}]},{args:null,kind:"FragmentSpread",name:"useEncryptedBackupsProcessStatePreLoaded_query"}],type:"Query",abstractKey:null};a.exports=e}),null);
__d("useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup.graphql",[],(function(t,n,r,o,a,i){"use strict";var e={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup",selections:[{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null}],storageKey:null}],type:"XFBEncryptedBackup",abstractKey:null};a.exports=e}),null);
__d("useMWEncryptedBackupsGetVirtualDevicesPreloaded",["CometRelay","react","react-compiler-runtime","useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup.graphql"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(s||(s=o("react"))).useCallback;function c(t){var r=o("react-compiler-runtime").c(4),a=t.encryptedBackup,i=o("CometRelay").useFragment(e!==void 0?e:e=n("useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup.graphql"),a),l;r[0]!==(i==null?void 0:i.virtual_devices)?(l=function(){var e=0,t=null;return i==null||i.virtual_devices.forEach(function(n){e:switch(n.device_type){case"HSM":{t=n.client_generated_id;break e}case"OFFLINE":{e=e+1;break e}default:}}),{offlineDevicesCount:e,vestaClientID:t}},r[0]=i==null?void 0:i.virtual_devices,r[1]=l):l=r[1],i==null||i.virtual_devices;var s=l,u;return r[2]!==s?(u={getVirtualDevices:s},r[2]=s,r[3]=u):u=r[3],u}l.default=c}),98);
__d("MWEncryptedBackupsJewelNuxWrapper.react",["CometErrorBoundary.react","CometPlaceholder.react","CometRelay","HeroInteractionIgnoreWithDiv.react","JSResourceForInteraction","MWChatEncryptedBackupsQPLSource.enum","MWEBEntrypointsKillswitch.enum","MWEBMobileOnboardingEligibility","MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","MWEBVirtualDevicesContextProvider.react","MWEBWebOnboardingUpsellUtils","MWEncryptedBackupsJewelNuxWrapper_query.graphql","MWEncryptedBackupsThreadListQPWrapper.react","cr:10269","cr:11983","cr:12316","cr:20045","cr:2046","react","react-compiler-runtime","useEncryptedBackupsProcessStatePreLoaded","useMWEncryptedBackupsGetVirtualDevicesPreloaded"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=u||(u=o("react")),d=(s=n("cr:12316"))!=null?s:n("cr:11983"),m=o("MWEBMobileOnboardingEligibility").requireMobileOnboardingIfEligible(r("JSResourceForInteraction")("MWEBMobileOnboardingQPBannerWrapper.react").__setRef("MWEncryptedBackupsJewelNuxWrapper.react"));function p(t){var a,i,l=o("react-compiler-runtime").c(19),s=t.children,u=t.query,d=o("CometRelay").useFragment(e!==void 0?e:e=n("MWEncryptedBackupsJewelNuxWrapper_query.graphql"),u),m;l[0]!==d?(m={entrypoint:r("MWEBEntrypointsKillswitch.enum").JEWEL_THREADLIST,query:d},l[0]=d,l[1]=m):m=l[1];var p=r("useEncryptedBackupsProcessStatePreLoaded")(m),f=d==null?void 0:d.xfb_backup,g;l[2]!==f?(g={encryptedBackup:f},l[2]=f,l[3]=g):g=l[3];var h=r("useMWEncryptedBackupsGetVirtualDevicesPreloaded")(g),y=h.getVirtualDevices,C;l[4]!==y?(C=y(),l[4]=y,l[5]=C):C=l[5];var b=C,v=b.offlineDevicesCount,S=b.vestaClientID,R=(a=d==null||(i=d.xfb_backup)==null?void 0:i.has_otc_eligible_devices)!=null?a:void 0,L=d.viewer.if_viewer_can_see_messenger_eb_auto_eb_upsells!=null,E;l[6]!==p||l[7]!==s||l[8]!==d||l[9]!==L?(E=c.jsx(_,{backupState:p,children:s,fragment:d,isUserEligibleForAutoEB:L}),l[6]=p,l[7]=s,l[8]=d,l[9]=L,l[10]=E):E=l[10];var k;l[11]!==d.viewer||l[12]!==E?(k=c.jsx(o("MWEBVestaUserInfoContext.react").MWEBVestaUserInfoContextProvider,{viewer$key:d.viewer,children:E}),l[11]=d.viewer,l[12]=E,l[13]=k):k=l[13];var I;return l[14]!==v||l[15]!==R||l[16]!==k||l[17]!==S?(I=c.jsx(r("MWEBVirtualDevicesContextProvider.react"),{hasOtcEligibleDevicesInitialValue:R,offlineDevicesCountInitialValue:v,vestaClientIDInitialValue:S,children:k}),l[14]=v,l[15]=R,l[16]=k,l[17]=S,l[18]=I):I=l[18],I}function _(e){var t=o("react-compiler-runtime").c(15),a=e.backupState,i=e.children,l=e.fragment,s=e.isUserEligibleForAutoEB,u=s===void 0?!1:s,p=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),_=p.virtualDeviceInfo;switch(a){case 3:{if(d!=null&&!_.isPINCodeRegistered){var f;return t[0]!==i?(f=c.jsx(d,{bannerSource:r("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_PERSISTENT_BANNER,source:r("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP,children:i}),t[0]=i,t[1]=f):f=t[1],f}return i}case 4:{var g;return t[2]!==i||t[3]!==l?(g=n("cr:2046")||r("MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react")?c.jsx(r("HeroInteractionIgnoreWithDiv.react"),{children:c.jsx(r("CometErrorBoundary.react"),{fallback:function(){return i},children:r("MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react")!=null?c.jsx(r("MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react"),{trigger:o("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsQPTrigger.JEWEL,children:i}):n("cr:2046")!=null&&c.jsx(n("cr:2046"),{fragmentKey:l,trigger:o("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsQPTrigger.JEWEL,children:i})})}):i,t[2]=i,t[3]=l,t[4]=g):g=t[4],g}case 2:{if(o("MWEBWebOnboardingUpsellUtils").IS_E2E_TEST_UNRELATED_TO_ENCRYPTED_BACKUPS||u)return i;var h;t[5]!==i?(h=n("cr:20045")?c.jsx(n("cr:20045"),{source:r("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP,children:i}):i,t[5]=i,t[6]=h):h=t[6];var y=h,C;t[7]!==y?(C=function(){return y},t[7]=y,t[8]=C):C=t[8];var b;t[9]!==y||t[10]!==l.viewer.if_viewer_can_see_messenger_eb_new_user_onboarding_upsells?(b=l.viewer.if_viewer_can_see_messenger_eb_new_user_onboarding_upsells!=null?c.jsx(r("CometPlaceholder.react"),{fallback:null,name:"MWEncryptedBackupsJewelNuxWrapper.OnboardingThreadListQP",children:c.jsx(o("CometRelay").MatchContainer,{match:l.viewer.if_viewer_can_see_messenger_eb_new_user_onboarding_upsells,props:{bannerSource:r("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_PERSISTENT_BANNER,children:y,qpSource:r("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_ONBOARDING_QP}})}):n("cr:10269")?c.jsx(r("CometPlaceholder.react"),{fallback:null,name:"MWEncryptedBackupsJewelNuxWrapper.OnboardingThreadListQP",children:c.jsx(n("cr:10269"),{source:r("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP,children:y})}):c.jsx(m,{fallback:y,props:{children:y,source:r("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_ONBOARDING_QP,trigger:o("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsQPTrigger.JEWEL}}),t[9]=y,t[10]=l.viewer.if_viewer_can_see_messenger_eb_new_user_onboarding_upsells,t[11]=b):b=t[11];var v;return t[12]!==C||t[13]!==b?(v=c.jsx(r("HeroInteractionIgnoreWithDiv.react"),{children:c.jsx(r("CometErrorBoundary.react"),{fallback:C,children:b})}),t[12]=C,t[13]=b,t[14]=v):v=t[14],v}default:return i}}l.default=p}),98);
__d("MWEncryptedBackupsQPWithPinPlaceholder.react",["MWXColumn.react","MWXGlimmer.react","MWXRow.react","MWXRowItem.react","gkx","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=r("gkx")("23433"),c={logoGlimmer:{borderStartStartRadius:"x1c9tyrk",borderStartEndRadius:"xeusxvb",borderEndEndRadius:"x1pahc9y",borderEndStartRadius:"x1ertn4p",height:"xxk0z11",width:"xvy4d1p",$$css:!0},pinInputGlimmer:{borderStartStartRadius:"x1i5p2am",borderStartEndRadius:"x1whfx0g",borderEndEndRadius:"xr2y4jy",borderEndStartRadius:"x1ihp6rs",height:"xc9qbxq",$$css:!0},root:{backgroundColor:"xlhe6ec",borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",borderTopStyle:"x13fuv20",borderInlineEndStyle:"x18b5jzi",borderBottomStyle:"x1q0q8m5",borderInlineStartStyle:"x1t7ytsu",borderTopWidth:"x972fbf",borderInlineEndWidth:"x10w94by",borderBottomWidth:"x1qhh985",borderInlineStartWidth:"x14e42zd",boxShadow:"xjf5wm9",boxSizing:"x9f619",minWidth:"xeuugli",overflowX:"x6ikm8r",overflowY:"x10wlt62",paddingTop:"x1iorvi4",paddingInlineEnd:"x11lfxj5",paddingBottom:"xjkvuk6",paddingInlineStart:"x135b78x",$$css:!0},textGlimmer:{borderStartStartRadius:"x1i5p2am",borderStartEndRadius:"x1whfx0g",borderEndEndRadius:"xr2y4jy",borderEndStartRadius:"x1ihp6rs",height:"x1qx5ct2",$$css:!0}};function d(){var e=o("react-compiler-runtime").c(6),t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t={0:{className:"xlhe6ec x1obq294 x5a5i1n xde0f50 x15x8krk x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x972fbf x10w94by x1qhh985 x14e42zd xjf5wm9 x9f619 xeuugli x6ikm8r x10wlt62 x11lfxj5 x135b78x xw7yly9 x1ys307a x1yztbdb xyqm7xq x1l90r2v xyamay9"},1:{className:"xlhe6ec x1obq294 x5a5i1n xde0f50 x15x8krk x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x972fbf x10w94by x1qhh985 x14e42zd xjf5wm9 x9f619 xeuugli x6ikm8r x10wlt62 x11lfxj5 x135b78x xw7yly9 x1ys307a x1yztbdb xyqm7xq x2lwn1j xsag5q8 xz9dl7a"}}[!!u<<0],e[0]=t):t=e[0];var n;e[1]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(r("MWXRowItem.react"),{verticalAlign:"center",children:s.jsx(r("MWXGlimmer.react"),{index:0,xstyle:c.logoGlimmer})}),e[1]=n):n=e[1];var a;e[2]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsxs(r("MWXRow.react"),{spacingVertical:0,verticalAlign:"center",children:[n,s.jsx(r("MWXRowItem.react"),{expanding:!0,children:s.jsx(r("MWXGlimmer.react"),{index:0,xstyle:c.textGlimmer})})]}),e[2]=a):a=e[2];var i;e[3]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx(r("MWXRow.react"),{wrap:"none",children:s.jsx(r("MWXRowItem.react"),{expanding:!0,children:s.jsx("div",{className:"x16ngw23 xwib8y2",children:s.jsx(r("MWXGlimmer.react"),{index:0,xstyle:c.textGlimmer})})})}),e[3]=i):i=e[3];var l;e[4]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx(r("MWXRow.react"),{direction:"forward",wrap:"none",children:s.jsx(r("MWXRowItem.react"),{expanding:!0,children:s.jsx(r("MWXGlimmer.react"),{index:1,xstyle:c.pinInputGlimmer})})}),e[4]=l):l=e[4];var d;return e[5]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx("div",babelHelpers.extends({},t,{children:s.jsxs(r("MWXColumn.react"),{spacing:8,style:c.root,children:[a,i,l,s.jsx(r("MWXRow.react"),{wrap:"none",children:s.jsx(r("MWXRowItem.react"),{expanding:!0,children:s.jsx("div",{className:"x18xe386 xpdvgm7 x1y1aw1k",children:s.jsx(r("MWXGlimmer.react"),{index:0,xstyle:c.textGlimmer})})})})]})})),e[5]=d):d=e[5],d}l.default=d}),98);
__d("MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query.graphql",[],(function(t,n,r,o,a,i){"use strict";var e={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query",selections:[{kind:"Defer",selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsThreadListRestoreQPWrapper_query"}]}],type:"Query",abstractKey:null};a.exports=e}),null);
__d("useMWEBIsUpsellDeferred",["MWEncryptedBackupsDeferLocalStorageUpsell","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(s||(s=o("react"))).useMemo;function c(t){var n=o("react-compiler-runtime").c(18),a=t.upsellType,l=(e||(e=r("useReStore")))(),s;n[0]!==a?(s=o("MWEncryptedBackupsDeferLocalStorageUpsell").getLocalStorageKeys(a),n[0]=a,n[1]=s):s=n[1];var u=s,c=u.countdownInMS,d=u.impressionsCountKey,m=u.lastImpressionTimeKey,p=u.maxImpressionLimit,_;n[2]!==c||n[3]!==l.tables.experiences_shared_state||n[4]!==m?(_=function(){return o("ReQL").fromTableAscending(l.tables.experiences_shared_state).getKeyRange(m).map(function(e){var t=e.stateValue;return t!=null&&+t+c>Date.now()})},n[2]=c,n[3]=l.tables.experiences_shared_state,n[4]=m,n[5]=_):_=n[5];var f;n[6]!==c||n[7]!==l||n[8]!==m?(f=[c,l,m],n[6]=c,n[7]=l,n[8]=m,n[9]=f):f=n[9];var g=o("ReQLSuspense").useFirst(_,f,i.id+":41"),h;n[10]!==l.tables.experiences_shared_state||n[11]!==d||n[12]!==p?(h=function(){return o("ReQL").fromTableAscending(l.tables.experiences_shared_state).getKeyRange(d).map(function(e){var t=e.stateValue;return!(p===o("MWEncryptedBackupsDeferLocalStorageUpsell").INFINITE_IMPRESSIONS_LIMIT||+t<p)})},n[10]=l.tables.experiences_shared_state,n[11]=d,n[12]=p,n[13]=h):h=n[13];var y;n[14]!==l||n[15]!==d||n[16]!==p?(y=[l,d,p],n[14]=l,n[15]=d,n[16]=p,n[17]=y):y=n[17];var C=o("ReQLSuspense").useFirst(h,y,i.id+":56");return g===!0||C===!0}l.default=c}),98);
__d("useMWEncryptedBackupsIsUpsellDismissed",["MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","MWEncryptedBackupsDeferLocalStorageUpsell","react","react-compiler-runtime","useMWEBIsUpsellDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useState;function u(e){var t=o("react-compiler-runtime").c(5),n=e.upsellType,a=o("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),i=s(!1),l=i[0],u=i[1],c;t[0]!==n?(c={upsellType:n},t[0]=n,t[1]=c):c=t[1];var d=r("useMWEBIsUpsellDeferred")(c),m=o("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices(),p=m.virtualDeviceInfo,_=p.doesUserHaveOtcEligibleDevices;if(a&&n===o("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_WITH_PIN_JEWEL&&!_){var f;return t[2]===Symbol.for("react.memo_cache_sentinel")?(f=[!0,u],t[2]=f):f=t[2],f}var g=d===!0||l,h;return t[3]!==g?(h=[g,u],t[3]=g,t[4]=h):h=t[4],h}l.default=u}),98);
__d("MWEncryptedBackupsThreadListRestoreQPWrapperDeferred.react",["CometPlaceholder.react","CometRelay","EncryptedBackupsSupportedPlatformUtils","MWEBVestaUserInfoContext.react","MWEncryptedBackupsDeferLocalStorageUpsell","MWEncryptedBackupsQPWithPinPlaceholder.react","MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query.graphql","deferredLoadComponent","gkx","react","react-compiler-runtime","requireDeferred","useHasRestoreInterstitialSoftblockBeenDismissed","useMWEBGetUpsellState","useMWEncryptedBackupsIsUpsellDismissed"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react")),c=r("deferredLoadComponent")(r("requireDeferred")("MWEncryptedBackupsThreadListRestoreQPWrapper.react").__setRef("MWEncryptedBackupsThreadListRestoreQPWrapperDeferred.react")),d=r("gkx")("3952");function m(t){var a=o("react-compiler-runtime").c(15),i=t.children,l=t.fragmentKey,s=t.trigger,m=o("CometRelay").useFragment(e!==void 0?e:e=n("MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query.graphql"),l),p=o("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),_=r("useMWEBGetUpsellState")(),f=_.isRestoreUpsellsDismissed,g;a[0]===Symbol.for("react.memo_cache_sentinel")?(g={upsellType:o("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_JEWEL},a[0]=g):g=a[0];var h=r("useMWEncryptedBackupsIsUpsellDismissed")(g),y=h[0],C=h[1],b;a[1]===Symbol.for("react.memo_cache_sentinel")?(b={upsellType:o("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_WITH_PIN_JEWEL},a[1]=b):b=a[1];var v=r("useMWEncryptedBackupsIsUpsellDismissed")(b),S=v[0],R=v[1],L;a[2]===Symbol.for("react.memo_cache_sentinel")?(L={upsellType:o("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.PERSISTENT_BANNER_JEWEL},a[2]=L):L=a[2];var E=r("useMWEncryptedBackupsIsUpsellDismissed")(L),k=E[0],I=E[1],T;a[3]!==p?(T={backupState:4,isCooldownOrLockOutState:p},a[3]=p,a[4]=T):T=a[4];var D=r("useHasRestoreInterstitialSoftblockBeenDismissed")(T),x=o("EncryptedBackupsSupportedPlatformUtils").useMWEncryptedBackupsGetCurrentSupportedPlatform(),$=y||S;if(f||$&&!d||$&&d&&k)return i;var P;a[5]===Symbol.for("react.memo_cache_sentinel")?(P=u.jsx(r("MWEncryptedBackupsQPWithPinPlaceholder.react"),{}),a[5]=P):P=a[5];var N;a[6]!==i||a[7]!==x||a[8]!==m||a[9]!==$||a[10]!==I||a[11]!==C||a[12]!==R||a[13]!==s?(N=u.jsx(r("CometPlaceholder.react"),{fallback:P,name:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred",children:u.jsx(c,{children:i,currentSupportedPlatform:x,fragmentKey:m,hasDismissedQps:$,setHasDismissedBanner:I,setHasDismissedQp:C,setHasDismissedQpWithPin:R,trigger:s})}),a[6]=i,a[7]=x,a[8]=m,a[9]=$,a[10]=I,a[11]=C,a[12]=R,a[13]=s,a[14]=N):N=a[14];var M=N;switch(x){case o("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.INSTAGRAM_DIRECT_INBOX:return i;case o("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.MESSENGER_DOT_COM:case o("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_INBOX:return D?M:i;case o("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM:return M}}l.default=m}),98);
__d("MWEncryptedBackupsThreadListRestoreQPWrapperDeferredWithEBCheck.react",["cr:9938"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:9938")}),98);
__d("MWFDSMarketplace.svg.react",["cr:21707"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:21707")}),98);
__d("useHasUnjoinedCMThreads",["LSIntEnum","ReQL","ReQLSuspense","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(){var t=o("react-compiler-runtime").c(4),n=(s||(s=r("useReStore")))(),a;t[0]!==n.tables.threads?(a=function(){return o("ReQL").union(o("ReQL").fromTableDescending(n.tables.threads.index("threadTypeLastActivityTimestampMs")).getKeyRange((e||(e=o("LSIntEnum"))).ofNumber(24)),o("ReQL").fromTableDescending(n.tables.threads.index("threadTypeLastActivityTimestampMs")).getKeyRange(e.ofNumber(19)))},t[0]=n.tables.threads,t[1]=a):a=t[1];var l;return t[2]!==n?(l=[n],t[2]=n,t[3]=l):l=t[3],!!o("ReQLSuspense").useFirst(a,l,i.id+":22")}l.default=u}),98);
__d("MessengerAsyncStorage",["AsyncStorage"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("AsyncStorage")}),98);
__d("useMWCMVerifyActivityStatusOnMountAndFocus",["FBLogger","I64","LSDict","LSFactory","LSVec","LSVerifyThreadsActivityStatusStoredProcedure","MessengerAsyncStorage","MetaConfig","ServerTime","VisibilityAPI","clearInterval","promiseDone","react","react-compiler-runtime","setInterval","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=s||(s=o("react")),d=c.useCallback,m=c.useEffect,p=c.useMemo,_=c.useRef,f=c.useState,g=1e3*60*60,h=g*3;function y(e){return(u||(u=o("I64"))).add(u.lsl_(u.of_float(e[0]),32),u.of_float(e[1]))}function C(e){return[(u||(u=o("I64"))).to_float(u.lsr_(e,32)),u.to_float(u.and_(e,u.of_int32(4294967295)))]}function b(t,n){var a=o("react-compiler-runtime").c(30),l=(e||(e=r("useReStore")))(),s=_(null),c="__"+t+".fromTimestampMs__",d;a[0]===Symbol.for("react.memo_cache_sentinel")?(d=C((u||(u=o("I64"))).of_float(o("ServerTime").getMillis()-h)),a[0]=d):d=a[0];var p=d,b=f(p),S=b[0],R=b[1],L=_(S),E,k;a[1]!==S?(E=function(){L.current=S},k=[S],a[1]=S,a[2]=E,a[3]=k):(E=a[2],k=a[3]),m(E,k);var I=_(!1),T;a[4]===Symbol.for("react.memo_cache_sentinel")?(T=r("MetaConfig")._("55")?["JOINED_PUBLIC_CHANNELS"]:[],a[4]=T):T=a[4];var D=T,x;if(a[5]!==t){var $=r("MetaConfig")._("95")||t==="ContextSwitcher"?["JOINED_COMMUNITY_CHANNELS"]:[];x=[].concat(D,$),a[5]=t,a[6]=x}else x=a[6];var P=x,N;a[7]!==l||a[8]!==c||a[9]!==P?(N=function(){P.length>0&&r("promiseDone")(r("MessengerAsyncStorage").getItem(c).then(function(e){if(e!=null){var t=JSON.parse(e);t!=null&&r("promiseDone")(l.runInTransaction(function(e){return r("LSVerifyThreadsActivityStatusStoredProcedure")(r("LSFactory")(e),{fromTimestampMs:y(t),serverMode:r("LSVec").ofArray(P),threads:new(r("LSDict"))([])})},"readwrite",void 0,void 0,i.id+":98"))}}).catch(v),function(){I.current=!0;var e=C((u||(u=o("I64"))).of_float(o("ServerTime").getMillis()));r("promiseDone")(r("MessengerAsyncStorage").setItem(c,JSON.stringify(e)),function(){R(e)})})},a[7]=l,a[8]=c,a[9]=P,a[10]=N):N=a[10];var M=N,w;a[11]===Symbol.for("react.memo_cache_sentinel")?(w=function(){s.current!=null&&(r("clearInterval")(s.current),s.current=null)},a[11]=w):w=a[11];var A=w,F;a[12]!==M?(F=function(){if(s.current==null&&r("MetaConfig")._("96")){var e;s.current=r("setInterval")(M,(e=r("MetaConfig")._("43"))!=null?e:g)}},a[12]=M,a[13]=F):F=a[13];var O=F,B;a[14]!==O||a[15]!==M?(B=function(){var e,t=o("ServerTime").getMillis()-(u||(u=o("I64"))).to_float(y(L.current));s.current==null&&O(),t>=((e=r("MetaConfig")._("43"))!=null?e:g)&&M()},a[14]=O,a[15]=M,a[16]=B):B=a[16];var W=B,q;a[17]!==W||a[18]!==n?(q=function(){o("VisibilityAPI").isVisibilityHidden()?A():n&&r("MetaConfig")._("97")&&W()},a[17]=W,a[18]=n,a[19]=q):q=a[19];var U=q,V;a[20]!==O||a[21]!==M||a[22]!==U?(V=function(){var e=null;return I.current||(M(),o("VisibilityAPI").canUseVisibilityAPI&&(e=o("VisibilityAPI").onVisibilityChange(U)),O()),(function(){e!=null&&o("VisibilityAPI").removeVisibiltyChangeListener(e),s.current!=null&&(r("clearInterval")(s.current),s.current=null)})},a[20]=O,a[21]=M,a[22]=U,a[23]=V):V=a[23];var H;a[24]!==W||a[25]!==O||a[26]!==n||a[27]!==M||a[28]!==U?(H=[A,W,O,n,M,U],a[24]=W,a[25]=O,a[26]=n,a[27]=M,a[28]=U,a[29]=H):H=a[29],m(V,H)}function v(e){r("FBLogger")("messenger_web").catching(e).mustfix("Failed to set timestamp for thread activity status")}l.default=b}),98);
__d("useMWInboxContextSwitcherFilterPreloaderCond",["cr:4651","emptyFunction","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){var a=o("react-compiler-runtime").c(1),i;return a[0]===Symbol.for("react.memo_cache_sentinel")?(i={onHoverIn:r("emptyFunction"),onHoverOut:r("emptyFunction"),onPressIn:r("emptyFunction")},a[0]=i):i=a[0],i}var u=(e=n("cr:4651"))!=null?e:s,c=u;l.default=c}),98);
__d("MWInboxContextSwitcher.react",["fbt","C4GFalcoLoggerDeferred","FDSPivotLinkTabs.react","I64","LSIntEnum","LSThreadRangeFilter","MWChatBadgeCountUpdates.react","MWInboxPersistedUIState","MWPBumpEntityKey","MWVerticalRhythm","Promise","gkx","promiseDone","react","react-compiler-runtime","useHasUnjoinedCMThreads","useMWCMVerifyActivityStatusOnMountAndFocus","useMWInboxContextSwitcherFilterPreloaderCond","useReStore","useSinglePartialViewImpression"],(function(t,n,r,o,a,i,l,s){"use strict";var e=["filter","hasNewContentBadge","isShown","logClick","odsAction","overrideTabChange","ref"],u,c,d,m,p,_=p||(p=o("react")),f=p.useEffect,g={tabContainerWithFilters:{paddingTop:"x1y1aw1k",paddingBottom:"xwib8y2",paddingInlineStart:"xwn43p0",paddingInlineEnd:"x1x5flf6",paddingLeft:null,paddingRight:null,$$css:!0},tabWithFilters:{paddingInlineStart:"xyiysdx",paddingInlineEnd:"x14vy60q",paddingLeft:null,paddingRight:null,$$css:!0}};function h(t){var n=o("react-compiler-runtime").c(29),a=t.entryPoint,l=t.onTabChange,u=t.parentThreadKey,p=t.selectedFilterTab,h=t.showMessageRequests,b=t.showNestedFolderThreads,v=(c||(c=r("useReStore")))();r("useMWCMVerifyActivityStatusOnMountAndFocus")("ContextSwitcher",a==="inbox");var S,R;n[0]!==v?(S=function(){r("promiseDone")(v.runInTransaction(C,"readwrite",void 0,void 0,i.id+":83"))},R=[v],n[0]=v,n[1]=S,n[2]=R):(S=n[1],R=n[2]),f(S,R);var L=r("useHasUnjoinedCMThreads")(),E=o("MWInboxPersistedUIState").usePersistedUIState(L,"__MWInboxContextSwitcher.hasViewedSuggestedChats__"),k=E[0],I=E[1],T;n[3]===Symbol.for("react.memo_cache_sentinel")?(T=(d||(d=o("LSIntEnum"))).ofNumber(0),n[3]=T):T=n[3];var D=o("MWChatBadgeCountUpdates.react").useUnseenThreadCount(T),x=D!=null&&D>0,$=o("MWChatBadgeCountUpdates.react").useHasUnseenCommunityThreads(),P=L&&!k,N=a==="jewel"?"jewel_tray":"messenger_inbox",M=a==="inbox"?"jewel_inbox":"chats_inbox",w;n[4]!==M||n[5]!==N?(w={onImpressionStart:function(){o("C4GFalcoLoggerDeferred").logC4GEngagementFalcoEvent({action:"impression",event:"blended_threadlist_community_tab_rendered",parent_surface:M,source:"blended_threadlist_community_tab",surface:N})}},n[4]=M,n[5]=N,n[6]=w):w=n[6];var A=r("useSinglePartialViewImpression")(w),F;n[7]===Symbol.for("react.memo_cache_sentinel")?(F=(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").GROUPS_ONLY),n[7]=F):F=n[7];var O=r("useMWInboxContextSwitcherFilterPreloaderCond")(v,u,F),B=O.onPressIn,W;n[8]===Symbol.for("react.memo_cache_sentinel")?(W=(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").UNREAD_ONLY),n[8]=W):W=n[8];var q=r("useMWInboxContextSwitcherFilterPreloaderCond")(v,u,W),U=q.onPressIn,V;if(n[9]!==a||n[10]!==L||n[11]!==P||n[12]!==$||n[13]!==x||n[14]!==k||n[15]!==A||n[16]!==B||n[17]!==U||n[18]!==l||n[19]!==M||n[20]!==p||n[21]!==I||n[22]!==h||n[23]!==b||n[24]!==N){var H=[{filter:(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").NONE),hasNewContentBadge:x,isShown:!0,label:s._(/*BTDS*/"Todos"),odsAction:"inbox_tab_click"},{filter:d.ofNumber(r("LSThreadRangeFilter").UNREAD_ONLY),hasNewContentBadge:!1,isShown:!0,label:s._(/*BTDS*/"No le\u00eddos"),odsAction:"unread_tab_click",onPressIn:U},{filter:d.ofNumber(r("LSThreadRangeFilter").GROUPS_ONLY),hasNewContentBadge:!1,isShown:!0,label:s._(/*BTDS*/"Grupos"),odsAction:"groups_tab_click",onPressIn:B}].concat(r("gkx")("2165")?[{filter:(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").COMMUNITIES),hasNewContentBadge:$||P,isShown:!0,label:s._(/*BTDS*/"Comunidades"),logClick:function(){o("C4GFalcoLoggerDeferred").logC4GEngagementFalcoEvent({action:"tap",event:"blended_threadlist_community_tab_clicked",parent_surface:M,source:"blended_threadlist_community_tab",surface:N})},odsAction:"communities_tab_click",ref:A}]:[],r("gkx")("6437")?[{filter:(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").DRAFTS),hasNewContentBadge:!1,isShown:!0,label:s._(/*BTDS*/"Borradores"),odsAction:"drafts_tab_click"}]:[],r("gkx")("17132")?[{filter:(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").MARKETPLACE),hasNewContentBadge:!1,isShown:!0,label:s._(/*BTDS*/"Marketplace"),odsAction:"marketplace_tab_click",overrideTabChange:function(){b!=null&&b((d||(d=o("LSIntEnum"))).ofNumber(-12))}},{filter:(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").MESSAGE_REQUESTS),hasNewContentBadge:!1,isShown:!0,label:s._(/*BTDS*/"Solicitudes de mensajes"),odsAction:"message_request_tab_click",overrideTabChange:function(){h==null||h()}}]:[]);V=H.filter(y).map(function(t,n){var i=t.filter,s=t.hasNewContentBadge,u=t.isShown,c=t.logClick,_=t.odsAction,f=t.overrideTabChange,h=t.ref,y=babelHelpers.objectWithoutPropertiesLoose(t,e);return babelHelpers.extends({},y,{hasNewContentBadge:s,onPress:function(){if((m||(m=o("I64"))).equal(i,(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").COMMUNITIES))&&L&&!k&&I(!0),o("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.contextswitcher."+a,_),c==null||c(),f!=null){f();return}l(i)},ref:h,selected:(m||(m=o("I64"))).equal(i,p),testid:(m||(m=o("I64"))).equal(i,(d||(d=o("LSIntEnum"))).ofNumber(r("LSThreadRangeFilter").COMMUNITIES))?"communities_tab":void 0,xstyle:g.tabWithFilters})}),n[9]=a,n[10]=L,n[11]=P,n[12]=$,n[13]=x,n[14]=k,n[15]=A,n[16]=B,n[17]=U,n[18]=l,n[19]=M,n[20]=p,n[21]=I,n[22]=h,n[23]=b,n[24]=N,n[25]=V}else V=n[25];var G=V;if(G.length<=1){var z;return n[26]===Symbol.for("react.memo_cache_sentinel")?(z=_.jsx(r("MWVerticalRhythm"),{height:8}),n[26]=z):z=n[26],z}var j;return n[27]!==G?(j=_.jsx(r("FDSPivotLinkTabs.react"),{linkType:"deemphasized",tabs:G,tabsContainerStyle:g.tabContainerWithFilters}),n[27]=G,n[28]=j):j=n[28],j}function y(e){return e.isShown}function C(e){return(u||(u=n("Promise"))).resolve()}l.default=h}),226);
__d("MWXIconMarketplace",["MWXSvgIcon","SVGIcon","cr:22393","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MWXSvgIcon").mwxSvgIcon(o("SVGIcon").svgIcon(n("cr:22393")),r("gkx")("23219"));l.default=e}),98);
__d("MWThreadListMarketplaceItem.react",["fbt","CometMarketplaceLogger","LSContactBitOffset","LSIntEnum","MWPBumpEntityKey","MWThreadListFolderItem.react","MWXIconGroup","MWXIconMarketplace","MWXIconStrict.react","ReQL","ReQLSuspense","react","react-compiler-runtime","useLogMarketplaceClick","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d=c||(c=o("react")),m=c.useEffect;function p(t){var n=o("react-compiler-runtime").c(27),a=t.onClick,l=t.responsive,c=t.selected,p=t.size,g=t.thread,h=r("useLogMarketplaceClick")("marketplace_inbox_folder"),y=(e||(e=r("useReStore")))(),C;n[0]!==y.tables._user_info?(C=function(){return o("ReQL").fromTableAscending(y.tables._user_info).map(f)},n[0]=y.tables._user_info,n[1]=C):C=n[1];var b;n[2]!==y?(b=[y],n[2]=y,n[3]=b):b=n[3];var v=o("ReQLSuspense").useFirst(C,b,i.id+":51"),S;n[4]!==y.tables.contacts||n[5]!==v?(S=function(){return v!=null?o("ReQL").fromTableAscending(y.tables.contacts,[].concat(o("LSContactBitOffset").contactCapabilityFields)).getKeyRange(v):o("ReQL").empty()},n[4]=y.tables.contacts,n[5]=v,n[6]=S):S=n[6];var R;n[7]!==y||n[8]!==v?(R=[y,v],n[7]=y,n[8]=v,n[9]=R):R=n[9];var L=o("ReQLSuspense").useFirst(S,R,i.id+":56"),E=L!=null&&o("LSContactBitOffset").has(86,L),k;n[10]===Symbol.for("react.memo_cache_sentinel")?(k=[],n[10]=k):k=n[10],m(_,k);var I;n[11]===Symbol.for("react.memo_cache_sentinel")?(I=s._(/*BTDS*/"Marketplace").toString(),n[11]=I):I=n[11];var T=I,D=r("MWXIconMarketplace");if(E===!0){var x;n[12]===Symbol.for("react.memo_cache_sentinel")?(x=s._(/*BTDS*/"_j[\"Grupos de compraventa\",\"3a9a1e192465754ec4427995fe1cffb4\",1]").toString(),n[12]=x):x=n[12],T=x,D=r("MWXIconGroup")}var $;n[13]!==D?($=d.jsx(r("MWXIconStrict.react"),{color:"primary",icon:D,size:36}),n[13]=D,n[14]=$):$=n[14];var P;n[15]!==h||n[16]!==a?(P=function(){return h(),a((u||(u=o("LSIntEnum"))).ofNumber(-12)),o("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","marketplace_threads")},n[15]=h,n[16]=a,n[17]=P):P=n[17];var N;n[18]===Symbol.for("react.memo_cache_sentinel")?(N=(u||(u=o("LSIntEnum"))).ofNumber(-12),n[18]=N):N=n[18];var M;return n[19]!==l||n[20]!==c||n[21]!==p||n[22]!==$||n[23]!==P||n[24]!==g||n[25]!==T?(M=d.jsx(r("MWThreadListFolderItem.react"),{icon:$,onClick:P,responsive:l,selected:c,size:p,systemFolder:N,thread:g,threadName:T}),n[19]=l,n[20]=c,n[21]=p,n[22]=$,n[23]=P,n[24]=g,n[25]=T,n[26]=M):M=n[26],M}function _(){return o("CometMarketplaceLogger").logImpression("marketplace_inbox_folder")}function f(e){return e.facebookUserId}l.default=p}),226);
__d("useHasOTCEligibleDevicesFromReStore",["MAWOneTimeCodeGating","ReQL","ReQLSuspense","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var t=o("react-compiler-runtime").c(8),n=(e||(e=r("useReStore")))(),a;t[0]!==n.tables.encrypted_backups?(a=function(){return o("ReQL").fromTableAscending(n.tables.encrypted_backups)},t[0]=n.tables.encrypted_backups,t[1]=a):a=t[1];var l;t[2]!==n?(l=[n],t[2]=n,t[3]=l):l=t[3];var s=o("ReQLSuspense").useFirst(a,l,i.id+":21"),u;t[4]!==s?(u=s==null||!o("MAWOneTimeCodeGating").isOneTimeCodeEnabled()?!1:s.hasOtcEligibleDevices,t[4]=s,t[5]=u):u=t[5];var c;return t[6]!==u?(c={hasOtcEligibleDevices:u},t[6]=u,t[7]=c):c=t[7],c}l.default=s}),98);
__d("useMWInboxContextSwitcherFilterPreloader",["MWPBaseThreadListHooks","MWPBaseThreadListUtils","react","react-compiler-runtime","useCometPreloader"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.useCallback,c=s.useMemo;function d(e,t,n){var a=o("react-compiler-runtime").c(12),i=o("MWPBaseThreadListHooks").useMWPBaseThreadListDefaultThreadsRange(e,t,n),l;a[0]!==e||a[1]!==i||a[2]!==n||a[3]!==t?(l=function(){i==null&&o("MWPBaseThreadListUtils").loadMoreThreadsForEmptyRangeDefault(e,t,n)},a[0]=e,a[1]=i,a[2]=n,a[3]=t,a[4]=l):l=a[4];var s=l,u=r("useCometPreloader")("button",s,s),c=u.onHighIntentPreloader,d=u.onHoverInPreloader,m=u.onHoverOutPreloader,p=u.onPressInPreloader,_;a[5]!==c||a[6]!==d?(_=function(t){d(t),c(!0)},a[5]=c,a[6]=d,a[7]=_):_=a[7];var f;return a[8]!==m||a[9]!==p||a[10]!==_?(f={onHoverIn:_,onHoverOut:m,onPressIn:p},a[8]=m,a[9]=p,a[10]=_,a[11]=f):f=a[11],f}l.default=d}),98);
__d("useMWJewelSettingsButtonSecurityAlertsBadge",["FDSBadge.react","react","react-compiler-runtime","useDeviceAlertCount","useMAWSecurityAlertsPreferences"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useMemo;function c(){var e=o("react-compiler-runtime").c(5),t=r("useMAWSecurityAlertsPreferences")(),n=t.securityAlertsPreferences,a=o("useDeviceAlertCount").useDeviceAlertCount();n==null||n.allowSecurityAlertForSelf;var i;e[0]!==(n==null?void 0:n.allowSecurityAlertForSelf)||e[1]!==a?(i=n!=null&&n.allowSecurityAlertForSelf&&a>0?s.jsx("div",{className:"x12u5thl x10l6tqk x12ibf10",children:s.jsx(r("FDSBadge.react"),{testid:void 0})}):null,e[0]=n==null?void 0:n.allowSecurityAlertForSelf,e[1]=a,e[2]=i):i=e[2];var l;return e[3]!==i?(l={badge:i},e[3]=i,e[4]=l):l=e[4],l}l.default=c}),98);